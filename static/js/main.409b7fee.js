/*! For license information please see main.409b7fee.js.LICENSE.txt */
(()=>{var __webpack_modules__={79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},217:e=>{"use strict";function t(e){return"undefined"!==typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function o(e,r,o){t[0]=e,r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2],r[o+3]=n[3]}function a(e,r,o){t[0]=e,r[o]=n[3],r[o+1]=n[2],r[o+2]=n[1],r[o+3]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function i(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?o:a,e.writeFloatBE=r?a:o,e.readFloatLE=r?s:i,e.readFloatBE=r?i:s}():function(){function t(e,t,n,r){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var a=Math.floor(Math.log(t)/Math.LN2);e((o<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,n,r)}}function s(e,t,n){var r=e(t,n),o=2*(r>>31)+1,a=r>>>23&255,s=8388607&r;return 255===a?s?NaN:o*(1/0):0===a?1401298464324817e-60*o*s:o*Math.pow(2,a-150)*(s+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=s.bind(null,o),e.readFloatBE=s.bind(null,a)}(),"undefined"!==typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function o(e,r,o){t[0]=e,r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2],r[o+3]=n[3],r[o+4]=n[4],r[o+5]=n[5],r[o+6]=n[6],r[o+7]=n[7]}function a(e,r,o){t[0]=e,r[o]=n[7],r[o+1]=n[6],r[o+2]=n[5],r[o+3]=n[4],r[o+4]=n[3],r[o+5]=n[2],r[o+6]=n[1],r[o+7]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function i(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?o:a,e.writeDoubleBE=r?a:o,e.readDoubleLE=r?s:i,e.readDoubleBE=r?i:s}():function(){function t(e,t,n,r,o,a){var s=r<0?1:0;if(s&&(r=-r),0===r)e(0,o,a+t),e(1/r>0?0:2147483648,o,a+n);else if(isNaN(r))e(0,o,a+t),e(2146959360,o,a+n);else if(r>17976931348623157e292)e(0,o,a+t),e((s<<31|2146435072)>>>0,o,a+n);else{var i;if(r<22250738585072014e-324)e((i=r/5e-324)>>>0,o,a+t),e((s<<31|i/4294967296)>>>0,o,a+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(i=r*Math.pow(2,-c))>>>0,o,a+t),e((s<<31|c+1023<<20|1048576*i&1048575)>>>0,o,a+n)}}}function s(e,t,n,r,o){var a=e(r,o+t),s=e(r,o+n),i=2*(s>>31)+1,c=s>>>20&2047,l=4294967296*(1048575&s)+a;return 2047===c?l?NaN:i*(1/0):0===c?5e-324*i*l:i*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=s.bind(null,o,0,4),e.readDoubleBE=s.bind(null,a,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},579:(e,t,n)=>{"use strict";e.exports=n(2799)},1099:(e,t,n)=>{"use strict";e.exports=n(9191)},1156:e=>{e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,s,i=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},1234:()=>{},1311:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xorwow=i}(0,e=n.nmd(e),n.amdD)},1351:()=>{},1368:e=>{"use strict";e.exports={}},1509:function(e,t,n){"use strict";var r=t;function o(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;++o)void 0!==e[r[o]]&&n||(e[r[o]]=t[r[o]]);return e}function a(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&o(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(4762),r.base64=n(6762),r.EventEmitter=n(7351),r.float=n(217),r.inquire=n(4882),r.utf8=n(8626),r.pool=n(6931),r.LongBits=n(6350),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"===typeof e||e instanceof String},r.isObject=function(e){return e&&"object"===typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"===typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"===typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=o,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=a,r.ProtocolError=a("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},1637:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xor128=i}(0,e=n.nmd(e),n.amdD)},2308:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new a(e),r=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.alea=i}(0,e=n.nmd(e),n.amdD)},2405:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xor128=i}(0,e=n.nmd(e),n.amdD)},2430:(e,t,n)=>{var r;!function(o,a){var s,i=(0,eval)("this"),c=256,l="random",u=a.pow(c,6),h=a.pow(2,52),d=2*h,p=255;function f(e,t,n){var r=[],p=b(y((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(o)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(c):(e=new Uint8Array(c),(i.crypto||i.msCrypto).getRandomValues(e)),v(e)}catch(r){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,v(o)]}}():e,3),r),f=new m(r),w=function(){for(var e=f.g(6),t=u,n=0;e<h;)e=(e+n)*c,t*=c,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return w.int32=function(){return 0|f.g(4)},w.quick=function(){return f.g(4)/4294967296},w.double=w,b(v(f.S),o),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a[l]=e,t):e})(w,p,"global"in t?t.global:this==a,t.state)}function m(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<c;)s[o]=o++;for(o=0;o<c;o++)s[o]=s[a=p&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=p&o+1],n=n*c+s[p&(s[o]=s[a=p&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(c)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function y(e,t){var n,r=[],o=typeof e;if(t&&"object"==o)for(n in e)try{r.push(y(e[n],t-1))}catch(a){}return r.length?r:"string"==o?e:e+"\0"}function b(e,t){for(var n,r=e+"",o=0;o<r.length;)t[p&o]=p&(n^=19*t[p&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a["seed"+l]=f,b(a.random(),o),e.exports){e.exports=f;try{s=n(1234)}catch(w){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},2799:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(e,t,r){var o=null;if(void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),"key"in t)for(var a in r={},t)"key"!==a&&(r[a]=t[a]);else r=t;return t=r.ref,{$$typeof:n,type:e,key:o,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=o,t.jsxs=o},2809:(e,t,n)=>{var r;!function(o,a){var s,i=this,c=256,l="random",u=a.pow(c,6),h=a.pow(2,52),d=2*h,p=255;function f(e,t,n){var r=[],p=b(y((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(o)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(c):(e=new Uint8Array(c),(i.crypto||i.msCrypto).getRandomValues(e)),v(e)}catch(r){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,v(o)]}}():e,3),r),f=new m(r),w=function(){for(var e=f.g(6),t=u,n=0;e<h;)e=(e+n)*c,t*=c,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return w.int32=function(){return 0|f.g(4)},w.quick=function(){return f.g(4)/4294967296},w.double=w,b(v(f.S),o),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a[l]=e,t):e})(w,p,"global"in t?t.global:this==a,t.state)}function m(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<c;)s[o]=o++;for(o=0;o<c;o++)s[o]=s[a=p&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=p&o+1],n=n*c+s[p&(s[o]=s[a=p&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(c)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function y(e,t){var n,r=[],o=typeof e;if(t&&"object"==o)for(n in e)try{r.push(y(e[n],t-1))}catch(a){}return r.length?r:"string"==o?e:e+"\0"}function b(e,t){for(var n,r=e+"",o=0;o<r.length;)t[p&o]=p&(n^=19*t[p&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a["seed"+l]=f,b(a.random(),o),e.exports){e.exports=f;try{s=n(3857)}catch(w){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},2987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3175:(e,t)=>{"use strict";const n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,r=/^[\u0021-\u003A\u003C-\u007E]*$/,o=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,a=/^[\u0020-\u003A\u003D-\u007E]*$/,s=Object.prototype.toString,i=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function c(e,t,n){do{const n=e.charCodeAt(t);if(32!==n&&9!==n)return t}while(++t<n);return n}function l(e,t,n){for(;t>n;){const n=e.charCodeAt(--t);if(32!==n&&9!==n)return t+1}return n}function u(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},3338:(e,t,n)=>{"use strict";e.exports=c;var r,o=n(1509),a=o.LongBits,s=o.utf8;function i(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l="undefined"!==typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},u=function(){return o.Buffer?function(e){return(c.create=function(e){return o.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function h(){var e=new a(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw i(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw i(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw i(this,8);return new a(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,c.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,i(this,10);return e}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw i(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw i(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw i(this,4);var e=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw i(this,4);var e=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw i(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},c.prototype.skip=function(e){if("number"===typeof e){if(this.pos+e>this.len)throw i(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw i(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!==(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=u(),r._configure();var t=o.Long?"toLong":"toNumber";o.merge(c.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},3457:(e,t,n)=>{"use strict";var r=n(1099),o=r.Reader,a=r.Writer,s=r.util,i=r.roots.default||(r.roots.default={});i.tensorflow=function(){var e={};return e.magenta=function(){var e={};return e.NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=s.emptyArray,e.prototype.keySignatures=s.emptyArray,e.prototype.tempos=s.emptyArray,e.prototype.notes=s.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=s.emptyArray,e.prototype.controlChanges=s.emptyArray,e.prototype.partInfos=s.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=s.emptyArray,e.prototype.sectionAnnotations=s.emptyArray,e.prototype.sectionGroups=s.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)i.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)i.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)i.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)i.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)i.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)i.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)i.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&i.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)i.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&i.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&i.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&i.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)i.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)i.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=s.Long?e.int64().toNumber():e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(i.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(i.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(i.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(i.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=s.Long?e.int64().toNumber():e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(i.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(i.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(i.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=i.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(i.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(i.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(i.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=i.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=i.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=i.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!s.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!s.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!s.isInteger(e.referenceNumber)&&!(e.referenceNumber&&s.isInteger(e.referenceNumber.low)&&s.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!s.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!s.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t){if(n=i.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t){if(n=i.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t){if(n=i.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t){if(n=i.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!==typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!s.isInteger(e.totalQuantizedSteps)&&!(e.totalQuantizedSteps&&s.isInteger(e.totalQuantizedSteps.low)&&s.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t){if(n=i.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t){if(n=i.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t){if(n=i.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=i.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t){if(n=i.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t){if(n=i.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=i.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=i.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo)))return"quantizationInfo."+n;if(null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=i.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo)))return"subsequenceInfo."+n;if(null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=i.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata)))return"sequenceMetadata."+n;return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence)return e;var t=new i.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(s.Long?(t.referenceNumber=s.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"===typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"===typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"===typeof e.referenceNumber&&(t.referenceNumber=new s.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!==typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=i.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");t.keySignatures=[];for(n=0;n<e.keySignatures.length;++n){if("object"!==typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=i.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");t.tempos=[];for(n=0;n<e.tempos.length;++n){if("object"!==typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=i.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");t.notes=[];for(n=0;n<e.notes.length;++n){if("object"!==typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=i.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(s.Long?(t.totalQuantizedSteps=s.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"===typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"===typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"===typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new s.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");t.pitchBends=[];for(n=0;n<e.pitchBends.length;++n){if("object"!==typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=i.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");t.controlChanges=[];for(n=0;n<e.controlChanges.length;++n){if("object"!==typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=i.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");t.partInfos=[];for(n=0;n<e.partInfos.length;++n){if("object"!==typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=i.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!==typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=i.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");t.textAnnotations=[];for(n=0;n<e.textAnnotations.length;++n){if("object"!==typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=i.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");t.sectionAnnotations=[];for(n=0;n<e.sectionAnnotations.length;++n){if("object"!==typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=i.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");t.sectionGroups=[];for(n=0;n<e.sectionGroups.length;++n){if("object"!==typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=i.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!==typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=i.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!==typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=i.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!==typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=i.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,s.Long){var r=new s.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;if(n.subsequenceInfo=null,s.Long){r=new s.Long(0,0,!1);n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.referenceNumber=t.longs===String?"0":0;n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var o=0;o<e.timeSignatures.length;++o)n.timeSignatures[o]=i.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[o],t)}if(e.keySignatures&&e.keySignatures.length){n.keySignatures=[];for(o=0;o<e.keySignatures.length;++o)n.keySignatures[o]=i.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[o],t)}if(e.tempos&&e.tempos.length){n.tempos=[];for(o=0;o<e.tempos.length;++o)n.tempos[o]=i.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[o],t)}if(e.notes&&e.notes.length){n.notes=[];for(o=0;o<e.notes.length;++o)n.notes[o]=i.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[o],t)}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length){n.pitchBends=[];for(o=0;o<e.pitchBends.length;++o)n.pitchBends[o]=i.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[o],t)}if(e.controlChanges&&e.controlChanges.length){n.controlChanges=[];for(o=0;o<e.controlChanges.length;++o)n.controlChanges[o]=i.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[o],t)}if(e.partInfos&&e.partInfos.length){n.partInfos=[];for(o=0;o<e.partInfos.length;++o)n.partInfos[o]=i.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[o],t)}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=i.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length){n.textAnnotations=[];for(o=0;o<e.textAnnotations.length;++o)n.textAnnotations[o]=i.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[o],t)}if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=i.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"===typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?s.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new s.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=i.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"===typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?s.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new s.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=i.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length){n.sectionAnnotations=[];for(o=0;o<e.sectionAnnotations.length;++o)n.sectionAnnotations[o]=i.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[o],t)}if(e.sectionGroups&&e.sectionGroups.length){n.sectionGroups=[];for(o=0;o<e.sectionGroups.length;++o)n.sectionGroups[o]=i.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[o],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=s.Long?e.int64().toNumber():e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=s.Long?e.int64().toNumber():e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!s.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!s.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!==typeof e.startTime?"startTime: number expected":null==e.quantizedStartStep||!e.hasOwnProperty("quantizedStartStep")||s.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&s.isInteger(e.quantizedStartStep.low)&&s.isInteger(e.quantizedStartStep.high)?null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!==typeof e.endTime?"endTime: number expected":null==e.quantizedEndStep||!e.hasOwnProperty("quantizedEndStep")||s.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&s.isInteger(e.quantizedEndStep.low)&&s.isInteger(e.quantizedEndStep.high)?null!=e.numerator&&e.hasOwnProperty("numerator")&&!s.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!s.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!s.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!s.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!==typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!s.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!s.isInteger(e.voice)?"voice: integer expected":null:"quantizedEndStep: integer|Long expected":"quantizedStartStep: integer|Long expected"},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.Note)return e;var t=new i.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(s.Long?(t.quantizedStartStep=s.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"===typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"===typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"===typeof e.quantizedStartStep&&(t.quantizedStartStep=new s.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(s.Long?(t.quantizedEndStep=s.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"===typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"===typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"===typeof e.quantizedEndStep&&(t.quantizedEndStep=new s.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,s.Long){var r=new s.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;if(s.Long){r=new s.Long(0,0,!1);n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?i.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"===typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?s.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new s.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"===typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?s.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new s.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.PitchName=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PITCH_NAME"]=0,t[e[1]="F_FLAT_FLAT"]=1,t[e[2]="C_FLAT_FLAT"]=2,t[e[3]="G_FLAT_FLAT"]=3,t[e[4]="D_FLAT_FLAT"]=4,t[e[5]="A_FLAT_FLAT"]=5,t[e[6]="E_FLAT_FLAT"]=6,t[e[7]="B_FLAT_FLAT"]=7,t[e[8]="F_FLAT"]=8,t[e[9]="C_FLAT"]=9,t[e[10]="G_FLAT"]=10,t[e[11]="D_FLAT"]=11,t[e[12]="A_FLAT"]=12,t[e[13]="E_FLAT"]=13,t[e[14]="B_FLAT"]=14,t[e[15]="F"]=15,t[e[16]="C"]=16,t[e[17]="G"]=17,t[e[18]="D"]=18,t[e[19]="A"]=19,t[e[20]="E"]=20,t[e[21]="B"]=21,t[e[22]="F_SHARP"]=22,t[e[23]="C_SHARP"]=23,t[e[24]="G_SHARP"]=24,t[e[25]="D_SHARP"]=25,t[e[26]="A_SHARP"]=26,t[e[27]="E_SHARP"]=27,t[e[28]="B_SHARP"]=28,t[e[29]="F_SHARP_SHARP"]=29,t[e[30]="C_SHARP_SHARP"]=30,t[e[31]="G_SHARP_SHARP"]=31,t[e[32]="D_SHARP_SHARP"]=32,t[e[33]="A_SHARP_SHARP"]=33,t[e[34]="E_SHARP_SHARP"]=34,t[e[35]="B_SHARP_SHARP"]=35,t}(),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!s.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!s.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new i.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new i.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?i.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?i.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!==typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new i.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!s.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!s.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!s.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!==typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new i.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=s.Long?e.int64().toNumber():e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null==e.quantizedStep||!e.hasOwnProperty("quantizedStep")||s.isInteger(e.quantizedStep)||e.quantizedStep&&s.isInteger(e.quantizedStep.low)&&s.isInteger(e.quantizedStep.high)?null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!s.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!s.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!s.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!s.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!==typeof e.isDrum?"isDrum: boolean expected":null:"quantizedStep: integer|Long expected"},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new i.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(s.Long?(t.quantizedStep=s.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"===typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"===typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"===typeof e.quantizedStep&&(t.quantizedStep=new s.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,s.Long){var r=new s.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"===typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?s.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new s.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!s.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!s.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new i.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new i.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?i.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?i.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?i.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=s.Long?e.int64().toNumber():e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!s.isInteger(e.quantizedStep)&&!(e.quantizedStep&&s.isInteger(e.quantizedStep.low)&&s.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!s.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new i.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(s.Long?(t.quantizedStep=s.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"===typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"===typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"===typeof e.quantizedStep&&(t.quantizedStep=new s.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,s.Long){var r=new s.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?i.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"===typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?s.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new s.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:s.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:s.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!s.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!s.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new i.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!==typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!==typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new i.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=s.Long?s.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=s.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null==e.sectionId||!e.hasOwnProperty("sectionId")||s.isInteger(e.sectionId)||e.sectionId&&s.isInteger(e.sectionId.low)&&s.isInteger(e.sectionId.high)?null:"sectionId: integer|Long expected"},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new i.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(s.Long?(t.sectionId=s.Long.fromValue(e.sectionId)).unsigned=!1:"string"===typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"===typeof e.sectionId?t.sectionId=e.sectionId:"object"===typeof e.sectionId&&(t.sectionId=new s.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,s.Long){var r=new s.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"===typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?s.Long.prototype.toString.call(e.sectionId):t.longs===Number?new s.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=s.Long?s.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:s.oneOfGetter(t=["sectionId","sectionGroup"]),set:s.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&i.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.sectionId=s.Long?e.int64().toNumber():e.int64();break;case 2:r.sectionGroup=i.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!s.isInteger(e.sectionId)&&!(e.sectionId&&s.isInteger(e.sectionId.low)&&s.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=i.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.Section)return e;var t=new i.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(s.Long?(t.sectionId=s.Long.fromValue(e.sectionId)).unsigned=!1:"string"===typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"===typeof e.sectionId?t.sectionId=e.sectionId:"object"===typeof e.sectionId&&(t.sectionId=new s.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!==typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=i.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"===typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?s.Long.prototype.toString.call(e.sectionId):t.longs===Number?new s.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=i.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=s.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)i.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(i.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=i.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!s.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new i.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!==typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=i.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=i.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e}(),e.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=s.emptyArray,e.prototype.composers=s.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.SequenceMetadata;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!s.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!s.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!s.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!s.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.SequenceMetadata)return e;var t=new i.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");t.composers=[];for(n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length){n.composers=[];for(r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r]}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new i.tensorflow.magenta.VelocityRange;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.min=e.int32();break;case 2:r.max=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!s.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!s.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof i.tensorflow.magenta.VelocityRange)return e;var t=new i.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e}(),e}(),e.exports=i},3694:(e,t,n)=>{"use strict";e.exports=o;var r=n(1509);function o(e,t,n){if("function"!==typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(o.prototype=Object.create(r.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function e(t,n,o,a,s){if(!a)throw TypeError("request must be specified");var i=this;if(!s)return r.asPromise(e,i,t,n,o,a);if(i.rpcImpl)try{return i.rpcImpl(t,n[i.requestDelimited?"encodeDelimited":"encode"](a).finish(),(function(e,n){if(e)return i.emit("error",e,t),s(e);if(null!==n){if(!(n instanceof o))try{n=o[i.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return i.emit("error",e,t),s(e)}return i.emit("data",n,t),s(null,n)}i.end(!0)}))}catch(c){return i.emit("error",c,t),void setTimeout((function(){s(c)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},o.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},3738:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3857:()=>{},3931:(e,t,n)=>{"use strict";e.exports=a;var r=n(5850);(a.prototype=Object.create(r.prototype)).constructor=a;var o=n(1509);function a(){r.call(this)}function s(e,t,n){e.length<40?o.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}a._configure=function(){a.alloc=o._Buffer_allocUnsafe,a.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&"set"===o.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},a.prototype.bytes=function(e){o.isString(e)&&(e=o._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(a.writeBytesBuffer,t,e),this},a.prototype.string=function(e){var t=o.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},a._configure()},3998:function(e,t,n){!function(e,t,n,r){"use strict";var o=function(e,t,n){return{endTime:t,insertTime:n,type:"exponentialRampToValue",value:e}},a=function(e,t,n){return{endTime:t,insertTime:n,type:"linearRampToValue",value:e}},s=function(e,t){return{startTime:t,type:"setValue",value:e}},i=function(e,t,n){return{duration:n,startTime:t,type:"setValueCurve",values:e}},c=function(e,t,n){var r=n.startTime,o=n.target,a=n.timeConstant;return o+(t-o)*Math.exp((r-e)/a)},l=function(e){return"exponentialRampToValue"===e.type},u=function(e){return"linearRampToValue"===e.type},h=function(e){return l(e)||u(e)},d=function(e){return"setValue"===e.type},p=function(e){return"setValueCurve"===e.type},f=function(e,t,n,r){var o=e[t];return void 0===o?r:h(o)||d(o)?o.value:p(o)?o.values[o.values.length-1]:c(n,f(e,t-1,o.startTime,r),o)},m=function(e,t,n,r,o){return void 0===n?[r.insertTime,o]:h(n)?[n.endTime,n.value]:d(n)?[n.startTime,n.value]:p(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,f(e,t-1,n.startTime,o)]},g=function(e){return"cancelAndHold"===e.type},y=function(e){return"cancelScheduledValues"===e.type},b=function(e){return g(e)||y(e)?e.cancelTime:l(e)||u(e)?e.endTime:e.startTime},v=function(e,t,n,r){var o=r.endTime,a=r.value;return n===a?a:0<n&&0<a||n<0&&a<0?n*Math.pow(a/n,(e-t)/(o-t)):0},w=function(e,t,n,r){return n+(e-t)/(r.endTime-t)*(r.value-n)},x=function(e,t){var n=Math.floor(t),r=Math.ceil(t);return n===r?e[n]:(1-(t-n))*e[n]+(1-(r-t))*e[r]},k=function(e,t){var n=t.duration,r=t.startTime,o=t.values,a=(e-r)/n*(o.length-1);return x(o,a)},S=function(e){return"setTarget"===e.type},_=function(){function e(t){n(this,e),this._automationEvents=[],this._currenTime=0,this._defaultValue=t}return r(e,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(e){var t=b(e);if(g(e)||y(e)){var n=this._automationEvents.findIndex((function(n){return y(e)&&p(n)?n.startTime+n.duration>=t:b(n)>=t})),r=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),g(e)){var c=this._automationEvents[this._automationEvents.length-1];if(void 0!==r&&h(r)){if(void 0!==c&&S(c))throw new Error("The internal list is malformed.");var d=void 0===c?r.insertTime:p(c)?c.startTime+c.duration:b(c),f=void 0===c?this._defaultValue:p(c)?c.values[c.values.length-1]:c.value,m=l(r)?v(t,d,f,r):w(t,d,f,r),x=l(r)?o(m,t,this._currenTime):a(m,t,this._currenTime);this._automationEvents.push(x)}if(void 0!==c&&S(c)&&this._automationEvents.push(s(this.getValue(t),t)),void 0!==c&&p(c)&&c.startTime+c.duration>t){var k=t-c.startTime,_=(c.values.length-1)/c.duration,C=Math.max(2,1+Math.ceil(k*_)),I=k/(C-1)*_,T=c.values.slice(0,C);if(I<1)for(var N=1;N<C;N+=1){var E=I*N%1;T[N]=c.values[N-1]*(1-E)+c.values[N]*E}this._automationEvents[this._automationEvents.length-1]=i(T,c.startTime,k)}}}else{var A=this._automationEvents.findIndex((function(e){return b(e)>t})),R=-1===A?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[A-1];if(void 0!==R&&p(R)&&b(R)+R.duration>t)return!1;var O=l(e)?o(e.value,e.endTime,this._currenTime):u(e)?a(e.value,t,this._currenTime):e;if(-1===A)this._automationEvents.push(O);else{if(p(e)&&t+e.duration>b(this._automationEvents[A]))return!1;this._automationEvents.splice(A,0,O)}}return!0}},{key:"flush",value:function(e){var t=this._automationEvents.findIndex((function(t){return b(t)>e}));if(t>1){var n=this._automationEvents.slice(t-1),r=n[0];S(r)&&n.unshift(s(f(this._automationEvents,t-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(e){if(0===this._automationEvents.length)return this._defaultValue;var n=this._automationEvents.findIndex((function(t){return b(t)>e})),r=this._automationEvents[n],o=(-1===n?this._automationEvents.length:n)-1,a=this._automationEvents[o];if(void 0!==a&&S(a)&&(void 0===r||!h(r)||r.insertTime>e))return c(e,f(this._automationEvents,o-1,a.startTime,this._defaultValue),a);if(void 0!==a&&d(a)&&(void 0===r||!h(r)))return a.value;if(void 0!==a&&p(a)&&(void 0===r||!h(r)||a.startTime+a.duration>e))return e<a.startTime+a.duration?k(e,a):a.values[a.values.length-1];if(void 0!==a&&h(a)&&(void 0===r||!h(r)))return a.value;if(void 0!==r&&l(r)){var s=m(this._automationEvents,o,a,r,this._defaultValue),i=t(s,2),g=i[0],y=i[1];return v(e,g,y,r)}if(void 0!==r&&u(r)){var x=m(this._automationEvents,o,a,r,this._defaultValue),_=t(x,2),C=_[0],I=_[1];return w(e,C,I,r)}return this._defaultValue}}])}(),C=function(e){return{cancelTime:e,type:"cancelAndHold"}},I=function(e){return{cancelTime:e,type:"cancelScheduledValues"}},T=function(e,t){return{endTime:t,type:"exponentialRampToValue",value:e}},N=function(e,t){return{endTime:t,type:"linearRampToValue",value:e}},E=function(e,t,n){return{startTime:t,target:e,timeConstant:n,type:"setTarget"}};e.AutomationEventList=_,e.createCancelAndHoldAutomationEvent=C,e.createCancelScheduledValuesAutomationEvent=I,e.createExponentialRampToValueAutomationEvent=T,e.createLinearRampToValueAutomationEvent=N,e.createSetTargetAutomationEvent=E,e.createSetValueAutomationEvent=s,e.createSetValueCurveAutomationEvent=i}(t,n(5715),n(7383),n(4579))},4141:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.tychei=i}(0,e=n.nmd(e),n.amdD)},4288:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function b(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var w=v.prototype=new b;w.constructor=v,m(w,y.prototype),w.isPureReactComponent=!0;var x=Array.isArray,k={H:null,A:null,T:null,S:null,V:null},S=Object.prototype.hasOwnProperty;function _(e,t,r,o,a,s){return r=s.ref,{$$typeof:n,type:e,key:t,ref:void 0!==r?r:null,props:s}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function N(){}function E(e,t,o,a,s){var i=typeof e;"undefined"!==i&&"boolean"!==i||(e=null);var c,l,u=!1;if(null===e)u=!0;else switch(i){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0;break;case d:return E((u=e._init)(e._payload),t,o,a,s)}}if(u)return s=s(e),u=""===a?"."+T(e,0):a,x(s)?(o="",null!=u&&(o=u.replace(I,"$&/")+"/"),E(s,t,o,"",(function(e){return e}))):null!=s&&(C(s)&&(c=s,l=o+(null==s.key||e&&e.key===s.key?"":(""+s.key).replace(I,"$&/")+"/")+u,s=_(c.type,l,void 0,0,0,c.props)),t.push(s)),1;u=0;var h,f=""===a?".":a+":";if(x(e))for(var m=0;m<e.length;m++)u+=E(a=e[m],t,o,i=f+T(a,m),s);else if("function"===typeof(m=null===(h=e)||"object"!==typeof h?null:"function"===typeof(h=p&&h[p]||h["@@iterator"])?h:null))for(e=m.call(e),m=0;!(a=e.next()).done;)u+=E(a=a.value,t,o,i=f+T(a,m++),s);else if("object"===i){if("function"===typeof e.then)return E(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(N,N):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,o,a,s);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function A(e,t,n){if(null==e)return e;var r=[],o=0;return E(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function M(){}t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=o,t.Profiler=s,t.PureComponent=v,t.StrictMode=a,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return k.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var r=m({},e.props),o=e.key;if(null!=t)for(a in void 0!==t.ref&&void 0,void 0!==t.key&&(o=""+t.key),t)!S.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var s=Array(a),i=0;i<a;i++)s[i]=arguments[i+2];r.children=s}return _(e.type,o,void 0,0,0,r)},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:i,_context:e},e},t.createElement=function(e,t,n){var r,o={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)S.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(o[r]=t[r]);var s=arguments.length-2;if(1===s)o.children=n;else if(1<s){for(var i=Array(s),c=0;c<s;c++)i[c]=arguments[c+2];o.children=i}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===o[r]&&(o[r]=s[r]);return _(e,a,void 0,0,0,o)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.T,n={};k.T=n;try{var r=e(),o=k.S;null!==o&&o(n,r),"object"===typeof r&&null!==r&&"function"===typeof r.then&&r.then(M,O)}catch(a){O(a)}finally{k.T=t}},t.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},t.use=function(e){return k.H.use(e)},t.useActionState=function(e,t,n){return k.H.useActionState(e,t,n)},t.useCallback=function(e,t){return k.H.useCallback(e,t)},t.useContext=function(e){return k.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return k.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var r=k.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},t.useId=function(){return k.H.useId()},t.useImperativeHandle=function(e,t,n){return k.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return k.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return k.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return k.H.useMemo(e,t)},t.useOptimistic=function(e,t){return k.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return k.H.useReducer(e,t,n)},t.useRef=function(e){return k.H.useRef(e)},t.useState=function(e){return k.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return k.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return k.H.useTransition()},t.version="19.1.0"},4334:(e,t,n)=>{var r=n(7359),o=n(7066),a=n(9016),s=n(9538),i=n(6288),c=n(5262),l=n(2430);l.alea=r,l.xor128=o,l.xorwow=a,l.xorshift7=s,l.xor4096=i,l.tychei=c,e.exports=l},4391:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(7004)},4461:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.tychei=i}(0,e=n.nmd(e),n.amdD)},4530:()=>{},4579:(e,t,n)=>{var r=n(7736);function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}e.exports=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4762:e=>{"use strict";e.exports=function(e,t){var n=new Array(arguments.length-1),r=0,o=2,a=!0;for(;o<arguments.length;)n[r++]=arguments[o++];return new Promise((function(o,s){n[r]=function(e){if(a)if(a=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];o.apply(null,t)}};try{e.apply(t||null,n)}catch(i){a&&(a=!1,s(i))}}))}},4882:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},5043:(e,t,n)=>{"use strict";e.exports=n(4288)},5262:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.tychei=i}(0,e=n.nmd(e),n.amdD)},5561:function(e,t,n){var r;!function(e,o){function a(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,s,i=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),o=0,a=-32;a<c;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,o=0==(n=i[127&a]^=r+s)?o+1:0);for(o>=128&&(i[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=i[o+34&127],n=i[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[o]=r^n;e.w=s,e.X=i,e.i=o}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&(r.X&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xor4096=i}(0,e=n.nmd(e),n.amdD)},5575:(e,t,n)=>{var r=n(8964),o=n(2405),a=n(1311),s=n(5843),i=n(5561),c=n(4141),l=n(8265);l.alea=r,l.xor128=o,l.xorwow=a,l.xorshift7=s,l.xor4096=i,l.tychei=c,e.exports=l},5715:(e,t,n)=>{var r=n(2987),o=n(1156),a=n(7122),s=n(7752);e.exports=function(e,t){return r(e)||o(e,t)||a(e,t)||s()},e.exports.__esModule=!0,e.exports.default=e.exports},5817:()=>{},5843:function(e,t,n){var r;!function(e,o){function a(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&(r.x&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xorshift7=i}(0,e=n.nmd(e),n.amdD)},5850:(e,t,n)=>{"use strict";e.exports=h;var r,o=n(1509),a=o.LongBits,s=o.base64,i=o.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function l(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return o.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new o.Array(e)},o.Array!==Array&&(h.alloc=o.pool(h.alloc,o.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},f.prototype=Object.create(c.prototype),f.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,a.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=a.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=a.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=a.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(o.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(o.float.writeDoubleLE,8,e)};var y=o.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(o.isString(e)){var n=h.alloc(t=s.length(e));s.decode(e,n,0),e=n}return this.uint32(t)._push(y,t,e)},h.prototype.string=function(e){var t=i.length(e);return t?this.uint32(t)._push(i.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},5896:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<a(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,s=o>>>1;r<s;){var i=2*(r+1)-1,c=e[i],l=i+1,u=e[l];if(0>a(c,n))l<o&&0>a(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[i]=n,r=i);else{if(!(l<o&&0>a(u,n)))break e;e[r]=u,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var i=Date,c=i.now();t.unstable_now=function(){return i.now()-c}}var l=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y=!1,b="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)o(u);else{if(!(t.startTime<=e))break;o(u),t.sortIndex=t.expirationTime,n(l,t)}t=r(u)}}function k(e){if(g=!1,x(e),!m)if(null!==r(l))m=!0,_||(_=!0,S());else{var t=r(u);null!==t&&O(k,t.startTime-e)}}var S,_=!1,C=-1,I=5,T=-1;function N(){return!!y||!(t.unstable_now()-T<I)}function E(){if(y=!1,_){var e=t.unstable_now();T=e;var n=!0;try{e:{m=!1,g&&(g=!1,v(C),C=-1),f=!0;var a=p;try{t:{for(x(e),d=r(l);null!==d&&!(d.expirationTime>e&&N());){var s=d.callback;if("function"===typeof s){d.callback=null,p=d.priorityLevel;var i=s(d.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof i){d.callback=i,x(e),n=!0;break t}d===r(l)&&o(l),x(e)}else o(l);d=r(l)}if(null!==d)n=!0;else{var c=r(u);null!==c&&O(k,c.startTime-e),n=!1}}break e}finally{d=null,p=a,f=!1}n=void 0}}finally{n?S():_=!1}}}if("function"===typeof w)S=function(){w(E)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,R=A.port2;A.port1.onmessage=E,S=function(){R.postMessage(null)}}else S=function(){b(E,0)};function O(e,n){C=b((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,o,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return e={id:h++,callback:o,priorityLevel:e,startTime:a,expirationTime:i=a+i,sortIndex:-1},a>s?(e.sortIndex=a,n(u,e),null===r(l)&&e===r(u)&&(g?(v(C),C=-1):g=!0,O(k,a-s))):(e.sortIndex=i,n(l,e),m||f||(m=!0,_||(_=!0,S()))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},6288:function(e,t,n){var r;!function(e,o){function a(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,s,i=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),o=0,a=-32;a<c;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,o=0==(n=i[127&a]^=r+s)?o+1:0);for(o>=128&&(i[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=i[o+34&127],n=i[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[o]=r^n;e.w=s,e.X=i,e.i=o}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&(r.X&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xor4096=i}(0,e=n.nmd(e),n.amdD)},6350:(e,t,n)=>{"use strict";e.exports=o;var r=n(1509);function o(e,t){this.lo=e>>>0,this.hi=t>>>0}var a=o.zero=new o(0,0);a.toNumber=function(){return 0},a.zzEncode=a.zzDecode=function(){return this},a.length=function(){return 1};var s=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(e){if(0===e)return a;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new o(n,r)},o.from=function(e){if("number"===typeof e)return o.fromNumber(e);if(r.isString(e)){if(!r.Long)return o.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new o(e.low>>>0,e.high>>>0):a},o.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var i=String.prototype.charCodeAt;o.fromHash=function(e){return e===s?a:new o((i.call(e,0)|i.call(e,1)<<8|i.call(e,2)<<16|i.call(e,3)<<24)>>>0,(i.call(e,4)|i.call(e,5)<<8|i.call(e,6)<<16|i.call(e,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},o.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},o.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},6399:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xorwow=i}(0,e=n.nmd(e),n.amdD)},6672:(e,t,n)=>{"use strict";var r=n(5043);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(o(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},i=Symbol.for("react.portal");var c=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(o(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:i,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=c.T,n=s.p;try{if(c.T=null,s.p=2,e)return e()}finally{c.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin),o="string"===typeof t.integrity?t.integrity:void 0,a="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:o,fetchPriority:a}):"script"===n&&s.d.X(e,{crossOrigin:r,integrity:o,fetchPriority:a,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=l(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,r=l(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=l(t.as,t.crossOrigin);s.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return c.H.useFormState(e,t,n)},t.useFormStatus=function(){return c.H.useHostTransitionStatus()},t.version="19.1.0"},6762:(e,t)=>{"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),o=new Array(123),a=0;a<64;)o[r[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;n.encode=function(e,t,n){for(var o,a=null,s=[],i=0,c=0;t<n;){var l=e[t++];switch(c){case 0:s[i++]=r[l>>2],o=(3&l)<<4,c=1;break;case 1:s[i++]=r[o|l>>4],o=(15&l)<<2,c=2;break;case 2:s[i++]=r[o|l>>6],s[i++]=r[63&l],c=0}i>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,s)),i=0)}return c&&(s[i++]=r[o],s[i++]=61,1===c&&(s[i++]=61)),a?(i&&a.push(String.fromCharCode.apply(String,s.slice(0,i))),a.join("")):String.fromCharCode.apply(String,s.slice(0,i))};var s="invalid encoding";n.decode=function(e,t,n){for(var r,a=n,i=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&i>1)break;if(void 0===(l=o[l]))throw Error(s);switch(i){case 0:r=l,i=1;break;case 1:t[n++]=r<<2|(48&l)>>4,r=l,i=2;break;case 2:t[n++]=(15&r)<<4|(60&l)>>2,r=l,i=3;break;case 3:t[n++]=(3&r)<<6|l,i=0}}if(1===i)throw Error(s);return n-a},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},6931:e=>{"use strict";e.exports=function(e,t,n){var r=n||8192,o=r>>>1,a=null,s=r;return function(n){if(n<1||n>o)return e(n);s+n>r&&(a=e(r),s=0);var i=t.call(a,s,s+=n);return 7&s&&(s=1+(7|s)),i}}},7004:(e,t,n)=>{"use strict";var r=n(8853),o=n(5043),a=n(7950);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function c(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(c(e)!==e)throw Error(s(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var d=Object.assign,p=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),w=Symbol.for("react.consumer"),x=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),S=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),I=Symbol.for("react.lazy");Symbol.for("react.scope");var T=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var N=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var E=Symbol.iterator;function A(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=E&&e[E]||e["@@iterator"])?e:null}var R=Symbol.for("react.client.reference");function O(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===R?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case g:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case S:return"Suspense";case _:return"SuspenseList";case T:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case m:return"Portal";case x:return(e.displayName||"Context")+".Provider";case w:return(e._context.displayName||"Context")+".Consumer";case k:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case C:return null!==(t=e.displayName||null)?t:O(e.type)||"Memo";case I:t=e._payload,e=e._init;try{return O(e(t))}catch(n){}}return null}var M=Array.isArray,P=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F={pending:!1,data:null,method:null,action:null},L=[],z=-1;function B(e){return{current:e}}function q(e){0>z||(e.current=L[z],L[z]=null,z--)}function W(e,t){z++,L[z]=e.current,e.current=t}var j=B(null),V=B(null),U=B(null),G=B(null);function H(e,t){switch(W(U,t),W(V,e),W(j,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?oh(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=ah(t=oh(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}q(j),W(j,e)}function K(){q(j),q(V),q(U)}function X(e){null!==e.memoizedState&&W(G,e);var t=j.current,n=ah(t,e.type);t!==n&&(W(V,e),W(j,n))}function Q(e){V.current===e&&(q(j),q(V)),G.current===e&&(q(G),Xh._currentValue=F)}var Y=Object.prototype.hasOwnProperty,J=r.unstable_scheduleCallback,Z=r.unstable_cancelCallback,$=r.unstable_shouldYield,ee=r.unstable_requestPaint,te=r.unstable_now,ne=r.unstable_getCurrentPriorityLevel,re=r.unstable_ImmediatePriority,oe=r.unstable_UserBlockingPriority,ae=r.unstable_NormalPriority,se=r.unstable_LowPriority,ie=r.unstable_IdlePriority,ce=r.log,le=r.unstable_setDisableYieldValue,ue=null,he=null;function de(e){if("function"===typeof ce&&le(e),he&&"function"===typeof he.setStrictMode)try{he.setStrictMode(ue,e)}catch(t){}}var pe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(fe(e)/me|0)|0},fe=Math.log,me=Math.LN2;var ge=256,ye=4194304;function be(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function ve(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var o=0,a=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var i=134217727&r;return 0!==i?0!==(r=i&~a)?o=be(r):0!==(s&=i)?o=be(s):n||0!==(n=i&~e)&&(o=be(n)):0!==(i=r&~a)?o=be(i):0!==s?o=be(s):n||0!==(n=r&~e)&&(o=be(n)),0===o?0:0!==t&&t!==o&&0===(t&a)&&((a=o&-o)>=(n=t&-t)||32===a&&0!==(4194048&n))?t:o}function we(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function xe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ke(){var e=ge;return 0===(4194048&(ge<<=1))&&(ge=256),e}function Se(){var e=ye;return 0===(62914560&(ye<<=1))&&(ye=4194304),e}function _e(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ce(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ie(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-pe(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194090&n}function Te(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-pe(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}function Ne(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ee(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Ae(){var e=D.p;return 0!==e?e:void 0===(e=window.event)?32:ld(e.type)}var Re=Math.random().toString(36).slice(2),Oe="__reactFiber$"+Re,Me="__reactProps$"+Re,Pe="__reactContainer$"+Re,De="__reactEvents$"+Re,Fe="__reactListeners$"+Re,Le="__reactHandles$"+Re,ze="__reactResources$"+Re,Be="__reactMarker$"+Re;function qe(e){delete e[Oe],delete e[Me],delete e[De],delete e[Fe],delete e[Le]}function We(e){var t=e[Oe];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Pe]||n[Oe]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=vh(e);null!==e;){if(n=e[Oe])return n;e=vh(e)}return t}n=(e=n).parentNode}return null}function je(e){if(e=e[Oe]||e[Pe]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ve(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function Ue(e){var t=e[ze];return t||(t=e[ze]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ge(e){e[Be]=!0}var He=new Set,Ke={};function Xe(e,t){Qe(e,t),Qe(e+"Capture",t)}function Qe(e,t){for(Ke[e]=t,e=0;e<t.length;e++)He.add(t[e])}var Ye,Je,Ze=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$e={},et={};function tt(e,t,n){if(o=t,Y.call(et,o)||!Y.call($e,o)&&(Ze.test(o)?et[o]=!0:($e[o]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var o}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function rt(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function ot(e){if(void 0===Ye)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ye=t&&t[1]||"",Je=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Ye+e+Je}var at=!1;function st(e,t){if(!e||at)return"";at=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(o){var r=o}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(s){r=s}(n=e())&&"function"===typeof n.catch&&n.catch((function(){}))}}catch(i){if(i&&r&&"string"===typeof i.stack)return[i.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),s=a[0],i=a[1];if(s&&i){var c=s.split("\n"),l=i.split("\n");for(o=r=0;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;for(;o<l.length&&!l[o].includes("DetermineComponentFrameRoot");)o++;if(r===c.length||o===l.length)for(r=c.length-1,o=l.length-1;1<=r&&0<=o&&c[r]!==l[o];)o--;for(;1<=r&&0<=o;r--,o--)if(c[r]!==l[o]){if(1!==r||1!==o)do{if(r--,0>--o||c[r]!==l[o]){var u="\n"+c[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=o);break}}}finally{at=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?ot(n):""}function it(e){switch(e.tag){case 26:case 27:case 5:return ot(e.type);case 16:return ot("Lazy");case 13:return ot("Suspense");case 19:return ot("SuspenseList");case 0:case 15:return st(e.type,!1);case 11:return st(e.type.render,!1);case 1:return st(e.type,!0);case 31:return ot("Activity");default:return""}}function ct(e){try{var t="";do{t+=it(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function lt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ht(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function dt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=ut(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function pt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function mt(e){return e.replace(ft,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function gt(e,t,n,r,o,a,s,i){e.name="",null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+lt(t)):e.value!==""+lt(t)&&(e.value=""+lt(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?bt(e,s,lt(t)):null!=n?bt(e,s,lt(n)):null!=r&&e.removeAttribute("value"),null==o&&null!=a&&(e.defaultChecked=!!a),null!=o&&(e.checked=o&&"function"!==typeof o&&"symbol"!==typeof o),null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i?e.name=""+lt(i):e.removeAttribute("name")}function yt(e,t,n,r,o,a,s,i){if(null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.type=a),null!=t||null!=n){if(!("submit"!==a&&"reset"!==a||void 0!==t&&null!==t))return;n=null!=n?""+lt(n):"",t=null!=t?""+lt(t):n,i||t===e.value||(e.value=t),e.defaultValue=t}r="function"!==typeof(r=null!=r?r:o)&&"symbol"!==typeof r&&!!r,e.checked=i?e.checked:!!r,e.defaultChecked=!!r,null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.name=s)}function bt(e,t,n){"number"===t&&pt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function vt(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+lt(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function wt(e,t,n){null==t||((t=""+lt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+lt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function xt(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(s(92));if(M(r)){if(1<r.length)throw Error(s(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=lt(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function kt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var St=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _t(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!==typeof n||0===n||St.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Ct(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(s(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var o in t)r=t[o],t.hasOwnProperty(o)&&n[o]!==r&&_t(e,o,r)}else for(var a in t)t.hasOwnProperty(a)&&_t(e,a,t[a])}function It(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Nt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Et(e){return Nt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var At=null;function Rt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ot=null,Mt=null;function Pt(e){var t=je(e);if(t&&(e=t.stateNode)){var n=e[Me]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+mt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=r[Me]||null;if(!o)throw Error(s(90));gt(r,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&dt(r)}break e;case"textarea":wt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&vt(e,!!n.multiple,t,!1)}}}var Dt=!1;function Ft(e,t,n){if(Dt)return e(t,n);Dt=!0;try{return e(t)}finally{if(Dt=!1,(null!==Ot||null!==Mt)&&(Wl(),Ot&&(t=Ot,e=Mt,Mt=Ot=null,Pt(t),e)))for(t=0;t<e.length;t++)Pt(e[t])}}function Lt(e,t){var n=e.stateNode;if(null===n)return null;var r=n[Me]||null;if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var zt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Bt=!1;if(zt)try{var qt={};Object.defineProperty(qt,"passive",{get:function(){Bt=!0}}),window.addEventListener("test",qt,qt),window.removeEventListener("test",qt,qt)}catch(Md){Bt=!1}var Wt=null,jt=null,Vt=null;function Ut(){if(Vt)return Vt;var e,t,n=jt,r=n.length,o="value"in Wt?Wt.value:Wt.textContent,a=o.length;for(e=0;e<r&&n[e]===o[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===o[a-t];t++);return Vt=o.slice(e,1<t?1-t:void 0)}function Gt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Ht(){return!0}function Kt(){return!1}function Xt(e){function t(t,n,r,o,a){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(o):o[s]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?Ht:Kt,this.isPropagationStopped=Kt,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Ht)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Ht)},persist:function(){},isPersistent:Ht}),t}var Qt,Yt,Jt,Zt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$t=Xt(Zt),en=d({},Zt,{view:0,detail:0}),tn=Xt(en),nn=d({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Qt=e.screenX-Jt.screenX,Yt=e.screenY-Jt.screenY):Yt=Qt=0,Jt=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:Yt}}),rn=Xt(nn),on=Xt(d({},nn,{dataTransfer:0})),an=Xt(d({},en,{relatedTarget:0})),sn=Xt(d({},Zt,{animationName:0,elapsedTime:0,pseudoElement:0})),cn=Xt(d({},Zt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ln=Xt(d({},Zt,{data:0})),un={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=dn[e])&&!!t[e]}function fn(){return pn}var mn=Xt(d({},en,{key:function(e){if(e.key){var t=un[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Gt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fn,charCode:function(e){return"keypress"===e.type?Gt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Gt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),gn=Xt(d({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),yn=Xt(d({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fn})),bn=Xt(d({},Zt,{propertyName:0,elapsedTime:0,pseudoElement:0})),vn=Xt(d({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),wn=Xt(d({},Zt,{newState:0,oldState:0})),xn=[9,13,27,32],kn=zt&&"CompositionEvent"in window,Sn=null;zt&&"documentMode"in document&&(Sn=document.documentMode);var _n=zt&&"TextEvent"in window&&!Sn,Cn=zt&&(!kn||Sn&&8<Sn&&11>=Sn),In=String.fromCharCode(32),Tn=!1;function Nn(e,t){switch(e){case"keyup":return-1!==xn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function En(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var An=!1;var Rn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function On(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Rn[e.type]:"textarea"===t}function Mn(e,t,n,r){Ot?Mt?Mt.push(r):Mt=[r]:Ot=r,0<(t=Uu(t,"onChange")).length&&(n=new $t("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Pn=null,Dn=null;function Fn(e){Fu(e,0)}function Ln(e){if(dt(Ve(e)))return e}function zn(e,t){if("change"===e)return t}var Bn=!1;if(zt){var qn;if(zt){var Wn="oninput"in document;if(!Wn){var jn=document.createElement("div");jn.setAttribute("oninput","return;"),Wn="function"===typeof jn.oninput}qn=Wn}else qn=!1;Bn=qn&&(!document.documentMode||9<document.documentMode)}function Vn(){Pn&&(Pn.detachEvent("onpropertychange",Un),Dn=Pn=null)}function Un(e){if("value"===e.propertyName&&Ln(Dn)){var t=[];Mn(t,Dn,e,Rt(e)),Ft(Fn,t)}}function Gn(e,t,n){"focusin"===e?(Vn(),Dn=n,(Pn=t).attachEvent("onpropertychange",Un)):"focusout"===e&&Vn()}function Hn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Ln(Dn)}function Kn(e,t){if("click"===e)return Ln(t)}function Xn(e,t){if("input"===e||"change"===e)return Ln(t)}var Qn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Yn(e,t){if(Qn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!Y.call(t,o)||!Qn(e[o],t[o]))return!1}return!0}function Jn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Zn(e,t){var n,r=Jn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Jn(r)}}function $n(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?$n(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function er(e){for(var t=pt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=pt((e=t.contentWindow).document)}return t}function tr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var nr=zt&&"documentMode"in document&&11>=document.documentMode,rr=null,or=null,ar=null,sr=!1;function ir(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;sr||null==rr||rr!==pt(r)||("selectionStart"in(r=rr)&&tr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},ar&&Yn(ar,r)||(ar=r,0<(r=Uu(or,"onSelect")).length&&(t=new $t("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rr)))}function cr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var lr={animationend:cr("Animation","AnimationEnd"),animationiteration:cr("Animation","AnimationIteration"),animationstart:cr("Animation","AnimationStart"),transitionrun:cr("Transition","TransitionRun"),transitionstart:cr("Transition","TransitionStart"),transitioncancel:cr("Transition","TransitionCancel"),transitionend:cr("Transition","TransitionEnd")},ur={},hr={};function dr(e){if(ur[e])return ur[e];if(!lr[e])return e;var t,n=lr[e];for(t in n)if(n.hasOwnProperty(t)&&t in hr)return ur[e]=n[t];return e}zt&&(hr=document.createElement("div").style,"AnimationEvent"in window||(delete lr.animationend.animation,delete lr.animationiteration.animation,delete lr.animationstart.animation),"TransitionEvent"in window||delete lr.transitionend.transition);var pr=dr("animationend"),fr=dr("animationiteration"),mr=dr("animationstart"),gr=dr("transitionrun"),yr=dr("transitionstart"),br=dr("transitioncancel"),vr=dr("transitionend"),wr=new Map,xr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){wr.set(e,t),Xe(t,[e])}xr.push("scrollEnd");var Sr=new WeakMap;function _r(e,t){if("object"===typeof e&&null!==e){var n=Sr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:ct(t)},Sr.set(e,t),t)}return{value:e,source:t,stack:ct(t)}}var Cr=[],Ir=0,Tr=0;function Nr(){for(var e=Ir,t=Tr=Ir=0;t<e;){var n=Cr[t];Cr[t++]=null;var r=Cr[t];Cr[t++]=null;var o=Cr[t];Cr[t++]=null;var a=Cr[t];if(Cr[t++]=null,null!==r&&null!==o){var s=r.pending;null===s?o.next=o:(o.next=s.next,s.next=o),r.pending=o}0!==a&&Or(n,o,a)}}function Er(e,t,n,r){Cr[Ir++]=e,Cr[Ir++]=t,Cr[Ir++]=n,Cr[Ir++]=r,Tr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Ar(e,t,n,r){return Er(e,t,n,r),Mr(e)}function Rr(e,t){return Er(e,null,null,t),Mr(e)}function Or(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var o=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(o=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,o&&null!==t&&(o=31-pe(n),null===(r=(e=a.hiddenUpdates)[o])?e[o]=[t]:r.push(t),t.lane=536870912|n),a):null}function Mr(e){if(50<Ol)throw Ol=0,Ml=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Pr={};function Dr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fr(e,t,n,r){return new Dr(e,t,n,r)}function Lr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zr(e,t){var n=e.alternate;return null===n?((n=Fr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function Br(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function qr(e,t,n,r,o,a){var i=0;if(r=e,"function"===typeof e)Lr(e)&&(i=1);else if("string"===typeof e)i=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,j.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case T:return(e=Fr(31,n,t,o)).elementType=T,e.lanes=a,e;case g:return Wr(n.children,o,a,t);case y:i=8,o|=24;break;case b:return(e=Fr(12,n,t,2|o)).elementType=b,e.lanes=a,e;case S:return(e=Fr(13,n,t,o)).elementType=S,e.lanes=a,e;case _:return(e=Fr(19,n,t,o)).elementType=_,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case v:case x:i=10;break e;case w:i=9;break e;case k:i=11;break e;case C:i=14;break e;case I:i=16,r=null;break e}i=29,n=Error(s(130,null===e?"null":typeof e,"")),r=null}return(t=Fr(i,n,t,o)).elementType=e,t.type=r,t.lanes=a,t}function Wr(e,t,n,r){return(e=Fr(7,e,r,t)).lanes=n,e}function jr(e,t,n){return(e=Fr(6,e,null,t)).lanes=n,e}function Vr(e,t,n){return(t=Fr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Ur=[],Gr=0,Hr=null,Kr=0,Xr=[],Qr=0,Yr=null,Jr=1,Zr="";function $r(e,t){Ur[Gr++]=Kr,Ur[Gr++]=Hr,Hr=e,Kr=t}function eo(e,t,n){Xr[Qr++]=Jr,Xr[Qr++]=Zr,Xr[Qr++]=Yr,Yr=e;var r=Jr;e=Zr;var o=32-pe(r)-1;r&=~(1<<o),n+=1;var a=32-pe(t)+o;if(30<a){var s=o-o%5;a=(r&(1<<s)-1).toString(32),r>>=s,o-=s,Jr=1<<32-pe(t)+o|n<<o|r,Zr=a+e}else Jr=1<<a|n<<o|r,Zr=e}function to(e){null!==e.return&&($r(e,1),eo(e,1,0))}function no(e){for(;e===Hr;)Hr=Ur[--Gr],Ur[Gr]=null,Kr=Ur[--Gr],Ur[Gr]=null;for(;e===Yr;)Yr=Xr[--Qr],Xr[Qr]=null,Zr=Xr[--Qr],Xr[Qr]=null,Jr=Xr[--Qr],Xr[Qr]=null}var ro=null,oo=null,ao=!1,so=null,io=!1,co=Error(s(519));function lo(e){throw go(_r(Error(s(418,"")),e)),co}function uo(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[Oe]=e,t[Me]=r,n){case"dialog":Lu("cancel",t),Lu("close",t);break;case"iframe":case"object":case"embed":Lu("load",t);break;case"video":case"audio":for(n=0;n<Pu.length;n++)Lu(Pu[n],t);break;case"source":Lu("error",t);break;case"img":case"image":case"link":Lu("error",t),Lu("load",t);break;case"details":Lu("toggle",t);break;case"input":Lu("invalid",t),yt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),ht(t);break;case"select":Lu("invalid",t);break;case"textarea":Lu("invalid",t),xt(t,r.value,r.defaultValue,r.children),ht(t)}"string"!==typeof(n=r.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||Yu(t.textContent,n)?(null!=r.popover&&(Lu("beforetoggle",t),Lu("toggle",t)),null!=r.onScroll&&Lu("scroll",t),null!=r.onScrollEnd&&Lu("scrollend",t),null!=r.onClick&&(t.onclick=Ju),t=!0):t=!1,t||lo(e)}function ho(e){for(ro=e.return;ro;)switch(ro.tag){case 5:case 13:return void(io=!1);case 27:case 3:return void(io=!0);default:ro=ro.return}}function po(e){if(e!==ro)return!1;if(!ao)return ho(e),ao=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||sh(e.type,e.memoizedProps)),t=!t),t&&oo&&lo(e),ho(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){oo=yh(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}oo=null}}else 27===n?(n=oo,ph(e.type)?(e=bh,bh=null,oo=e):oo=n):oo=ro?yh(e.stateNode.nextSibling):null;return!0}function fo(){oo=ro=null,ao=!1}function mo(){var e=so;return null!==e&&(null===vl?vl=e:vl.push.apply(vl,e),so=null),e}function go(e){null===so?so=[e]:so.push(e)}var yo=B(null),bo=null,vo=null;function wo(e,t,n){W(yo,t._currentValue),t._currentValue=n}function xo(e){e._currentValue=yo.current,q(yo)}function ko(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function So(e,t,n,r){var o=e.child;for(null!==o&&(o.return=e);null!==o;){var a=o.dependencies;if(null!==a){var i=o.child;a=a.firstContext;e:for(;null!==a;){var c=a;a=o;for(var l=0;l<t.length;l++)if(c.context===t[l]){a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),ko(a.return,n,e),r||(i=null);break e}a=c.next}}else if(18===o.tag){if(null===(i=o.return))throw Error(s(341));i.lanes|=n,null!==(a=i.alternate)&&(a.lanes|=n),ko(i,n,e),i=null}else i=o.child;if(null!==i)i.return=o;else for(i=o;null!==i;){if(i===e){i=null;break}if(null!==(o=i.sibling)){o.return=i.return,i=o;break}i=i.return}o=i}}function _o(e,t,n,r){e=null;for(var o=t,a=!1;null!==o;){if(!a)if(0!==(524288&o.flags))a=!0;else if(0!==(262144&o.flags))break;if(10===o.tag){var i=o.alternate;if(null===i)throw Error(s(387));if(null!==(i=i.memoizedProps)){var c=o.type;Qn(o.pendingProps.value,i.value)||(null!==e?e.push(c):e=[c])}}else if(o===G.current){if(null===(i=o.alternate))throw Error(s(387));i.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(null!==e?e.push(Xh):e=[Xh])}o=o.return}null!==e&&So(t,e,n,r),t.flags|=262144}function Co(e){for(e=e.firstContext;null!==e;){if(!Qn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Io(e){bo=e,vo=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function To(e){return Eo(bo,e)}function No(e,t){return null===bo&&Io(e),Eo(e,t)}function Eo(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===vo){if(null===e)throw Error(s(308));vo=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else vo=vo.next=t;return n}var Ao="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},Ro=r.unstable_scheduleCallback,Oo=r.unstable_NormalPriority,Mo={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Po(){return{controller:new Ao,data:new Map,refCount:0}}function Do(e){e.refCount--,0===e.refCount&&Ro(Oo,(function(){e.controller.abort()}))}var Fo=null,Lo=0,zo=0,Bo=null;function qo(){if(0===--Lo&&null!==Fo){null!==Bo&&(Bo.status="fulfilled");var e=Fo;Fo=null,zo=0,Bo=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Wo=P.S;P.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Fo){var n=Fo=[];Lo=0,zo=Eu(),Bo={status:"pending",value:void 0,then:function(e){n.push(e)}}}Lo++,t.then(qo,qo)}(0,t),null!==Wo&&Wo(e,t)};var jo=B(null);function Vo(){var e=jo.current;return null!==e?e:rl.pooledCache}function Uo(e,t){W(jo,null===t?jo.current:t.pool)}function Go(){var e=Vo();return null===e?null:{parent:Mo._currentValue,pool:e}}var Ho=Error(s(460)),Ko=Error(s(474)),Xo=Error(s(542)),Qo={then:function(){}};function Yo(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Jo(){}function Zo(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Jo,Jo),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ta(e=t.reason),e;default:if("string"===typeof t.status)t.then(Jo,Jo);else{if(null!==(e=rl)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}}),(function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ta(e=t.reason),e}throw $o=t,Ho}}var $o=null;function ea(){if(null===$o)throw Error(s(459));var e=$o;return $o=null,e}function ta(e){if(e===Ho||e===Xo)throw Error(s(483))}var na=!1;function ra(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function aa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function sa(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&nl)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,t=Mr(e),Or(e,null,n),t}return Er(e,r,t,n),Mr(e)}function ia(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Te(e,n)}}function ca(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?o=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?o=a=t:a=a.next=t}else o=a=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var la=!1;function ua(){if(la){if(null!==Bo)throw Bo}}function ha(e,t,n,r){la=!1;var o=e.updateQueue;na=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,i=o.shared.pending;if(null!==i){o.shared.pending=null;var c=i,l=c.next;c.next=null,null===s?a=l:s.next=l,s=c;var u=e.alternate;null!==u&&((i=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===i?u.firstBaseUpdate=l:i.next=l,u.lastBaseUpdate=c))}if(null!==a){var h=o.baseState;for(s=0,u=l=c=null,i=a;;){var p=-536870913&i.lane,f=p!==i.lane;if(f?(al&p)===p:(r&p)===p){0!==p&&p===zo&&(la=!0),null!==u&&(u=u.next={lane:0,tag:i.tag,payload:i.payload,callback:null,next:null});e:{var m=e,g=i;p=t;var y=n;switch(g.tag){case 1:if("function"===typeof(m=g.payload)){h=m.call(y,h,p);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(p="function"===typeof(m=g.payload)?m.call(y,h,p):m)||void 0===p)break e;h=d({},h,p);break e;case 2:na=!0}}null!==(p=i.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=o.callbacks)?o.callbacks=[p]:f.push(p))}else f={lane:p,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===u?(l=u=f,c=h):u=u.next=f,s|=p;if(null===(i=i.next)){if(null===(i=o.shared.pending))break;i=(f=i).next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}null===u&&(c=h),o.baseState=c,o.firstBaseUpdate=l,o.lastBaseUpdate=u,null===a&&(o.shared.lanes=0),pl|=s,e.lanes=s,e.memoizedState=h}}function da(e,t){if("function"!==typeof e)throw Error(s(191,e));e.call(t)}function pa(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)da(n[e],t)}var fa=B(null),ma=B(0);function ga(e,t){W(ma,e=hl),W(fa,t),hl=e|t.baseLanes}function ya(){W(ma,hl),W(fa,fa.current)}function ba(){hl=ma.current,q(fa),q(ma)}var va=0,wa=null,xa=null,ka=null,Sa=!1,_a=!1,Ca=!1,Ia=0,Ta=0,Na=null,Ea=0;function Aa(){throw Error(s(321))}function Ra(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Qn(e[n],t[n]))return!1;return!0}function Oa(e,t,n,r,o,a){return va=a,wa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,P.H=null===e||null===e.memoizedState?Hs:Ks,Ca=!1,a=n(r,o),Ca=!1,_a&&(a=Pa(t,n,r,o)),Ma(e),a}function Ma(e){P.H=Gs;var t=null!==xa&&null!==xa.next;if(va=0,ka=xa=wa=null,Sa=!1,Ta=0,Na=null,t)throw Error(s(300));null===e||Ti||null!==(e=e.dependencies)&&Co(e)&&(Ti=!0)}function Pa(e,t,n,r){wa=e;var o=0;do{if(_a&&(Na=null),Ta=0,_a=!1,25<=o)throw Error(s(301));if(o+=1,ka=xa=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}P.H=Xs,a=t(n,r)}while(_a);return a}function Da(){var e=P.H,t=e.useState()[0];return t="function"===typeof t.then?Wa(t):t,e=e.useState()[0],(null!==xa?xa.memoizedState:null)!==e&&(wa.flags|=1024),t}function Fa(){var e=0!==Ia;return Ia=0,e}function La(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function za(e){if(Sa){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Sa=!1}va=0,ka=xa=wa=null,_a=!1,Ta=Ia=0,Na=null}function Ba(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ka?wa.memoizedState=ka=e:ka=ka.next=e,ka}function qa(){if(null===xa){var e=wa.alternate;e=null!==e?e.memoizedState:null}else e=xa.next;var t=null===ka?wa.memoizedState:ka.next;if(null!==t)ka=t,xa=e;else{if(null===e){if(null===wa.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(xa=e).memoizedState,baseState:xa.baseState,baseQueue:xa.baseQueue,queue:xa.queue,next:null},null===ka?wa.memoizedState=ka=e:ka=ka.next=e}return ka}function Wa(e){var t=Ta;return Ta+=1,null===Na&&(Na=[]),e=Zo(Na,e,t),t=wa,null===(null===ka?t.memoizedState:ka.next)&&(t=t.alternate,P.H=null===t||null===t.memoizedState?Hs:Ks),e}function ja(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Wa(e);if(e.$$typeof===x)return To(e)}throw Error(s(438,String(e)))}function Va(e){var t=null,n=wa.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=wa.alternate;null!==r&&(null!==(r=r.updateQueue)&&(null!=(r=r.memoCache)&&(t={data:r.data.map((function(e){return e.slice()})),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},wa.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=N;return t.index++,n}function Ua(e,t){return"function"===typeof t?t(e):t}function Ga(e){return Ha(qa(),xa,e)}function Ha(e,t,n){var r=e.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=n;var o=e.baseQueue,a=r.pending;if(null!==a){if(null!==o){var i=o.next;o.next=a.next,a.next=i}t.baseQueue=o=a,r.pending=null}if(a=e.baseState,null===o)e.memoizedState=a;else{var c=i=null,l=null,u=t=o.next,h=!1;do{var d=-536870913&u.lane;if(d!==u.lane?(al&d)===d:(va&d)===d){var p=u.revertLane;if(0===p)null!==l&&(l=l.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===zo&&(h=!0);else{if((va&p)===p){u=u.next,p===zo&&(h=!0);continue}d={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===l?(c=l=d,i=a):l=l.next=d,wa.lanes|=p,pl|=p}d=u.action,Ca&&n(a,d),a=u.hasEagerState?u.eagerState:n(a,d)}else p={lane:d,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===l?(c=l=p,i=a):l=l.next=p,wa.lanes|=d,pl|=d;u=u.next}while(null!==u&&u!==t);if(null===l?i=a:l.next=c,!Qn(a,e.memoizedState)&&(Ti=!0,h&&null!==(n=Bo)))throw n;e.memoizedState=a,e.baseState=i,e.baseQueue=l,r.lastRenderedState=a}return null===o&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Ka(e){var t=qa(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var i=o=o.next;do{a=e(a,i.action),i=i.next}while(i!==o);Qn(a,t.memoizedState)||(Ti=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Xa(e,t,n){var r=wa,o=qa(),a=ao;if(a){if(void 0===n)throw Error(s(407));n=n()}else n=t();var i=!Qn((xa||o).memoizedState,n);if(i&&(o.memoizedState=n,Ti=!0),o=o.queue,ys(2048,8,Ja.bind(null,r,o,e),[e]),o.getSnapshot!==t||i||null!==ka&&1&ka.memoizedState.tag){if(r.flags|=2048,fs(9,{destroy:void 0,resource:void 0},Ya.bind(null,r,o,n,t),null),null===rl)throw Error(s(349));a||0!==(124&va)||Qa(r,t,n)}return n}function Qa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=wa.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},wa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ya(e,t,n,r){t.value=n,t.getSnapshot=r,Za(t)&&$a(e)}function Ja(e,t,n){return n((function(){Za(t)&&$a(e)}))}function Za(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Qn(e,n)}catch(r){return!0}}function $a(e){var t=Rr(e,2);null!==t&&Fl(t,e,2)}function es(e){var t=Ba();if("function"===typeof e){var n=e;if(e=n(),Ca){de(!0);try{n()}finally{de(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ua,lastRenderedState:e},t}function ts(e,t,n,r){return e.baseState=n,Ha(e,xa,"function"===typeof r?r:Ua)}function ns(e,t,n,r,o){if(js(e))throw Error(s(485));if(null!==(e=t.action)){var a={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==P.T?n(!0):a.isTransition=!1,r(a),null===(n=t.pending)?(a.next=t.pending=a,rs(t,a)):(a.next=n.next,t.pending=n.next=a)}}function rs(e,t){var n=t.action,r=t.payload,o=e.state;if(t.isTransition){var a=P.T,s={};P.T=s;try{var i=n(o,r),c=P.S;null!==c&&c(s,i),os(e,t,i)}catch(l){ss(e,t,l)}finally{P.T=a}}else try{os(e,t,a=n(o,r))}catch(u){ss(e,t,u)}}function os(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then((function(n){as(e,t,n)}),(function(n){return ss(e,t,n)})):as(e,t,n)}function as(e,t,n){t.status="fulfilled",t.value=n,is(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,rs(e,n)))}function ss(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,is(t),t=t.next}while(t!==r)}e.action=null}function is(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function cs(e,t){return t}function ls(e,t){if(ao){var n=rl.formState;if(null!==n){e:{var r=wa;if(ao){if(oo){t:{for(var o=oo,a=io;8!==o.nodeType;){if(!a){o=null;break t}if(null===(o=yh(o.nextSibling))){o=null;break t}}o="F!"===(a=o.data)||"F"===a?o:null}if(o){oo=yh(o.nextSibling),r="F!"===o.data;break e}}lo(r)}r=!1}r&&(t=n[0])}}return(n=Ba()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cs,lastRenderedState:t},n.queue=r,n=Bs.bind(null,wa,r),r.dispatch=n,r=es(!1),a=Ws.bind(null,wa,!1,r.queue),o={state:t,dispatch:null,action:e,pending:null},(r=Ba()).queue=o,n=ns.bind(null,wa,o,a,n),o.dispatch=n,r.memoizedState=e,[t,n,!1]}function us(e){return hs(qa(),xa,e)}function hs(e,t,n){if(t=Ha(e,t,cs)[0],e=Ga(Ua)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var r=Wa(t)}catch(s){if(s===Ho)throw Xo;throw s}else r=t;var o=(t=qa()).queue,a=o.dispatch;return n!==t.memoizedState&&(wa.flags|=2048,fs(9,{destroy:void 0,resource:void 0},ds.bind(null,o,n),null)),[r,a,e]}function ds(e,t){e.action=t}function ps(e){var t=qa(),n=xa;if(null!==n)return hs(t,n,e);qa(),t=t.memoizedState;var r=(n=qa()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function fs(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=wa.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},wa.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ms(){return qa().memoizedState}function gs(e,t,n,r){var o=Ba();r=void 0===r?null:r,wa.flags|=e,o.memoizedState=fs(1|t,{destroy:void 0,resource:void 0},n,r)}function ys(e,t,n,r){var o=qa();r=void 0===r?null:r;var a=o.memoizedState.inst;null!==xa&&null!==r&&Ra(r,xa.memoizedState.deps)?o.memoizedState=fs(t,a,n,r):(wa.flags|=e,o.memoizedState=fs(1|t,a,n,r))}function bs(e,t){gs(8390656,8,e,t)}function vs(e,t){ys(2048,8,e,t)}function ws(e,t){return ys(4,2,e,t)}function xs(e,t){return ys(4,4,e,t)}function ks(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Ss(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,ys(4,4,ks.bind(null,t,e),n)}function _s(){}function Cs(e,t){var n=qa();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&Ra(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Is(e,t){var n=qa();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&Ra(t,r[1]))return r[0];if(r=e(),Ca){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[r,t],r}function Ts(e,t,n){return void 0===n||0!==(1073741824&va)?e.memoizedState=t:(e.memoizedState=n,e=Dl(),wa.lanes|=e,pl|=e,n)}function Ns(e,t,n,r){return Qn(n,t)?n:null!==fa.current?(e=Ts(e,n,r),Qn(e,t)||(Ti=!0),e):0===(42&va)?(Ti=!0,e.memoizedState=n):(e=Dl(),wa.lanes|=e,pl|=e,t)}function Es(e,t,n,r,o){var a=D.p;D.p=0!==a&&8>a?a:8;var s=P.T,i={};P.T=i,Ws(e,!1,t,n);try{var c=o(),l=P.S;if(null!==l&&l(i,c),null!==c&&"object"===typeof c&&"function"===typeof c.then)qs(e,t,function(e,t){var n=[],r={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then((function(){r.status="fulfilled",r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)}),(function(e){for(r.status="rejected",r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)})),r}(c,r),Pl());else qs(e,t,r,Pl())}catch(u){qs(e,t,{then:function(){},status:"rejected",reason:u},Pl())}finally{D.p=a,P.T=s}}function As(){}function Rs(e,t,n,r){if(5!==e.tag)throw Error(s(476));var o=Os(e).queue;Es(e,o,t,F,null===n?As:function(){return Ms(e),n(r)})}function Os(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:F,baseState:F,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ua,lastRenderedState:F},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ua,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Ms(e){qs(e,Os(e).next.queue,{},Pl())}function Ps(){return To(Xh)}function Ds(){return qa().memoizedState}function Fs(){return qa().memoizedState}function Ls(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Pl(),r=sa(t,e=aa(n),n);return null!==r&&(Fl(r,t,n),ia(r,t,n)),t={cache:Po()},void(e.payload=t)}t=t.return}}function zs(e,t,n){var r=Pl();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},js(e)?Vs(t,n):null!==(n=Ar(e,t,n,r))&&(Fl(n,e,r),Us(n,t,r))}function Bs(e,t,n){qs(e,t,n,Pl())}function qs(e,t,n,r){var o={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(js(e))Vs(t,o);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,i=a(s,n);if(o.hasEagerState=!0,o.eagerState=i,Qn(i,s))return Er(e,t,o,0),null===rl&&Nr(),!1}catch(c){}if(null!==(n=Ar(e,t,o,r)))return Fl(n,e,r),Us(n,t,r),!0}return!1}function Ws(e,t,n,r){if(r={lane:2,revertLane:Eu(),action:r,hasEagerState:!1,eagerState:null,next:null},js(e)){if(t)throw Error(s(479))}else null!==(t=Ar(e,n,r,2))&&Fl(t,e,2)}function js(e){var t=e.alternate;return e===wa||null!==t&&t===wa}function Vs(e,t){_a=Sa=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Us(e,t,n){if(0!==(4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Te(e,n)}}var Gs={readContext:To,use:ja,useCallback:Aa,useContext:Aa,useEffect:Aa,useImperativeHandle:Aa,useLayoutEffect:Aa,useInsertionEffect:Aa,useMemo:Aa,useReducer:Aa,useRef:Aa,useState:Aa,useDebugValue:Aa,useDeferredValue:Aa,useTransition:Aa,useSyncExternalStore:Aa,useId:Aa,useHostTransitionStatus:Aa,useFormState:Aa,useActionState:Aa,useOptimistic:Aa,useMemoCache:Aa,useCacheRefresh:Aa},Hs={readContext:To,use:ja,useCallback:function(e,t){return Ba().memoizedState=[e,void 0===t?null:t],e},useContext:To,useEffect:bs,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gs(4194308,4,ks.bind(null,t,e),n)},useLayoutEffect:function(e,t){return gs(4194308,4,e,t)},useInsertionEffect:function(e,t){gs(4,2,e,t)},useMemo:function(e,t){var n=Ba();t=void 0===t?null:t;var r=e();if(Ca){de(!0);try{e()}finally{de(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Ba();if(void 0!==n){var o=n(t);if(Ca){de(!0);try{n(t)}finally{de(!1)}}}else o=t;return r.memoizedState=r.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},r.queue=e,e=e.dispatch=zs.bind(null,wa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ba().memoizedState=e},useState:function(e){var t=(e=es(e)).queue,n=Bs.bind(null,wa,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:_s,useDeferredValue:function(e,t){return Ts(Ba(),e,t)},useTransition:function(){var e=es(!1);return e=Es.bind(null,wa,e.queue,!0,!1),Ba().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=wa,o=Ba();if(ao){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===rl)throw Error(s(349));0!==(124&al)||Qa(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,bs(Ja.bind(null,r,a,e),[e]),r.flags|=2048,fs(9,{destroy:void 0,resource:void 0},Ya.bind(null,r,a,n,t),null),n},useId:function(){var e=Ba(),t=rl.identifierPrefix;if(ao){var n=Zr;t="\xab"+t+"R"+(n=(Jr&~(1<<32-pe(Jr)-1)).toString(32)+n),0<(n=Ia++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Ea++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Ps,useFormState:ls,useActionState:ls,useOptimistic:function(e){var t=Ba();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Ws.bind(null,wa,!0,n),n.dispatch=t,[e,t]},useMemoCache:Va,useCacheRefresh:function(){return Ba().memoizedState=Ls.bind(null,wa)}},Ks={readContext:To,use:ja,useCallback:Cs,useContext:To,useEffect:vs,useImperativeHandle:Ss,useInsertionEffect:ws,useLayoutEffect:xs,useMemo:Is,useReducer:Ga,useRef:ms,useState:function(){return Ga(Ua)},useDebugValue:_s,useDeferredValue:function(e,t){return Ns(qa(),xa.memoizedState,e,t)},useTransition:function(){var e=Ga(Ua)[0],t=qa().memoizedState;return["boolean"===typeof e?e:Wa(e),t]},useSyncExternalStore:Xa,useId:Ds,useHostTransitionStatus:Ps,useFormState:us,useActionState:us,useOptimistic:function(e,t){return ts(qa(),0,e,t)},useMemoCache:Va,useCacheRefresh:Fs},Xs={readContext:To,use:ja,useCallback:Cs,useContext:To,useEffect:vs,useImperativeHandle:Ss,useInsertionEffect:ws,useLayoutEffect:xs,useMemo:Is,useReducer:Ka,useRef:ms,useState:function(){return Ka(Ua)},useDebugValue:_s,useDeferredValue:function(e,t){var n=qa();return null===xa?Ts(n,e,t):Ns(n,xa.memoizedState,e,t)},useTransition:function(){var e=Ka(Ua)[0],t=qa().memoizedState;return["boolean"===typeof e?e:Wa(e),t]},useSyncExternalStore:Xa,useId:Ds,useHostTransitionStatus:Ps,useFormState:ps,useActionState:ps,useOptimistic:function(e,t){var n=qa();return null!==xa?ts(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Va,useCacheRefresh:Fs},Qs=null,Ys=0;function Js(e){var t=Ys;return Ys+=1,null===Qs&&(Qs=[]),Zo(Qs,e,t)}function Zs(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function $s(e,t){if(t.$$typeof===p)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ei(e){return(0,e._init)(e._payload)}function ti(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function o(e,t){return(e=zr(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function i(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=jr(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===g?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===I&&ei(a)===t.type)?(Zs(t=o(t,n.props),n),t.return=e,t):(Zs(t=qr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vr(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Wr(n,e.mode,r,a)).return=e,t):((t=o(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=jr(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case f:return Zs(n=qr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case m:return(t=Vr(t,e.mode,n)).return=e,t;case I:return d(e,t=(0,t._init)(t._payload),n)}if(M(t)||A(t))return(t=Wr(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return d(e,Js(t),n);if(t.$$typeof===x)return d(e,No(e,t),n);$s(e,t)}return null}function p(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==o?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===o?l(e,t,n,r):null;case m:return n.key===o?u(e,t,n,r):null;case I:return p(e,t,n=(o=n._init)(n._payload),r)}if(M(n)||A(n))return null!==o?null:h(e,t,n,r,null);if("function"===typeof n.then)return p(e,t,Js(n),r);if(n.$$typeof===x)return p(e,t,No(e,n),r);$s(e,n)}return null}function y(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return c(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case f:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o);case m:return u(t,e=e.get(null===r.key?n:r.key)||null,r,o);case I:return y(e,t,n,r=(0,r._init)(r._payload),o)}if(M(r)||A(r))return h(t,e=e.get(n)||null,r,o,null);if("function"===typeof r.then)return y(e,t,n,Js(r),o);if(r.$$typeof===x)return y(e,t,n,No(t,r),o);$s(t,r)}return null}function b(c,l,u,h){if("object"===typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var v=u.key;null!==l;){if(l.key===v){if((v=u.type)===g){if(7===l.tag){n(c,l.sibling),(h=o(l,u.props.children)).return=c,c=h;break e}}else if(l.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===I&&ei(v)===l.type){n(c,l.sibling),Zs(h=o(l,u.props),u),h.return=c,c=h;break e}n(c,l);break}t(c,l),l=l.sibling}u.type===g?((h=Wr(u.props.children,c.mode,h,u.key)).return=c,c=h):(Zs(h=qr(u.type,u.key,u.props,null,c.mode,h),u),h.return=c,c=h)}return i(c);case m:e:{for(v=u.key;null!==l;){if(l.key===v){if(4===l.tag&&l.stateNode.containerInfo===u.containerInfo&&l.stateNode.implementation===u.implementation){n(c,l.sibling),(h=o(l,u.children||[])).return=c,c=h;break e}n(c,l);break}t(c,l),l=l.sibling}(h=Vr(u,c.mode,h)).return=c,c=h}return i(c);case I:return b(c,l,u=(v=u._init)(u._payload),h)}if(M(u))return function(o,s,i,c){for(var l=null,u=null,h=s,f=s=0,m=null;null!==h&&f<i.length;f++){h.index>f?(m=h,h=null):m=h.sibling;var g=p(o,h,i[f],c);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(o,h),s=a(g,s,f),null===u?l=g:u.sibling=g,u=g,h=m}if(f===i.length)return n(o,h),ao&&$r(o,f),l;if(null===h){for(;f<i.length;f++)null!==(h=d(o,i[f],c))&&(s=a(h,s,f),null===u?l=h:u.sibling=h,u=h);return ao&&$r(o,f),l}for(h=r(h);f<i.length;f++)null!==(m=y(h,o,f,i[f],c))&&(e&&null!==m.alternate&&h.delete(null===m.key?f:m.key),s=a(m,s,f),null===u?l=m:u.sibling=m,u=m);return e&&h.forEach((function(e){return t(o,e)})),ao&&$r(o,f),l}(c,l,u,h);if(A(u)){if("function"!==typeof(v=A(u)))throw Error(s(150));return function(o,i,c,l){if(null==c)throw Error(s(151));for(var u=null,h=null,f=i,m=i=0,g=null,b=c.next();null!==f&&!b.done;m++,b=c.next()){f.index>m?(g=f,f=null):g=f.sibling;var v=p(o,f,b.value,l);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(o,f),i=a(v,i,m),null===h?u=v:h.sibling=v,h=v,f=g}if(b.done)return n(o,f),ao&&$r(o,m),u;if(null===f){for(;!b.done;m++,b=c.next())null!==(b=d(o,b.value,l))&&(i=a(b,i,m),null===h?u=b:h.sibling=b,h=b);return ao&&$r(o,m),u}for(f=r(f);!b.done;m++,b=c.next())null!==(b=y(f,o,m,b.value,l))&&(e&&null!==b.alternate&&f.delete(null===b.key?m:b.key),i=a(b,i,m),null===h?u=b:h.sibling=b,h=b);return e&&f.forEach((function(e){return t(o,e)})),ao&&$r(o,m),u}(c,l,u=v.call(u),h)}if("function"===typeof u.then)return b(c,l,Js(u),h);if(u.$$typeof===x)return b(c,l,No(c,u),h);$s(c,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==l&&6===l.tag?(n(c,l.sibling),(h=o(l,u)).return=c,c=h):(n(c,l),(h=jr(u,c.mode,h)).return=c,c=h),i(c)):n(c,l)}return function(e,t,n,r){try{Ys=0;var o=b(e,t,n,r);return Qs=null,o}catch(s){if(s===Ho||s===Xo)throw s;var a=Fr(29,s,null,e.mode);return a.lanes=r,a.return=e,a}}}var ni=ti(!0),ri=ti(!1),oi=B(null),ai=null;function si(e){var t=e.alternate;W(ui,1&ui.current),W(oi,e),null===ai&&(null===t||null!==fa.current||null!==t.memoizedState)&&(ai=e)}function ii(e){if(22===e.tag){if(W(ui,ui.current),W(oi,e),null===ai){var t=e.alternate;null!==t&&null!==t.memoizedState&&(ai=e)}}else ci()}function ci(){W(ui,ui.current),W(oi,oi.current)}function li(e){q(oi),ai===e&&(ai=null),q(ui)}var ui=B(0);function hi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||gh(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function di(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:d({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var pi={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Pl(),o=aa(r);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=sa(e,o,r))&&(Fl(t,e,r),ia(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Pl(),o=aa(r);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=sa(e,o,r))&&(Fl(t,e,r),ia(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Pl(),r=aa(n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=sa(e,r,n))&&(Fl(t,e,n),ia(t,e,n))}};function fi(e,t,n,r,o,a,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!Yn(n,r)||!Yn(o,a))}function mi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&pi.enqueueReplaceState(t,t.state,null)}function gi(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var o in n===t&&(n=d({},n)),e)void 0===n[o]&&(n[o]=e[o]);return n}var yi="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function bi(e){yi(e)}function vi(e){console.error(e)}function wi(e){yi(e)}function xi(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout((function(){throw n}))}}function ki(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout((function(){throw r}))}}function Si(e,t,n){return(n=aa(n)).tag=3,n.payload={element:null},n.callback=function(){xi(e,t)},n}function _i(e){return(e=aa(e)).tag=3,e}function Ci(e,t,n,r){var o=n.type.getDerivedStateFromError;if("function"===typeof o){var a=r.value;e.payload=function(){return o(a)},e.callback=function(){ki(t,n,r)}}var s=n.stateNode;null!==s&&"function"===typeof s.componentDidCatch&&(e.callback=function(){ki(t,n,r),"function"!==typeof o&&(null===_l?_l=new Set([this]):_l.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Ii=Error(s(461)),Ti=!1;function Ni(e,t,n,r){t.child=null===e?ri(t,null,n,r):ni(t,e.child,n,r)}function Ei(e,t,n,r,o){n=n.render;var a=t.ref;if("ref"in r){var s={};for(var i in r)"ref"!==i&&(s[i]=r[i])}else s=r;return Io(t),r=Oa(e,t,n,s,a,o),i=Fa(),null===e||Ti?(ao&&i&&to(t),t.flags|=1,Ni(e,t,r,o),t.child):(La(e,t,o),Qi(e,t,o))}function Ai(e,t,n,r,o){if(null===e){var a=n.type;return"function"!==typeof a||Lr(a)||void 0!==a.defaultProps||null!==n.compare?((e=qr(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ri(e,t,a,r,o))}if(a=e.child,!Yi(e,o)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:Yn)(s,r)&&e.ref===t.ref)return Qi(e,t,o)}return t.flags|=1,(e=zr(a,r)).ref=t.ref,e.return=t,t.child=e}function Ri(e,t,n,r,o){if(null!==e){var a=e.memoizedProps;if(Yn(a,r)&&e.ref===t.ref){if(Ti=!1,t.pendingProps=r=a,!Yi(e,o))return t.lanes=e.lanes,Qi(e,t,o);0!==(131072&e.flags)&&(Ti=!0)}}return Di(e,t,n,r,o)}function Oi(e,t,n){var r=t.pendingProps,o=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode){if(0!==(128&t.flags)){if(r=null!==a?a.baseLanes|n:n,null!==e){for(o=t.child=e.child,a=0;null!==o;)a=a|o.lanes|o.childLanes,o=o.sibling;t.childLanes=a&~r}else t.childLanes=0,t.child=null;return Mi(e,t,r,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Mi(e,t,null!==a?a.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Uo(0,null!==a?a.cachePool:null),null!==a?ga(t,a):ya(),ii(t)}else null!==a?(Uo(0,a.cachePool),ga(t,a),ci(),t.memoizedState=null):(null!==e&&Uo(0,null),ya(),ci());return Ni(e,t,o,n),t.child}function Mi(e,t,n,r){var o=Vo();return o=null===o?null:{parent:Mo._currentValue,pool:o},t.memoizedState={baseLanes:n,cachePool:o},null!==e&&Uo(0,null),ya(),ii(t),null!==e&&_o(e,t,r,!0),null}function Pi(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(s(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Di(e,t,n,r,o){return Io(t),n=Oa(e,t,n,r,void 0,o),r=Fa(),null===e||Ti?(ao&&r&&to(t),t.flags|=1,Ni(e,t,n,o),t.child):(La(e,t,o),Qi(e,t,o))}function Fi(e,t,n,r,o,a){return Io(t),t.updateQueue=null,n=Pa(t,r,n,o),Ma(e),r=Fa(),null===e||Ti?(ao&&r&&to(t),t.flags|=1,Ni(e,t,n,a),t.child):(La(e,t,a),Qi(e,t,a))}function Li(e,t,n,r,o){if(Io(t),null===t.stateNode){var a=Pr,s=n.contextType;"object"===typeof s&&null!==s&&(a=To(s)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=pi,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},ra(t),s=n.contextType,a.context="object"===typeof s&&null!==s?To(s):Pr,a.state=t.memoizedState,"function"===typeof(s=n.getDerivedStateFromProps)&&(di(t,n,s,r),a.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(s=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),s!==a.state&&pi.enqueueReplaceState(a,a.state,null),ha(t,r,a,o),ua(),a.state=t.memoizedState),"function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var i=t.memoizedProps,c=gi(n,i);a.props=c;var l=a.context,u=n.contextType;s=Pr,"object"===typeof u&&null!==u&&(s=To(u));var h=n.getDerivedStateFromProps;u="function"===typeof h||"function"===typeof a.getSnapshotBeforeUpdate,i=t.pendingProps!==i,u||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(i||l!==s)&&mi(t,a,r,s),na=!1;var d=t.memoizedState;a.state=d,ha(t,r,a,o),ua(),l=t.memoizedState,i||d!==l||na?("function"===typeof h&&(di(t,n,h,r),l=t.memoizedState),(c=na||fi(t,n,c,r,d,l,s))?(u||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=s,r=c):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,oa(e,t),u=gi(n,s=t.memoizedProps),a.props=u,h=t.pendingProps,d=a.context,l=n.contextType,c=Pr,"object"===typeof l&&null!==l&&(c=To(l)),(l="function"===typeof(i=n.getDerivedStateFromProps)||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==h||d!==c)&&mi(t,a,r,c),na=!1,d=t.memoizedState,a.state=d,ha(t,r,a,o),ua();var p=t.memoizedState;s!==h||d!==p||na||null!==e&&null!==e.dependencies&&Co(e.dependencies)?("function"===typeof i&&(di(t,n,i,r),p=t.memoizedState),(u=na||fi(t,n,u,r,d,p,c)||null!==e&&null!==e.dependencies&&Co(e.dependencies))?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,c),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=c,r=u):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Pi(e,t),r=0!==(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!==typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=ni(t,e.child,null,o),t.child=ni(t,null,n,o)):Ni(e,t,n,o),t.memoizedState=a.state,e=t.child):e=Qi(e,t,o),e}function zi(e,t,n,r){return fo(),t.flags|=256,Ni(e,t,n,r),t.child}var Bi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qi(e){return{baseLanes:e,cachePool:Go()}}function Wi(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=gl),e}function ji(e,t,n){var r,o=t.pendingProps,a=!1,i=0!==(128&t.flags);if((r=i)||(r=(null===e||null!==e.memoizedState)&&0!==(2&ui.current)),r&&(a=!0,t.flags&=-129),r=0!==(32&t.flags),t.flags&=-33,null===e){if(ao){if(a?si(t):ci(),ao){var c,l=oo;if(c=l){e:{for(c=l,l=io;8!==c.nodeType;){if(!l){l=null;break e}if(null===(c=yh(c.nextSibling))){l=null;break e}}l=c}null!==l?(t.memoizedState={dehydrated:l,treeContext:null!==Yr?{id:Jr,overflow:Zr}:null,retryLane:536870912,hydrationErrors:null},(c=Fr(18,null,null,0)).stateNode=l,c.return=t,t.child=c,ro=t,oo=null,c=!0):c=!1}c||lo(t)}if(null!==(l=t.memoizedState)&&null!==(l=l.dehydrated))return gh(l)?t.lanes=32:t.lanes=536870912,null;li(t)}return l=o.children,o=o.fallback,a?(ci(),l=Ui({mode:"hidden",children:l},a=t.mode),o=Wr(o,a,n,null),l.return=t,o.return=t,l.sibling=o,t.child=l,(a=t.child).memoizedState=qi(n),a.childLanes=Wi(e,r,n),t.memoizedState=Bi,o):(si(t),Vi(t,l))}if(null!==(c=e.memoizedState)&&null!==(l=c.dehydrated)){if(i)256&t.flags?(si(t),t.flags&=-257,t=Gi(e,t,n)):null!==t.memoizedState?(ci(),t.child=e.child,t.flags|=128,t=null):(ci(),a=o.fallback,l=t.mode,o=Ui({mode:"visible",children:o.children},l),(a=Wr(a,l,n,null)).flags|=2,o.return=t,a.return=t,o.sibling=a,t.child=o,ni(t,e.child,null,n),(o=t.child).memoizedState=qi(n),o.childLanes=Wi(e,r,n),t.memoizedState=Bi,t=a);else if(si(t),gh(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var u=r.dgst;r=u,(o=Error(s(419))).stack="",o.digest=r,go({value:o,source:null,stack:null}),t=Gi(e,t,n)}else if(Ti||_o(e,t,n,!1),r=0!==(n&e.childLanes),Ti||r){if(null!==(r=rl)&&(0!==(o=0!==((o=0!==(42&(o=n&-n))?1:Ne(o))&(r.suspendedLanes|n))?0:o)&&o!==c.retryLane))throw c.retryLane=o,Rr(e,o),Fl(r,e,o),Ii;"$?"===l.data||Kl(),t=Gi(e,t,n)}else"$?"===l.data?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,oo=yh(l.nextSibling),ro=t,ao=!0,so=null,io=!1,null!==e&&(Xr[Qr++]=Jr,Xr[Qr++]=Zr,Xr[Qr++]=Yr,Jr=e.id,Zr=e.overflow,Yr=t),(t=Vi(t,o.children)).flags|=4096);return t}return a?(ci(),a=o.fallback,l=t.mode,u=(c=e.child).sibling,(o=zr(c,{mode:"hidden",children:o.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?a=zr(u,a):(a=Wr(a,l,n,null)).flags|=2,a.return=t,o.return=t,o.sibling=a,t.child=o,o=a,a=t.child,null===(l=e.child.memoizedState)?l=qi(n):(null!==(c=l.cachePool)?(u=Mo._currentValue,c=c.parent!==u?{parent:u,pool:u}:c):c=Go(),l={baseLanes:l.baseLanes|n,cachePool:c}),a.memoizedState=l,a.childLanes=Wi(e,r,n),t.memoizedState=Bi,o):(si(t),e=(n=e.child).sibling,(n=zr(n,{mode:"visible",children:o.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Vi(e,t){return(t=Ui({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ui(e,t){return(e=Fr(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Gi(e,t,n){return ni(t,e.child,null,n),(e=Vi(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Hi(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ko(e.return,t,n)}function Ki(e,t,n,r,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=o)}function Xi(e,t,n){var r=t.pendingProps,o=r.revealOrder,a=r.tail;if(Ni(e,t,r.children,n),0!==(2&(r=ui.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Hi(e,n,t);else if(19===e.tag)Hi(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(W(ui,r),o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===hi(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),Ki(t,!1,o,n,a);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===hi(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}Ki(t,!0,n,null,a);break;case"together":Ki(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Qi(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),pl|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(_o(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=zr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Yi(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Co(e))}function Ji(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ti=!0;else{if(!Yi(e,n)&&0===(128&t.flags))return Ti=!1,function(e,t,n){switch(t.tag){case 3:H(t,t.stateNode.containerInfo),wo(0,Mo,e.memoizedState.cache),fo();break;case 27:case 5:X(t);break;case 4:H(t,t.stateNode.containerInfo);break;case 10:wo(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(si(t),t.flags|=128,null):0!==(n&t.child.childLanes)?ji(e,t,n):(si(t),null!==(e=Qi(e,t,n))?e.sibling:null);si(t);break;case 19:var o=0!==(128&e.flags);if((r=0!==(n&t.childLanes))||(_o(e,t,n,!1),r=0!==(n&t.childLanes)),o){if(r)return Xi(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),W(ui,ui.current),r)break;return null;case 22:case 23:return t.lanes=0,Oi(e,t,n);case 24:wo(0,Mo,e.memoizedState.cache)}return Qi(e,t,n)}(e,t,n);Ti=0!==(131072&e.flags)}else Ti=!1,ao&&0!==(1048576&t.flags)&&eo(t,Kr,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var r=t.elementType,o=r._init;if(r=o(r._payload),t.type=r,"function"!==typeof r){if(void 0!==r&&null!==r){if((o=r.$$typeof)===k){t.tag=11,t=Ei(null,t,r,e,n);break e}if(o===C){t.tag=14,t=Ai(null,t,r,e,n);break e}}throw t=O(r)||r,Error(s(306,t,""))}Lr(r)?(e=gi(r,e),t.tag=1,t=Li(null,t,r,e,n)):(t.tag=0,t=Di(null,t,r,e,n))}return t;case 0:return Di(e,t,t.type,t.pendingProps,n);case 1:return Li(e,t,r=t.type,o=gi(r,t.pendingProps),n);case 3:e:{if(H(t,t.stateNode.containerInfo),null===e)throw Error(s(387));r=t.pendingProps;var a=t.memoizedState;o=a.element,oa(e,t),ha(t,r,null,n);var i=t.memoizedState;if(r=i.cache,wo(0,Mo,r),r!==a.cache&&So(t,[Mo],n,!0),ua(),r=i.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:i.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=zi(e,t,r,n);break e}if(r!==o){go(o=_r(Error(s(424)),t)),t=zi(e,t,r,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(oo=yh(e.firstChild),ro=t,ao=!0,so=null,io=!0,n=ri(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),r===o){t=Qi(e,t,n);break e}Ni(e,t,r,n)}t=t.child}return t;case 26:return Pi(e,t),null===e?(n=Nh(t.type,null,t.pendingProps,null))?t.memoizedState=n:ao||(n=t.type,e=t.pendingProps,(r=rh(U.current).createElement(n))[Oe]=t,r[Me]=e,eh(r,n,e),Ge(r),t.stateNode=r):t.memoizedState=Nh(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&ao&&(r=t.stateNode=wh(t.type,t.pendingProps,U.current),ro=t,io=!0,o=oo,ph(t.type)?(bh=o,oo=yh(r.firstChild)):oo=o),Ni(e,t,t.pendingProps.children,n),Pi(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ao&&((o=r=oo)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var o=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Be])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==o.rel||e.getAttribute("href")!==(null==o.href||""===o.href?null:o.href)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin)||e.getAttribute("title")!==(null==o.title?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==o.src?null:o.src)||e.getAttribute("type")!==(null==o.type?null:o.type)||e.getAttribute("crossorigin")!==(null==o.crossOrigin?null:o.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==o.name?null:""+o.name;if("hidden"===o.type&&e.getAttribute("name")===a)return e}if(null===(e=yh(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,io))?(t.stateNode=r,ro=t,oo=yh(r.firstChild),io=!1,o=!0):o=!1),o||lo(t)),X(t),o=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,r=a.children,sh(o,a)?r=null:null!==i&&sh(o,i)&&(t.flags|=32),null!==t.memoizedState&&(o=Oa(e,t,Da,null,null,n),Xh._currentValue=o),Pi(e,t),Ni(e,t,r,n),t.child;case 6:return null===e&&ao&&((e=n=oo)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=yh(e.nextSibling)))return null}return e}(n,t.pendingProps,io))?(t.stateNode=n,ro=t,oo=null,e=!0):e=!1),e||lo(t)),null;case 13:return ji(e,t,n);case 4:return H(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ni(t,null,r,n):Ni(e,t,r,n),t.child;case 11:return Ei(e,t,t.type,t.pendingProps,n);case 7:return Ni(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ni(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,wo(0,t.type,r.value),Ni(e,t,r.children,n),t.child;case 9:return o=t.type._context,r=t.pendingProps.children,Io(t),r=r(o=To(o)),t.flags|=1,Ni(e,t,r,n),t.child;case 14:return Ai(e,t,t.type,t.pendingProps,n);case 15:return Ri(e,t,t.type,t.pendingProps,n);case 19:return Xi(e,t,n);case 31:return r=t.pendingProps,n=t.mode,r={mode:r.mode,children:r.children},null===e?((n=Ui(r,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=zr(e.child,r)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Oi(e,t,n);case 24:return Io(t),r=To(Mo),null===e?(null===(o=Vo())&&(o=rl,a=Po(),o.pooledCache=a,a.refCount++,null!==a&&(o.pooledCacheLanes|=n),o=a),t.memoizedState={parent:r,cache:o},ra(t),wo(0,Mo,o)):(0!==(e.lanes&n)&&(oa(e,t),ha(t,null,null,n),ua()),o=e.memoizedState,a=t.memoizedState,o.parent!==r?(o={parent:r,cache:r},t.memoizedState=o,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=o),wo(0,Mo,r)):(r=a.cache,wo(0,Mo,r),r!==o.cache&&So(t,[Mo],n,!0))),Ni(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function Zi(e){e.flags|=4}function $i(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Wh(t)){if(null!==(t=oi.current)&&((4194048&al)===al?null!==ai:(62914560&al)!==al&&0===(536870912&al)||t!==ai))throw $o=Qo,Ko;e.flags|=8192}}function ec(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Se():536870912,e.lanes|=t,yl|=t)}function tc(e,t){if(!ao)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nc(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=65011712&o.subtreeFlags,r|=65011712&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function rc(e,t,n){var r=t.pendingProps;switch(no(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nc(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),xo(Mo),K(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(po(t)?Zi(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,mo())),nc(t),null;case 26:return n=t.memoizedState,null===e?(Zi(t),null!==n?(nc(t),$i(t,n)):(nc(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Zi(t),nc(t),$i(t,n)):(nc(t),t.flags&=-16777217):(e.memoizedProps!==r&&Zi(t),nc(t),t.flags&=-16777217),null;case 27:Q(t),n=U.current;var o=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Zi(t);else{if(!r){if(null===t.stateNode)throw Error(s(166));return nc(t),null}e=j.current,po(t)?uo(t):(e=wh(o,r,n),t.stateNode=e,Zi(t))}return nc(t),null;case 5:if(Q(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&Zi(t);else{if(!r){if(null===t.stateNode)throw Error(s(166));return nc(t),null}if(e=j.current,po(t))uo(t);else{switch(o=rh(U.current),e){case 1:e=o.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=o.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=o.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=o.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=o.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof r.is?o.createElement("select",{is:r.is}):o.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"===typeof r.is?o.createElement(n,{is:r.is}):o.createElement(n)}}e[Oe]=t,e[Me]=r;e:for(o=t.child;null!==o;){if(5===o.tag||6===o.tag)e.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;null===o.sibling;){if(null===o.return||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=e;e:switch(eh(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Zi(t)}}return nc(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&Zi(t);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(e=U.current,po(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(o=ro))switch(o.tag){case 27:case 5:r=o.memoizedProps}e[Oe]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||Yu(e.nodeValue,n)))||lo(t)}else(e=rh(e).createTextNode(r))[Oe]=t,t.stateNode=e}return nc(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(o=po(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(s(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(s(317));o[Oe]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nc(t),o=!1}else o=mo(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return 256&t.flags?(li(t),t):(li(t),null)}if(li(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){o=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(o=r.alternate.memoizedState.cachePool.pool);var a=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(a=r.memoizedState.cachePool.pool),a!==o&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),ec(t,t.updateQueue),nc(t),null;case 4:return K(),null===e&&qu(t.stateNode.containerInfo),nc(t),null;case 10:return xo(t.type),nc(t),null;case 19:if(q(ui),null===(o=t.memoizedState))return nc(t),null;if(r=0!==(128&t.flags),null===(a=o.rendering))if(r)tc(o,!1);else{if(0!==dl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=hi(e))){for(t.flags|=128,tc(o,!1),e=a.updateQueue,t.updateQueue=e,ec(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Br(n,e),n=n.sibling;return W(ui,1&ui.current|2),t.child}e=e.sibling}null!==o.tail&&te()>kl&&(t.flags|=128,r=!0,tc(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=hi(a))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,ec(t,e),tc(o,!0),null===o.tail&&"hidden"===o.tailMode&&!a.alternate&&!ao)return nc(t),null}else 2*te()-o.renderingStartTime>kl&&536870912!==n&&(t.flags|=128,r=!0,tc(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=o.last)?e.sibling=a:t.child=a,o.last=a)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=te(),t.sibling=null,e=ui.current,W(ui,r?1&e|2:1&e),t):(nc(t),null);case 22:case 23:return li(t),ba(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!==(536870912&n)&&0===(128&t.flags)&&(nc(t),6&t.subtreeFlags&&(t.flags|=8192)):nc(t),null!==(n=t.updateQueue)&&ec(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&q(jo),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xo(Mo),nc(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function oc(e,t){switch(no(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xo(Mo),K(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Q(t),null;case 13:if(li(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return q(ui),null;case 4:return K(),null;case 10:return xo(t.type),null;case 22:case 23:return li(t),ba(),null!==e&&q(jo),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xo(Mo),null;default:return null}}function ac(e,t){switch(no(t),t.tag){case 3:xo(Mo),K();break;case 26:case 27:case 5:Q(t);break;case 4:K();break;case 13:li(t);break;case 19:q(ui);break;case 10:xo(t.type);break;case 22:case 23:li(t),ba(),null!==e&&q(jo);break;case 24:xo(Mo)}}function sc(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var o=r.next;n=o;do{if((n.tag&e)===e){r=void 0;var a=n.create,s=n.inst;r=a(),s.destroy=r}n=n.next}while(n!==o)}}catch(i){uu(t,t.return,i)}}function ic(e,t,n){try{var r=t.updateQueue,o=null!==r?r.lastEffect:null;if(null!==o){var a=o.next;r=a;do{if((r.tag&e)===e){var s=r.inst,i=s.destroy;if(void 0!==i){s.destroy=void 0,o=t;var c=n,l=i;try{l()}catch(u){uu(o,c,u)}}}r=r.next}while(r!==a)}}catch(u){uu(t,t.return,u)}}function cc(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{pa(t,n)}catch(r){uu(e,e.return,r)}}}function lc(e,t,n){n.props=gi(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){uu(e,t,r)}}function uc(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"===typeof n?e.refCleanup=n(r):n.current=r}}catch(o){uu(e,t,o)}}function hc(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"===typeof r)try{r()}catch(o){uu(e,t,o)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(a){uu(e,t,a)}else n.current=null}function dc(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(o){uu(e,e.return,o)}}function pc(e,t,n){try{var r=e.stateNode;!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,a=null,i=null,c=null,l=null,u=null,h=null;for(f in n){var d=n[f];if(n.hasOwnProperty(f)&&null!=d)switch(f){case"checked":case"value":break;case"defaultValue":l=d;default:r.hasOwnProperty(f)||Zu(e,t,f,null,r,d)}}for(var p in r){var f=r[p];if(d=n[p],r.hasOwnProperty(p)&&(null!=f||null!=d))switch(p){case"type":a=f;break;case"name":o=f;break;case"checked":u=f;break;case"defaultChecked":h=f;break;case"value":i=f;break;case"defaultValue":c=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,t));break;default:f!==d&&Zu(e,t,p,f,r,d)}}return void gt(e,i,c,l,u,h,a,o);case"select":for(a in f=i=c=p=null,n)if(l=n[a],n.hasOwnProperty(a)&&null!=l)switch(a){case"value":break;case"multiple":f=l;default:r.hasOwnProperty(a)||Zu(e,t,a,null,r,l)}for(o in r)if(a=r[o],l=n[o],r.hasOwnProperty(o)&&(null!=a||null!=l))switch(o){case"value":p=a;break;case"defaultValue":c=a;break;case"multiple":i=a;default:a!==l&&Zu(e,t,o,a,r,l)}return t=c,n=i,r=f,void(null!=p?vt(e,!!n,p,!1):!!r!==!!n&&(null!=t?vt(e,!!n,t,!0):vt(e,!!n,n?[]:"",!1)));case"textarea":for(c in f=p=null,n)if(o=n[c],n.hasOwnProperty(c)&&null!=o&&!r.hasOwnProperty(c))switch(c){case"value":case"children":break;default:Zu(e,t,c,null,r,o)}for(i in r)if(o=r[i],a=n[i],r.hasOwnProperty(i)&&(null!=o||null!=a))switch(i){case"value":p=o;break;case"defaultValue":f=o;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=o)throw Error(s(91));break;default:o!==a&&Zu(e,t,i,o,r,a)}return void wt(e,p,f);case"option":for(var m in n)if(p=n[m],n.hasOwnProperty(m)&&null!=p&&!r.hasOwnProperty(m))if("selected"===m)e.selected=!1;else Zu(e,t,m,null,r,p);for(l in r)if(p=r[l],f=n[l],r.hasOwnProperty(l)&&p!==f&&(null!=p||null!=f))if("selected"===l)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else Zu(e,t,l,p,r,f);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!r.hasOwnProperty(g)&&Zu(e,t,g,null,r,p);for(u in r)if(p=r[u],f=n[u],r.hasOwnProperty(u)&&p!==f&&(null!=p||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(s(137,t));break;default:Zu(e,t,u,p,r,f)}return;default:if(It(t)){for(var y in n)p=n[y],n.hasOwnProperty(y)&&void 0!==p&&!r.hasOwnProperty(y)&&$u(e,t,y,void 0,r,p);for(h in r)p=r[h],f=n[h],!r.hasOwnProperty(h)||p===f||void 0===p&&void 0===f||$u(e,t,h,p,r,f);return}}for(var b in n)p=n[b],n.hasOwnProperty(b)&&null!=p&&!r.hasOwnProperty(b)&&Zu(e,t,b,null,r,p);for(d in r)p=r[d],f=n[d],!r.hasOwnProperty(d)||p===f||null==p&&null==f||Zu(e,t,d,p,r,f)}(r,e.type,n,t),r[Me]=t}catch(o){uu(e,e.return,o)}}function fc(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&ph(e.type)||4===e.tag}function mc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||fc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&ph(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Ju));else if(4!==r&&(27===r&&ph(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(gc(e,t,n),e=e.sibling;null!==e;)gc(e,t,n),e=e.sibling}function yc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&ph(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(yc(e,t,n),e=e.sibling;null!==e;)yc(e,t,n),e=e.sibling}function bc(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);eh(t,r,n),t[Oe]=e,t[Me]=n}catch(a){uu(e,e.return,a)}}var vc=!1,wc=!1,xc=!1,kc="function"===typeof WeakSet?WeakSet:Set,Sc=null;function _c(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Lc(e,n),4&r&&sc(5,n);break;case 1:if(Lc(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){uu(n,n.return,s)}else{var o=gi(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(i){uu(n,n.return,i)}}64&r&&cc(n),512&r&&uc(n,n.return);break;case 3:if(Lc(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{pa(e,t)}catch(s){uu(n,n.return,s)}}break;case 27:null===t&&4&r&&bc(n);case 26:case 5:Lc(e,n),null===t&&4&r&&dc(n),512&r&&uc(n,n.return);break;case 12:Lc(e,n);break;case 13:Lc(e,n),4&r&&Ac(e,n),64&r&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=fu.bind(null,n))));break;case 22:if(!(r=null!==n.memoizedState||vc)){t=null!==t&&null!==t.memoizedState||wc,o=vc;var a=wc;vc=r,(wc=t)&&!a?Bc(e,n,0!==(8772&n.subtreeFlags)):Lc(e,n),vc=o,wc=a}break;case 30:break;default:Lc(e,n)}}function Cc(e){var t=e.alternate;null!==t&&(e.alternate=null,Cc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&qe(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ic=null,Tc=!1;function Nc(e,t,n){for(n=n.child;null!==n;)Ec(e,t,n),n=n.sibling}function Ec(e,t,n){if(he&&"function"===typeof he.onCommitFiberUnmount)try{he.onCommitFiberUnmount(ue,n)}catch(a){}switch(n.tag){case 26:wc||hc(n,t),Nc(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:wc||hc(n,t);var r=Ic,o=Tc;ph(n.type)&&(Ic=n.stateNode,Tc=!1),Nc(e,t,n),xh(n.stateNode),Ic=r,Tc=o;break;case 5:wc||hc(n,t);case 6:if(r=Ic,o=Tc,Ic=null,Nc(e,t,n),Tc=o,null!==(Ic=r))if(Tc)try{(9===Ic.nodeType?Ic.body:"HTML"===Ic.nodeName?Ic.ownerDocument.body:Ic).removeChild(n.stateNode)}catch(s){uu(n,t,s)}else try{Ic.removeChild(n.stateNode)}catch(s){uu(n,t,s)}break;case 18:null!==Ic&&(Tc?(fh(9===(e=Ic).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Td(e)):fh(Ic,n.stateNode));break;case 4:r=Ic,o=Tc,Ic=n.stateNode.containerInfo,Tc=!0,Nc(e,t,n),Ic=r,Tc=o;break;case 0:case 11:case 14:case 15:wc||ic(2,n,t),wc||ic(4,n,t),Nc(e,t,n);break;case 1:wc||(hc(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount&&lc(n,t,r)),Nc(e,t,n);break;case 21:Nc(e,t,n);break;case 22:wc=(r=wc)||null!==n.memoizedState,Nc(e,t,n),wc=r;break;default:Nc(e,t,n)}}function Ac(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Td(e)}catch(n){uu(t,t.return,n)}}function Rc(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new kc),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new kc),t;default:throw Error(s(435,e.tag))}}(e);t.forEach((function(t){var r=mu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}function Oc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r],a=e,i=t,c=i;e:for(;null!==c;){switch(c.tag){case 27:if(ph(c.type)){Ic=c.stateNode,Tc=!1;break e}break;case 5:Ic=c.stateNode,Tc=!1;break e;case 3:case 4:Ic=c.stateNode.containerInfo,Tc=!0;break e}c=c.return}if(null===Ic)throw Error(s(160));Ec(a,i,o),Ic=null,Tc=!1,null!==(a=o.alternate)&&(a.return=null),o.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Pc(t,e),t=t.sibling}var Mc=null;function Pc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Oc(t,e),Dc(e),4&r&&(ic(3,e,e.return),sc(3,e),ic(5,e,e.return));break;case 1:Oc(t,e),Dc(e),512&r&&(wc||null===n||hc(n,n.return)),64&r&&vc&&(null!==(e=e.updateQueue)&&(null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))));break;case 26:var o=Mc;if(Oc(t,e),Dc(e),512&r&&(wc||null===n||hc(n,n.return)),4&r){var a=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,o=o.ownerDocument||o;t:switch(r){case"title":(!(a=o.getElementsByTagName("title")[0])||a[Be]||a[Oe]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=o.createElement(r),o.head.insertBefore(a,o.querySelector("head > title"))),eh(a,r,n),a[Oe]=e,Ge(a),r=a;break e;case"link":var i=Bh("link","href",o).get(r+(n.href||""));if(i)for(var c=0;c<i.length;c++)if((a=i[c]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&a.getAttribute("rel")===(null==n.rel?null:n.rel)&&a.getAttribute("title")===(null==n.title?null:n.title)&&a.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){i.splice(c,1);break t}eh(a=o.createElement(r),r,n),o.head.appendChild(a);break;case"meta":if(i=Bh("meta","content",o).get(r+(n.content||"")))for(c=0;c<i.length;c++)if((a=i[c]).getAttribute("content")===(null==n.content?null:""+n.content)&&a.getAttribute("name")===(null==n.name?null:n.name)&&a.getAttribute("property")===(null==n.property?null:n.property)&&a.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&a.getAttribute("charset")===(null==n.charSet?null:n.charSet)){i.splice(c,1);break t}eh(a=o.createElement(r),r,n),o.head.appendChild(a);break;default:throw Error(s(468,r))}a[Oe]=e,Ge(a),r=a}e.stateNode=r}else qh(o,e.type,e.stateNode);else e.stateNode=Ph(o,r,e.memoizedProps);else a!==r?(null===a?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):a.count--,null===r?qh(o,e.type,e.stateNode):Ph(o,r,e.memoizedProps)):null===r&&null!==e.stateNode&&pc(e,e.memoizedProps,n.memoizedProps)}break;case 27:Oc(t,e),Dc(e),512&r&&(wc||null===n||hc(n,n.return)),null!==n&&4&r&&pc(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Oc(t,e),Dc(e),512&r&&(wc||null===n||hc(n,n.return)),32&e.flags){o=e.stateNode;try{kt(o,"")}catch(f){uu(e,e.return,f)}}4&r&&null!=e.stateNode&&pc(e,o=e.memoizedProps,null!==n?n.memoizedProps:o),1024&r&&(xc=!0);break;case 6:if(Oc(t,e),Dc(e),4&r){if(null===e.stateNode)throw Error(s(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(f){uu(e,e.return,f)}}break;case 3:if(zh=null,o=Mc,Mc=_h(t.containerInfo),Oc(t,e),Mc=o,Dc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Td(t.containerInfo)}catch(f){uu(e,e.return,f)}xc&&(xc=!1,Fc(e));break;case 4:r=Mc,Mc=_h(e.stateNode.containerInfo),Oc(t,e),Dc(e),Mc=r;break;case 12:default:Oc(t,e),Dc(e);break;case 13:Oc(t,e),Dc(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(xl=te()),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Rc(e,r)));break;case 22:o=null!==e.memoizedState;var l=null!==n&&null!==n.memoizedState,u=vc,h=wc;if(vc=u||o,wc=h||l,Oc(t,e),wc=h,vc=u,Dc(e),8192&r)e:for(t=e.stateNode,t._visibility=o?-2&t._visibility:1|t._visibility,o&&(null===n||l||vc||wc||zc(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){l=n=t;try{if(a=l.stateNode,o)"function"===typeof(i=a.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{c=l.stateNode;var d=l.memoizedProps.style,p=void 0!==d&&null!==d&&d.hasOwnProperty("display")?d.display:null;c.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(f){uu(l,l.return,f)}}}else if(6===t.tag){if(null===n){l=t;try{l.stateNode.nodeValue=o?"":l.memoizedProps}catch(f){uu(l,l.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&(null!==(r=e.updateQueue)&&(null!==(n=r.retryQueue)&&(r.retryQueue=null,Rc(e,n))));break;case 19:Oc(t,e),Dc(e),4&r&&(null!==(r=e.updateQueue)&&(e.updateQueue=null,Rc(e,r)));case 30:case 21:}}function Dc(e){var t=e.flags;if(2&t){try{for(var n,r=e.return;null!==r;){if(fc(r)){n=r;break}r=r.return}if(null==n)throw Error(s(160));switch(n.tag){case 27:var o=n.stateNode;yc(e,mc(e),o);break;case 5:var a=n.stateNode;32&n.flags&&(kt(a,""),n.flags&=-33),yc(e,mc(e),a);break;case 3:case 4:var i=n.stateNode.containerInfo;gc(e,mc(e),i);break;default:throw Error(s(161))}}catch(c){uu(e,e.return,c)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Fc(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Fc(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Lc(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)_c(e,t.alternate,t),t=t.sibling}function zc(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:ic(4,t,t.return),zc(t);break;case 1:hc(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&lc(t,t.return,n),zc(t);break;case 27:xh(t.stateNode);case 26:case 5:hc(t,t.return),zc(t);break;case 22:null===t.memoizedState&&zc(t);break;default:zc(t)}e=e.sibling}}function Bc(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,o=e,a=t,s=a.flags;switch(a.tag){case 0:case 11:case 15:Bc(o,a,n),sc(4,a);break;case 1:if(Bc(o,a,n),"function"===typeof(o=(r=a).stateNode).componentDidMount)try{o.componentDidMount()}catch(l){uu(r,r.return,l)}if(null!==(o=(r=a).updateQueue)){var i=r.stateNode;try{var c=o.shared.hiddenCallbacks;if(null!==c)for(o.shared.hiddenCallbacks=null,o=0;o<c.length;o++)da(c[o],i)}catch(l){uu(r,r.return,l)}}n&&64&s&&cc(a),uc(a,a.return);break;case 27:bc(a);case 26:case 5:Bc(o,a,n),n&&null===r&&4&s&&dc(a),uc(a,a.return);break;case 12:Bc(o,a,n);break;case 13:Bc(o,a,n),n&&4&s&&Ac(o,a);break;case 22:null===a.memoizedState&&Bc(o,a,n),uc(a,a.return);break;case 30:break;default:Bc(o,a,n)}t=t.sibling}}function qc(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Do(n))}function Wc(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Do(e))}function jc(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Vc(e,t,n,r),t=t.sibling}function Vc(e,t,n,r){var o=t.flags;switch(t.tag){case 0:case 11:case 15:jc(e,t,n,r),2048&o&&sc(9,t);break;case 1:case 13:default:jc(e,t,n,r);break;case 3:jc(e,t,n,r),2048&o&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Do(e)));break;case 12:if(2048&o){jc(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,s=a.id,i=a.onPostCommit;"function"===typeof i&&i(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(c){uu(t,t.return,c)}}else jc(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,s=t.alternate,null!==t.memoizedState?2&a._visibility?jc(e,t,n,r):Gc(e,t):2&a._visibility?jc(e,t,n,r):(a._visibility|=2,Uc(e,t,n,r,0!==(10256&t.subtreeFlags))),2048&o&&qc(s,t);break;case 24:jc(e,t,n,r),2048&o&&Wc(t.alternate,t)}}function Uc(e,t,n,r,o){for(o=o&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var a=e,s=t,i=n,c=r,l=s.flags;switch(s.tag){case 0:case 11:case 15:Uc(a,s,i,c,o),sc(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?Uc(a,s,i,c,o):Gc(a,s):(u._visibility|=2,Uc(a,s,i,c,o)),o&&2048&l&&qc(s.alternate,s);break;case 24:Uc(a,s,i,c,o),o&&2048&l&&Wc(s.alternate,s);break;default:Uc(a,s,i,c,o)}t=t.sibling}}function Gc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,o=r.flags;switch(r.tag){case 22:Gc(n,r),2048&o&&qc(r.alternate,r);break;case 24:Gc(n,r),2048&o&&Wc(r.alternate,r);break;default:Gc(n,r)}t=t.sibling}}var Hc=8192;function Kc(e){if(e.subtreeFlags&Hc)for(e=e.child;null!==e;)Xc(e),e=e.sibling}function Xc(e){switch(e.tag){case 26:Kc(e),e.flags&Hc&&null!==e.memoizedState&&function(e,t,n){if(null===jh)throw Error(s(475));var r=jh;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var o=Eh(n.href),a=e.querySelector(Ah(o));if(a)return null!==(e=a._p)&&"object"===typeof e&&"function"===typeof e.then&&(r.count++,r=Uh.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=a,void Ge(a);a=e.ownerDocument||e,n=Rh(n),(o=kh.get(o))&&Fh(n,o),Ge(a=a.createElement("link"));var i=a;i._p=new Promise((function(e,t){i.onload=e,i.onerror=t})),eh(a,"link",n),t.instance=a}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(r.count++,t=Uh.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(Mc,e.memoizedState,e.memoizedProps);break;case 5:default:Kc(e);break;case 3:case 4:var t=Mc;Mc=_h(e.stateNode.containerInfo),Kc(e),Mc=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Hc,Hc=16777216,Kc(e),Hc=t):Kc(e))}}function Qc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Yc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Sc=r,$c(r,e)}Qc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Jc(e),e=e.sibling}function Jc(e){switch(e.tag){case 0:case 11:case 15:Yc(e),2048&e.flags&&ic(9,e,e.return);break;case 3:case 12:default:Yc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Zc(e)):Yc(e)}}function Zc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Sc=r,$c(r,e)}Qc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:ic(8,t,t.return),Zc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Zc(t));break;default:Zc(t)}e=e.sibling}}function $c(e,t){for(;null!==Sc;){var n=Sc;switch(n.tag){case 0:case 11:case 15:ic(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Do(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Sc=r;else e:for(n=e;null!==Sc;){var o=(r=Sc).sibling,a=r.return;if(Cc(r),r===n){Sc=null;break e}if(null!==o){o.return=a,Sc=o;break e}Sc=a}}}var el={getCacheForType:function(e){var t=To(Mo),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tl="function"===typeof WeakMap?WeakMap:Map,nl=0,rl=null,ol=null,al=0,sl=0,il=null,cl=!1,ll=!1,ul=!1,hl=0,dl=0,pl=0,fl=0,ml=0,gl=0,yl=0,bl=null,vl=null,wl=!1,xl=0,kl=1/0,Sl=null,_l=null,Cl=0,Il=null,Tl=null,Nl=0,El=0,Al=null,Rl=null,Ol=0,Ml=null;function Pl(){if(0!==(2&nl)&&0!==al)return al&-al;if(null!==P.T){return 0!==zo?zo:Eu()}return Ae()}function Dl(){0===gl&&(gl=0===(536870912&al)||ao?ke():536870912);var e=oi.current;return null!==e&&(e.flags|=32),gl}function Fl(e,t,n){(e!==rl||2!==sl&&9!==sl)&&null===e.cancelPendingCommit||(Vl(e,0),ql(e,al,gl,!1)),Ce(e,n),0!==(2&nl)&&e===rl||(e===rl&&(0===(2&nl)&&(fl|=n),4===dl&&ql(e,al,gl,!1)),ku(e))}function Ll(e,t,n){if(0!==(6&nl))throw Error(s(327));for(var r=!n&&0===(124&t)&&0===(t&e.expiredLanes)||we(e,t),o=r?function(e,t){var n=nl;nl|=2;var r=Gl(),o=Hl();rl!==e||al!==t?(Sl=null,kl=te()+500,Vl(e,t)):ll=we(e,t);e:for(;;)try{if(0!==sl&&null!==ol){t=ol;var a=il;t:switch(sl){case 1:sl=0,il=null,$l(e,t,a,1);break;case 2:case 9:if(Yo(a)){sl=0,il=null,Zl(t);break}t=function(){2!==sl&&9!==sl||rl!==e||(sl=7),ku(e)},a.then(t,t);break e;case 3:sl=7;break e;case 4:sl=5;break e;case 7:Yo(a)?(sl=0,il=null,Zl(t)):(sl=0,il=null,$l(e,t,a,7));break;case 5:var i=null;switch(ol.tag){case 26:i=ol.memoizedState;case 5:case 27:var c=ol;if(!i||Wh(i)){sl=0,il=null;var l=c.sibling;if(null!==l)ol=l;else{var u=c.return;null!==u?(ol=u,eu(u)):ol=null}break t}}sl=0,il=null,$l(e,t,a,5);break;case 6:sl=0,il=null,$l(e,t,a,6);break;case 8:jl(),dl=6;break e;default:throw Error(s(462))}}Yl();break}catch(h){Ul(e,h)}return vo=bo=null,P.H=r,P.A=o,nl=n,null!==ol?0:(rl=null,al=0,Nr(),dl)}(e,t):Xl(e,t,!0),a=r;;){if(0===o){ll&&!r&&ql(e,t,0,!1);break}if(n=e.current.alternate,!a||Bl(n)){if(2===o){if(a=t,e.errorRecoveryDisabledLanes&a)var i=0;else i=0!==(i=-536870913&e.pendingLanes)?i:536870912&i?536870912:0;if(0!==i){t=i;e:{var c=e;o=bl;var l=c.current.memoizedState.isDehydrated;if(l&&(Vl(c,i).flags|=256),2!==(i=Xl(c,i,!1))){if(ul&&!l){c.errorRecoveryDisabledLanes|=a,fl|=a,o=4;break e}a=vl,vl=o,null!==a&&(null===vl?vl=a:vl.push.apply(vl,a))}o=i}if(a=!1,2!==o)continue}}if(1===o){Vl(e,0),ql(e,t,0,!0);break}e:{switch(r=e,a=o){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:ql(r,t,gl,!cl);break e;case 2:vl=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(o=xl+300-te())){if(ql(r,t,gl,!cl),0!==ve(r,0,!0))break e;r.timeoutHandle=ch(zl.bind(null,r,n,vl,Sl,wl,t,gl,fl,yl,cl,a,2,-0,0),o)}else zl(r,n,vl,Sl,wl,t,gl,fl,yl,cl,a,0,-0,0)}break}o=Xl(e,t,!1),a=!1}ku(e)}function zl(e,t,n,r,o,a,i,c,l,u,h,d,p,f){if(e.timeoutHandle=-1,(8192&(d=t.subtreeFlags)||16785408===(16785408&d))&&(jh={stylesheets:null,count:0,unsuspend:Vh},Xc(t),null!==(d=function(){if(null===jh)throw Error(s(475));var e=jh;return e.stylesheets&&0===e.count&&Hh(e,e.stylesheets),0<e.count?function(t){var n=setTimeout((function(){if(e.stylesheets&&Hh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=d(nu.bind(null,e,t,a,n,r,o,i,c,l,h,1,p,f)),void ql(e,a,i,!u);nu(e,t,a,n,r,o,i,c,l)}function Bl(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var r=0;r<n.length;r++){var o=n[r],a=o.getSnapshot;o=o.value;try{if(!Qn(a(),o))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ql(e,t,n,r){t&=~ml,t&=~fl,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var o=t;0<o;){var a=31-pe(o),s=1<<a;r[a]=-1,o&=~s}0!==n&&Ie(e,n,t)}function Wl(){return 0!==(6&nl)||(Su(0,!1),!1)}function jl(){if(null!==ol){if(0===sl)var e=ol.return;else vo=bo=null,za(e=ol),Qs=null,Ys=0,e=ol;for(;null!==e;)ac(e.alternate,e),e=e.return;ol=null}}function Vl(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,lh(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),jl(),rl=e,ol=n=zr(e.current,null),al=t,sl=0,il=null,cl=!1,ll=we(e,t),ul=!1,yl=gl=ml=fl=pl=dl=0,vl=bl=null,wl=!1,0!==(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var o=31-pe(r),a=1<<o;t|=e[o],r&=~a}return hl=t,Nr(),n}function Ul(e,t){wa=null,P.H=Gs,t===Ho||t===Xo?(t=ea(),sl=3):t===Ko?(t=ea(),sl=4):sl=t===Ii?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,il=t,null===ol&&(dl=1,xi(e,_r(t,e.current)))}function Gl(){var e=P.H;return P.H=Gs,null===e?Gs:e}function Hl(){var e=P.A;return P.A=el,e}function Kl(){dl=4,cl||(4194048&al)!==al&&null!==oi.current||(ll=!0),0===(134217727&pl)&&0===(134217727&fl)||null===rl||ql(rl,al,gl,!1)}function Xl(e,t,n){var r=nl;nl|=2;var o=Gl(),a=Hl();rl===e&&al===t||(Sl=null,Vl(e,t)),t=!1;var s=dl;e:for(;;)try{if(0!==sl&&null!==ol){var i=ol,c=il;switch(sl){case 8:jl(),s=6;break e;case 3:case 2:case 9:case 6:null===oi.current&&(t=!0);var l=sl;if(sl=0,il=null,$l(e,i,c,l),n&&ll){s=0;break e}break;default:l=sl,sl=0,il=null,$l(e,i,c,l)}}Ql(),s=dl;break}catch(u){Ul(e,u)}return t&&e.shellSuspendCounter++,vo=bo=null,nl=r,P.H=o,P.A=a,null===ol&&(rl=null,al=0,Nr()),s}function Ql(){for(;null!==ol;)Jl(ol)}function Yl(){for(;null!==ol&&!$();)Jl(ol)}function Jl(e){var t=Ji(e.alternate,e,hl);e.memoizedProps=e.pendingProps,null===t?eu(e):ol=t}function Zl(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Fi(n,t,t.pendingProps,t.type,void 0,al);break;case 11:t=Fi(n,t,t.pendingProps,t.type.render,t.ref,al);break;case 5:za(t);default:ac(n,t),t=Ji(n,t=ol=Br(t,hl),hl)}e.memoizedProps=e.pendingProps,null===t?eu(e):ol=t}function $l(e,t,n,r){vo=bo=null,za(t),Qs=null,Ys=0;var o=t.return;try{if(function(e,t,n,r,o){if(n.flags|=32768,null!==r&&"object"===typeof r&&"function"===typeof r.then){if(null!==(t=n.alternate)&&_o(t,n,o,!0),null!==(n=oi.current)){switch(n.tag){case 13:return null===ai?Kl():null===n.alternate&&0===dl&&(dl=3),n.flags&=-257,n.flags|=65536,n.lanes=o,r===Qo?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),hu(e,r,o)),!1;case 22:return n.flags|=65536,r===Qo?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),hu(e,r,o)),!1}throw Error(s(435,n.tag))}return hu(e,r,o),Kl(),!1}if(ao)return null!==(t=oi.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=o,r!==co&&go(_r(e=Error(s(422),{cause:r}),n))):(r!==co&&go(_r(t=Error(s(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,o&=-o,e.lanes|=o,r=_r(r,n),ca(e,o=Si(e.stateNode,r,o)),4!==dl&&(dl=2)),!1;var a=Error(s(520),{cause:r});if(a=_r(a,n),null===bl?bl=[a]:bl.push(a),4!==dl&&(dl=2),null===t)return!0;r=_r(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=o&-o,n.lanes|=e,ca(n,e=Si(n.stateNode,r,e)),!1;case 1:if(t=n.type,a=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==a&&"function"===typeof a.componentDidCatch&&(null===_l||!_l.has(a))))return n.flags|=65536,o&=-o,n.lanes|=o,Ci(o=_i(o),e,n,r),ca(n,o),!1}n=n.return}while(null!==n);return!1}(e,o,t,n,al))return dl=1,xi(e,_r(n,e.current)),void(ol=null)}catch(a){if(null!==o)throw ol=o,a;return dl=1,xi(e,_r(n,e.current)),void(ol=null)}32768&t.flags?(ao||1===r?e=!0:ll||0!==(536870912&al)?e=!1:(cl=e=!0,(2===r||9===r||3===r||6===r)&&(null!==(r=oi.current)&&13===r.tag&&(r.flags|=16384))),tu(t,e)):eu(t)}function eu(e){var t=e;do{if(0!==(32768&t.flags))return void tu(t,cl);e=t.return;var n=rc(t.alternate,t,hl);if(null!==n)return void(ol=n);if(null!==(t=t.sibling))return void(ol=t);ol=t=e}while(null!==t);0===dl&&(dl=5)}function tu(e,t){do{var n=oc(e.alternate,e);if(null!==n)return n.flags&=32767,void(ol=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(ol=e);ol=e=n}while(null!==e);dl=6,ol=null}function nu(e,t,n,r,o,a,i,c,l){e.cancelPendingCommit=null;do{iu()}while(0!==Cl);if(0!==(6&nl))throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(a=t.lanes|t.childLanes,function(e,t,n,r,o,a){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var i=e.entanglements,c=e.expirationTimes,l=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-pe(n),h=1<<u;i[u]=0,c[u]=-1;var d=l[u];if(null!==d)for(l[u]=null,u=0;u<d.length;u++){var p=d[u];null!==p&&(p.lane&=-536870913)}n&=~h}0!==r&&Ie(e,r,0),0!==a&&0===o&&0!==e.tag&&(e.suspendedLanes|=a&~(s&~t))}(e,n,a|=Tr,i,c,l),e===rl&&(ol=rl=null,al=0),Tl=t,Il=e,Nl=n,El=a,Al=o,Rl=r,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,J(ae,(function(){return cu(),null}))):(e.callbackNode=null,e.callbackPriority=0),r=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||r){r=P.T,P.T=null,o=D.p,D.p=2,i=nl,nl|=4;try{!function(e,t){if(e=e.containerInfo,th=nd,tr(e=er(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(g){n=null;break e}var i=0,c=-1,l=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==o&&3!==d.nodeType||(c=i+o),d!==a||0!==r&&3!==d.nodeType||(l=i+r),3===d.nodeType&&(i+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===o&&(c=i),p===a&&++h===r&&(l=i),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(nh={focusedElem:e,selectionRange:n},nd=!1,Sc=t;null!==Sc;)if(e=(t=Sc).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,Sc=e;else for(;null!==Sc;){switch(a=(t=Sc).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==a){e=void 0,n=t,o=a.memoizedProps,a=a.memoizedState,r=n.stateNode;try{var m=gi(n.type,o,(n.elementType,n.type));e=r.getSnapshotBeforeUpdate(m,a),r.__reactInternalSnapshotBeforeUpdate=e}catch(y){uu(n,n.return,y)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))mh(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":mh(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,Sc=e;break}Sc=t.return}}(e,t)}finally{nl=i,D.p=o,P.T=r}}Cl=1,ru(),ou(),au()}}function ru(){if(1===Cl){Cl=0;var e=Il,t=Tl,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=P.T,P.T=null;var r=D.p;D.p=2;var o=nl;nl|=4;try{Pc(t,e);var a=nh,s=er(e.containerInfo),i=a.focusedElem,c=a.selectionRange;if(s!==i&&i&&i.ownerDocument&&$n(i.ownerDocument.documentElement,i)){if(null!==c&&tr(i)){var l=c.start,u=c.end;if(void 0===u&&(u=l),"selectionStart"in i)i.selectionStart=l,i.selectionEnd=Math.min(u,i.value.length);else{var h=i.ownerDocument||document,d=h&&h.defaultView||window;if(d.getSelection){var p=d.getSelection(),f=i.textContent.length,m=Math.min(c.start,f),g=void 0===c.end?m:Math.min(c.end,f);!p.extend&&m>g&&(s=g,g=m,m=s);var y=Zn(i,m),b=Zn(i,g);if(y&&b&&(1!==p.rangeCount||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==b.node||p.focusOffset!==b.offset)){var v=h.createRange();v.setStart(y.node,y.offset),p.removeAllRanges(),m>g?(p.addRange(v),p.extend(b.node,b.offset)):(v.setEnd(b.node,b.offset),p.addRange(v))}}}}for(h=[],p=i;p=p.parentNode;)1===p.nodeType&&h.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<h.length;i++){var w=h[i];w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}nd=!!th,nh=th=null}finally{nl=o,D.p=r,P.T=n}}e.current=t,Cl=2}}function ou(){if(2===Cl){Cl=0;var e=Il,t=Tl,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=P.T,P.T=null;var r=D.p;D.p=2;var o=nl;nl|=4;try{_c(e,t.alternate,t)}finally{nl=o,D.p=r,P.T=n}}Cl=3}}function au(){if(4===Cl||3===Cl){Cl=0,ee();var e=Il,t=Tl,n=Nl,r=Rl;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Cl=5:(Cl=0,Tl=Il=null,su(e,e.pendingLanes));var o=e.pendingLanes;if(0===o&&(_l=null),Ee(n),t=t.stateNode,he&&"function"===typeof he.onCommitFiberRoot)try{he.onCommitFiberRoot(ue,t,void 0,128===(128&t.current.flags))}catch(c){}if(null!==r){t=P.T,o=D.p,D.p=2,P.T=null;try{for(var a=e.onRecoverableError,s=0;s<r.length;s++){var i=r[s];a(i.value,{componentStack:i.stack})}}finally{P.T=t,D.p=o}}0!==(3&Nl)&&iu(),ku(e),o=e.pendingLanes,0!==(4194090&n)&&0!==(42&o)?e===Ml?Ol++:(Ol=0,Ml=e):Ol=0,Su(0,!1)}}function su(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Do(t)))}function iu(e){return ru(),ou(),au(),cu()}function cu(){if(5!==Cl)return!1;var e=Il,t=El;El=0;var n=Ee(Nl),r=P.T,o=D.p;try{D.p=32>n?32:n,P.T=null,n=Al,Al=null;var a=Il,i=Nl;if(Cl=0,Tl=Il=null,Nl=0,0!==(6&nl))throw Error(s(331));var c=nl;if(nl|=4,Jc(a.current),Vc(a,a.current,i,n),nl=c,Su(0,!1),he&&"function"===typeof he.onPostCommitFiberRoot)try{he.onPostCommitFiberRoot(ue,a)}catch(l){}return!0}finally{D.p=o,P.T=r,su(e,t)}}function lu(e,t,n){t=_r(n,t),null!==(e=sa(e,t=Si(e.stateNode,t,2),2))&&(Ce(e,2),ku(e))}function uu(e,t,n){if(3===e.tag)lu(e,e,n);else for(;null!==t;){if(3===t.tag){lu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===_l||!_l.has(r))){e=_r(n,e),null!==(r=sa(t,n=_i(2),2))&&(Ci(n,r,t,e),Ce(r,2),ku(r));break}}t=t.return}}function hu(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new tl;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(ul=!0,o.add(n),e=du.bind(null,e,t,n),t.then(e,e))}function du(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,rl===e&&(al&n)===n&&(4===dl||3===dl&&(62914560&al)===al&&300>te()-xl?0===(2&nl)&&Vl(e,0):ml|=n,yl===al&&(yl=0)),ku(e)}function pu(e,t){0===t&&(t=Se()),null!==(e=Rr(e,t))&&(Ce(e,t),ku(e))}function fu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),pu(e,n)}function mu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==r&&r.delete(t),pu(e,n)}var gu=null,yu=null,bu=!1,vu=!1,wu=!1,xu=0;function ku(e){e!==yu&&null===e.next&&(null===yu?gu=yu=e:yu=yu.next=e),vu=!0,bu||(bu=!0,hh((function(){0!==(6&nl)?J(re,_u):Cu()})))}function Su(e,t){if(!wu&&vu){wu=!0;do{for(var n=!1,r=gu;null!==r;){if(!t)if(0!==e){var o=r.pendingLanes;if(0===o)var a=0;else{var s=r.suspendedLanes,i=r.pingedLanes;a=(1<<31-pe(42|e)+1)-1,a=201326741&(a&=o&~(s&~i))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,Nu(r,a))}else a=al,0===(3&(a=ve(r,r===rl?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||we(r,a)||(n=!0,Nu(r,a));r=r.next}}while(n);wu=!1}}function _u(){Cu()}function Cu(){vu=bu=!1;var e=0;0!==xu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ih&&(ih=e,!0);return ih=null,!1}()&&(e=xu),xu=0);for(var t=te(),n=null,r=gu;null!==r;){var o=r.next,a=Iu(r,t);0===a?(r.next=null,null===n?gu=o:n.next=o,null===o&&(yu=n)):(n=r,(0!==e||0!==(3&a))&&(vu=!0)),r=o}Su(e,!1)}function Iu(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var s=31-pe(a),i=1<<s,c=o[s];-1===c?0!==(i&n)&&0===(i&r)||(o[s]=xe(i,t)):c<=t&&(e.expiredLanes|=i),a&=~i}if(n=al,n=ve(e,e===(t=rl)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===sl||9===sl)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&Z(r),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||we(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&Z(r),Ee(n)){case 2:case 8:n=oe;break;case 32:default:n=ae;break;case 268435456:n=ie}return r=Tu.bind(null,e),n=J(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&Z(r),e.callbackPriority=2,e.callbackNode=null,2}function Tu(e,t){if(0!==Cl&&5!==Cl)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(iu()&&e.callbackNode!==n)return null;var r=al;return 0===(r=ve(e,e===rl?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Ll(e,r,t),Iu(e,te()),null!=e.callbackNode&&e.callbackNode===n?Tu.bind(null,e):null)}function Nu(e,t){if(iu())return null;Ll(e,t,!0)}function Eu(){return 0===xu&&(xu=ke()),xu}function Au(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Et(""+e)}function Ru(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ou=0;Ou<xr.length;Ou++){var Mu=xr[Ou];kr(Mu.toLowerCase(),"on"+(Mu[0].toUpperCase()+Mu.slice(1)))}kr(pr,"onAnimationEnd"),kr(fr,"onAnimationIteration"),kr(mr,"onAnimationStart"),kr("dblclick","onDoubleClick"),kr("focusin","onFocus"),kr("focusout","onBlur"),kr(gr,"onTransitionRun"),kr(yr,"onTransitionStart"),kr(br,"onTransitionCancel"),kr(vr,"onTransitionEnd"),Qe("onMouseEnter",["mouseout","mouseover"]),Qe("onMouseLeave",["mouseout","mouseover"]),Qe("onPointerEnter",["pointerout","pointerover"]),Qe("onPointerLeave",["pointerout","pointerover"]),Xe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Du=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pu));function Fu(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var s=r.length-1;0<=s;s--){var i=r[s],c=i.instance,l=i.currentTarget;if(i=i.listener,c!==a&&o.isPropagationStopped())break e;a=i,o.currentTarget=l;try{a(o)}catch(u){yi(u)}o.currentTarget=null,a=c}else for(s=0;s<r.length;s++){if(c=(i=r[s]).instance,l=i.currentTarget,i=i.listener,c!==a&&o.isPropagationStopped())break e;a=i,o.currentTarget=l;try{a(o)}catch(u){yi(u)}o.currentTarget=null,a=c}}}}function Lu(e,t){var n=t[De];void 0===n&&(n=t[De]=new Set);var r=e+"__bubble";n.has(r)||(Wu(t,e,2,!1),n.add(r))}function zu(e,t,n){var r=0;t&&(r|=4),Wu(n,e,r,t)}var Bu="_reactListening"+Math.random().toString(36).slice(2);function qu(e){if(!e[Bu]){e[Bu]=!0,He.forEach((function(t){"selectionchange"!==t&&(Du.has(t)||zu(t,!1,e),zu(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Bu]||(t[Bu]=!0,zu("selectionchange",!1,t))}}function Wu(e,t,n,r){switch(ld(t)){case 2:var o=rd;break;case 8:o=od;break;default:o=ad}n=o.bind(null,t,n,e),o=void 0,!Bt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function ju(e,t,n,r,o){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var i=r.stateNode.containerInfo;if(i===o)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&s.stateNode.containerInfo===o)return;s=s.return}for(;null!==i;){if(null===(s=We(i)))return;if(5===(l=s.tag)||6===l||26===l||27===l){r=a=s;continue e}i=i.parentNode}}r=r.return}Ft((function(){var r=a,o=Rt(n),s=[];e:{var i=wr.get(e);if(void 0!==i){var l=$t,u=e;switch(e){case"keypress":if(0===Gt(n))break e;case"keydown":case"keyup":l=mn;break;case"focusin":u="focus",l=an;break;case"focusout":u="blur",l=an;break;case"beforeblur":case"afterblur":l=an;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=rn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=on;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=yn;break;case pr:case fr:case mr:l=sn;break;case vr:l=bn;break;case"scroll":case"scrollend":l=tn;break;case"wheel":l=vn;break;case"copy":case"cut":case"paste":l=cn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=gn;break;case"toggle":case"beforetoggle":l=wn}var h=0!==(4&t),d=!h&&("scroll"===e||"scrollend"===e),p=h?null!==i?i+"Capture":null:i;h=[];for(var f,m=r;null!==m;){var g=m;if(f=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===f||null===p||null!=(g=Lt(m,p))&&h.push(Vu(m,g,f)),d)break;m=m.return}0<h.length&&(i=new l(i,u,null,n,o),s.push({event:i,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(i="mouseover"===e||"pointerover"===e)||n===At||!(u=n.relatedTarget||n.fromElement)||!We(u)&&!u[Pe])&&(l||i)&&(i=o.window===o?o:(i=o.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=r,null!==(u=(u=n.relatedTarget||n.toElement)?We(u):null)&&(d=c(u),h=u.tag,u!==d||5!==h&&27!==h&&6!==h)&&(u=null)):(l=null,u=r),l!==u)){if(h=rn,g="onMouseLeave",p="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(h=gn,g="onPointerLeave",p="onPointerEnter",m="pointer"),d=null==l?i:Ve(l),f=null==u?i:Ve(u),(i=new h(g,m+"leave",l,n,o)).target=d,i.relatedTarget=f,g=null,We(o)===r&&((h=new h(p,m+"enter",u,n,o)).target=f,h.relatedTarget=d,g=h),d=g,l&&u)e:{for(p=u,m=0,f=h=l;f;f=Gu(f))m++;for(f=0,g=p;g;g=Gu(g))f++;for(;0<m-f;)h=Gu(h),m--;for(;0<f-m;)p=Gu(p),f--;for(;m--;){if(h===p||null!==p&&h===p.alternate)break e;h=Gu(h),p=Gu(p)}h=null}else h=null;null!==l&&Hu(s,i,l,h,!1),null!==u&&null!==d&&Hu(s,d,u,h,!0)}if("select"===(l=(i=r?Ve(r):window).nodeName&&i.nodeName.toLowerCase())||"input"===l&&"file"===i.type)var y=zn;else if(On(i))if(Bn)y=Xn;else{y=Hn;var b=Gn}else!(l=i.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==i.type&&"radio"!==i.type?r&&It(r.elementType)&&(y=zn):y=Kn;switch(y&&(y=y(e,r))?Mn(s,y,n,o):(b&&b(e,i,r),"focusout"===e&&r&&"number"===i.type&&null!=r.memoizedProps.value&&bt(i,"number",i.value)),b=r?Ve(r):window,e){case"focusin":(On(b)||"true"===b.contentEditable)&&(rr=b,or=r,ar=null);break;case"focusout":ar=or=rr=null;break;case"mousedown":sr=!0;break;case"contextmenu":case"mouseup":case"dragend":sr=!1,ir(s,n,o);break;case"selectionchange":if(nr)break;case"keydown":case"keyup":ir(s,n,o)}var v;if(kn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else An?Nn(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Cn&&"ko"!==n.locale&&(An||"onCompositionStart"!==w?"onCompositionEnd"===w&&An&&(v=Ut()):(jt="value"in(Wt=o)?Wt.value:Wt.textContent,An=!0)),0<(b=Uu(r,w)).length&&(w=new ln(w,e,null,n,o),s.push({event:w,listeners:b}),v?w.data=v:null!==(v=En(n))&&(w.data=v))),(v=_n?function(e,t){switch(e){case"compositionend":return En(t);case"keypress":return 32!==t.which?null:(Tn=!0,In);case"textInput":return(e=t.data)===In&&Tn?null:e;default:return null}}(e,n):function(e,t){if(An)return"compositionend"===e||!kn&&Nn(e,t)?(e=Ut(),Vt=jt=Wt=null,An=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Cn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(w=Uu(r,"onBeforeInput")).length&&(b=new ln("onBeforeInput","beforeinput",null,n,o),s.push({event:b,listeners:w}),b.data=v)),function(e,t,n,r,o){if("submit"===t&&n&&n.stateNode===o){var a=Au((o[Me]||null).action),s=r.submitter;s&&null!==(t=(t=s[Me]||null)?Au(t.formAction):s.getAttribute("formAction"))&&(a=t,s=null);var i=new $t("action","action",null,r,o);e.push({event:i,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==xu){var e=s?Ru(o,s):new FormData(o);Rs(n,{pending:!0,data:e,method:o.method,action:a},null,e)}}else"function"===typeof a&&(i.preventDefault(),e=s?Ru(o,s):new FormData(o),Rs(n,{pending:!0,data:e,method:o.method,action:a},a,e))},currentTarget:o}]})}}(s,e,r,n,o)}Fu(s,t)}))}function Vu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Uu(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,a=o.stateNode;if(5!==(o=o.tag)&&26!==o&&27!==o||null===a||(null!=(o=Lt(e,n))&&r.unshift(Vu(e,o,a)),null!=(o=Lt(e,t))&&r.push(Vu(e,o,a))),3===e.tag)return r;e=e.return}return[]}function Gu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Hu(e,t,n,r,o){for(var a=t._reactName,s=[];null!==n&&n!==r;){var i=n,c=i.alternate,l=i.stateNode;if(i=i.tag,null!==c&&c===r)break;5!==i&&26!==i&&27!==i||null===l||(c=l,o?null!=(l=Lt(n,a))&&s.unshift(Vu(n,l,c)):o||null!=(l=Lt(n,a))&&s.push(Vu(n,l,c))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Ku=/\r\n?/g,Xu=/\u0000|\uFFFD/g;function Qu(e){return("string"===typeof e?e:""+e).replace(Ku,"\n").replace(Xu,"")}function Yu(e,t){return t=Qu(t),Qu(e)===t}function Ju(){}function Zu(e,t,n,r,o,a){switch(n){case"children":"string"===typeof r?"body"===t||"textarea"===t&&""===r||kt(e,r):("number"===typeof r||"bigint"===typeof r)&&"body"!==t&&kt(e,""+r);break;case"className":nt(e,"class",r);break;case"tabIndex":nt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,r);break;case"style":Ct(e,r,a);break;case"data":if("object"!==t){nt(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==r||"function"===typeof r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Et(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"===typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof a&&("formAction"===n?("input"!==t&&Zu(e,t,"name",o.name,o,null),Zu(e,t,"formEncType",o.formEncType,o,null),Zu(e,t,"formMethod",o.formMethod,o,null),Zu(e,t,"formTarget",o.formTarget,o,null)):(Zu(e,t,"encType",o.encType,o,null),Zu(e,t,"method",o.method,o,null),Zu(e,t,"target",o.target,o,null))),null==r||"symbol"===typeof r||"boolean"===typeof r){e.removeAttribute(n);break}r=Et(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=Ju);break;case"onScroll":null!=r&&Lu("scroll",e);break;case"onScrollEnd":null!=r&&Lu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(s(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(s(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"muted":e.muted=r&&"function"!==typeof r&&"symbol"!==typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==r||"function"===typeof r||"boolean"===typeof r||"symbol"===typeof r){e.removeAttribute("xlink:href");break}n=Et(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!==typeof r&&"symbol"!==typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"===typeof r||"symbol"===typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":Lu("beforetoggle",e),Lu("toggle",e),tt(e,"popover",r);break;case"xlinkActuate":rt(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":rt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":rt(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":rt(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":rt(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":rt(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":rt(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":rt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":rt(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":tt(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Tt.get(n)||n,r)}}function $u(e,t,n,r,o,a){switch(n){case"style":Ct(e,r,a);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!==typeof r||!("__html"in r))throw Error(s(61));if(null!=(n=r.__html)){if(null!=o.children)throw Error(s(60));e.innerHTML=n}}break;case"children":"string"===typeof r?kt(e,r):("number"===typeof r||"bigint"===typeof r)&&kt(e,""+r);break;case"onScroll":null!=r&&Lu("scroll",e);break;case"onScrollEnd":null!=r&&Lu("scrollend",e);break;case"onClick":null!=r&&(e.onclick=Ju);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ke.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(o=n.endsWith("Capture"),t=n.slice(2,o?n.length-7:void 0),"function"===typeof(a=null!=(a=e[Me]||null)?a[n]:null)&&e.removeEventListener(t,a,o),"function"!==typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):tt(e,n,r):("function"!==typeof a&&null!==a&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,o)))}}function eh(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Lu("error",e),Lu("load",e);var r,o=!1,a=!1;for(r in n)if(n.hasOwnProperty(r)){var i=n[r];if(null!=i)switch(r){case"src":o=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Zu(e,t,r,i,n,null)}}return a&&Zu(e,t,"srcSet",n.srcSet,n,null),void(o&&Zu(e,t,"src",n.src,n,null));case"input":Lu("invalid",e);var c=r=i=a=null,l=null,u=null;for(o in n)if(n.hasOwnProperty(o)){var h=n[o];if(null!=h)switch(o){case"name":a=h;break;case"type":i=h;break;case"checked":l=h;break;case"defaultChecked":u=h;break;case"value":r=h;break;case"defaultValue":c=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(s(137,t));break;default:Zu(e,t,o,h,n,null)}}return yt(e,r,c,l,u,i,a,!1),void ht(e);case"select":for(a in Lu("invalid",e),o=i=r=null,n)if(n.hasOwnProperty(a)&&null!=(c=n[a]))switch(a){case"value":r=c;break;case"defaultValue":i=c;break;case"multiple":o=c;default:Zu(e,t,a,c,n,null)}return t=r,n=i,e.multiple=!!o,void(null!=t?vt(e,!!o,t,!1):null!=n&&vt(e,!!o,n,!0));case"textarea":for(i in Lu("invalid",e),r=a=o=null,n)if(n.hasOwnProperty(i)&&null!=(c=n[i]))switch(i){case"value":o=c;break;case"defaultValue":a=c;break;case"children":r=c;break;case"dangerouslySetInnerHTML":if(null!=c)throw Error(s(91));break;default:Zu(e,t,i,c,n,null)}return xt(e,o,a,r),void ht(e);case"option":for(l in n)if(n.hasOwnProperty(l)&&null!=(o=n[l]))if("selected"===l)e.selected=o&&"function"!==typeof o&&"symbol"!==typeof o;else Zu(e,t,l,o,n,null);return;case"dialog":Lu("beforetoggle",e),Lu("toggle",e),Lu("cancel",e),Lu("close",e);break;case"iframe":case"object":Lu("load",e);break;case"video":case"audio":for(o=0;o<Pu.length;o++)Lu(Pu[o],e);break;case"image":Lu("error",e),Lu("load",e);break;case"details":Lu("toggle",e);break;case"embed":case"source":case"link":Lu("error",e),Lu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(o=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:Zu(e,t,u,o,n,null)}return;default:if(It(t)){for(h in n)n.hasOwnProperty(h)&&(void 0!==(o=n[h])&&$u(e,t,h,o,n,void 0));return}}for(c in n)n.hasOwnProperty(c)&&(null!=(o=n[c])&&Zu(e,t,c,o,n,null))}var th=null,nh=null;function rh(e){return 9===e.nodeType?e:e.ownerDocument}function oh(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ah(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function sh(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ih=null;var ch="function"===typeof setTimeout?setTimeout:void 0,lh="function"===typeof clearTimeout?clearTimeout:void 0,uh="function"===typeof Promise?Promise:void 0,hh="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof uh?function(e){return uh.resolve(null).then(e).catch(dh)}:ch;function dh(e){setTimeout((function(){throw e}))}function ph(e){return"head"===e}function fh(e,t){var n=t,r=0,o=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0<r&&8>r){n=r;var s=e.ownerDocument;if(1&n&&xh(s.documentElement),2&n&&xh(s.body),4&n)for(xh(n=s.head),s=n.firstChild;s;){var i=s.nextSibling,c=s.nodeName;s[Be]||"SCRIPT"===c||"STYLE"===c||"LINK"===c&&"stylesheet"===s.rel.toLowerCase()||n.removeChild(s),s=i}}if(0===o)return e.removeChild(a),void Td(t);o--}else"$"===n||"$?"===n||"$!"===n?o++:r=n.charCodeAt(0)-48;else r=0;n=a}while(n);Td(t)}function mh(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":mh(n),qe(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function gh(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function yh(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var bh=null;function vh(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function wh(e,t,n){switch(t=rh(n),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function xh(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);qe(e)}var kh=new Map,Sh=new Set;function _h(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Ch=D.d;D.d={f:function(){var e=Ch.f(),t=Wl();return e||t},r:function(e){var t=je(e);null!==t&&5===t.tag&&"form"===t.type?Ms(t):Ch.r(e)},D:function(e){Ch.D(e),Th("dns-prefetch",e,null)},C:function(e,t){Ch.C(e,t),Th("preconnect",e,t)},L:function(e,t,n){Ch.L(e,t,n);var r=Ih;if(r&&e&&t){var o='link[rel="preload"][as="'+mt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(o+='[imagesrcset="'+mt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(o+='[imagesizes="'+mt(n.imageSizes)+'"]')):o+='[href="'+mt(e)+'"]';var a=o;switch(t){case"style":a=Eh(e);break;case"script":a=Oh(e)}kh.has(a)||(e=d({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),kh.set(a,e),null!==r.querySelector(o)||"style"===t&&r.querySelector(Ah(a))||"script"===t&&r.querySelector(Mh(a))||(eh(t=r.createElement("link"),"link",e),Ge(t),r.head.appendChild(t)))}},m:function(e,t){Ch.m(e,t);var n=Ih;if(n&&e){var r=t&&"string"===typeof t.as?t.as:"script",o='link[rel="modulepreload"][as="'+mt(r)+'"][href="'+mt(e)+'"]',a=o;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=Oh(e)}if(!kh.has(a)&&(e=d({rel:"modulepreload",href:e},t),kh.set(a,e),null===n.querySelector(o))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Mh(a)))return}eh(r=n.createElement("link"),"link",e),Ge(r),n.head.appendChild(r)}}},X:function(e,t){Ch.X(e,t);var n=Ih;if(n&&e){var r=Ue(n).hoistableScripts,o=Oh(e),a=r.get(o);a||((a=n.querySelector(Mh(o)))||(e=d({src:e,async:!0},t),(t=kh.get(o))&&Lh(e,t),Ge(a=n.createElement("script")),eh(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}},S:function(e,t,n){Ch.S(e,t,n);var r=Ih;if(r&&e){var o=Ue(r).hoistableStyles,a=Eh(e);t=t||"default";var s=o.get(a);if(!s){var i={loading:0,preload:null};if(s=r.querySelector(Ah(a)))i.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},n),(n=kh.get(a))&&Fh(e,n);var c=s=r.createElement("link");Ge(c),eh(c,"link",e),c._p=new Promise((function(e,t){c.onload=e,c.onerror=t})),c.addEventListener("load",(function(){i.loading|=1})),c.addEventListener("error",(function(){i.loading|=2})),i.loading|=4,Dh(s,t,r)}s={type:"stylesheet",instance:s,count:1,state:i},o.set(a,s)}}},M:function(e,t){Ch.M(e,t);var n=Ih;if(n&&e){var r=Ue(n).hoistableScripts,o=Oh(e),a=r.get(o);a||((a=n.querySelector(Mh(o)))||(e=d({src:e,async:!0,type:"module"},t),(t=kh.get(o))&&Lh(e,t),Ge(a=n.createElement("script")),eh(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(o,a))}}};var Ih="undefined"===typeof document?null:document;function Th(e,t,n){var r=Ih;if(r&&"string"===typeof t&&t){var o=mt(t);o='link[rel="'+e+'"][href="'+o+'"]',"string"===typeof n&&(o+='[crossorigin="'+n+'"]'),Sh.has(o)||(Sh.add(o),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(o)&&(eh(t=r.createElement("link"),"link",e),Ge(t),r.head.appendChild(t)))}}function Nh(e,t,n,r){var o,a,i,c,l=(l=U.current)?_h(l):null;if(!l)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Eh(n.href),(r=(n=Ue(l).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Eh(n.href);var u=Ue(l).hoistableStyles,h=u.get(e);if(h||(l=l.ownerDocument||l,h={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,h),(u=l.querySelector(Ah(e)))&&!u._p&&(h.instance=u,h.state.loading=5),kh.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},kh.set(e,n),u||(o=l,a=e,i=n,c=h.state,o.querySelector('link[rel="preload"][as="style"]['+a+"]")?c.loading=1:(a=o.createElement("link"),c.preload=a,a.addEventListener("load",(function(){return c.loading|=1})),a.addEventListener("error",(function(){return c.loading|=2})),eh(a,"link",i),Ge(a),o.head.appendChild(a))))),t&&null===r)throw Error(s(528,""));return h}if(t&&null!==r)throw Error(s(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Oh(n),(r=(n=Ue(l).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Eh(e){return'href="'+mt(e)+'"'}function Ah(e){return'link[rel="stylesheet"]['+e+"]"}function Rh(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Oh(e){return'[src="'+mt(e)+'"]'}function Mh(e){return"script[async]"+e}function Ph(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+mt(n.href)+'"]');if(r)return t.instance=r,Ge(r),r;var o=d({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ge(r=(e.ownerDocument||e).createElement("style")),eh(r,"style",o),Dh(r,n.precedence,e),t.instance=r;case"stylesheet":o=Eh(n.href);var a=e.querySelector(Ah(o));if(a)return t.state.loading|=4,t.instance=a,Ge(a),a;r=Rh(n),(o=kh.get(o))&&Fh(r,o),Ge(a=(e.ownerDocument||e).createElement("link"));var i=a;return i._p=new Promise((function(e,t){i.onload=e,i.onerror=t})),eh(a,"link",r),t.state.loading|=4,Dh(a,n.precedence,e),t.instance=a;case"script":return a=Oh(n.src),(o=e.querySelector(Mh(a)))?(t.instance=o,Ge(o),o):(r=n,(o=kh.get(a))&&Lh(r=d({},n),o),Ge(o=(e=e.ownerDocument||e).createElement("script")),eh(o,"link",r),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Dh(r,n.precedence,e));return t.instance}function Dh(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=r.length?r[r.length-1]:null,a=o,s=0;s<r.length;s++){var i=r[s];if(i.dataset.precedence===t)a=i;else if(a!==o)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Fh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Lh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var zh=null;function Bh(e,t,n){if(null===zh){var r=new Map,o=zh=new Map;o.set(n,r)}else(r=(o=zh).get(n))||(r=new Map,o.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),o=0;o<n.length;o++){var a=n[o];if(!(a[Be]||a[Oe]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var s=a.getAttribute(t)||"";s=e+s;var i=r.get(s);i?i.push(a):r.set(s,[a])}}return r}function qh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function Wh(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var jh=null;function Vh(){}function Uh(){if(this.count--,0===this.count)if(this.stylesheets)Hh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Gh=null;function Hh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Gh=new Map,t.forEach(Kh,e),Gh=null,Uh.call(e))}function Kh(e,t){if(!(4&t.state.loading)){var n=Gh.get(e);if(n)var r=n.get(null);else{n=new Map,Gh.set(e,n);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<o.length;a++){var s=o[a];"LINK"!==s.nodeName&&"not all"===s.getAttribute("media")||(n.set(s.dataset.precedence,s),r=s)}r&&n.set(null,r)}s=(o=t.instance).getAttribute("data-precedence"),(a=n.get(s)||r)===r&&n.set(null,o),n.set(s,o),this.count++,r=Uh.bind(this),o.addEventListener("load",r),o.addEventListener("error",r),a?a.parentNode.insertBefore(o,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(o,e.firstChild),t.state.loading|=4}}var Xh={$$typeof:x,Provider:null,Consumer:null,_currentValue:F,_currentValue2:F,_threadCount:0};function Qh(e,t,n,r,o,a,s,i){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_e(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_e(0),this.hiddenUpdates=_e(null),this.identifierPrefix=r,this.onUncaughtError=o,this.onCaughtError=a,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=i,this.incompleteTransitions=new Map}function Yh(e,t,n,r,o,a,s,i,c,l,u,h){return e=new Qh(e,t,n,s,i,c,l,h),t=1,!0===a&&(t|=24),a=Fr(3,null,null,t),e.current=a,a.stateNode=e,(t=Po()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},ra(a),e}function Jh(e){return e?e=Pr:Pr}function Zh(e,t,n,r,o,a){o=Jh(o),null===r.context?r.context=o:r.pendingContext=o,(r=aa(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=sa(e,r,t))&&(Fl(n,0,t),ia(n,e,t))}function $h(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function ed(e,t){$h(e,t),(e=e.alternate)&&$h(e,t)}function td(e){if(13===e.tag){var t=Rr(e,67108864);null!==t&&Fl(t,0,67108864),ed(e,67108864)}}var nd=!0;function rd(e,t,n,r){var o=P.T;P.T=null;var a=D.p;try{D.p=2,ad(e,t,n,r)}finally{D.p=a,P.T=o}}function od(e,t,n,r){var o=P.T;P.T=null;var a=D.p;try{D.p=8,ad(e,t,n,r)}finally{D.p=a,P.T=o}}function ad(e,t,n,r){if(nd){var o=sd(r);if(null===o)ju(e,t,r,id,n),bd(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return hd=vd(hd,e,t,n,r,o),!0;case"dragenter":return dd=vd(dd,e,t,n,r,o),!0;case"mouseover":return pd=vd(pd,e,t,n,r,o),!0;case"pointerover":var a=o.pointerId;return fd.set(a,vd(fd.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":return a=o.pointerId,md.set(a,vd(md.get(a)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(bd(e,r),4&t&&-1<yd.indexOf(e)){for(;null!==o;){var a=je(o);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var s=be(a.pendingLanes);if(0!==s){var i=a;for(i.pendingLanes|=2,i.entangledLanes|=2;s;){var c=1<<31-pe(s);i.entanglements[1]|=c,s&=~c}ku(a),0===(6&nl)&&(kl=te()+500,Su(0,!1))}}break;case 13:null!==(i=Rr(a,2))&&Fl(i,0,2),Wl(),ed(a,2)}if(null===(a=sd(r))&&ju(e,t,r,id,n),a===o)break;o=a}null!==o&&r.stopPropagation()}else ju(e,t,r,null,n)}}function sd(e){return cd(e=Rt(e))}var id=null;function cd(e){if(id=null,null!==(e=We(e))){var t=c(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=l(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return id=e,null}function ld(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case re:return 2;case oe:return 8;case ae:case se:return 32;case ie:return 268435456;default:return 32}default:return 32}}var ud=!1,hd=null,dd=null,pd=null,fd=new Map,md=new Map,gd=[],yd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bd(e,t){switch(e){case"focusin":case"focusout":hd=null;break;case"dragenter":case"dragleave":dd=null;break;case"mouseover":case"mouseout":pd=null;break;case"pointerover":case"pointerout":fd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(t.pointerId)}}function vd(e,t,n,r,o,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[o]},null!==t&&(null!==(t=je(t))&&td(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function wd(e){var t=We(e.target);if(null!==t){var n=c(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void function(e,t){var n=D.p;try{return D.p=e,t()}finally{D.p=n}}(e.priority,(function(){if(13===n.tag){var e=Pl();e=Ne(e);var t=Rr(n,e);null!==t&&Fl(t,0,e),ed(n,e)}}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function xd(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=sd(e.nativeEvent);if(null!==n)return null!==(t=je(n))&&td(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);At=r,n.target.dispatchEvent(r),At=null,t.shift()}return!0}function kd(e,t,n){xd(e)&&n.delete(t)}function Sd(){ud=!1,null!==hd&&xd(hd)&&(hd=null),null!==dd&&xd(dd)&&(dd=null),null!==pd&&xd(pd)&&(pd=null),fd.forEach(kd),md.forEach(kd)}function _d(e,t){e.blockedOn===t&&(e.blockedOn=null,ud||(ud=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Sd)))}var Cd=null;function Id(e){Cd!==e&&(Cd=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,(function(){Cd===e&&(Cd=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],o=e[t+2];if("function"!==typeof r){if(null===cd(r||n))continue;break}var a=je(n);null!==a&&(e.splice(t,3),t-=3,Rs(a,{pending:!0,data:o,method:n.method,action:r},r,o))}})))}function Td(e){function t(t){return _d(t,e)}null!==hd&&_d(hd,e),null!==dd&&_d(dd,e),null!==pd&&_d(pd,e),fd.forEach(t),md.forEach(t);for(var n=0;n<gd.length;n++){var r=gd[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<gd.length&&null===(n=gd[0]).blockedOn;)wd(n),null===n.blockedOn&&gd.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var o=n[r],a=n[r+1],s=o[Me]||null;if("function"===typeof a)s||Id(n);else if(s){var i=null;if(a&&a.hasAttribute("formAction")){if(o=a,s=a[Me]||null)i=s.formAction;else if(null!==cd(o))continue}else i=s.action;"function"===typeof i?n[r+1]=i:(n.splice(r,3),r-=3),Id(n)}}}function Nd(e){this._internalRoot=e}function Ed(e){this._internalRoot=e}Ed.prototype.render=Nd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));Zh(t.current,Pl(),e,t,null,null)},Ed.prototype.unmount=Nd.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Zh(e.current,2,null,e,null,null),Wl(),t[Pe]=null}},Ed.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ae();e={blockedOn:null,target:e,priority:t};for(var n=0;n<gd.length&&0!==t&&t<gd[n].priority;n++);gd.splice(n,0,e),0===n&&wd(e)}};var Ad=o.version;if("19.1.0"!==Ad)throw Error(s(527,Ad,"19.1.0"));D.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=c(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return u(o),e;if(a===r)return u(o),t;a=a.sibling}throw Error(s(188))}if(n.return!==r.return)n=o,r=a;else{for(var i=!1,l=o.child;l;){if(l===n){i=!0,n=o,r=a;break}if(l===r){i=!0,r=o,n=a;break}l=l.sibling}if(!i){for(l=a.child;l;){if(l===n){i=!0,n=a,r=o;break}if(l===r){i=!0,r=a,n=o;break}l=l.sibling}if(!i)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Rd={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Od=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Od.isDisabled&&Od.supportsFiber)try{ue=Od.inject(Rd),he=Od}catch(Pd){}}t.createRoot=function(e,t){if(!i(e))throw Error(s(299));var n=!1,r="",o=bi,a=vi,c=wi;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(a=t.onCaughtError),void 0!==t.onRecoverableError&&(c=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Yh(e,1,!1,null,0,n,r,o,a,c,0,null),e[Pe]=t.current,qu(e),new Nd(t)},t.hydrateRoot=function(e,t,n){if(!i(e))throw Error(s(299));var r=!1,o="",a=bi,c=vi,l=wi,u=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(a=n.onUncaughtError),void 0!==n.onCaughtError&&(c=n.onCaughtError),void 0!==n.onRecoverableError&&(l=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(u=n.formState)),(t=Yh(e,1,!0,t,0,r,o,a,c,l,0,u)).context=Jh(null),n=t.current,(o=aa(r=Ne(r=Pl()))).callback=null,sa(n,o,r),n=r,t.current.lanes=n,Ce(t,n),ku(t),e[Pe]=t.current,qu(e),new Ed(t)},t.version="19.1.0"},7066:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xor128=i}(0,e=n.nmd(e),n.amdD)},7122:(e,t,n)=>{var r=n(79);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},7351:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},7359:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new a(e),r=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.alea=i}(0,e=n.nmd(e),n.amdD)},7383:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},7541:(e,t,n)=>{"use strict";var r=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,r.fetch&&(t.default=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},7707:(e,t,n)=>{"use strict";e.exports=a;var r=n(3338);(a.prototype=Object.create(r.prototype)).constructor=a;var o=n(1509);function a(e){r.call(this,e)}a._configure=function(){o.Buffer&&(a.prototype._slice=o.Buffer.prototype.slice)},a.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},a._configure()},7736:(e,t,n)=>{var r=n(3738).default,o=n(9045);e.exports=function(e){var t=o(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},7752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(6672)},8062:(e,t,n)=>{"use strict";n.r(t),n.d(t,{userAgent:()=>r});const r=""},8094:(e,t,n)=>{"use strict";t.Service=n(3694)},8108:()=>{},8265:(e,t,n)=>{var r;!function(o,a){var s,i=this,c=256,l="random",u=a.pow(c,6),h=a.pow(2,52),d=2*h,p=255;function f(e,t,n){var r=[],p=b(y((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(o)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(c):(e=new Uint8Array(c),(i.crypto||i.msCrypto).getRandomValues(e)),v(e)}catch(r){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,v(o)]}}():e,3),r),f=new m(r),w=function(){for(var e=f.g(6),t=u,n=0;e<h;)e=(e+n)*c,t*=c,n=f.g(1);for(;e>=d;)e/=2,t/=2,n>>>=1;return(e+n)/t};return w.int32=function(){return 0|f.g(4)},w.quick=function(){return f.g(4)/4294967296},w.double=w,b(v(f.S),o),(t.pass||n||function(e,t,n,r){return r&&(r.S&&g(r,f),e.state=function(){return g(f,{})}),n?(a[l]=e,t):e})(w,p,"global"in t?t.global:this==a,t.state)}function m(e){var t,n=e.length,r=this,o=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<c;)s[o]=o++;for(o=0;o<c;o++)s[o]=s[a=p&a+e[o%n]+(t=s[o])],s[a]=t;(r.g=function(e){for(var t,n=0,o=r.i,a=r.j,s=r.S;e--;)t=s[o=p&o+1],n=n*c+s[p&(s[o]=s[a=p&a+t])+(s[a]=t)];return r.i=o,r.j=a,n})(c)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function y(e,t){var n,r=[],o=typeof e;if(t&&"object"==o)for(n in e)try{r.push(y(e[n],t-1))}catch(a){}return r.length?r:"string"==o?e:e+"\0"}function b(e,t){for(var n,r=e+"",o=0;o<r.length;)t[p&o]=p&(n^=19*t[p&o])+r.charCodeAt(o++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(a["seed"+l]=f,b(a.random(),o),e.exports){e.exports=f;try{s=n(1351)}catch(w){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},8547:function(e,t,n){var r;!function(e,o){function a(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&(r.x&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xorshift7=i}(0,e=n.nmd(e),n.amdD)},8590:()=>{},8626:(e,t)=>{"use strict";var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296===(64512&n)&&56320===(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,o=null,a=[],s=0;t<n;)(r=e[t++])<128?a[s++]=r:r>191&&r<224?a[s++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[s++]=55296+(r>>10),a[s++]=56320+(1023&r)):a[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},n.write=function(e,t,n){for(var r,o,a=n,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&56320===(64512&(o=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&o),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-a}},8681:function(e,t,n){var r;!function(e,o){function a(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,s,i=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),o=0,a=-32;a<c;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(s=s+1640531527|0,o=0==(n=i[127&a]^=r+s)?o+1:0);for(o>=128&&(i[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=i[o+34&127],n=i[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,i[o]=r^n;e.w=s,e.X=i,e.i=o}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&(r.X&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xor4096=i}(0,e=n.nmd(e),n.amdD)},8791:(e,t,n)=>{"use strict";n.r(t),n.d(t,{now:()=>o,timing:()=>a});const r=n.g.process.hrtime(),o=()=>{const e=n.g.process.hrtime(r);return e[0]+e[1]/1e9},a={navigationStart:Date.now()}},8853:(e,t,n)=>{"use strict";e.exports=n(5896)},8964:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new a(e),r=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.alea=i}(0,e=n.nmd(e),n.amdD)},9016:function(e,t,n){var r;!function(e,o){function a(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&("object"==typeof r&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xorwow=i}(0,e=n.nmd(e),n.amdD)},9045:(e,t,n)=>{var r=n(3738).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9191:(e,t,n)=>{"use strict";var r=t;function o(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(5850),r.BufferWriter=n(3931),r.Reader=n(3338),r.BufferReader=n(7707),r.util=n(1509),r.rpc=n(8094),r.roots=n(1368),r.configure=o,o()},9538:function(e,t,n){var r;!function(e,o){function a(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new a(e),r=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,r&&(r.x&&s(r,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=i:n.amdD&&n.amdO?void 0===(r=function(){return i}.call(t,n,t,o))||(o.exports=r):this.xorshift7=i}(0,e=n.nmd(e),n.amdD)},9815:(e,t,n)=>{var r=n(2308),o=n(1637),a=n(6399),s=n(8547),i=n(8681),c=n(4461),l=n(2809);l.alea=r,l.xor128=o,l.xorwow=a,l.xorshift7=s,l.xor4096=i,l.tychei=c,e.exports=l}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.amdD=function(){throw new Error("define cannot be used indirect")},__webpack_require__.amdO={},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var __webpack_exports__={};(()=>{"use strict";var e={};__webpack_require__.r(e),__webpack_require__.d(e,{assertParamsValid:()=>Tf,computeFlatOffset:()=>qf,computeOutShape:()=>Ef,getNormalizedAxes:()=>Mf,isSliceContinous:()=>Bf,maskToAxes:()=>Nf,parseSliceParams:()=>Wf,sliceInfo:()=>jf,startForAxis:()=>Lf,startIndicesWithElidedDims:()=>Pf,stopForAxis:()=>zf,stopIndicesWithElidedDims:()=>Df,stridesForAxis:()=>Ff,stridesWithElidedDims:()=>Af});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{collectGatherOpShapeInfo:()=>$b,computeOutShape:()=>Zb,segOpComputeOptimalWindowSize:()=>Jb});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{ERF_A1:()=>Db,ERF_A2:()=>Fb,ERF_A3:()=>Lb,ERF_A4:()=>zb,ERF_A5:()=>Bb,ERF_P:()=>Pb,PARALLELIZE_THRESHOLD:()=>wb,SELU_SCALE:()=>Mb,SELU_SCALEALPHA:()=>Ob,applyActivation:()=>Cy,assertAndGetBroadcastShape:()=>Ym,assertAxesAreInnerMostDims:()=>_g,assertParamsConsistent:()=>bb,assignToTypedArray:()=>Kb,axesAreInnerMostDims:()=>wg,calculateShapes:()=>Rb,castTensor:()=>ev,combineLocations:()=>xg,complexWithEvenIndex:()=>Ub,complexWithOddIndex:()=>Gb,computeConv2DInfo:()=>um,computeConv3DInfo:()=>hm,computeDefaultPad:()=>dm,computeDilation2DInfo:()=>im,computeOptimalWindowSize:()=>xb,computeOutAndReduceShapes:()=>kg,computeOutShape:()=>vb,computePool2DInfo:()=>cm,computePool3DInfo:()=>lm,convertConv2DDataFormat:()=>vm,eitherStridesOrDilationsAreOne:()=>bm,expandShapeToKeepDim:()=>Sg,exponent:()=>Qb,exponents:()=>Xb,fromStringArrayToUint8:()=>rv,fromUint8ToStringArray:()=>nv,getAxesPermutation:()=>Cg,getBroadcastDims:()=>Xm,getComplexWithIndex:()=>Hb,getFusedBiasGradient:()=>_y,getFusedDyActivation:()=>Sy,getImageCenter:()=>kb,getInnerMostAxes:()=>Tg,getPermuted:()=>_b,getReductionAxes:()=>Qm,getReshaped:()=>Sb,getReshapedPermuted:()=>Cb,getSliceBeginCoords:()=>Ib,getSliceSize:()=>Tb,getUndoAxesPermutation:()=>Ig,log:()=>Wb,mergeRealAndImagArrays:()=>jb,prepareAndValidate:()=>Nb,prepareSplitSize:()=>Yb,reshapeTensor:()=>tv,segment_util:()=>t,shouldFuse:()=>Iy,slice_util:()=>e,splitRealAndImagArrays:()=>Vb,tupleValuesAreOne:()=>ym,upcastType:()=>cp,validateInput:()=>Ab,validateUpdateShape:()=>Eb,warn:()=>qb});var r={};__webpack_require__.r(r),__webpack_require__.d(r,{mx:()=>YN,XI:()=>jE,Nk:()=>VE,YG:()=>HE,hH:()=>ZE,sG:()=>zA,uM:()=>VA,vS:()=>uR,GG:()=>vR,rq:()=>xR,WR:()=>PR,GE:()=>qR,px:()=>jR,jC:()=>rO,He:()=>sO,hE:()=>bO,BF:()=>HA,Dk:()=>EO,_B:()=>YO,qy:()=>ZO,Zy:()=>uM,dH:()=>aE,HS:()=>zE,eW:()=>jM,dl:()=>$A,Dw:()=>KM,xT:()=>QM,_X:()=>dE,wz:()=>JM});var o=__webpack_require__(5043),a=__webpack_require__(4391);function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function c(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}__webpack_require__(3175);const d=["sri"],p=["page"],f=["page","matches"],m=["onClick","discover","prefetch","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],g=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],y=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition"];var b="popstate";function v(){return I((function(e,t){let{pathname:n,search:r,hash:o}=e.location;return S("",{pathname:n,search:r,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:_(t)}),null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function w(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function x(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function k(e,t){return{usr:e.state,key:e.key,idx:t}}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return h(h({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?C(t):t),{},{state:n,key:t&&t.key||r||Math.random().toString(36).substring(2,10)})}function _(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function C(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function I(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:o=document.defaultView,v5Compat:a=!1}=r,s=o.history,i="POP",c=null,l=u();function u(){return(s.state||{idx:null}).idx}function d(){i="POP";let e=u(),t=null==e?null:e-l;l=e,c&&c({action:i,location:f.location,delta:t})}function p(e){return T(e)}null==l&&(l=0,s.replaceState(h(h({},s.state),{},{idx:l}),""));let f={get action(){return i},get location(){return e(o,s)},listen(e){if(c)throw new Error("A history only accepts one active listener");return o.addEventListener(b,d),c=e,()=>{o.removeEventListener(b,d),c=null}},createHref:e=>t(o,e),createURL:p,encodeLocation(e){let t=p(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){i="PUSH";let r=S(f.location,e,t);n&&n(r,e),l=u()+1;let h=k(r,l),d=f.createHref(r);try{s.pushState(h,"",d)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;o.location.assign(d)}a&&c&&c({action:i,location:f.location,delta:1})},replace:function(e,t){i="REPLACE";let r=S(f.location,e,t);n&&n(r,e),l=u();let o=k(r,l),h=f.createHref(r);s.replaceState(o,"",h),a&&c&&c({action:i,location:f.location,delta:0})},go:e=>s.go(e)};return f}function T(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n="http://localhost";"undefined"!==typeof window&&(n="null"!==window.location.origin?window.location.origin:window.location.href),w(n,"No window.location.(origin|href) available to create URL");let r="string"===typeof e?e:_(e);return r=r.replace(/ $/,"%20"),!t&&r.startsWith("//")&&(r=n+r),new URL(r,n)}new WeakMap;function N(e,t){return E(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function E(e,t,n,r){let o=U(("string"===typeof t?C(t):t).pathname||"/",n);if(null==o)return null;let a=A(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(a);let s=null;for(let i=0;null==s&&i<a.length;++i){let e=V(o);s=q(a[i],e,r)}return s}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=(e,o,a)=>{let s={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};s.relativePath.startsWith("/")&&(w(s.relativePath.startsWith(r),'Absolute route path "'.concat(s.relativePath,'" nested under path "').concat(r,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),s.relativePath=s.relativePath.slice(r.length));let i=Q([r,s.relativePath]),c=n.concat(s);e.children&&e.children.length>0&&(w(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(i,'".')),A(e.children,t,c,i)),(null!=e.path||e.index)&&t.push({path:i,score:B(i,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!==(n=e.path)&&void 0!==n&&n.includes("?"))for(let r of R(e.path))o(e,t,r);else o(e,t)})),t}function R(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,o=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return o?[a,""]:[a];let s=R(r.join("/")),i=[];return i.push(...s.map((e=>""===e?a:[a,e].join("/")))),o&&i.push(...s),i.map((t=>e.startsWith("/")&&""===t?"/":t))}var O=/^:[\w-]+$/,M=3,P=2,D=1,F=10,L=-2,z=e=>"*"===e;function B(e,t){let n=e.split("/"),r=n.length;return n.some(z)&&(r+=L),t&&(r+=P),n.filter((e=>!z(e))).reduce(((e,t)=>e+(O.test(t)?M:""===t?D:F)),r)}function q(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:r}=e,o={},a="/",s=[];for(let i=0;i<r.length;++i){let e=r[i],c=i===r.length-1,l="/"===a?t:t.slice(a.length)||"/",u=W({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},l),h=e.route;if(!u&&c&&n&&!r[r.length-1].route.index&&(u=W({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!u)return null;Object.assign(o,u.params),s.push({params:o,pathname:Q([a,u.pathname]),pathnameBase:Y(Q([a,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(a=Q([a,u.pathnameBase]))}return s}function W(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=j(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let a=o[0],s=a.replace(/(.)\/+$/,"$1"),i=o.slice(1),c=r.reduce(((e,t,n)=>{let{paramName:r,isOptional:o}=t;if("*"===r){let e=i[n]||"";s=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const c=i[n];return e[r]=o&&!c?void 0:(c||"").replace(/%2F/g,"/"),e}),{});return{params:c,pathname:a,pathnameBase:s,pattern:e}}function j(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];x("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'.concat(e,'" will be treated as if it were "').concat(e.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(e.replace(/\*$/,"/*"),'".'));let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));return e.endsWith("*")?(r.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function V(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return x(!1,'The URL path "'.concat(e,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(t,").")),e}}function U(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function G(e,t,n,r){return"Cannot include a '".concat(e,"' character in a manually specified `to.").concat(t,"` field [").concat(JSON.stringify(r),"].  Please separate it out to the `to.").concat(n,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function H(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function K(e){let t=H(e);return t.map(((e,n)=>n===t.length-1?e.pathname:e.pathnameBase))}function X(e,t,n){let r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?r=C(e):(r=h({},e),w(!r.pathname||!r.pathname.includes("?"),G("?","pathname","search",r)),w(!r.pathname||!r.pathname.includes("#"),G("#","pathname","hash",r)),w(!r.search||!r.search.includes("#"),G("#","search","hash",r)));let a,s=""===e||""===r.pathname,i=s?"/":r.pathname;if(null==i)a=n;else{let e=t.length-1;if(!o&&i.startsWith("..")){let t=i.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}a=e>=0?t[e]:"/"}let c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:r="",hash:o=""}="string"===typeof e?C(e):e,a=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:a,search:J(r),hash:Z(o)}}(r,a),l=i&&"/"!==i&&i.endsWith("/"),u=(s||"."===i)&&n.endsWith("/");return c.pathname.endsWith("/")||!l&&!u||(c.pathname+="/"),c}var Q=e=>e.join("/").replace(/\/\/+/g,"/"),Y=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),J=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Z=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function $(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var ee=["POST","PUT","PATCH","DELETE"],te=(new Set(ee),["GET",...ee]);new Set(te),Symbol("ResetLoaderData");var ne=o.createContext(null);ne.displayName="DataRouter";var re=o.createContext(null);re.displayName="DataRouterState";var oe=o.createContext({isTransitioning:!1});oe.displayName="ViewTransition";var ae=o.createContext(new Map);ae.displayName="Fetchers";var se=o.createContext(null);se.displayName="Await";var ie=o.createContext(null);ie.displayName="Navigation";var ce=o.createContext(null);ce.displayName="Location";var le=o.createContext({outlet:null,matches:[],isDataRoute:!1});le.displayName="Route";var ue=o.createContext(null);ue.displayName="RouteError";function he(){return null!=o.useContext(ce)}function de(){return w(he(),"useLocation() may be used only in the context of a <Router> component."),o.useContext(ce).location}var pe="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function fe(e){o.useContext(ie).static||o.useLayoutEffect(e)}function me(){let{isDataRoute:e}=o.useContext(le);return e?function(){let{router:e}=_e("useNavigate"),t=Ie("useNavigate"),n=o.useRef(!1);fe((()=>{n.current=!0}));let r=o.useCallback((async function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(n.current,pe),n.current&&("number"===typeof r?e.navigate(r):await e.navigate(r,h({fromRouteId:t},o)))}),[e,t]);return r}():function(){w(he(),"useNavigate() may be used only in the context of a <Router> component.");let e=o.useContext(ne),{basename:t,navigator:n}=o.useContext(ie),{matches:r}=o.useContext(le),{pathname:a}=de(),s=JSON.stringify(K(r)),i=o.useRef(!1);fe((()=>{i.current=!0}));let c=o.useCallback((function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(i.current,pe),!i.current)return;if("number"===typeof r)return void n.go(r);let c=X(r,JSON.parse(s),a,"path"===o.relative);null==e&&"/"!==t&&(c.pathname="/"===c.pathname?t:Q([t,c.pathname])),(o.replace?n.replace:n.push)(c,o.state,o)}),[t,n,s,a,e]);return c}()}o.createContext(null);function ge(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:n}=o.useContext(le),{pathname:r}=de(),a=JSON.stringify(K(n));return o.useMemo((()=>X(e,JSON.parse(a),r,"path"===t)),[e,a,r,t])}function ye(e,t,n,r){w(he(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a,static:s}=o.useContext(ie),{matches:i}=o.useContext(le),c=i[i.length-1],l=c?c.params:{},u=c?c.pathname:"/",d=c?c.pathnameBase:"/",p=c&&c.route;{let e=p&&p.path||"";Ee(u,!p||e.endsWith("*")||e.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(u,'" (under <Route path="').concat(e,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(e,'"> to <Route path="').concat("/"===e?"*":"".concat(e,"/*"),'">.'))}let f,m=de();if(t){var g;let e="string"===typeof t?C(t):t;w("/"===d||(null===(g=e.pathname)||void 0===g?void 0:g.startsWith(d)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(d,'" but pathname "').concat(e.pathname,'" was given in the `location` prop.')),f=e}else f=m;let y=f.pathname||"/",b=y;if("/"!==d){let e=d.replace(/^\//,"").split("/");b="/"+y.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=!s&&n&&n.matches&&n.matches.length>0?n.matches:N(e,{pathname:b});x(p||null!=v,'No routes matched location "'.concat(f.pathname).concat(f.search).concat(f.hash,'" ')),x(null==v||void 0!==v[v.length-1].route.element||void 0!==v[v.length-1].route.Component||void 0!==v[v.length-1].route.lazy,'Matched leaf route at location "'.concat(f.pathname).concat(f.search).concat(f.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let k=ke(v&&v.map((e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:Q([d,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:Q([d,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),i,n,r);return t&&k?o.createElement(ce.Provider,{value:{location:h({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:"POP"}},k):k}function be(){let e=Te(),t=$(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},i=null;return console.error("Error handled by React Router default ErrorBoundary:",e),i=o.createElement(o.Fragment,null,o.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),o.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",o.createElement("code",{style:s},"ErrorBoundary")," or"," ",o.createElement("code",{style:s},"errorElement")," prop on your route.")),o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),n?o.createElement("pre",{style:a},n):null,i)}var ve=o.createElement(be,null),we=class extends o.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?o.createElement(le.Provider,{value:this.props.routeContext},o.createElement(ue.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function xe(e){let{routeContext:t,match:n,children:r}=e,a=o.useContext(ne);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),o.createElement(le.Provider,{value:t},r)}function ke(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let r=e,a=null===n||void 0===n?void 0:n.errors;if(null!=a){let e=r.findIndex((e=>e.route.id&&void 0!==(null===a||void 0===a?void 0:a[e.route.id])));w(e>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(a).join(","))),r=r.slice(0,Math.min(r.length,e+1))}let s=!1,i=-1;if(n)for(let o=0;o<r.length;o++){let e=r[o];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(i=o),e.route.id){let{loaderData:t,errors:o}=n,a=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!o||void 0===o[e.route.id]);if(e.route.lazy||a){s=!0,r=i>=0?r.slice(0,i+1):[r[0]];break}}}return r.reduceRight(((e,c,l)=>{let u,h=!1,d=null,p=null;n&&(u=a&&c.route.id?a[c.route.id]:void 0,d=c.route.errorElement||ve,s&&(i<0&&0===l?(Ee("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,p=null):i===l&&(h=!0,p=c.route.hydrateFallbackElement||null)));let f=t.concat(r.slice(0,l+1)),m=()=>{let t;return t=u?d:h?p:c.route.Component?o.createElement(c.route.Component,null):c.route.element?c.route.element:e,o.createElement(xe,{match:c,routeContext:{outlet:e,matches:f,isDataRoute:null!=n},children:t})};return n&&(c.route.ErrorBoundary||c.route.errorElement||0===l)?o.createElement(we,{location:n.location,revalidation:n.revalidation,component:d,error:u,children:m(),routeContext:{outlet:null,matches:f,isDataRoute:!0}}):m()}),null)}function Se(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function _e(e){let t=o.useContext(ne);return w(t,Se(e)),t}function Ce(e){let t=o.useContext(re);return w(t,Se(e)),t}function Ie(e){let t=function(e){let t=o.useContext(le);return w(t,Se(e)),t}(e),n=t.matches[t.matches.length-1];return w(n.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),n.route.id}function Te(){var e;let t=o.useContext(ue),n=Ce("useRouteError"),r=Ie("useRouteError");return void 0!==t?t:null===(e=n.errors)||void 0===e?void 0:e[r]}var Ne={};function Ee(e,t,n){t||Ne[e]||(Ne[e]=!0,x(!1,n))}o.memo((function(e){let{routes:t,future:n,state:r}=e;return ye(t,void 0,r,n)}));function Ae(e){w(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Re(e){let{basename:t="/",children:n=null,location:r,navigationType:a="POP",navigator:s,static:i=!1}=e;w(!he(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=t.replace(/^\/*/,"/"),l=o.useMemo((()=>({basename:c,navigator:s,static:i,future:{}})),[c,s,i]);"string"===typeof r&&(r=C(r));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:f="default"}=r,m=o.useMemo((()=>{let e=U(u,c);return null==e?null:{location:{pathname:e,search:h,hash:d,state:p,key:f},navigationType:a}}),[c,u,h,d,p,f,a]);return x(null!=m,'<Router basename="'.concat(c,'"> is not able to match the URL "').concat(u).concat(h).concat(d,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==m?null:o.createElement(ie.Provider,{value:l},o.createElement(ce.Provider,{children:n,value:m}))}function Oe(e){let{children:t,location:n}=e;return ye(Me(t),n)}o.Component;function Me(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return o.Children.forEach(e,((e,r)=>{if(!o.isValidElement(e))return;let a=[...t,r];if(e.type===o.Fragment)return void n.push.apply(n,Me(e.props.children,a));w(e.type===Ae,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),w(!e.props.index||!e.props.children,"An index route cannot have child routes.");let s={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=Me(e.props.children,a)),n.push(s)})),n}var Pe="get",De="application/x-www-form-urlencoded";function Fe(e){return null!=e&&"string"===typeof e.tagName}var Le=null;var ze=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Be(e){return null==e||ze.has(e)?e:(x(!1,'"'.concat(e,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(De,'"')),null)}function qe(e,t){let n,r,o,a,s;if(function(e){return Fe(e)&&"form"===e.tagName.toLowerCase()}(e)){let s=e.getAttribute("action");r=s?U(s,t):null,n=e.getAttribute("method")||Pe,o=Be(e.getAttribute("enctype"))||De,a=new FormData(e)}else if(function(e){return Fe(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Fe(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let s=e.form;if(null==s)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let i=e.getAttribute("formaction")||s.getAttribute("action");if(r=i?U(i,t):null,n=e.getAttribute("formmethod")||s.getAttribute("method")||Pe,o=Be(e.getAttribute("formenctype"))||Be(s.getAttribute("enctype"))||De,a=new FormData(s,e),!function(){if(null===Le)try{new FormData(document.createElement("form"),0),Le=!1}catch(e){Le=!0}return Le}()){let{name:t,type:n,value:r}=e;if("image"===n){let e=t?"".concat(t,"."):"";a.append("".concat(e,"x"),"0"),a.append("".concat(e,"y"),"0")}else t&&a.append(t,r)}}else{if(Fe(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Pe,r=null,o=De,s=e}return a&&"text/plain"===o&&(s=a,a=void 0),{action:r,method:n.toLowerCase(),encType:o,formData:a,body:s}}function We(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}async function je(e,t){if(e.id in t)return t[e.id];try{let n=await import(e.module);return t[e.id]=n,n}catch(n){return console.error("Error loading route module `".concat(e.module,"`, reloading page...")),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise((()=>{}))}}function Ve(e){return null!=e&&"string"===typeof e.page}function Ue(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function Ge(e,t,n,r,o,a){let s=(e,t)=>!n[t]||e.route.id!==n[t].route.id,i=(e,t)=>{var r;return n[t].pathname!==e.pathname||(null===(r=n[t].route.path)||void 0===r?void 0:r.endsWith("*"))&&n[t].params["*"]!==e.params["*"]};return"assets"===a?t.filter(((e,t)=>s(e,t)||i(e,t))):"data"===a?t.filter(((t,a)=>{let c=r.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(s(t,a)||i(t,a))return!0;if(t.route.shouldRevalidate){var l;let r=t.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:(null===(l=n[0])||void 0===l?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof r)return r}return!0})):[]}function He(e,t){let{includeHydrateFallback:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=e.map((e=>{let r=t.routes[e.route.id];if(!r)return[];let o=[r.module];return r.clientActionModule&&(o=o.concat(r.clientActionModule)),r.clientLoaderModule&&(o=o.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(o=o.concat(r.hydrateFallbackModule)),r.imports&&(o=o.concat(r.imports)),o})).flat(1),[...new Set(r)];var r}function Ke(e,t){let n=new Set,r=new Set(t);return e.reduce(((e,o)=>{if(t&&!Ve(o)&&"script"===o.as&&o.href&&r.has(o.href))return e;let a=JSON.stringify(function(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}(o));return n.has(a)||(n.add(a),e.push({key:a,link:o})),e}),[])}function Xe(e){return{__html:e}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;Symbol("SingleFetchRedirect");var Qe=new Set([100,101,204,205]);function Ye(e,t){let n="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===n.pathname?n.pathname="_root.data":t&&"/"===U(n.pathname,t)?n.pathname="".concat(t.replace(/\/$/,""),"/_root.data"):n.pathname="".concat(n.pathname.replace(/\/$/,""),".data"),n}o.Component;function Je(e){let{error:t,isOutsideRemixApp:n}=e;console.error(t);let r,a=o.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if($(t))return o.createElement(Ze,{title:"Unhandled Thrown Response!"},o.createElement("h1",{style:{fontSize:"24px"}},t.status," ",t.statusText),a);if(t instanceof Error)r=t;else{let e=null==t?"Unknown Error":"object"===typeof t&&"toString"in t?t.toString():JSON.stringify(t);r=new Error(e)}return o.createElement(Ze,{title:"Application Error!",isOutsideRemixApp:n},o.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),o.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},r.stack),a)}function Ze(e){var t;let{title:n,renderScripts:r,isOutsideRemixApp:a,children:s}=e,{routeModules:i}=rt();return null!==(t=i.root)&&void 0!==t&&t.Layout&&!a?s:o.createElement("html",{lang:"en"},o.createElement("head",null,o.createElement("meta",{charSet:"utf-8"}),o.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),o.createElement("title",null,n)),o.createElement("body",null,o.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},s,r?o.createElement(ut,null):null)))}function $e(e,t){return"lazy"===e.mode&&!0===t}function et(){let e=o.useContext(ne);return We(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tt(){let e=o.useContext(re);return We(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var nt=o.createContext(void 0);function rt(){let e=o.useContext(nt);return We(e,"You must render this element inside a <HydratedRouter> element"),e}function ot(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function at(e,t,n){if(n&&!lt)return[e[0]];if(t){let n=e.findIndex((e=>void 0!==t[e.route.id]));return e.slice(0,n+1)}return e}function st(e){let{page:t}=e,n=s(e,p),{router:r}=et(),a=o.useMemo((()=>N(r.routes,t,r.basename)),[r.routes,t,r.basename]);return a?o.createElement(ct,h({page:t,matches:a},n)):null}function it(e){let{manifest:t,routeModules:n}=rt(),[r,a]=o.useState([]);return o.useEffect((()=>{let r=!1;return async function(e,t,n){let r=await Promise.all(e.map((async e=>{let r=t.routes[e.route.id];if(r){let e=await je(r,n);return e.links?e.links():[]}return[]})));return Ke(r.flat(1).filter(Ue).filter((e=>"stylesheet"===e.rel||"preload"===e.rel)).map((e=>"stylesheet"===e.rel?h(h({},e),{},{rel:"prefetch",as:"style"}):h(h({},e),{},{rel:"prefetch"}))))}(e,t,n).then((e=>{r||a(e)})),()=>{r=!0}}),[e,t,n]),r}function ct(e){let{page:t,matches:n}=e,r=s(e,f),a=de(),{manifest:i,routeModules:c}=rt(),{basename:l}=et(),{loaderData:u,matches:d}=tt(),p=o.useMemo((()=>Ge(t,n,d,i,a,"data")),[t,n,d,i,a]),m=o.useMemo((()=>Ge(t,n,d,i,a,"assets")),[t,n,d,i,a]),g=o.useMemo((()=>{if(t===a.pathname+a.search+a.hash)return[];let e=new Set,r=!1;if(n.forEach((t=>{var n;let o=i.routes[t.route.id];o&&o.hasLoader&&(!p.some((e=>e.route.id===t.route.id))&&t.route.id in u&&null!==(n=c[t.route.id])&&void 0!==n&&n.shouldRevalidate||o.hasClientLoader?r=!0:e.add(t.route.id))})),0===e.size)return[];let o=Ye(t,l);return r&&e.size>0&&o.searchParams.set("_routes",n.filter((t=>e.has(t.route.id))).map((e=>e.route.id)).join(",")),[o.pathname+o.search]}),[l,u,a,i,p,n,t,c]),y=o.useMemo((()=>He(m,i)),[m,i]),b=it(m);return o.createElement(o.Fragment,null,g.map((e=>o.createElement("link",h({key:e,rel:"prefetch",as:"fetch",href:e},r)))),y.map((e=>o.createElement("link",h({key:e,rel:"modulepreload",href:e},r)))),b.map((e=>{let{key:t,link:n}=e;return o.createElement("link",h({key:t},n))})))}nt.displayName="FrameworkContext";var lt=!1;function ut(e){let{manifest:t,serverHandoffString:n,isSpaMode:r,renderMeta:a,routeDiscovery:i,ssr:c}=rt(),{router:l,static:u,staticContext:p}=et(),{matches:f}=tt(),m=$e(i,c);a&&(a.didRenderScripts=!0);let g=at(f,null,r);o.useEffect((()=>{lt=!0}),[]);let y=o.useMemo((()=>{var r;let a=p?"window.__reactRouterContext = ".concat(n,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",i=u?"".concat(null!==(r=t.hmr)&&void 0!==r&&r.runtime?"import ".concat(JSON.stringify(t.hmr.runtime),";"):"").concat(m?"":"import ".concat(JSON.stringify(t.url)),";\n").concat(g.map(((e,n)=>{let r="route".concat(n),o=t.routes[e.route.id];We(o,"Route ".concat(e.route.id," not found in manifest"));let{clientActionModule:a,clientLoaderModule:s,clientMiddlewareModule:i,hydrateFallbackModule:c,module:l}=o,u=[...a?[{module:a,varName:"".concat(r,"_clientAction")}]:[],...s?[{module:s,varName:"".concat(r,"_clientLoader")}]:[],...i?[{module:i,varName:"".concat(r,"_clientMiddleware")}]:[],...c?[{module:c,varName:"".concat(r,"_HydrateFallback")}]:[],{module:l,varName:"".concat(r,"_main")}];return 1===u.length?"import * as ".concat(r," from ").concat(JSON.stringify(l),";"):[u.map((e=>"import * as ".concat(e.varName,' from "').concat(e.module,'";'))).join("\n"),"const ".concat(r," = {").concat(u.map((e=>"...".concat(e.varName))).join(","),"};")].join("\n")})).join("\n"),"\n  ").concat(m?"window.__reactRouterManifest = ".concat(JSON.stringify(function(e,t){let{sri:n}=e,r=s(e,d),o=new Set(t.state.matches.map((e=>e.route.id))),a=t.state.location.pathname.split("/").filter(Boolean),i=["/"];for(a.pop();a.length>0;)i.push("/".concat(a.join("/"))),a.pop();i.forEach((e=>{let n=N(t.routes,e,t.basename);n&&n.forEach((e=>o.add(e.route.id)))}));let c=[...o].reduce(((e,t)=>Object.assign(e,{[t]:r.routes[t]})),{});return h(h({},r),{},{routes:c,sri:!!n||void 0})}(t,l),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(g.map(((e,t)=>"".concat(JSON.stringify(e.route.id),":route").concat(t))).join(","),"};\n\nimport(").concat(JSON.stringify(t.entry.module),");"):" ";return o.createElement(o.Fragment,null,o.createElement("script",h(h({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:Xe(a),type:void 0})),o.createElement("script",h(h({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:Xe(i),type:"module",async:!0})))}),[]),b=lt?[]:function(e){return[...new Set(e)]}(t.entry.imports.concat(He(g,t,{includeHydrateFallback:!0}))),v="object"===typeof t.sri?t.sri:{};return lt?null:o.createElement(o.Fragment,null,"object"===typeof t.sri?o.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:v})}}):null,m?null:o.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin,integrity:v[t.url],suppressHydrationWarning:!0}),o.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin,integrity:v[t.entry.module],suppressHydrationWarning:!0}),b.map((t=>o.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin,integrity:v[t],suppressHydrationWarning:!0}))),y)}function ht(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{t.forEach((t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)}))}}var dt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{dt&&(window.__reactRouterVersion="7.6.0")}catch(F2){}function pt(e){let{basename:t,children:n,window:r}=e,a=o.useRef();null==a.current&&(a.current=v({window:r,v5Compat:!0}));let s=a.current,[i,c]=o.useState({action:s.action,location:s.location}),l=o.useCallback((e=>{o.startTransition((()=>c(e)))}),[c]);return o.useLayoutEffect((()=>s.listen(l)),[s,l]),o.createElement(Re,{basename:t,children:n,location:i.location,navigationType:i.action,navigator:s})}var ft=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mt=o.forwardRef((function(e,t){let n,{onClick:r,discover:a="render",prefetch:i="none",relative:c,reloadDocument:l,replace:u,state:d,target:p,to:f,preventScrollReset:g,viewTransition:y}=e,b=s(e,m),{basename:v}=o.useContext(ie),k="string"===typeof f&&ft.test(f),S=!1;if("string"===typeof f&&k&&(n=f,dt))try{let e=new URL(window.location.href),t=f.startsWith("//")?new URL(e.protocol+f):new URL(f),n=U(t.pathname,v);t.origin===e.origin&&null!=n?f=n+t.search+t.hash:S=!0}catch(F2){x(!1,'<Link to="'.concat(f,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}let C=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(he(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=o.useContext(ie),{hash:a,pathname:s,search:i}=ge(e,{relative:t}),c=s;return"/"!==n&&(c="/"===s?n:Q([n,s])),r.createHref({pathname:c,search:i,hash:a})}(f,{relative:c}),[I,T,N]=function(e,t){let n=o.useContext(nt),[r,a]=o.useState(!1),[s,i]=o.useState(!1),{onFocus:c,onBlur:l,onMouseEnter:u,onMouseLeave:h,onTouchStart:d}=t,p=o.useRef(null);o.useEffect((()=>{if("render"===e&&i(!0),"viewport"===e){let e=new IntersectionObserver((e=>{e.forEach((e=>{i(e.isIntersecting)}))}),{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}}),[e]),o.useEffect((()=>{if(r){let e=setTimeout((()=>{i(!0)}),100);return()=>{clearTimeout(e)}}}),[r]);let f=()=>{a(!0)},m=()=>{a(!1),i(!1)};return n?"intent"!==e?[s,p,{}]:[s,p,{onFocus:ot(c,f),onBlur:ot(l,m),onMouseEnter:ot(u,f),onMouseLeave:ot(h,m),onTouchStart:ot(d,f)}]:[!1,p,{}]}(i,b),E=function(e){let{target:t,replace:n,state:r,preventScrollReset:a,relative:s,viewTransition:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=me(),l=de(),u=ge(e,{relative:s});return o.useCallback((o=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(o,t)){o.preventDefault();let t=void 0!==n?n:_(l)===_(u);c(e,{replace:t,state:r,preventScrollReset:a,relative:s,viewTransition:i})}}),[l,c,u,n,r,t,e,a,s,i])}(f,{replace:u,state:d,target:p,preventScrollReset:g,relative:c,viewTransition:y});let A=o.createElement("a",h(h(h({},b),N),{},{href:n||C,onClick:S||l?r:function(e){r&&r(e),e.defaultPrevented||E(e)},ref:ht(t,T),target:p,"data-discover":k||"render"!==a?void 0:"true"}));return I&&!k?o.createElement(o.Fragment,null,A,o.createElement(st,{page:C})):A}));mt.displayName="Link";var gt=o.forwardRef((function(e,t){let{"aria-current":n="page",caseSensitive:r=!1,className:a="",end:i=!1,style:c,to:l,viewTransition:u,children:d}=e,p=s(e,g),f=ge(l,{relative:p.relative}),m=de(),y=o.useContext(re),{navigator:b,basename:v}=o.useContext(ie),x=null!=y&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.useContext(oe);w(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=vt("useViewTransitionState"),a=ge(e,{relative:t.relative});if(!n.isTransitioning)return!1;let s=U(n.currentLocation.pathname,r)||n.currentLocation.pathname,i=U(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=W(a.pathname,i)||null!=W(a.pathname,s)}(f)&&!0===u,k=b.encodeLocation?b.encodeLocation(f).pathname:f.pathname,S=m.pathname,_=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;r||(S=S.toLowerCase(),_=_?_.toLowerCase():null,k=k.toLowerCase()),_&&v&&(_=U(_,v)||_);const C="/"!==k&&k.endsWith("/")?k.length-1:k.length;let I,T=S===k||!i&&S.startsWith(k)&&"/"===S.charAt(C),N=null!=_&&(_===k||!i&&_.startsWith(k)&&"/"===_.charAt(k.length)),E={isActive:T,isPending:N,isTransitioning:x},A=T?n:void 0;I="function"===typeof a?a(E):[a,T?"active":null,N?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let R="function"===typeof c?c(E):c;return o.createElement(mt,h(h({},p),{},{"aria-current":A,className:I,ref:t,style:R,to:l,viewTransition:u}),"function"===typeof d?d(E):d)}));gt.displayName="NavLink";var yt=o.forwardRef(((e,t)=>{let{discover:n="render",fetcherKey:r,navigate:a,reloadDocument:i,replace:c,state:l,method:u=Pe,action:d,onSubmit:p,relative:f,preventScrollReset:m,viewTransition:g}=e,b=s(e,y),v=kt(),x=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:n}=o.useContext(ie),r=o.useContext(le);w(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),s=h({},ge(e||".",{relative:t})),i=de();if(null==e){s.search=i.search;let e=new URLSearchParams(s.search),t=e.getAll("index");if(t.some((e=>""===e))){e.delete("index"),t.filter((e=>e)).forEach((t=>e.append("index",t)));let n=e.toString();s.search=n?"?".concat(n):""}}e&&"."!==e||!a.route.index||(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(s.pathname="/"===s.pathname?n:Q([n,s.pathname]));return _(s)}(d,{relative:f}),k="get"===u.toLowerCase()?"get":"post",S="string"===typeof d&&ft.test(d);return o.createElement("form",h(h({ref:t,method:k,action:x,onSubmit:i?p:e=>{if(p&&p(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,n=(null===t||void 0===t?void 0:t.getAttribute("formmethod"))||u;v(t||e.currentTarget,{fetcherKey:r,method:n,navigate:a,replace:c,state:l,relative:f,preventScrollReset:m,viewTransition:g})}},b),{},{"data-discover":S||"render"!==n?void 0:"true"}))}));function bt(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function vt(e){let t=o.useContext(ne);return w(t,bt(e)),t}yt.displayName="Form";var wt=0,xt=()=>"__".concat(String(++wt),"__");function kt(){let{router:e}=vt("useSubmit"),{basename:t}=o.useContext(ie),n=Ie("useRouteId");return o.useCallback((async function(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:a,method:s,encType:i,formData:c,body:l}=qe(r,t);if(!1===o.navigate){let t=o.fetcherKey||xt();await e.fetch(t,n,o.action||a,{preventScrollReset:o.preventScrollReset,formData:c,body:l,formMethod:o.method||s,formEncType:o.encType||i,flushSync:o.flushSync})}else await e.navigate(o.action||a,{preventScrollReset:o.preventScrollReset,formData:c,body:l,formMethod:o.method||s,formEncType:o.encType||i,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})}),[e,t,n])}var St=__webpack_require__(579);const _t=e=>{let{sequencerStructure:t,trackNames:n,getCellState:r,handleCellClick:o,currentPlaybackPosition:a=null,onLoopButtonClick:s,loopRange:i,loopedBlockIndices:c,mutedTracks:l,isGridModeActive:u,onTrackStepsChange:h}=e;return(0,St.jsx)("div",{className:"blocks-container",children:t.map(((e,d)=>{const p=e.originalIndex,f=e.id;let m=!1;if(i&&null!==i.start&&null!==i.end){const e=i.start,n=i.end,r=t.length;m=e<=n?p>=e&&p<=n:p>=e&&p<r||p>=0&&p<=n}const g=c&&c.includes(p),y=c&&c.length>0&&!g,b=g?"LOOPING":"LOOP",v="loop-button ".concat(g?"active":"");return(0,St.jsx)("div",{className:"block-container ".concat(y?"block-out-of-loop":""),children:(0,St.jsxs)("div",{className:"sequencer",children:[(0,St.jsxs)("div",{className:"sequencer-header",children:[(0,St.jsx)("h2",{children:e.name}),(0,St.jsx)("button",{className:v,onClick:()=>s(p),children:b})]}),(0,St.jsx)("div",{className:"grid",children:n.map((t=>{const n=e.trackSteps[t]||0;return(0,St.jsxs)("div",{className:"track-row ".concat(l&&l.has(t)?"muted":""),children:[u&&(0,St.jsxs)("div",{className:"track-step-controls",children:[(0,St.jsx)("button",{onClick:()=>{f&&n>1&&h(f,t,n-1)},disabled:!f||n<=1,className:"step-control-button",children:"-"}),(0,St.jsx)("input",{type:"number",value:n,onChange:e=>{const n=parseInt(e.target.value,10);f&&!isNaN(n)&&n>=1&&n<=16&&h(f,t,n)},min:"1",max:"16",className:"step-count-input"}),(0,St.jsx)("button",{onClick:()=>{f&&n<16&&h(f,t,n+1)},disabled:!f||n>=16,className:"step-control-button",children:"+"})]}),Array.from({length:n},((e,n)=>{const s="".concat(d,"-").concat(t,"-").concat(n),i=r(s),c=!!i.instrumentId;let u="";return a&&a.blockIndex===d&&a.stepIndex===n&&(!l||!l.has(t))&&(u=c?"playing-active":"playing-empty"),(0,St.jsx)("div",{className:"grid-cell ".concat(c?"active":""," ").concat(u),onClick:()=>o(s),"data-cell-id":s,children:i.instrumentId&&(0,St.jsx)("img",{src:"./icons/".concat(i.instrumentId,".png"),alt:i.instrumentId,className:"cell-instrument-icon",title:i.instrumentId})},s)}))]},t)}))})]})},f||"block-".concat(d))}))})},Ct={kick:{urls:{C4:"kick.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/kick.PNG",name:"\u0411\u0430\u0441-\u0431\u0430\u0440\u0430\u0431\u0430\u043d"},snare:{urls:{C4:"snare.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/snare.png",name:"\u041c\u0430\u043b\u044b\u0439 \u0431\u0430\u0440\u0430\u0431\u0430\u043d"},hihat:{urls:{C4:"hihat.mp3"},baseUrl:"./samples/drums/",volume:-3,icon:"./icons/hihat.png",name:"\u0425\u0430\u0439-\u0445\u044d\u0442"},hhop:{urls:{C4:"hhop.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/hhop.png",name:"\u0425\u0430\u0439-\u0445\u044d\u0442 open"},tomhi:{urls:{C4:"tomhi.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/tomhi.png",name:"\u0422\u043e\u043c \u0432\u044b\u0441\u043e\u043a\u0438\u0439"},tommid:{urls:{C4:"tommid.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/tommid.png",name:"\u0422\u043e\u043c \u0441\u0440\u0435\u0434\u043d\u0438\u0439"},tomlow:{urls:{C4:"tomlow.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/tomlow.png",name:"\u0422\u043e\u043c \u043d\u0438\u0437\u043a\u0438\u0439"},ride:{urls:{C4:"ride.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/ride.png",name:"\u0420\u0438\u0434"},ridebell:{urls:{C4:"ridebell.mp3"},baseUrl:"./samples/drums/",volume:0,icon:"./icons/ridebell.png",name:"\u0420\u0438\u0434-\u0431\u0443\u0431\u0435\u043d"},crash:{urls:{C4:"crash.wav"},baseUrl:"./samples/drums/",volume:-5,icon:"./icons/crash.png",name:"\u041a\u0440\u0435\u0441\u0442"}},It=e=>{let{onInstrumentSelect:t,onClearAll:n,isGridModeActive:r,onToggleGridMode:a,currentBarInfo:s,onTimeSignatureChange:i,onAddBar:c,onRemoveBar:l}=e;const[u,h]=(0,o.useState)(null),d=e=>{u===e?(h(null),null===t||void 0===t||t(null,{id:null,name:""})):(h(e),t&&t(e,"eraser"===e?{id:e,name:"\u041b\u0430\u0441\u0442\u0438\u043a"}:Ct[e]))},p=e=>{if(s&&i){const t=s.timeSignature||4;let n=t+e;const r=1,o=6;n<r&&(n=r),n>o&&(n=o),n!==t&&i(n)}};return(0,St.jsxs)("div",{className:"instrument-panel",children:[(0,St.jsxs)("div",{className:"instrument-list",children:[Object.keys(Ct).map((e=>(0,St.jsx)("div",{className:"instrument-item ".concat(u===e?"selected":""),onClick:()=>d(e),title:Ct[e].name,children:(0,St.jsx)("img",{src:Ct[e].icon,alt:Ct[e].name})},e))),(0,St.jsx)("div",{className:"instrument-item eraser ".concat("eraser"===u?"selected":""),onClick:()=>d("eraser"),title:"\u041b\u0430\u0441\u0442\u0438\u043a",children:(0,St.jsx)("img",{src:"/icons/eraser.png",alt:"\u041b\u0430\u0441\u0442\u0438\u043a"})})]}),(0,St.jsxs)("div",{className:"panel-actions",children:[r&&(0,St.jsxs)("div",{className:"grid-controls-panel",children:[s&&(0,St.jsxs)("div",{className:"bar-info-display",children:[(0,St.jsx)("span",{children:"Time Signature: "}),(0,St.jsx)("button",{onClick:()=>p(-1),disabled:(s.timeSignature||4)<=1,className:"time-signature-step-button",title:"\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0442\u0430\u043a\u0442\u0430",children:"-"}),(0,St.jsx)("span",{className:"time-signature-value",children:s.timeSignature||4}),(0,St.jsx)("button",{onClick:()=>p(1),disabled:(s.timeSignature||4)>=6,className:"time-signature-step-button",title:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0442\u0430\u043a\u0442\u0430",children:"+"}),(0,St.jsx)("span",{className:"time-signature-denominator",children:"/ 4"})]}),(0,St.jsxs)("div",{className:"bar-controls",children:[(0,St.jsx)("span",{className:"bar-controls-label",children:"Bars:"}),(0,St.jsx)("button",{onClick:c,className:"grid-control-button add-bar-button",title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0442\u0430\u043a\u0442 \u043f\u043e\u0441\u043b\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e",children:"+"}),(0,St.jsx)("button",{onClick:l,className:"grid-control-button remove-bar-button",title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0442\u0430\u043a\u0442",children:"-"})]})]}),(0,St.jsx)("button",{className:"grid-button ".concat(r?"active":""),onClick:a,title:"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u0435\u0442\u043a\u043e\u0439 \u0441\u0435\u043a\u0432\u0435\u043d\u0441\u043e\u0440\u0430",children:"GRID"}),(0,St.jsx)("button",{className:"clear-button",onClick:n,title:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u044f\u0447\u0435\u0439\u043a\u0438",children:(0,St.jsx)("span",{className:"clear-icon",children:"\xd7"})})]})]})},Tt=120,Nt=e=>{let{sequencerStructure:t,trackNames:n,cellsState:r,currentBar:o=0,totalBars:a=1,onBarChange:s=()=>{},currentBarInfo:i={},onVerticalModeChange:c=()=>{},inVerticalMode:l=!1,isPlaying:u=!1,bpm:h=Tt,isInitialized:d=!1,isPrerollEnabled:p=!0,isTransitioning:f=!1,onPlayToggle:m=()=>{},onBpmChange:g=()=>{},onPrerollToggle:y=()=>{},isMetronomeEnabled:b=!1,onMetronomeToggle:v=()=>{}}=e;null===i||void 0===i||i.timeSignature;const w=e=>{const t=parseInt(e.target.value,10);!isNaN(t)&&t>=60&&t<=240&&g(t)},x="player-menu ".concat(l?"in-vertical-mode":"");return(0,St.jsxs)("div",{className:x,children:[(0,St.jsxs)("div",{className:"transport-controls",children:[(0,St.jsx)("button",{className:"play-button ".concat(u?"active":""),onClick:m,disabled:!d||f,children:u?"\u25a0":"\u25b6"}),!l&&(0,St.jsxs)(St.Fragment,{children:[(0,St.jsx)("button",{className:"display-mode-button",onClick:()=>c("vertical"),children:"\u0412\u0435\u0440\u0442\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0432\u0438\u0434"}),(0,St.jsx)("button",{className:"preroll-button ".concat(p?"active":""),onClick:()=>{y(!p)},children:"\u041e\u0442\u0441\u0447\u0451\u0442"}),(0,St.jsx)("button",{className:"metronome-button ".concat(b?"active":""),onClick:v,children:"\u041c\u0435\u0442\u0440\u043e\u043d\u043e\u043c"})]})]}),(0,St.jsxs)("div",{className:"bpm-controls",children:[(0,St.jsx)("label",{htmlFor:"bpm-input",children:"BPM:"}),(0,St.jsx)("input",{id:"bpm-input",type:"number",min:60,max:240,value:h,onChange:w}),(0,St.jsx)("input",{type:"range",min:60,max:240,value:h,onChange:w,className:"bpm-slider"})]}),(0,St.jsxs)("div",{className:"bar-controls",children:[(0,St.jsx)("button",{onClick:()=>{o>0&&s(o-1)},disabled:0===o,className:"bar-button",children:"<"}),(0,St.jsxs)("span",{className:"bar-indicator",children:[o+1," / ",a]}),(0,St.jsx)("button",{onClick:()=>{o<a-1&&s(o+1)},disabled:o===a-1,className:"bar-button",children:">"})]})]})},Et={bpm:120,bars:[{id:1,name:"\u0422\u0430\u043a\u0442 1",timeSignature:4},{id:2,name:"\u0422\u0430\u043a\u0442 2",timeSignature:4}],trackNames:["R","L","RF","LF"],sequencerStructure:[{id:1,name:"\u0411\u043b\u043e\u043a 1",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:2,name:"\u0411\u043b\u043e\u043a 2",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:3,name:"\u0411\u043b\u043e\u043a 3",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:4,name:"\u0411\u043b\u043e\u043a 4",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:5,name:"\u0411\u043b\u043e\u043a 5",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:6,name:"\u0411\u043b\u043e\u043a 6",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:7,name:"\u0411\u043b\u043e\u043a 7",trackSteps:{R:4,L:4,RF:4,LF:4}},{id:8,name:"\u0411\u043b\u043e\u043a 81",trackSteps:{R:4,L:4,RF:4,LF:4}}],initialInstruments:{"0-R":{0:"kick",2:"kick"},"0-L":{1:"snare",3:"snare"},"1-R":{0:"kick",2:"kick"},"1-L":{1:"snare",3:"snare"},"1-RF":{0:"hihat",1:"hihat",2:"hihat",3:"hihat"}}},At=(e,t)=>({handleCellClick:(e,n)=>{const r=null===n||void 0===n?void 0:n.id;null!==r&&void 0!==r?(t((t=>{const n=t[e]||{instrumentId:null};if("eraser"===r)return n.instrumentId?h(h({},t),{},{[e]:h(h({},n),{},{instrumentId:null})}):t;let o;return o=n.instrumentId&&n.instrumentId===r?null:r,h(h({},t),{},{[e]:h(h({},n),{},{instrumentId:o})})})),console.log("Clicked cell: ".concat(e,", instrument: ").concat(r||"none"))):console.log("\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d, \u043a\u043b\u0438\u043a \u043f\u043e \u044f\u0447\u0435\u0439\u043a\u0435 \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f")},clearAllCells:()=>{const n={};Object.keys(e).forEach((t=>{n[t]=h(h({},e[t]),{},{instrumentId:null})})),t(n)}}),Rt="15.1.22";var Ot=__webpack_require__(3998);const Mt=new WeakSet,Pt=new WeakMap,Dt=new WeakMap,Ft=new WeakMap,Lt=new WeakMap,zt=new WeakMap,Bt=new WeakMap,qt=new WeakMap,Wt=new WeakMap,jt=new WeakMap,Vt={construct:()=>Vt},Ut=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Gt=(e,t)=>{const n=[];let r=e.replace(/^[\s]+/,""),o=r.match(Ut);for(;null!==o;){const e=o[1].slice(1,-1),a=o[0].replace(/([\s]+)?;?$/,"").replace(e,new URL(e,t).toString());n.push(a),r=r.slice(o[0].length).replace(/^[\s]+/,""),o=r.match(Ut)}return[n.join(";"),r]},Ht=e=>{if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Kt=e=>{if(!(e=>{try{new new Proxy(e,Vt)}catch(t){return!1}return!0})(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!==typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Xt=(e,t)=>{const n=e.get(t);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},Qt=(e,t)=>{const n=Array.from(e).filter(t);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[r]=n;return e.delete(r),r},Yt=(e,t,n,r)=>{const o=Xt(e,t),a=Qt(o,(e=>e[0]===n&&e[1]===r));return 0===o.size&&e.delete(t),a},Jt=e=>Xt(Bt,e),Zt=e=>{if(Mt.has(e))throw new Error("The AudioNode is already stored.");Mt.add(e),Jt(e).forEach((e=>e(!0)))},$t=e=>"port"in e,en=e=>{if(!Mt.has(e))throw new Error("The AudioNode is not stored.");Mt.delete(e),Jt(e).forEach((e=>e(!1)))},tn=(e,t)=>{!$t(e)&&t.every((e=>0===e.size))&&en(e)},nn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},rn=(e,t)=>e.context===t,on=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch(t){return!1}return!0},an=()=>new DOMException("","IndexSizeError"),sn=e=>{var t;e.getChannelData=(t=e.getChannelData,n=>{try{return t.call(e,n)}catch(r){if(12===r.code)throw an();throw r}})},cn={numberOfChannels:1},ln=-34028234663852886e22,un=-ln,hn=e=>Mt.has(e),dn={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},pn=e=>Xt(Pt,e),fn=e=>Xt(Ft,e),mn=(e,t)=>{const{activeInputs:n}=pn(e);n.forEach((n=>n.forEach((n=>{let[r]=n;t.includes(e)||mn(r,[...t,e])}))));const r=(e=>"playbackRate"in e)(e)?[e.playbackRate]:$t(e)?Array.from(e.parameters.values()):(e=>"frequency"in e&&"gain"in e)(e)?[e.Q,e.detune,e.frequency,e.gain]:(e=>"offset"in e)(e)?[e.offset]:(e=>!("frequency"in e)&&"gain"in e)(e)?[e.gain]:(e=>"detune"in e&&"frequency"in e&&!("gain"in e))(e)?[e.detune,e.frequency]:(e=>"pan"in e)(e)?[e.pan]:[];for(const o of r){const e=fn(o);void 0!==e&&e.activeInputs.forEach((e=>{let[n]=e;return mn(n,t)}))}hn(e)&&en(e)},gn=e=>{mn(e.destination,[])},yn=e=>void 0===e||"number"===typeof e||"string"===typeof e&&("balanced"===e||"interactive"===e||"playback"===e),bn=e=>"context"in e,vn=e=>bn(e[0]),wn=(e,t,n,r)=>{for(const o of e)if(n(o)){if(r)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0},xn=(e,t,n,r)=>{let[o,a]=n;wn(e,[t,o,a],(e=>e[0]===t&&e[1]===o),r)},kn=(e,t,n)=>{let[r,o,a]=t;const s=e.get(r);void 0===s?e.set(r,new Set([[o,a]])):wn(s,[o,a],(e=>e[0]===o),n)},Sn=e=>"inputs"in e,_n=(e,t,n,r)=>{if(Sn(t)){const o=t.inputs[r];return e.connect(o,n,0),[o,n,0]}return e.connect(t,n,r),[t,n,r]},Cn=(e,t,n)=>{for(const r of e)if(r[0]===t&&r[1]===n)return e.delete(r),r;return null},In=(e,t)=>{if(!Jt(e).delete(t))throw new Error("Missing the expected event listener.")},Tn=(e,t,n)=>{const r=Xt(e,t),o=Qt(r,(e=>e[0]===n));return 0===r.size&&e.delete(t),o},Nn=(e,t,n,r)=>{Sn(t)?e.disconnect(t.inputs[r],n,0):e.disconnect(t,n,r)},En=e=>Xt(Dt,e),An=e=>Xt(Lt,e),Rn=e=>qt.has(e),On=e=>!Mt.has(e),Mn=(e,t)=>new Promise((n=>{if(null!==t)n(!0);else{const t=e.createScriptProcessor(256,1,1),r=e.createGain(),o=e.createBuffer(1,2,44100),a=o.getChannelData(0);a[0]=1,a[1]=1;const s=e.createBufferSource();s.buffer=o,s.loop=!0,s.connect(t).connect(e.destination),s.connect(r),s.disconnect(r),t.onaudioprocess=r=>{const o=r.inputBuffer.getChannelData(0);Array.prototype.some.call(o,(e=>1===e))?n(!0):n(!1),s.stop(),t.onaudioprocess=null,s.disconnect(t),t.disconnect(e.destination)},s.start()}})),Pn=(e,t)=>{const n=new Map;for(const r of e)for(const e of r){const t=n.get(e);n.set(e,void 0===t?1:t+1)}n.forEach(((e,n)=>t(n,e)))},Dn=e=>"context"in e,Fn=e=>{const t=new Map;e.connect=(e=>function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=Dn(n)?e(n,r,o):e(n,r),s=t.get(n);return void 0===s?t.set(n,[{input:o,output:r}]):s.every((e=>e.input!==o||e.output!==r))&&s.push({input:o,output:r}),a})(e.connect.bind(e)),e.disconnect=(n=>(r,o,a)=>{if(n.apply(e),void 0===r)t.clear();else if("number"===typeof r)for(const[e,n]of t){const o=n.filter((e=>e.output!==r));0===o.length?t.delete(e):t.set(e,o)}else if(t.has(r))if(void 0===o)t.delete(r);else{const e=t.get(r);if(void 0!==e){const n=e.filter((e=>e.output!==o&&(e.input!==a||void 0===a)));0===n.length?t.delete(r):t.set(r,n)}}for(const[n,s]of t)s.forEach((t=>{Dn(n)?e.connect(n,t.output,t.input):e.connect(n,t.output)}))})(e.disconnect)},Ln=(e,t,n,r)=>{const{activeInputs:o,passiveInputs:a}=fn(t),{outputs:s}=pn(e),i=Jt(e),c=s=>{const i=En(e),c=An(t);if(s){const t=Tn(a,e,n);xn(o,e,t,!1),r||Rn(e)||i.connect(c,n)}else{const t=((e,t,n)=>Qt(e,(e=>e[0]===t&&e[1]===n)))(o,e,n);kn(a,t,!1),r||Rn(e)||i.disconnect(c,n)}};return!!wn(s,[t,n],(e=>e[0]===t&&e[1]===n),!0)&&(i.add(c),hn(e)?xn(o,e,[n,c],!0):kn(a,[e,n,c],!0),!0)},zn=(e,t,n,r,o)=>{const[a,s]=((e,t,n,r)=>{const{activeInputs:o,passiveInputs:a}=pn(t),s=Cn(o[r],e,n);if(null===s)return[Yt(a,e,n,r)[2],!1];return[s[2],!0]})(e,n,r,o);if(null!==a&&(In(e,a),!s||t||Rn(e)||Nn(En(e),En(n),r,o)),hn(n)){const{activeInputs:e}=pn(n);tn(n,e)}},Bn=(e,t,n,r)=>{const[o,a]=((e,t,n)=>{const{activeInputs:r,passiveInputs:o}=fn(t),a=Cn(r,e,n);if(null===a)return[Tn(o,e,n)[1],!1];return[a[2],!0]})(e,n,r);null!==o&&(In(e,o),!a||t||Rn(e)||En(e).disconnect(An(n),r))};class qn{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._map.forEach(((n,r)=>e.call(t,n,r,this)))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Wn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function jn(e,t,n,r,o){if("function"===typeof e.copyFromChannel)0===t[n].byteLength&&(t[n]=new Float32Array(128)),e.copyFromChannel(t[n],r,o);else{const a=e.getChannelData(r);if(0===t[n].byteLength)t[n]=a.slice(o,o+128);else{const e=new Float32Array(a.buffer,o*Float32Array.BYTES_PER_ELEMENT,128);t[n].set(e)}}}const Vn=(e,t,n,r,o)=>{"function"===typeof e.copyToChannel?0!==t[n].byteLength&&e.copyToChannel(t[n],r,o):0!==t[n].byteLength&&e.getChannelData(r).set(t[n],o)},Un=(e,t)=>{const n=[];for(let r=0;r<e;r+=1){const e=[],o="number"===typeof t?t:t[r];for(let t=0;t<o;t+=1)e.push(new Float32Array(128));n.push(e)}return n},Gn=async(e,t,n,r,o,a,s)=>{const i=null===t?128*Math.ceil(e.context.length/128):t.length,c=r.channelCount*r.numberOfInputs,l=o.reduce(((e,t)=>e+t),0),u=0===l?null:n.createBuffer(l,i,n.sampleRate);if(void 0===a)throw new Error("Missing the processor constructor.");const d=pn(e),p=await((e,t)=>{const n=Xt(jt,e),r=En(t);return Xt(n,r)})(n,e),f=Un(r.numberOfInputs,r.channelCount),m=Un(r.numberOfOutputs,o),g=Array.from(e.parameters.keys()).reduce(((e,t)=>h(h({},e),{},{[t]:new Float32Array(128)})),{});for(let h=0;h<i;h+=128){if(r.numberOfInputs>0&&null!==t)for(let e=0;e<r.numberOfInputs;e+=1)for(let n=0;n<r.channelCount;n+=1)jn(t,f[e],n,n,h);void 0!==a.parameterDescriptors&&null!==t&&a.parameterDescriptors.forEach(((e,n)=>{let{name:r}=e;jn(t,g,r,c+n,h)}));for(let e=0;e<r.numberOfInputs;e+=1)for(let t=0;t<o[e];t+=1)0===m[e][t].byteLength&&(m[e][t]=new Float32Array(128));try{const e=f.map(((e,t)=>0===d.activeInputs[t].size?[]:e)),t=s(h/n.sampleRate,n.sampleRate,(()=>p.process(e,m,g)));if(null!==u)for(let n=0,a=0;n<r.numberOfOutputs;n+=1){for(let e=0;e<o[n];e+=1)Vn(u,m[n],e,a+e,h);a+=o[n]}if(!t)break}catch(y){e.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},Hn={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Kn={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Xn={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Qn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Yn={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Jn=e=>{const{port1:t,port2:n}=new MessageChannel;return new Promise((r=>{const o=()=>{n.onmessage=null,t.close(),n.close(),r()};n.onmessage=()=>o();try{t.postMessage(e,[e])}catch(a){}finally{o()}}))},Zn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},$n=(e,t,n)=>{const r=t[n];if(void 0===r)throw e();return r},er={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},tr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},nr=()=>new DOMException("","InvalidStateError"),rr=()=>new DOMException("","InvalidAccessError"),or={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},ar=(e,t,n,r,o,a,s,i,c,l,u)=>{const h=l.length;let d=i;for(let p=0;p<h;p+=1){let i=n[0]*l[p];for(let t=1;t<o;t+=1){const r=d-t&c-1;i+=n[t]*a[r],i-=e[t]*s[r]}for(let e=o;e<r;e+=1)i+=n[e]*a[d-e&c-1];for(let n=o;n<t;n+=1)i-=e[n]*s[d-n&c-1];a[d]=l[p],s[d]=i,d=d+1&c-1,u[p]=i}return d},sr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},ir=e=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=e.decodeAudioData(t.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch(n){}return!1},cr={numberOfChannels:1},lr=(e,t,n)=>{const r=t[n];void 0!==r&&r!==e[n]&&(e[n]=r)},ur=(e,t)=>{lr(e,t,"channelCount"),lr(e,t,"channelCountMode"),lr(e,t,"channelInterpretation")},hr=e=>"function"===typeof e.getFloatTimeDomainData,dr=(e,t,n)=>{const r=t[n];void 0!==r&&r!==e[n].value&&(e[n].value=r)},pr=e=>{e.start=(t=>function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if("number"===typeof o&&o<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");t.call(e,n,r,o)})(e.start)},fr=e=>{var t;e.stop=(t=e.stop,function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(n<0)throw new RangeError("The parameter can't be negative.");t.call(e,n)})},mr=(e,t)=>null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t))))),gr=async(e,t)=>{const n=await(e=>new Promise(((t,n)=>{const{port1:r,port2:o}=new MessageChannel;r.onmessage=e=>{let{data:n}=e;r.close(),o.close(),t(n)},r.onmessageerror=e=>{let{data:t}=e;r.close(),o.close(),n(t)},o.postMessage(e)})))(t);return new e(n)},yr=(e,t)=>{const n=e.createBiquadFilter();return ur(n,t),dr(n,t,"Q"),dr(n,t,"detune"),dr(n,t,"frequency"),dr(n,t,"gain"),lr(n,t,"type"),n},br=(e,t)=>{const n=e.createChannelSplitter(t.numberOfOutputs);return ur(n,t),(e=>{const t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw nr()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:e=>{if("explicit"!==e)throw nr()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:e=>{if("discrete"!==e)throw nr()}})})(n),n},vr=(e,t)=>(e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e),wr=["offset"],xr=(e,t)=>{const n=e.createDelay(t.maxDelayTime);return ur(n,t),dr(n,t,"delayTime"),n},kr=(e,t)=>{const n=e.createGain();return ur(n,t),dr(n,t,"gain"),n};function Sr(e,t){const n=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/n,(e[1]*t[0]-e[0]*t[1])/n]}function _r(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function Cr(e,t){let n=[0,0];for(let r=e.length-1;r>=0;r-=1)n=_r(n,t),n[0]+=e[r];return n}const Ir=["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"],Tr=(e,t,n,r)=>e.createScriptProcessor(t,n,r),Nr=["channelCount","channelCountMode","pan"],Er=["curve","oversample"],Ar=()=>new DOMException("","NotSupportedError"),Rr={numberOfChannels:1},Or={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Mr={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Pr={disableNormalization:!1},Dr={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Fr=()=>new DOMException("","UnknownError"),Lr={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},zr=(e,t,n)=>void 0===e.copyFromChannel?e.getChannelData(n)[0]:(e.copyFromChannel(t,n),t[0]),Br=e=>{if(null===e)return!1;const t=e.length;return t%2!==0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},qr=(e,t,n,r)=>{let o=e;for(;!o.hasOwnProperty(t);)o=Object.getPrototypeOf(o);const{get:a,set:s}=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,{get:n(a),set:r(s)})},Wr=(e,t,n)=>{try{e.setValueAtTime(t,n)}catch(r){if(9!==r.code)throw r;Wr(e,t,n+1e-7)}},jr=e=>{const t=e.createOscillator();try{t.start(-1)}catch(n){return n instanceof RangeError}return!1},Vr=e=>{const t=e.createBuffer(1,1,44100),n=e.createBufferSource();n.buffer=t,n.start(),n.stop();try{return n.stop(),!0}catch(r){return!1}},Ur=e=>{const t=e.createOscillator();try{t.stop(-1)}catch(n){return n instanceof RangeError}return!1},Gr=(e,t)=>{const n=t.createGain();e.connect(n);const r=(t=>()=>{t.call(e,n),e.removeEventListener("ended",r)})(e.disconnect);e.addEventListener("ended",r),vr(e,n),e.stop=(t=>{let r=!1;return function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r)try{t.call(e,o)}catch(a){n.gain.setValueAtTime(0,o)}else t.call(e,o),r=!0}})(e.stop)},Hr=(e,t)=>n=>{const r={value:e};return Object.defineProperties(n,{currentTarget:r,target:r}),"function"===typeof t?t.call(e,n):t.handleEvent.call(e,n)},Kr=(e=>(t,n,r,o)=>{let[a,s,i]=r;e(t[s],[n,a,i],(e=>e[0]===n&&e[1]===a),o)})(wn),Xr=(e=>(t,n,r,o)=>{let[a,s,i]=r;const c=t.get(a);void 0===c?t.set(a,new Set([[s,n,i]])):e(c,[s,n,i],(e=>e[0]===s&&e[1]===n),o)})(wn),Qr=(e=>(t,n,r,o)=>e(t[o],(e=>e[0]===n&&e[1]===r)))(Qt),Yr=new WeakMap,Jr=(e=>t=>{var n;return null!==(n=e.get(t))&&void 0!==n?n:0})(Yr),Zr=($r=new Map,eo=new WeakMap,(e,t)=>{const n=eo.get(e);if(void 0!==n)return n;const r=$r.get(e);if(void 0!==r)return r;try{const n=t();return n instanceof Promise?($r.set(e,n),n.catch((()=>!1)).then((t=>($r.delete(e),eo.set(e,t),t)))):(eo.set(e,n),n)}catch(o){return eo.set(e,!1),!1}});var $r,eo;const to="undefined"===typeof window?null:window,no=((e,t)=>(n,r)=>{const o=n.createAnalyser();if(ur(o,r),!(r.maxDecibels>r.minDecibels))throw t();return lr(o,r,"fftSize"),lr(o,r,"maxDecibels"),lr(o,r,"minDecibels"),lr(o,r,"smoothingTimeConstant"),e(hr,(()=>hr(o)))||(e=>{e.getFloatTimeDomainData=t=>{const n=new Uint8Array(t.length);e.getByteTimeDomainData(n);const r=Math.max(n.length,e.fftSize);for(let e=0;e<r;e+=1)t[e]=.0078125*(n[e]-128);return t}})(o),o})(Zr,an),ro=(e=>t=>{const n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(pn),oo=((e,t,n)=>async(r,o,a)=>{const s=e(r);await Promise.all(s.activeInputs.map(((e,s)=>Array.from(e).map((async e=>{let[i,c]=e;const l=t(i),u=await l.render(i,o),h=r.context.destination;n(i)||r===h&&n(r)||u.connect(a,c,s)})))).reduce(((e,t)=>[...e,...t]),[]))})(pn,ro,Rn),ao=((e,t,n)=>()=>{const r=new WeakMap;return{render(o,a){const s=r.get(a);return void 0!==s?Promise.resolve(s):(async(o,a)=>{let s=t(o);if(!rn(s,a)){const t={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,fftSize:s.fftSize,maxDecibels:s.maxDecibels,minDecibels:s.minDecibels,smoothingTimeConstant:s.smoothingTimeConstant};s=e(a,t)}return r.set(a,s),await n(o,a,s),s})(o,a)}}})(no,En,oo),so=(io=zt,e=>{const t=io.get(e);if(void 0===t)throw nr();return t});var io;const co=(e=>null===e?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null)(to),lo=(e=>t=>null!==e&&t instanceof e)(co),uo=new WeakMap,ho=(e=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(t,n,r){if(null!==n){let o=this._listeners.get(n);void 0===o&&(o=e(this,n),"function"===typeof n&&this._listeners.set(n,o)),this._nativeEventTarget.addEventListener(t,o,r)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,t,n){const r=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===r?null:r,n)}})(Hr),po=(e=>null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null)(to),fo=(e=>t=>null!==e&&t instanceof e)(po),mo=(e=>t=>null!==e&&"function"===typeof e.AudioNode&&t instanceof e.AudioNode)(to),go=(e=>t=>null!==e&&"function"===typeof e.AudioParam&&t instanceof e.AudioParam)(to),yo=(e=>null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null)(to),bo=((e,t,n,r,o,a,s,i,c,l,u,h,d,p,f,m)=>class extends l{constructor(t,r,o,a){super(o),this._context=t,this._nativeAudioNode=o;const s=u(t);h(s)&&!0!==n(Mn,(()=>Mn(s,m)))&&Fn(o),Dt.set(this,o),Bt.set(this,new Set),"closed"!==t.state&&r&&Zt(this),e(this,a,o)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(e){this._nativeAudioNode.channelCount=e}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(e){this._nativeAudioNode.channelCountMode=e}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(e){this._nativeAudioNode.channelInterpretation=e}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw o();const l=u(this._context),h=f(l);if(d(e)||p(e))throw a();if(bn(e)){const o=En(e);try{const t=_n(this._nativeAudioNode,o,n,i),r=On(this);(h||r)&&this._nativeAudioNode.disconnect(...t),"closed"!==this.context.state&&!r&&On(e)&&Zt(e)}catch(g){if(12===g.code)throw a();throw g}if(t(this,e,n,i,h)){const t=c([this],e);Pn(t,r(h))}return e}const m=An(e);if("playbackRate"===m.name&&1024===m.maxValue)throw s();try{this._nativeAudioNode.connect(m,n),(h||On(this))&&this._nativeAudioNode.disconnect(m,n)}catch(g){if(12===g.code)throw a();throw g}if(Ln(this,e,n,h)){const t=c([this],e);Pn(t,r(h))}}disconnect(e,t,n){let r;const s=u(this._context),l=f(s);if(void 0===e)r=((e,t)=>{const n=pn(e),r=[];for(const o of n.outputs)vn(o)?zn(e,t,...o):Bn(e,t,...o),r.push(o[0]);return n.outputs.clear(),r})(this,l);else if("number"===typeof e){if(e<0||e>=this.numberOfOutputs)throw o();r=((e,t,n)=>{const r=pn(e),o=[];for(const a of r.outputs)a[1]===n&&(vn(a)?zn(e,t,...a):Bn(e,t,...a),o.push(a[0]),r.outputs.delete(a));return o})(this,l,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw o();if(bn(e)&&void 0!==n&&(n<0||n>=e.numberOfInputs))throw o();if(r=((e,t,n,r,o)=>{const a=pn(e);return Array.from(a.outputs).filter((e=>e[0]===n&&(void 0===r||e[1]===r)&&(void 0===o||e[2]===o))).map((n=>(vn(n)?zn(e,t,...n):Bn(e,t,...n),a.outputs.delete(n),n[0])))})(this,l,e,t,n),0===r.length)throw a()}for(const o of r){const e=c([this],o);Pn(e,i)}}})((vo=Pt,(e,t,n)=>{const r=[];for(let o=0;o<n.numberOfInputs;o+=1)r.push(new Set);vo.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),((e,t,n,r,o,a,s,i,c,l,u,h,d)=>{const p=new WeakMap;return(f,m,g,y,b)=>{const{activeInputs:v,passiveInputs:w}=a(m),{outputs:x}=a(f),k=i(f),S=a=>{const i=c(m),l=c(f);if(a){const t=Yt(w,f,g,y);e(v,f,t,!1),b||h(f)||n(l,i,g,y),d(m)&&Zt(m)}else{const e=r(v,f,g,y);t(w,y,e,!1),b||h(f)||o(l,i,g,y);const n=s(m);if(0===n)u(m)&&tn(m,v);else{const e=p.get(m);void 0!==e&&clearTimeout(e),p.set(m,setTimeout((()=>{u(m)&&tn(m,v)}),1e3*n))}}};return!!l(x,[m,g,y],(e=>e[0]===m&&e[1]===g&&e[2]===y),!0)&&(k.add(S),u(f)?e(v,f,[g,y,S],!0):t(w,y,[f,g,S],!0),!0)}})(Kr,Xr,_n,Qr,Nn,pn,Jr,Jt,En,wn,hn,Rn,On),Zr,((e,t,n,r,o,a)=>s=>(i,c)=>{const l=e.get(i);if(void 0===l){if(!s&&a(i)){const e=r(i),{outputs:a}=n(i);for(const n of a)if(vn(n)){const o=r(n[0]);t(e,o,n[1],n[2])}else{const t=o(n[0]);e.disconnect(t,n[1])}}e.set(i,c)}else e.set(i,l+c)})(qt,Nn,pn,En,An,hn),an,rr,Ar,((e,t,n,r,o,a,s,i)=>(c,l)=>{const u=t.get(c);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=a(c.context),d=i(h);if(u===l){if(t.delete(c),!d&&s(c)){const t=r(c),{outputs:a}=n(c);for(const n of a)if(vn(n)){const o=r(n[0]);e(t,o,n[1],n[2])}else{const e=o(n[0]);t.connect(e,n[1])}}}else t.set(c,u-l)})(_n,qt,pn,En,An,so,hn,lo),((e,t,n)=>function r(o,a){const s=bn(a)?a:n(e,a);if((e=>"delayTime"in e)(s))return[];if(o[0]===s)return[o];if(o.includes(s))return[];const{outputs:i}=t(s);return Array.from(i).map((e=>r([...o,s],e[0]))).reduce(((e,t)=>e.concat(t)),[])})(uo,pn,Xt),ho,so,fo,mo,go,lo,yo);var vo;const wo=((e,t,n,r,o,a)=>class extends e{constructor(e,n){const s=o(e),i=h(h({},nn),n),c=r(s,i);super(e,!1,c,a(s)?t():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(e){this._nativeAnalyserNode.fftSize=e}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(e){const t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(e){const t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(e){this._nativeAnalyserNode.smoothingTimeConstant=e}getByteFrequencyData(e){this._nativeAnalyserNode.getByteFrequencyData(e)}getByteTimeDomainData(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}})(bo,ao,an,no,so,lo),xo=new WeakSet,ko=(e=>null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null)(to),So=(_o=new Uint32Array(1),e=>(_o[0]=e,_o[0]));var _o;const Co=((e,t)=>n=>{n.copyFromChannel=function(r,o){const a=e(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),s=e(o);if(s>=n.numberOfChannels)throw t();const i=n.length,c=n.getChannelData(s),l=r.length;for(let e=a<0?-a:0;e+a<i&&e<l;e+=1)r[e]=c[e+a]},n.copyToChannel=function(r,o){const a=e(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),s=e(o);if(s>=n.numberOfChannels)throw t();const i=n.length,c=n.getChannelData(s),l=r.length;for(let e=a<0?-a:0;e+a<i&&e<l;e+=1)c[e+a]=r[e]}})(So,an),Io=(e=>t=>{t.copyFromChannel=(n=>function(r,o){const a=e(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),s=e(o);if(a<t.length)return n.call(t,r,s,a)})(t.copyFromChannel),t.copyToChannel=(n=>function(r,o){const a=e(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),s=e(o);if(a<t.length)return n.call(t,r,s,a)})(t.copyToChannel)})(So),To=((e,t,n,r,o,a,s,i)=>{let c=null;return class l{constructor(l){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:d,sampleRate:p}=h(h({},cn),l);null===c&&(c=new o(1,1,44100));const f=null!==r&&t(a,a)?new r({length:u,numberOfChannels:d,sampleRate:p}):c.createBuffer(d,u,p);if(0===f.numberOfChannels)throw n();return"function"!==typeof f.copyFromChannel?(s(f),sn(f)):t(on,(()=>on(f)))||i(f),e.add(f),f}static[Symbol.hasInstance](t){return null!==t&&"object"===typeof t&&Object.getPrototypeOf(t)===l.prototype||e.has(t)}}})(xo,Zr,Ar,ko,co,(e=>()=>{if(null===e)return!1;try{new e({length:1,sampleRate:44100})}catch(t){return!1}return!0})(ko),Co,Io),No=(e=>(t,n)=>{const r=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(t.destination);const o=()=>{n.removeEventListener("ended",o),n.disconnect(r),r.disconnect()};n.addEventListener("ended",o)})(kr),Eo=((e,t,n)=>async(r,o,a)=>{const s=t(r);await Promise.all(Array.from(s.activeInputs).map((async t=>{let[r,s]=t;const i=e(r),c=await i.render(r,o);n(r)||c.connect(a,s)})))})(ro,fn,Rn),Ao=(e=>(t,n,r)=>e(n,t,r))(Eo),Ro=((e,t,n,r,o,a,s,i,c,l,u)=>(h,d)=>{const p=h.createBufferSource();return ur(p,d),dr(p,d,"playbackRate"),lr(p,d,"buffer"),lr(p,d,"loop"),lr(p,d,"loopEnd"),lr(p,d,"loopStart"),t(n,(()=>n(h)))||(e=>{e.start=(t=>{let n=!1;return function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;if(n)throw nr();t.call(e,r,o,a),n=!0}})(e.start)})(p),t(r,(()=>r(h)))||c(p),t(o,(()=>o(h)))||l(p,h),t(a,(()=>a(h)))||pr(p),t(s,(()=>s(h)))||u(p,h),t(i,(()=>i(h)))||fr(p),e(h,p),p})(No,Zr,(e=>{const t=e.createBufferSource();t.start();try{t.start()}catch(n){return!0}return!1}),(e=>{const t=e.createBufferSource(),n=e.createBuffer(1,1,44100);t.buffer=n;try{t.start(0,1)}catch(r){return!1}return!0}),(e=>{const t=e.createBufferSource();t.start();try{t.stop()}catch(n){return!1}return!0}),jr,Vr,Ur,(e=>{e.start=(t=>function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;const a=e.buffer,s=null===a?r:Math.min(a.duration,r);null!==a&&s>a.duration-.5/e.context.sampleRate?t.call(e,n,0,0):t.call(e,n,s,o)})(e.start)}),(e=>(t,n)=>{const r=n.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=r),e(t,"buffer",(e=>()=>{const n=e.call(t);return n===r?null:n}),(e=>n=>e.call(t,null===n?r:n)))})(qr),Gr),Oo=((e,t)=>(n,r,o)=>(e(r).replay(o),t(r,n,o)))((e=>t=>{const n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(fn),Eo),Mo=((e,t,n,r,o)=>()=>{const a=new WeakMap;let s=null,i=null;return{set start(e){s=e},set stop(e){i=e},render(c,l){const u=a.get(l);return void 0!==u?Promise.resolve(u):(async(c,l)=>{let u=n(c);const h=rn(u,l);if(!h){const e={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=t(l,e),null!==s&&u.start(...s),null!==i&&u.stop(i)}return a.set(l,u),h?await e(l,c.playbackRate,u.playbackRate):await r(l,c.playbackRate,u.playbackRate),await o(c,l,u),u})(c,l)}}})(Ao,Ro,En,Oo,oo),Po=((e,t,n,r,o,a,s,i,c,l,u,h,d)=>function(p,f,m){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const b=m.value,v=new Ot.AutomationEventList(b),w=f?r(v):null,x={get defaultValue(){return b},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===y?m.minValue:y},get value(){return m.value},set value(e){m.value=e,x.setValueAtTime(e,p.context.currentTime)},cancelAndHoldAtTime(e){if("function"===typeof m.cancelAndHoldAtTime)null===w&&v.flush(p.context.currentTime),v.add(o(e)),m.cancelAndHoldAtTime(e);else{const t=Array.from(v).pop();null===w&&v.flush(p.context.currentTime),v.add(o(e));const n=Array.from(v).pop();m.cancelScheduledValues(e),t!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return x},cancelScheduledValues:e=>(null===w&&v.flush(p.context.currentTime),v.add(a(e)),m.cancelScheduledValues(e),x),exponentialRampToValueAtTime(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;const n=p.context.currentTime;return null===w&&v.flush(n),0===Array.from(v).length&&(v.add(l(b,n)),m.setValueAtTime(b,n)),v.add(s(e,t)),m.exponentialRampToValueAtTime(e,t),x},linearRampToValueAtTime(e,t){const n=p.context.currentTime;return null===w&&v.flush(n),0===Array.from(v).length&&(v.add(l(b,n)),m.setValueAtTime(b,n)),v.add(i(e,t)),m.linearRampToValueAtTime(e,t),x},setTargetAtTime:(e,t,n)=>(null===w&&v.flush(p.context.currentTime),v.add(c(e,t,n)),m.setTargetAtTime(e,t,n),x),setValueAtTime:(e,t)=>(null===w&&v.flush(p.context.currentTime),v.add(l(e,t)),m.setValueAtTime(e,t),x),setValueCurveAtTime(e,t,n){const r=e instanceof Float32Array?e:new Float32Array(e);if(null!==h&&"webkitAudioContext"===h.name){const e=t+n,o=p.context.sampleRate,a=Math.ceil(t*o),s=Math.floor(e*o),i=s-a,c=new Float32Array(i);for(let u=0;u<i;u+=1){const e=(r.length-1)/n*((a+u)/o-t),s=Math.floor(e),i=Math.ceil(e);c[u]=s===i?r[s]:(1-(e-s))*r[s]+(1-(i-e))*r[i]}null===w&&v.flush(p.context.currentTime),v.add(u(c,t,n)),m.setValueCurveAtTime(c,t,n);const l=s/o;l<e&&d(x,c[c.length-1],l),d(x,r[r.length-1],e)}else null===w&&v.flush(p.context.currentTime),v.add(u(r,t,n)),m.setValueCurveAtTime(r,t,n);return x}};return n.set(x,m),t.set(x,p),e(x,w),x})((Do=Ft,(e,t)=>{Do.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),uo,Lt,(e=>({replay(t){for(const n of e)if("exponentialRampToValue"===n.type){const{endTime:e,value:r}=n;t.exponentialRampToValueAtTime(r,e)}else if("linearRampToValue"===n.type){const{endTime:e,value:r}=n;t.linearRampToValueAtTime(r,e)}else if("setTarget"===n.type){const{startTime:e,target:r,timeConstant:o}=n;t.setTargetAtTime(r,e,o)}else if("setValue"===n.type){const{startTime:e,value:r}=n;t.setValueAtTime(r,e)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:e,startTime:r,values:o}=n;t.setValueCurveAtTime(o,r,e)}}}})),Ot.createCancelAndHoldAutomationEvent,Ot.createCancelScheduledValuesAutomationEvent,Ot.createExponentialRampToValueAutomationEvent,Ot.createLinearRampToValueAutomationEvent,Ot.createSetTargetAutomationEvent,Ot.createSetValueAutomationEvent,Ot.createSetValueCurveAutomationEvent,po,Wr);var Do;const Fo=((e,t,n,r,o,a,s,i)=>class extends e{constructor(e,r){const i=a(e),c=h(h({},dn),r),l=o(i,c),u=s(i),d=u?t():null;super(e,!1,l,d),this._audioBufferSourceNodeRenderer=d,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=l,this._onended=null,this._playbackRate=n(this,u,l.playbackRate,un,ln)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(e){this._nativeAudioBufferSourceNode.loop=e}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(e){this._nativeAudioBufferSourceNode.loopEnd=e}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(e){this._nativeAudioBufferSourceNode.loopStart=e}get onended(){return this._onended}set onended(e){const t="function"===typeof e?i(this,e):null;this._nativeAudioBufferSourceNode.onended=t;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===t?e:n}get playbackRate(){return this._playbackRate}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(this._nativeAudioBufferSourceNode.start(e,t,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[e,t]:[e,t,n]),"closed"!==this.context.state){Zt(this);const e=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",e),hn(this)&&en(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",e)}}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}})(bo,Mo,Po,nr,Ro,so,lo,Hr),Lo=((e,t,n,r,o,a,s,i)=>class extends e{constructor(e,n){const r=a(e),c=s(r),l=o(r,n,c);super(e,!1,l,c?t(i):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=l}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(e){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=e}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(e){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=e}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(bo,(e=>{const t=new WeakMap;return{render(n,r){const o=t.get(r);return void 0!==o?Promise.resolve(o):(async(n,r)=>{const o=r.destination;return t.set(r,o),await e(n,r,o),o})(n,r)}}}),an,nr,((e,t)=>(n,r,o)=>{const a=n.destination;if(a.channelCount!==r)try{a.channelCount=r}catch(i){}o&&"explicit"!==a.channelCountMode&&(a.channelCountMode="explicit"),0===a.maxChannelCount&&Object.defineProperty(a,"maxChannelCount",{value:r});const s=e(n,{channelCount:r,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,gain:1});return t(s,"channelCount",(e=>()=>e.call(s)),(e=>t=>{e.call(s,t);try{a.channelCount=t}catch(n){if(t>a.maxChannelCount)throw n}})),t(s,"channelCountMode",(e=>()=>e.call(s)),(e=>t=>{e.call(s,t),a.channelCountMode=t})),t(s,"channelInterpretation",(e=>()=>e.call(s)),(e=>t=>{e.call(s,t),a.channelInterpretation=t})),Object.defineProperty(s,"maxChannelCount",{get:()=>a.maxChannelCount}),s.connect(a),s})(kr,qr),so,lo,oo),zo=((e,t,n,r,o)=>()=>{const a=new WeakMap;return{render(s,i){const c=a.get(i);return void 0!==c?Promise.resolve(c):(async(s,i)=>{let c=n(s);const l=rn(c,i);if(!l){const e={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=t(i,e)}return a.set(i,c),l?(await e(i,s.Q,c.Q),await e(i,s.detune,c.detune),await e(i,s.frequency,c.frequency),await e(i,s.gain,c.gain)):(await r(i,s.Q,c.Q),await r(i,s.detune,c.detune),await r(i,s.frequency,c.frequency),await r(i,s.gain,c.gain)),await o(s,i,c),c})(s,i)}}})(Ao,yr,En,Oo,oo),Bo=(e=>(t,n)=>e.set(t,n))(Yr),qo=((e,t,n,r,o,a,s,i)=>class extends e{constructor(e,r){const c=a(e),l=h(h({},Hn),r),u=o(c,l),d=s(c);super(e,!1,u,d?n():null),this._Q=t(this,d,u.Q,un,ln),this._detune=t(this,d,u.detune,1200*Math.log2(un),-1200*Math.log2(un)),this._frequency=t(this,d,u.frequency,e.sampleRate/2,0),this._gain=t(this,d,u.gain,40*Math.log10(un),ln),this._nativeBiquadFilterNode=u,i(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(e){this._nativeBiquadFilterNode.type=e}getFrequencyResponse(e,t,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(e,t,n)}catch(o){if(11===o.code)throw r();throw o}if(e.length!==t.length||t.length!==n.length)throw r()}})(bo,Po,zo,rr,yr,so,lo,Bo),Wo=((e,t)=>(n,r,o)=>{const a=new Set;return n.connect=(o=>function(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l=0===a.size;if(t(s))return o.call(n,s,i,c),e(a,[s,i,c],(e=>e[0]===s&&e[1]===i&&e[2]===c),!0),l&&r(),s;o.call(n,s,i),e(a,[s,i],(e=>e[0]===s&&e[1]===i),!0),l&&r()})(n.connect),n.disconnect=(e=>(r,s,i)=>{const c=a.size>0;if(void 0===r)e.apply(n),a.clear();else if("number"===typeof r){e.call(n,r);for(const e of a)e[1]===r&&a.delete(e)}else{t(r)?e.call(n,r,s,i):e.call(n,r,s);for(const e of a)e[0]!==r||void 0!==s&&e[1]!==s||void 0!==i&&e[2]!==i||a.delete(e)}const l=0===a.size;c&&l&&o()})(n.disconnect),n})(wn,mo),jo=((e,t)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw e()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw e()}});const o=n.createBufferSource();t(r,(()=>{const e=r.numberOfInputs;for(let t=0;t<e;t+=1)o.connect(r,0,t)}),(()=>o.disconnect(r)))})(nr,Wo),Vo=((e,t)=>(n,r)=>{const o=n.createChannelMerger(r.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(n,o),ur(o,r),o})(po,jo),Uo=((e,t,n)=>()=>{const r=new WeakMap;return{render(o,a){const s=r.get(a);return void 0!==s?Promise.resolve(s):(async(o,a)=>{let s=t(o);if(!rn(s,a)){const t={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,numberOfInputs:s.numberOfInputs};s=e(a,t)}return r.set(a,s),await n(o,a,s),s})(o,a)}}})(Vo,En,oo),Go=((e,t,n,r,o)=>class extends e{constructor(e,a){const s=r(e),i=h(h({},Kn),a);super(e,!1,n(s,i),o(s)?t():null)}})(bo,Uo,Vo,so,lo),Ho=((e,t,n)=>()=>{const r=new WeakMap;return{render(o,a){const s=r.get(a);return void 0!==s?Promise.resolve(s):(async(o,a)=>{let s=t(o);if(!rn(s,a)){const t={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,numberOfOutputs:s.numberOfOutputs};s=e(a,t)}return r.set(a,s),await n(o,a,s),s})(o,a)}}})(br,En,oo),Ko=((e,t,n,r,o,a)=>class extends e{constructor(e,s){const i=r(e),c=a(h(h({},Xn),s));super(e,!1,n(i,c),o(i)?t():null)}})(bo,Ho,br,so,lo,(e=>h(h({},e),{},{channelCount:e.numberOfOutputs}))),Xo=((e,t,n,r)=>(o,a)=>{let{offset:i}=a,c=s(a,wr);const l=o.createBuffer(1,2,44100),u=t(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),d=n(o,h(h({},c),{},{gain:i})),p=l.getChannelData(0);p[0]=1,p[1]=1,u.buffer=l,u.loop=!0;const f={get bufferSize(){},get channelCount(){return d.channelCount},set channelCount(e){d.channelCount=e},get channelCountMode(){return d.channelCountMode},set channelCountMode(e){d.channelCountMode=e},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(e){d.channelInterpretation=e},get context(){return d.context},get inputs(){return[]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},get offset(){return d.gain},get onended(){return u.onended},set onended(e){u.onended=e},addEventListener(){return u.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent(){return u.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener(){return u.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;u.start.call(u,e)},stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;u.stop.call(u,e)}};return e(o,u),r(vr(f,d),(()=>u.connect(d)),(()=>u.disconnect(d)))})(No,Ro,kr,Wo),Qo=((e,t,n,r,o)=>(a,s)=>{if(void 0===a.createConstantSource)return n(a,s);const i=a.createConstantSource();return ur(i,s),dr(i,s,"offset"),t(r,(()=>r(a)))||pr(i),t(o,(()=>o(a)))||fr(i),e(a,i),i})(No,Zr,Xo,jr,Ur),Yo=((e,t,n,r,o)=>()=>{const a=new WeakMap;let s=null,i=null;return{set start(e){s=e},set stop(e){i=e},render(c,l){const u=a.get(l);return void 0!==u?Promise.resolve(u):(async(c,l)=>{let u=n(c);const h=rn(u,l);if(!h){const e={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=t(l,e),null!==s&&u.start(s),null!==i&&u.stop(i)}return a.set(l,u),h?await e(l,c.offset,u.offset):await r(l,c.offset,u.offset),await o(c,l,u),u})(c,l)}}})(Ao,Qo,En,Oo,oo),Jo=((e,t,n,r,o,a,s)=>class extends e{constructor(e,s){const i=o(e),c=h(h({},Qn),s),l=r(i,c),u=a(i),d=u?n():null;super(e,!1,l,d),this._constantSourceNodeRenderer=d,this._nativeConstantSourceNode=l,this._offset=t(this,u,l.offset,un,ln),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(e){const t="function"===typeof e?s(this,e):null;this._nativeConstantSourceNode.onended=t;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===t?e:n}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeConstantSourceNode.start(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=e),"closed"!==this.context.state){Zt(this);const e=()=>{this._nativeConstantSourceNode.removeEventListener("ended",e),hn(this)&&en(this)};this._nativeConstantSourceNode.addEventListener("ended",e)}}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}})(bo,Po,Yo,Qo,so,lo,Hr),Zo=((e,t)=>(n,r)=>{const o=n.createConvolver();if(ur(o,r),r.disableNormalization===o.normalize&&(o.normalize=!r.disableNormalization),lr(o,r,"buffer"),r.channelCount>2)throw e();if(t(o,"channelCount",(e=>()=>e.call(o)),(t=>n=>{if(n>2)throw e();return t.call(o,n)})),"max"===r.channelCountMode)throw e();return t(o,"channelCountMode",(e=>()=>e.call(o)),(t=>n=>{if("max"===n)throw e();return t.call(o,n)})),o})(Ar,qr),$o=((e,t,n)=>()=>{const r=new WeakMap;return{render(o,a){const s=r.get(a);return void 0!==s?Promise.resolve(s):(async(o,a)=>{let s=t(o);if(!rn(s,a)){const t={buffer:s.buffer,channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,disableNormalization:!s.normalize};s=e(a,t)}return r.set(a,s),Sn(s)?await n(o,a,s.inputs[0]):await n(o,a,s),s})(o,a)}}})(Zo,En,oo),ea=((e,t,n,r,o,a)=>class extends e{constructor(e,s){const i=r(e),c=h(h({},Yn),s),l=n(i,c);super(e,!1,l,o(i)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=l,null!==c.buffer&&a(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(e){if(this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer){const e=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=e.createBuffer(1,1,e.sampleRate),this._isBufferNullified=!0,a(this,0)}else this._isBufferNullified=!1,a(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(e){this._nativeConvolverNode.normalize=e}})(bo,$o,Zo,so,lo,Bo),ta=((e,t,n,r,o)=>a=>{const s=new WeakMap;return{render(i,c){const l=s.get(c);return void 0!==l?Promise.resolve(l):(async(i,c)=>{let l=n(i);const u=rn(l,c);if(!u){const e={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:a};l=t(c,e)}return s.set(c,l),u?await e(c,i.delayTime,l.delayTime):await r(c,i.delayTime,l.delayTime),await o(i,c,l),l})(i,c)}}})(Ao,xr,En,Oo,oo),na=((e,t,n,r,o,a,s)=>class extends e{constructor(e,i){const c=o(e),l=h(h({},Zn),i),u=r(c,l),d=a(c);super(e,!1,u,d?n(l.maxDelayTime):null),this._delayTime=t(this,d,u.delayTime),s(this,l.maxDelayTime)}get delayTime(){return this._delayTime}})(bo,Po,ta,xr,so,lo,Bo),ra=(e=>(t,n)=>{const r=t.createDynamicsCompressor();if(ur(r,n),n.channelCount>2)throw e();if("max"===n.channelCountMode)throw e();return dr(r,n,"attack"),dr(r,n,"knee"),dr(r,n,"ratio"),dr(r,n,"release"),dr(r,n,"threshold"),r})(Ar),oa=((e,t,n,r,o)=>()=>{const a=new WeakMap;return{render(s,i){const c=a.get(i);return void 0!==c?Promise.resolve(c):(async(s,i)=>{let c=n(s);const l=rn(c,i);if(!l){const e={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=t(i,e)}return a.set(i,c),l?(await e(i,s.attack,c.attack),await e(i,s.knee,c.knee),await e(i,s.ratio,c.ratio),await e(i,s.release,c.release),await e(i,s.threshold,c.threshold)):(await r(i,s.attack,c.attack),await r(i,s.knee,c.knee),await r(i,s.ratio,c.ratio),await r(i,s.release,c.release),await r(i,s.threshold,c.threshold)),await o(s,i,c),c})(s,i)}}})(Ao,ra,En,Oo,oo),aa=((e,t,n,r,o,a,s,i)=>class extends e{constructor(e,o){const c=a(e),l=h(h({},er),o),u=r(c,l),d=s(c);super(e,!1,u,d?n():null),this._attack=t(this,d,u.attack),this._knee=t(this,d,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=t(this,d,u.ratio),this._release=t(this,d,u.release),this._threshold=t(this,d,u.threshold),i(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(e){const t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,o()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(e){const t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,o()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"===typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(bo,Po,oa,ra,Ar,so,lo,Bo),sa=((e,t,n,r,o)=>()=>{const a=new WeakMap;return{render(s,i){const c=a.get(i);return void 0!==c?Promise.resolve(c):(async(s,i)=>{let c=n(s);const l=rn(c,i);if(!l){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=t(i,e)}return a.set(i,c),l?await e(i,s.gain,c.gain):await r(i,s.gain,c.gain),await o(s,i,c),c})(s,i)}}})(Ao,kr,En,Oo,oo),ia=((e,t,n,r,o,a)=>class extends e{constructor(e,s){const i=o(e),c=h(h({},tr),s),l=r(i,c),u=a(i);super(e,!1,l,u?n():null),this._gain=t(this,u,l.gain,un,ln)}get gain(){return this._gain}})(bo,Po,sa,kr,so,lo),ca=((e,t,n,r)=>(o,a,s)=>{let{channelCount:i,channelCountMode:c,channelInterpretation:l,feedback:u,feedforward:h}=s;const d=mr(a,o.sampleRate),p=u instanceof Float64Array?u:new Float64Array(u),f=h instanceof Float64Array?h:new Float64Array(h),m=p.length,g=f.length,y=Math.min(m,g);if(0===m||m>20)throw r();if(0===p[0])throw t();if(0===g||g>20)throw r();if(0===f[0])throw t();if(1!==p[0]){for(let e=0;e<g;e+=1)f[e]/=p[0];for(let e=1;e<m;e+=1)p[e]/=p[0]}const b=n(o,d,i,i);b.channelCount=i,b.channelCountMode=c,b.channelInterpretation=l;const v=[],w=[],x=[];for(let e=0;e<i;e+=1){v.push(0);const e=new Float32Array(32),t=new Float32Array(32);e.fill(0),t.fill(0),w.push(e),x.push(t)}b.onaudioprocess=e=>{const t=e.inputBuffer,n=e.outputBuffer,r=t.numberOfChannels;for(let o=0;o<r;o+=1){const e=t.getChannelData(o),r=n.getChannelData(o);v[o]=ar(p,m,f,g,y,w[o],x[o],v[o],32,e,r)}};const k=o.sampleRate/2,S={get bufferSize(){return d},get channelCount(){return b.channelCount},set channelCount(e){b.channelCount=e},get channelCountMode(){return b.channelCountMode},set channelCountMode(e){b.channelCountMode=e},get channelInterpretation(){return b.channelInterpretation},set channelInterpretation(e){b.channelInterpretation=e},get context(){return b.context},get inputs(){return[b]},get numberOfInputs(){return b.numberOfInputs},get numberOfOutputs(){return b.numberOfOutputs},addEventListener(){return b.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent(){return b.dispatchEvent(arguments.length<=0?void 0:arguments[0])},getFrequencyResponse(t,n,r){if(t.length!==n.length||n.length!==r.length)throw e();const o=t.length;for(let e=0;e<o;e+=1){const o=-Math.PI*(t[e]/k),a=[Math.cos(o),Math.sin(o)],s=Sr(Cr(f,a),Cr(p,a));n[e]=Math.sqrt(s[0]*s[0]+s[1]*s[1]),r[e]=Math.atan2(s[1],s[0])}},removeEventListener(){return b.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};return vr(S,b)})(rr,nr,Tr,Ar),la=((e,t,n,r)=>o=>e(ir,(()=>ir(o)))?Promise.resolve(e(r,r)).then((e=>{if(!e){const e=n(o,512,0,1);o.oncomplete=()=>{e.onaudioprocess=null,e.disconnect()},e.onaudioprocess=()=>o.currentTime,e.connect(o.destination)}return o.startRendering()})):new Promise((e=>{const n=t(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.oncomplete=t=>{n.disconnect(),e(t.renderedBuffer)},n.connect(o.destination),o.startRendering()})))(Zr,kr,Tr,((e,t)=>()=>{if(null===t)return Promise.resolve(!1);const n=new t(1,1,44100),r=e(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((e=>{n.oncomplete=()=>{r.disconnect(),e(0!==n.currentTime)},n.startRendering()}))})(kr,co)),ua=((e,t,n,r,o)=>(a,s)=>{const i=new WeakMap;let c=null;const l=async(l,u)=>{let h=null,d=t(l);const p=rn(d,u);if(void 0===u.createIIRFilter?h=e(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=u.createIIRFilter(s,a)),i.set(u,null===h?d:h),null!==h){if(null===c){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new n(l.context.destination.channelCount,l.context.length,u.sampleRate);c=(async()=>{await r(l,e,e.destination);return((e,t,n,r)=>{const o=n instanceof Float64Array?n:new Float64Array(n),a=r instanceof Float64Array?r:new Float64Array(r),s=o.length,i=a.length,c=Math.min(s,i);if(1!==o[0]){for(let e=0;e<s;e+=1)a[e]/=o[0];for(let e=1;e<i;e+=1)o[e]/=o[0]}const l=new Float32Array(32),u=new Float32Array(32),h=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),d=e.numberOfChannels;for(let p=0;p<d;p+=1){const t=e.getChannelData(p),n=h.getChannelData(p);l.fill(0),u.fill(0),ar(o,s,a,i,c,l,u,0,32,t,n)}return h})(await o(e),u,a,s)})()}const e=await c;return h.buffer=e,h.start(0),h}return await r(l,u,d),d};return{render(e,t){const n=i.get(t);return void 0!==n?Promise.resolve(n):l(e,t)}}})(Ro,En,co,oo,la),ha=(e=>(t,n,r)=>{if(void 0===t.createIIRFilter)return e(t,n,r);const o=t.createIIRFilter(r.feedforward,r.feedback);return ur(o,r),o})(ca),da=((e,t,n,r,o,a)=>class extends e{constructor(e,s){const i=r(e),c=o(i),l=h(h({},or),s),u=t(i,c?null:e.baseLatency,l);super(e,!1,u,c?n(l.feedback,l.feedforward):null),(e=>{var t;e.getFrequencyResponse=(t=e.getFrequencyResponse,(n,r,o)=>{if(n.length!==r.length||r.length!==o.length)throw rr();return t.call(e,n,r,o)})})(u),this._nativeIIRFilterNode=u,a(this,1)}getFrequencyResponse(e,t,n){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,n)}})(bo,ha,ua,so,lo,Bo),pa=((e,t,n,r,o,a,s,i)=>(c,l)=>{const u=l.listener,{forwardX:h,forwardY:d,forwardZ:p,positionX:f,positionY:m,positionZ:g,upX:y,upY:b,upZ:v}=void 0===u.forwardX?(()=>{const h=new Float32Array(1),d=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=s(l);let f=!1,m=[0,0,-1,0,1,0],g=[0,0,0];const y=()=>{if(f)return;f=!0;const e=r(l,256,9,0);e.onaudioprocess=e=>{let{inputBuffer:t}=e;const n=[a(t,h,0),a(t,h,1),a(t,h,2),a(t,h,3),a(t,h,4),a(t,h,5)];n.some(((e,t)=>e!==m[t]))&&(u.setOrientation(...n),m=n);const r=[a(t,h,6),a(t,h,7),a(t,h,8)];r.some(((e,t)=>e!==g[t]))&&(u.setPosition(...r),g=r)},d.connect(e)},b=e=>t=>{t!==m[e]&&(m[e]=t,u.setOrientation(...m))},v=e=>t=>{t!==g[e]&&(g[e]=t,u.setPosition(...g))},w=(t,r,a)=>{const s=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:r});s.connect(d,0,t),s.start(),Object.defineProperty(s.offset,"defaultValue",{get:()=>r});const u=e({context:c},p,s.offset,un,ln);var h,f,m,g,b,v,w;return i(u,"value",(e=>()=>e.call(u)),(e=>t=>{try{e.call(u,t)}catch(n){if(9!==n.code)throw n}y(),p&&a(t)})),u.cancelAndHoldAtTime=(h=u.cancelAndHoldAtTime,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=h.apply(u,t);return y(),r}),u.cancelScheduledValues=(f=u.cancelScheduledValues,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=f.apply(u,t);return y(),r}),u.exponentialRampToValueAtTime=(m=u.exponentialRampToValueAtTime,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=m.apply(u,t);return y(),r}),u.linearRampToValueAtTime=(g=u.linearRampToValueAtTime,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=g.apply(u,t);return y(),r}),u.setTargetAtTime=(b=u.setTargetAtTime,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=b.apply(u,t);return y(),r}),u.setValueAtTime=(v=u.setValueAtTime,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=v.apply(u,t);return y(),r}),u.setValueCurveAtTime=(w=u.setValueCurveAtTime,p?()=>{throw o()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=w.apply(u,t);return y(),r}),u};return{forwardX:w(0,0,b(0)),forwardY:w(1,0,b(1)),forwardZ:w(2,-1,b(2)),positionX:w(6,0,v(0)),positionY:w(7,0,v(1)),positionZ:w(8,0,v(2)),upX:w(3,0,b(3)),upY:w(4,1,b(4)),upZ:w(5,0,b(5))}})():u;return{get forwardX(){return h},get forwardY(){return d},get forwardZ(){return p},get positionX(){return f},get positionY(){return m},get positionZ(){return g},get upX(){return y},get upY(){return b},get upZ(){return v}}})(Po,Vo,Qo,Tr,Ar,zr,lo,qr),fa=new WeakMap,ma=((e,t,n,r,o,a)=>class extends n{constructor(n,a){super(n),this._nativeContext=n,zt.set(this,n),r(n)&&o.set(n,new Set),this._destination=new e(this,a),this._listener=t(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(e){const t="function"===typeof e?a(this,e):null;this._nativeContext.onstatechange=t;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===t?e:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(Lo,pa,ho,lo,fa,Hr),ga=((e,t,n,r,o,a)=>(s,i)=>{const c=s.createOscillator();return ur(c,i),dr(c,i,"detune"),dr(c,i,"frequency"),void 0!==i.periodicWave?c.setPeriodicWave(i.periodicWave):lr(c,i,"type"),t(n,(()=>n(s)))||pr(c),t(r,(()=>r(s)))||a(c,s),t(o,(()=>o(s)))||fr(c),e(s,c),c})(No,Zr,jr,Vr,Ur,Gr),ya=((e,t,n,r,o)=>()=>{const a=new WeakMap;let s=null,i=null,c=null;return{set periodicWave(e){s=e},set start(e){i=e},set stop(e){c=e},render(l,u){const h=a.get(u);return void 0!==h?Promise.resolve(h):(async(l,u)=>{let h=n(l);const d=rn(h,u);if(!d){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===s?void 0:s,type:h.type};h=t(u,e),null!==i&&h.start(i),null!==c&&h.stop(c)}return a.set(u,h),d?(await e(u,l.detune,h.detune),await e(u,l.frequency,h.frequency)):(await r(u,l.detune,h.detune),await r(u,l.frequency,h.frequency)),await o(l,u,h),h})(l,u)}}})(Ao,ga,En,Oo,oo),ba=((e,t,n,r,o,a,s)=>class extends e{constructor(e,s){const i=o(e),c=h(h({},Or),s),l=n(i,c),u=a(i),d=u?r():null,p=e.sampleRate/2;super(e,!1,l,d),this._detune=t(this,u,l.detune,153600,-153600),this._frequency=t(this,u,l.frequency,p,-p),this._nativeOscillatorNode=l,this._onended=null,this._oscillatorNodeRenderer=d,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(e){const t="function"===typeof e?s(this,e):null;this._nativeOscillatorNode.onended=t;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===t?e:n}get type(){return this._nativeOscillatorNode.type}set type(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeOscillatorNode.start(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=e),"closed"!==this.context.state){Zt(this);const e=()=>{this._nativeOscillatorNode.removeEventListener("ended",e),hn(this)&&en(this)};this._nativeOscillatorNode.addEventListener("ended",e)}}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}})(bo,Po,ga,ya,so,lo,Hr),va=(e=>(t,n)=>{const r=e(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=t.createBuffer(1,2,44100);return r.buffer=o,r.loop=!0,r.connect(n),r.start(),()=>{r.stop(),r.disconnect(n)}})(Ro),wa=((e,t,n,r,o)=>(a,i)=>{let{curve:c,oversample:l}=i,u=s(i,Er);const d=a.createWaveShaper(),p=a.createWaveShaper();ur(d,u),ur(p,u);const f=n(a,h(h({},u),{},{gain:1})),m=n(a,h(h({},u),{},{gain:-1})),g=n(a,h(h({},u),{},{gain:1})),y=n(a,h(h({},u),{},{gain:-1}));let b=null,v=!1,w=null;const x={get bufferSize(){},get channelCount(){return d.channelCount},set channelCount(e){f.channelCount=e,m.channelCount=e,d.channelCount=e,g.channelCount=e,p.channelCount=e,y.channelCount=e},get channelCountMode(){return d.channelCountMode},set channelCountMode(e){f.channelCountMode=e,m.channelCountMode=e,d.channelCountMode=e,g.channelCountMode=e,p.channelCountMode=e,y.channelCountMode=e},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(e){f.channelInterpretation=e,m.channelInterpretation=e,d.channelInterpretation=e,g.channelInterpretation=e,p.channelInterpretation=e,y.channelInterpretation=e},get context(){return d.context},get curve(){return w},set curve(n){if(null!==n&&n.length<2)throw t();if(null===n)d.curve=n,p.curve=n;else{const e=n.length,t=new Float32Array(e+2-e%2),r=new Float32Array(e+2-e%2);t[0]=n[0],r[0]=-n[e-1];const o=Math.ceil((e+1)/2),a=(e+1)/2-1;for(let s=1;s<o;s+=1){const i=s/o*a,c=Math.floor(i),l=Math.ceil(i);t[s]=c===l?n[c]:(1-(i-c))*n[c]+(1-(l-i))*n[l],r[s]=c===l?-n[e-1-c]:-(1-(i-c))*n[e-1-c]-(1-(l-i))*n[e-1-l]}t[o]=e%2===1?n[o-1]:(n[o-2]+n[o-1])/2,d.curve=t,p.curve=r}w=n,v&&(r(w)&&null===b?b=e(a,f):null!==b&&(b(),b=null))},get inputs(){return[f]},get numberOfInputs(){return d.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},get oversample(){return d.oversample},set oversample(e){d.oversample=e,p.oversample=e},addEventListener(){return f.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent(){return f.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener(){return f.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};null!==c&&(x.curve=c instanceof Float32Array?c:new Float32Array(c)),l!==x.oversample&&(x.oversample=l);return o(vr(x,g),(()=>{f.connect(d).connect(g),f.connect(m).connect(p).connect(y).connect(g),v=!0,r(w)&&(b=e(a,f))}),(()=>{f.disconnect(d),d.disconnect(g),f.disconnect(m),m.disconnect(p),p.disconnect(y),y.disconnect(g),v=!1,null!==b&&(b(),b=null)}))})(va,nr,kr,Br,Wo),xa=((e,t,n,r,o,a,s)=>(i,c)=>{const l=i.createWaveShaper();if(null!==a&&"webkitAudioContext"===a.name&&void 0===i.createGain().gain.automationRate)return n(i,c);ur(l,c);const u=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==u&&u.length<2)throw t();lr(l,{curve:u},"curve"),lr(l,c,"oversample");let h=null,d=!1;s(l,"curve",(e=>()=>e.call(l)),(t=>n=>(t.call(l,n),d&&(r(n)&&null===h?h=e(i,l):r(n)||null===h||(h(),h=null)),n)));return o(l,(()=>{d=!0,r(l.curve)&&(h=e(i,l))}),(()=>{d=!1,null!==h&&(h(),h=null)}))})(va,nr,wa,Br,Wo,po,qr),ka=((e,t,n,r,o,a,i,c,l,u)=>(d,p)=>{let{coneInnerAngle:f,coneOuterAngle:m,coneOuterGain:g,distanceModel:y,maxDistance:b,orientationX:v,orientationY:w,orientationZ:x,panningModel:k,positionX:S,positionY:_,positionZ:C,refDistance:I,rolloffFactor:T}=p,N=s(p,Ir);const E=d.createPanner();if(N.channelCount>2)throw i();if("max"===N.channelCountMode)throw i();ur(E,N);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},R=n(d,h(h({},A),{},{channelInterpretation:"speakers",numberOfInputs:6})),O=r(d,h(h({},N),{},{gain:1})),M=r(d,h(h({},A),{},{gain:1})),P=r(d,h(h({},A),{},{gain:0})),D=r(d,h(h({},A),{},{gain:0})),F=r(d,h(h({},A),{},{gain:0})),L=r(d,h(h({},A),{},{gain:0})),z=r(d,h(h({},A),{},{gain:0})),B=o(d,256,6,1),q=a(d,h(h({},A),{},{curve:new Float32Array([1,1]),oversample:"none"}));let W=[v,w,x],j=[S,_,C];const V=new Float32Array(1);B.onaudioprocess=e=>{let{inputBuffer:t}=e;const n=[l(t,V,0),l(t,V,1),l(t,V,2)];n.some(((e,t)=>e!==W[t]))&&(E.setOrientation(...n),W=n);const r=[l(t,V,3),l(t,V,4),l(t,V,5)];r.some(((e,t)=>e!==j[t]))&&(E.setPosition(...r),j=r)},Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(z.gain,"defaultValue",{get:()=>0});const U={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(e){if(e>2)throw i();O.channelCount=e,E.channelCount=e},get channelCountMode(){return E.channelCountMode},set channelCountMode(e){if("max"===e)throw i();O.channelCountMode=e,E.channelCountMode=e},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(e){O.channelInterpretation=e,E.channelInterpretation=e},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(e){E.coneInnerAngle=e},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(e){E.coneOuterAngle=e},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();E.coneOuterGain=e},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(e){E.distanceModel=e},get inputs(){return[O]},get maxDistance(){return E.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;E.maxDistance=e},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return P.gain},get orientationZ(){return D.gain},get panningModel(){return E.panningModel},set panningModel(e){E.panningModel=e},get positionX(){return F.gain},get positionY(){return L.gain},get positionZ(){return z.gain},get refDistance(){return E.refDistance},set refDistance(e){if(e<0)throw new RangeError;E.refDistance=e},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;E.rolloffFactor=e},addEventListener(){return O.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent(){return O.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener(){return O.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};f!==U.coneInnerAngle&&(U.coneInnerAngle=f),m!==U.coneOuterAngle&&(U.coneOuterAngle=m),g!==U.coneOuterGain&&(U.coneOuterGain=g),y!==U.distanceModel&&(U.distanceModel=y),b!==U.maxDistance&&(U.maxDistance=b),v!==U.orientationX.value&&(U.orientationX.value=v),w!==U.orientationY.value&&(U.orientationY.value=w),x!==U.orientationZ.value&&(U.orientationZ.value=x),k!==U.panningModel&&(U.panningModel=k),S!==U.positionX.value&&(U.positionX.value=S),_!==U.positionY.value&&(U.positionY.value=_),C!==U.positionZ.value&&(U.positionZ.value=C),I!==U.refDistance&&(U.refDistance=I),T!==U.rolloffFactor&&(U.rolloffFactor=T),1===W[0]&&0===W[1]&&0===W[2]||E.setOrientation(...W),0===j[0]&&0===j[1]&&0===j[2]||E.setPosition(...j);return u(vr(U,E),(()=>{O.connect(E),e(O,q,0,0),q.connect(M).connect(R,0,0),q.connect(P).connect(R,0,1),q.connect(D).connect(R,0,2),q.connect(F).connect(R,0,3),q.connect(L).connect(R,0,4),q.connect(z).connect(R,0,5),R.connect(B).connect(d.destination)}),(()=>{O.disconnect(E),c(O,q,0,0),q.disconnect(M),M.disconnect(R),q.disconnect(P),P.disconnect(R),q.disconnect(D),D.disconnect(R),q.disconnect(F),F.disconnect(R),q.disconnect(L),L.disconnect(R),q.disconnect(z),z.disconnect(R),R.disconnect(B),B.disconnect(d.destination)}))})(_n,nr,Vo,kr,Tr,xa,Ar,Nn,zr,Wo),Sa=(e=>(t,n)=>{const r=t.createPanner();return void 0===r.orientationX?e(t,n):(ur(r,n),dr(r,n,"orientationX"),dr(r,n,"orientationY"),dr(r,n,"orientationZ"),dr(r,n,"positionX"),dr(r,n,"positionY"),dr(r,n,"positionZ"),lr(r,n,"coneInnerAngle"),lr(r,n,"coneOuterAngle"),lr(r,n,"coneOuterGain"),lr(r,n,"distanceModel"),lr(r,n,"maxDistance"),lr(r,n,"panningModel"),lr(r,n,"refDistance"),lr(r,n,"rolloffFactor"),r)})(ka),_a=((e,t,n,r,o,a,s,i,c,l)=>()=>{const u=new WeakMap;let d=null;return{render(p,f){const m=u.get(f);return void 0!==m?Promise.resolve(m):(async(p,f)=>{let m=null,g=a(p);const y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},b=h(h({},y),{},{coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor}),v=rn(g,f);if("bufferSize"in g)m=r(f,h(h({},y),{},{gain:1}));else if(!v){const e=h(h({},b),{},{orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value});g=o(f,e)}if(u.set(f,null===m?g:m),null!==m){if(null===d){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new s(6,p.context.length,f.sampleRate),r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});r.connect(e.destination),d=(async()=>{const t=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(t,r)=>{const o=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===r?1:0});return await i(e,t,o.offset),o})));for(let e=0;e<6;e+=1)t[e].connect(r,0,e),t[e].start(0);return l(e)})()}const e=await d,a=r(f,h(h({},y),{},{gain:1}));await c(p,f,a);const u=[];for(let t=0;t<e.numberOfChannels;t+=1)u.push(e.getChannelData(t));let g=[u[0][0],u[1][0],u[2][0]],v=[u[3][0],u[4][0],u[5][0]],w=r(f,h(h({},y),{},{gain:1})),x=o(f,h(h({},b),{},{orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:v[0],positionY:v[1],positionZ:v[2]}));a.connect(w).connect(x.inputs[0]),x.connect(m);for(let t=128;t<e.length;t+=128){const e=[u[0][t],u[1][t],u[2][t]],n=[u[3][t],u[4][t],u[5][t]];if(e.some(((e,t)=>e!==g[t]))||n.some(((e,t)=>e!==v[t]))){g=e,v=n;const s=t/f.sampleRate;w.gain.setValueAtTime(0,s),w=r(f,h(h({},y),{},{gain:0})),x=o(f,h(h({},b),{},{orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:v[0],positionY:v[1],positionZ:v[2]})),w.gain.setValueAtTime(1,s),a.connect(w).connect(x.inputs[0]),x.connect(m)}}return m}return v?(await e(f,p.orientationX,g.orientationX),await e(f,p.orientationY,g.orientationY),await e(f,p.orientationZ,g.orientationZ),await e(f,p.positionX,g.positionX),await e(f,p.positionY,g.positionY),await e(f,p.positionZ,g.positionZ)):(await i(f,p.orientationX,g.orientationX),await i(f,p.orientationY,g.orientationY),await i(f,p.orientationZ,g.orientationZ),await i(f,p.positionX,g.positionX),await i(f,p.positionY,g.positionY),await i(f,p.positionZ,g.positionZ)),Sn(g)?await c(p,f,g.inputs[0]):await c(p,f,g),g})(p,f)}}})(Ao,Vo,Qo,kr,Sa,En,co,Oo,oo,la),Ca=((e,t,n,r,o,a,s)=>class extends e{constructor(e,i){const c=o(e),l=h(h({},Mr),i),u=n(c,l),d=a(c);super(e,!1,u,d?r():null),this._nativePannerNode=u,this._orientationX=t(this,d,u.orientationX,un,ln),this._orientationY=t(this,d,u.orientationY,un,ln),this._orientationZ=t(this,d,u.orientationZ,un,ln),this._positionX=t(this,d,u.positionX,un,ln),this._positionY=t(this,d,u.positionY,un,ln),this._positionZ=t(this,d,u.positionZ,un,ln),s(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(e){this._nativePannerNode.coneInnerAngle=e}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(e){this._nativePannerNode.coneOuterAngle=e}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(e){this._nativePannerNode.coneOuterGain=e}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(e){this._nativePannerNode.distanceModel=e}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(e){this._nativePannerNode.maxDistance=e}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(e){this._nativePannerNode.panningModel=e}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(e){this._nativePannerNode.refDistance=e}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(e){this._nativePannerNode.rolloffFactor=e}})(bo,Po,Sa,_a,so,lo,Bo),Ia=(e=>(t,n)=>{let{disableNormalization:r,imag:o,real:a}=n;const s=o instanceof Float32Array?o:new Float32Array(o),i=a instanceof Float32Array?a:new Float32Array(a),c=t.createPeriodicWave(i,s,{disableNormalization:r});if(Array.from(o).length<2)throw e();return c})(an),Ta=((e,t,n,r)=>class o{constructor(o,a){const s=t(o),i=r(h(h({},Pr),a)),c=e(s,i);return n.add(c),c}static[Symbol.hasInstance](e){return null!==e&&"object"===typeof e&&Object.getPrototypeOf(e)===o.prototype||n.has(e)}})(Ia,so,new WeakSet,(e=>{const{imag:t,real:n}=e;return h(h({},e),{},void 0===t?void 0===n?{imag:[0,0],real:[0,0]}:{imag:Array.from(n,(()=>0)),real:n}:void 0===n?{imag:t,real:Array.from(t,(()=>0))}:{imag:t,real:n})})),Na=((e,t,n,r,o,a)=>{const i=16385,c=new Float32Array([1,1]),l=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d=h(h({},u),{},{oversample:"none"}),p=(e,a,s,p,f)=>{if(1===a)return((e,t,o,a)=>{const s=new Float32Array(i),p=new Float32Array(i);for(let n=0;n<i;n+=1){const e=n/16384*l;s[n]=Math.cos(e),p[n]=Math.sin(e)}const f=n(e,h(h({},u),{},{gain:0})),m=r(e,h(h({},d),{},{curve:s})),g=r(e,h(h({},d),{},{curve:c})),y=n(e,h(h({},u),{},{gain:0})),b=r(e,h(h({},d),{},{curve:p}));return{connectGraph(){t.connect(f),t.connect(void 0===g.inputs?g:g.inputs[0]),t.connect(y),g.connect(o),o.connect(void 0===m.inputs?m:m.inputs[0]),o.connect(void 0===b.inputs?b:b.inputs[0]),m.connect(f.gain),b.connect(y.gain),f.connect(a,0,0),y.connect(a,0,1)},disconnectGraph(){t.disconnect(f),t.disconnect(void 0===g.inputs?g:g.inputs[0]),t.disconnect(y),g.disconnect(o),o.disconnect(void 0===m.inputs?m:m.inputs[0]),o.disconnect(void 0===b.inputs?b:b.inputs[0]),m.disconnect(f.gain),b.disconnect(y.gain),f.disconnect(a,0,0),y.disconnect(a,0,1)}}})(e,s,p,f);if(2===a)return((e,o,a,s)=>{const p=new Float32Array(i),f=new Float32Array(i),m=new Float32Array(i),g=new Float32Array(i),y=Math.floor(8192.5);for(let t=0;t<i;t+=1)if(t>y){const e=(t-y)/(16384-y)*l;p[t]=Math.cos(e),f[t]=Math.sin(e),m[t]=0,g[t]=1}else{const e=t/(16384-y)*l;p[t]=1,f[t]=0,m[t]=Math.cos(e),g[t]=Math.sin(e)}const b=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(e,h(h({},u),{},{gain:0})),w=r(e,h(h({},d),{},{curve:p})),x=n(e,h(h({},u),{},{gain:0})),k=r(e,h(h({},d),{},{curve:f})),S=r(e,h(h({},d),{},{curve:c})),_=n(e,h(h({},u),{},{gain:0})),C=r(e,h(h({},d),{},{curve:m})),I=n(e,h(h({},u),{},{gain:0})),T=r(e,h(h({},d),{},{curve:g}));return{connectGraph(){o.connect(b),o.connect(void 0===S.inputs?S:S.inputs[0]),b.connect(v,0),b.connect(x,0),b.connect(_,1),b.connect(I,1),S.connect(a),a.connect(void 0===w.inputs?w:w.inputs[0]),a.connect(void 0===k.inputs?k:k.inputs[0]),a.connect(void 0===C.inputs?C:C.inputs[0]),a.connect(void 0===T.inputs?T:T.inputs[0]),w.connect(v.gain),k.connect(x.gain),C.connect(_.gain),T.connect(I.gain),v.connect(s,0,0),_.connect(s,0,0),x.connect(s,0,1),I.connect(s,0,1)},disconnectGraph(){o.disconnect(b),o.disconnect(void 0===S.inputs?S:S.inputs[0]),b.disconnect(v,0),b.disconnect(x,0),b.disconnect(_,1),b.disconnect(I,1),S.disconnect(a),a.disconnect(void 0===w.inputs?w:w.inputs[0]),a.disconnect(void 0===k.inputs?k:k.inputs[0]),a.disconnect(void 0===C.inputs?C:C.inputs[0]),a.disconnect(void 0===T.inputs?T:T.inputs[0]),w.disconnect(v.gain),k.disconnect(x.gain),C.disconnect(_.gain),T.disconnect(I.gain),v.disconnect(s,0,0),_.disconnect(s,0,0),x.disconnect(s,0,1),I.disconnect(s,0,1)}}})(e,s,p,f);throw o()};return(t,r)=>{let{channelCount:i,channelCountMode:c,pan:l}=r,u=s(r,Nr);if("max"===c)throw o();const d=e(t,h(h({},u),{},{channelCount:1,channelCountMode:c,numberOfInputs:2})),f=n(t,h(h({},u),{},{channelCount:i,channelCountMode:c,gain:1})),m=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:l});let{connectGraph:g,disconnectGraph:y}=p(t,i,f,m,d);Object.defineProperty(m.gain,"defaultValue",{get:()=>0}),Object.defineProperty(m.gain,"maxValue",{get:()=>1}),Object.defineProperty(m.gain,"minValue",{get:()=>-1});const b={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(e){f.channelCount!==e&&(v&&y(),({connectGraph:g,disconnectGraph:y}=p(t,e,f,m,d)),v&&g()),f.channelCount=e},get channelCountMode(){return f.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw o();f.channelCountMode=e},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(e){f.channelInterpretation=e},get context(){return f.context},get inputs(){return[f]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get pan(){return m.gain},addEventListener(){return f.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent(){return f.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener(){return f.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};let v=!1;return a(vr(b,d),(()=>{g(),v=!0}),(()=>{y(),v=!1}))}})(Vo,br,kr,xa,Ar,Wo),Ea=((e,t)=>(n,r)=>{const o=r.channelCountMode;if("clamped-max"===o)throw t();if(void 0===n.createStereoPanner)return e(n,r);const a=n.createStereoPanner();return ur(a,r),dr(a,r,"pan"),Object.defineProperty(a,"channelCountMode",{get:()=>o,set:e=>{if(e!==o)throw t()}}),a})(Na,Ar),Aa=((e,t,n,r,o)=>()=>{const a=new WeakMap;return{render(s,i){const c=a.get(i);return void 0!==c?Promise.resolve(c):(async(s,i)=>{let c=n(s);const l=rn(c,i);if(!l){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=t(i,e)}return a.set(i,c),l?await e(i,s.pan,c.pan):await r(i,s.pan,c.pan),Sn(c)?await o(s,i,c.inputs[0]):await o(s,i,c),c})(s,i)}}})(Ao,Ea,En,Oo,oo),Ra=((e,t,n,r,o,a)=>class extends e{constructor(e,s){const i=o(e),c=h(h({},Dr),s),l=n(i,c),u=a(i);super(e,!1,l,u?r():null),this._pan=t(this,u,l.pan)}get pan(){return this._pan}})(bo,Po,Ea,Aa,so,lo),Oa=((e,t,n)=>()=>{const r=new WeakMap;return{render(o,a){const s=r.get(a);return void 0!==s?Promise.resolve(s):(async(o,a)=>{let s=t(o);if(!rn(s,a)){const t={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,curve:s.curve,oversample:s.oversample};s=e(a,t)}return r.set(a,s),Sn(s)?await n(o,a,s.inputs[0]):await n(o,a,s),s})(o,a)}}})(xa,En,oo),Ma=((e,t,n,r,o,a,s)=>class extends e{constructor(e,t){const i=o(e),c=h(h({},Lr),t),l=n(i,c);super(e,!0,l,a(i)?r():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=l,s(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(e){this._nativeWaveShaperNode.oversample=e}})(bo,nr,xa,Oa,so,lo,Bo),Pa=(e=>null!==e&&e.isSecureContext)(to),Da=(e=>(t,n,r)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get:()=>Math.round(t*n)},currentTime:{configurable:!0,get:()=>t}});try{return r()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}})(to),Fa=new WeakMap,La=((e,t)=>n=>{let r=e.get(n);if(void 0!==r)return r;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new t(1,1,44100),e.set(n,r),r})(Fa,co),za=Pa?((e,t,n,r,o,a,s,i,c,l,u,h,d)=>{let p=0;return function(f,m){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{credentials:"omit"};const y=u.get(f);if(void 0!==y&&y.has(m))return Promise.resolve();const b=l.get(f);if(void 0!==b){const e=b.get(m);if(void 0!==e)return e}const v=a(f),w=void 0===v.audioWorklet?o(m).then((e=>{let[t,r]=e;const[o,a]=Gt(t,r),s="".concat(o,";((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{").concat(a,"\n})})(window,'_AWGS')");return n(s)})).then((()=>{const e=d._AWGS.pop();if(void 0===e)throw new SyntaxError;r(v.currentTime,v.sampleRate,(()=>e(class{},void 0,((e,n)=>{if(""===e.trim())throw t();const r=Wt.get(v);if(void 0!==r){if(r.has(e))throw t();Kt(n),Ht(n.parameterDescriptors),r.set(e,n)}else Kt(n),Ht(n.parameterDescriptors),Wt.set(v,new Map([[e,n]]))}),v.sampleRate,void 0,void 0)))})):Promise.all([o(m),Promise.resolve(e(h,h))]).then((e=>{let[[t,n],r]=e;const o=p+1;p=o;const[a,l]=Gt(t,n),u=r?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}",h=r?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));",d=r?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));",f="".concat(a,";((AudioWorkletProcessor,registerProcessor)=>{").concat(l,"\n})(").concat(u,",(n,p)=>registerProcessor(n,class extends p{").concat(h,"process(i,o,p){").concat(d,"return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac").concat(o,"',class extends AudioWorkletProcessor{process(){return !1}})"),m=new Blob([f],{type:"application/javascript; charset=utf-8"}),y=URL.createObjectURL(m);return v.audioWorklet.addModule(y,g).then((()=>{if(i(v))return v;const e=s(v);return e.audioWorklet.addModule(y,g).then((()=>e))})).then((e=>{if(null===c)throw new SyntaxError;try{new c(e,"__sac".concat(o))}catch(t){throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(y)))}));return void 0===b?l.set(f,new Map([[m,w]])):b.set(m,w),w.then((()=>{const e=u.get(f);void 0===e?u.set(f,new Set([m])):e.add(m)})).finally((()=>{const e=l.get(f);void 0!==e&&e.delete(m)})),w}})(Zr,Ar,(e=>t=>new Promise(((n,r)=>{if(null===e)return void r(new SyntaxError);const o=e.document.head;if(null===o)r(new SyntaxError);else{const a=e.document.createElement("script"),s=new Blob([t],{type:"application/javascript"}),i=URL.createObjectURL(s),c=e.onerror,l=()=>{e.onerror=c,URL.revokeObjectURL(i)};e.onerror=(t,n,o,a,s)=>n===i||n===e.location.href&&1===o&&1===a?(l(),r(s),!1):null!==c?c(t,n,o,a,s):void 0,a.onerror=()=>{l(),r(new SyntaxError)},a.onload=()=>{l(),n()},a.src=i,a.type="module",o.appendChild(a)}})))(to),Da,(e=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch(n){}throw e()})((()=>new DOMException("","AbortError"))),so,La,lo,yo,new WeakMap,new WeakMap,((e,t)=>async()=>{if(null===e)return!0;if(null===t)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new t(1,128,44100),o=URL.createObjectURL(n);let a=!1,s=!1;try{await r.audioWorklet.addModule(o);const t=new e(r,"a",{numberOfOutputs:0}),n=r.createOscillator();t.port.onmessage=()=>a=!0,t.onprocessorerror=()=>s=!0,n.connect(t),n.start(0),await r.startRendering(),await new Promise((e=>setTimeout(e)))}catch(i){}finally{URL.revokeObjectURL(o)}return a&&!s})(yo,co),to):void 0,Ba=((e,t)=>n=>e(n)||t(n))(fo,lo),qa=((e,t,n,r,o,a,s,i,c,l,u)=>(h,d)=>{const p=s(h)?h:a(h);if(o.has(d)){const e=n();return Promise.reject(e)}try{o.add(d)}catch(f){}return t(c,(()=>c(p)))?p.decodeAudioData(d).then((n=>(Jn(d).catch((()=>{})),t(i,(()=>i(n)))||u(n),e.add(n),n))):new Promise(((t,n)=>{const o=async()=>{try{await Jn(d)}catch(e){}},a=e=>{n(e),o()};try{p.decodeAudioData(d,(n=>{"function"!==typeof n.copyFromChannel&&(l(n),sn(n)),e.add(n),o().then((()=>t(n)))}),(e=>{a(null===e?r():e)}))}catch(s){a(s)}}))})(xo,Zr,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,so,Ba,on,ir,Co,Io),Wa=((e,t,n,r,o,a,s,i,c,l,u,d,p,f,m,g,y,b,v,w)=>class extends m{constructor(t,n){super(t,n),this._nativeContext=t,this._audioWorklet=void 0===e?void 0:{addModule:(t,n)=>e(this,t,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new o(this)}createBuffer(e,t,r){return new n({length:t,numberOfChannels:e,sampleRate:r})}createBufferSource(){return new r(this)}createChannelMerger(){return new a(this,{numberOfInputs:arguments.length>0&&void 0!==arguments[0]?arguments[0]:6})}createChannelSplitter(){return new s(this,{numberOfOutputs:arguments.length>0&&void 0!==arguments[0]?arguments[0]:6})}createConstantSource(){return new i(this)}createConvolver(){return new c(this)}createDelay(){return new u(this,{maxDelayTime:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1})}createDynamicsCompressor(){return new d(this)}createGain(){return new p(this)}createIIRFilter(e,t){return new f(this,{feedback:t,feedforward:e})}createOscillator(){return new g(this)}createPanner(){return new y(this)}createPeriodicWave(e,t){return new b(this,h(h({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{disableNormalization:!1}),{},{imag:t,real:e}))}createStereoPanner(){return new v(this)}createWaveShaper(){return new w(this)}decodeAudioData(e,t,n){return l(this._nativeContext,e).then((e=>("function"===typeof t&&t(e),e)),(e=>{throw"function"===typeof n&&n(e),e}))}})(za,wo,To,Fo,qo,Go,Ko,Jo,ea,qa,na,aa,ia,da,ma,ba,Ca,Ta,Ra,Ma),ja=((e,t,n,r)=>class extends e{constructor(e,o){const a=n(e),s=t(a,o);if(r(a))throw TypeError();super(e,!0,s,null),this._nativeMediaElementAudioSourceNode=s}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(bo,((e,t)=>e.createMediaElementSource(t.mediaElement)),so,lo),Va=((e,t,n,r)=>class extends e{constructor(e,o){const a=n(e);if(r(a))throw new TypeError;const s=h(h({},sr),o),i=t(a,s);super(e,!1,i,null),this._nativeMediaStreamAudioDestinationNode=i}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(bo,((e,t)=>{const n=e.createMediaStreamDestination();return ur(n,t),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),so,lo),Ua=((e,t,n,r)=>class extends e{constructor(e,o){const a=n(e),s=t(a,o);if(r(a))throw new TypeError;super(e,!0,s,null),this._nativeMediaStreamAudioSourceNode=s}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(bo,((e,t)=>{let{mediaStream:n}=t;const r=n.getAudioTracks();r.sort(((e,t)=>e.id<t.id?-1:e.id>t.id?1:0));const o=r.slice(0,1),a=e.createMediaStreamSource(new MediaStream(o));return Object.defineProperty(a,"mediaStream",{value:n}),a}),so,lo),Ga=((e,t)=>(n,r)=>{let{mediaStreamTrack:o}=r;if("function"===typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(o);const a=new MediaStream([o]),s=n.createMediaStreamSource(a);if("audio"!==o.kind)throw e();if(t(n))throw new TypeError;return s})(nr,lo),Ha=((e,t,n)=>class extends e{constructor(e,r){const o=n(e);super(e,!0,t(o,r),null)}})(bo,Ga,so),Ka=((e,t,n,r,o,a,s,i,c)=>class extends e{constructor(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null===c)throw new Error("Missing the native AudioContext constructor.");try{e=new c(t)}catch(s){if(12===s.code&&"sampleRate is not in range"===s.message)throw n();throw s}if(null===e)throw r();if(!yn(t.latencyHint))throw new TypeError("The provided value '".concat(t.latencyHint,"' is not a valid enum value of type AudioContextLatencyCategory."));if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:o}=t,{sampleRate:a}=e;if(this._baseLatency="number"===typeof e.baseLatency?e.baseLatency:"balanced"===o?512/a:"interactive"===o||void 0===o?256/a:"playback"===o?1024/a:128*Math.max(2,Math.min(128,Math.round(o*a/128)))/a,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),gn(this)})))}createMediaElementSource(e){return new o(this,{mediaElement:e})}createMediaStreamDestination(){return new a(this)}createMediaStreamSource(e){return new s(this,{mediaStream:e})}createMediaStreamTrackSource(e){return new i(this,{mediaStreamTrack:e})}resume(){return"suspended"===this._state?new Promise(((e,t)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?e():this.resume().then(e,t)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((e=>{if(void 0===e||15===e.code)throw t();throw e}))}suspend(){return this._nativeAudioContext.suspend().catch((e=>{if(void 0===e)throw t();throw e}))}})(Wa,nr,Ar,Fr,ja,Va,Ua,Ha,po),Xa=(e=>t=>{const n=e.get(t);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(fa),Qa=(e=>(t,n)=>{e(t).add(n)})(Xa),Ya=(e=>function(t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t[arguments.length>2&&void 0!==arguments[2]?arguments[2]:0];if(void 0===o)throw e();return Dn(n)?o.connect(n,0,r):o.connect(n,0)})(an),Ja=(e=>(t,n)=>{e(t).delete(n)})(Xa),Za=(e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return void 0===n?t.forEach((e=>e.disconnect())):"number"===typeof n?$n(e,t,n).disconnect():Dn(n)?void 0===r?t.forEach((e=>e.disconnect(n))):void 0===o?$n(e,t,r).disconnect(n,0):$n(e,t,r).disconnect(n,0,o):void 0===r?t.forEach((e=>e.disconnect(n))):$n(e,t,r).disconnect(n,0)})(an),$a=new WeakMap,es=((e,t)=>n=>t(e,n))($a,Xt),ts=((e,t,n,r,o,a,s,i,c,l,u,d,p)=>(f,m,g,y)=>{if(0===y.numberOfInputs&&0===y.numberOfOutputs)throw c();const b=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(b.some((e=>e<1)))throw c();if(b.length!==y.numberOfOutputs)throw t();if("explicit"!==y.channelCountMode)throw c();const v=y.channelCount*y.numberOfInputs,w=b.reduce(((e,t)=>e+t),0),x=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length;if(v+x>6||w>6)throw c();const k=new MessageChannel,S=[],_=[];for(let e=0;e<y.numberOfInputs;e+=1)S.push(s(f,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),_.push(o(f,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const C=[];if(void 0!==g.parameterDescriptors)for(const{defaultValue:e,maxValue:t,minValue:n,name:r}of g.parameterDescriptors){const o=a(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==y.parameterData[r]?y.parameterData[r]:void 0===e?0:e});Object.defineProperties(o.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===t?un:t},minValue:{get:()=>void 0===n?ln:n}}),C.push(o)}const I=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,v+x)}),T=mr(m,f.sampleRate),N=i(f,T,v+x,Math.max(1,w)),E=o(f,{channelCount:Math.max(1,w),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,w)}),A=[];for(let e=0;e<y.numberOfOutputs;e+=1)A.push(r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:b[e]}));for(let e=0;e<y.numberOfInputs;e+=1){S[e].connect(_[e]);for(let t=0;t<y.channelCount;t+=1)_[e].connect(I,t,e*y.channelCount+t)}const R=new qn(void 0===g.parameterDescriptors?[]:g.parameterDescriptors.map(((e,t)=>{let{name:n}=e;const r=C[t];return r.connect(I,0,v+t),r.start(0),[n,r.offset]})));I.connect(N);let O=y.channelInterpretation,M=null;const P=0===y.numberOfOutputs?[N]:A,D={get bufferSize(){return T},get channelCount(){return y.channelCount},set channelCount(e){throw n()},get channelCountMode(){return y.channelCountMode},set channelCountMode(e){throw n()},get channelInterpretation(){return O},set channelInterpretation(e){for(const t of S)t.channelInterpretation=e;O=e},get context(){return N.context},get inputs(){return S},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},get onprocessorerror(){return M},set onprocessorerror(e){"function"===typeof M&&D.removeEventListener("processorerror",M),M="function"===typeof e?e:null,"function"===typeof M&&D.addEventListener("processorerror",M)},get parameters(){return R},get port(){return k.port2},addEventListener(){return N.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},connect:e.bind(null,P),disconnect:l.bind(null,P),dispatchEvent(){return N.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener(){return N.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},F=new Map;var L,z;k.port1.addEventListener=(L=k.port1.addEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("message"===t[0]){const e="function"===typeof t[1]?t[1]:"object"===typeof t[1]&&null!==t[1]&&"function"===typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=F.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{u(f.currentTime,f.sampleRate,(()=>e(t)))},F.set(e,t[1]))}}return L.call(k.port1,t[0],t[1],t[2])}),k.port1.removeEventListener=(z=k.port1.removeEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("message"===t[0]){const e=F.get(t[1]);void 0!==e&&(F.delete(t[1]),t[1]=e)}return z.call(k.port1,t[0],t[1],t[2])});let B=null;Object.defineProperty(k.port1,"onmessage",{get:()=>B,set:e=>{"function"===typeof B&&k.port1.removeEventListener("message",B),B="function"===typeof e?e:null,"function"===typeof B&&(k.port1.addEventListener("message",B),k.port1.start())}}),g.prototype.port=k.port1;let q=null;const W=((e,t,n,r)=>{let o=jt.get(e);void 0===o&&(o=new WeakMap,jt.set(e,o));const a=gr(n,r);return o.set(t,a),a})(f,D,g,y);W.then((e=>q=e));const j=Un(y.numberOfInputs,y.channelCount),V=Un(y.numberOfOutputs,b),U=void 0===g.parameterDescriptors?[]:g.parameterDescriptors.reduce(((e,t)=>{let{name:n}=t;return h(h({},e),{},{[n]:new Float32Array(128)})}),{});let G=!0;const H=()=>{y.numberOfOutputs>0&&N.disconnect(E);for(let e=0,t=0;e<y.numberOfOutputs;e+=1){const n=A[e];for(let r=0;r<b[e];r+=1)E.disconnect(n,t+r,r);t+=b[e]}},K=new Map;N.onaudioprocess=e=>{let{inputBuffer:t,outputBuffer:n}=e;if(null!==q){const e=d(D);for(let o=0;o<T;o+=128){for(let e=0;e<y.numberOfInputs;e+=1)for(let n=0;n<y.channelCount;n+=1)jn(t,j[e],n,n,o);void 0!==g.parameterDescriptors&&g.parameterDescriptors.forEach(((e,n)=>{let{name:r}=e;jn(t,U,r,v+n,o)}));for(let e=0;e<y.numberOfInputs;e+=1)for(let t=0;t<b[e];t+=1)0===V[e][t].byteLength&&(V[e][t]=new Float32Array(128));try{const t=j.map(((t,n)=>{if(e[n].size>0)return K.set(n,T/128),t;const r=K.get(n);return void 0===r?[]:(t.every((e=>e.every((e=>0===e))))&&(1===r?K.delete(n):K.set(n,r-1)),t)})),r=u(f.currentTime+o/f.sampleRate,f.sampleRate,(()=>q.process(t,V,U)));G=r;for(let e=0,a=0;e<y.numberOfOutputs;e+=1){for(let t=0;t<b[e];t+=1)Vn(n,V[e],t,a+t,o);a+=b[e]}}catch(r){G=!1,D.dispatchEvent(new ErrorEvent("processorerror",{colno:r.colno,filename:r.filename,lineno:r.lineno,message:r.message}))}if(!G){for(let e=0;e<y.numberOfInputs;e+=1){S[e].disconnect(_[e]);for(let t=0;t<y.channelCount;t+=1)_[o].disconnect(I,t,e*y.channelCount+t)}if(void 0!==g.parameterDescriptors){const e=g.parameterDescriptors.length;for(let t=0;t<e;t+=1){const e=C[t];e.disconnect(I,0,v+t),e.stop()}}I.disconnect(N),N.onaudioprocess=null,X?H():J();break}}}};let X=!1;const Q=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Y=()=>N.connect(Q).connect(f.destination),J=()=>{N.disconnect(Q),Q.disconnect()};return Y(),p(D,(()=>{if(G){J(),y.numberOfOutputs>0&&N.connect(E);for(let e=0,t=0;e<y.numberOfOutputs;e+=1){const n=A[e];for(let r=0;r<b[e];r+=1)E.connect(n,t+r,r);t+=b[e]}}X=!0}),(()=>{G&&(Y(),H()),X=!1}))})(Ya,an,nr,Vo,br,Qo,kr,Tr,Ar,Za,Da,es,Wo),ns=((e,t,n,r,o)=>(a,s,i,c,l,u)=>{if(null!==i)try{const t=new i(a,c,u),r=new Map;let s=null;if(Object.defineProperties(t,{channelCount:{get:()=>u.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>s,set:e=>{"function"===typeof s&&t.removeEventListener("processorerror",s),s="function"===typeof e?e:null,"function"===typeof s&&t.addEventListener("processorerror",s)}}}),t.addEventListener=(p=t.addEventListener,function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if("processorerror"===n[0]){const e="function"===typeof n[1]?n[1]:"object"===typeof n[1]&&null!==n[1]&&"function"===typeof n[1].handleEvent?n[1].handleEvent:null;if(null!==e){const t=r.get(n[1]);void 0!==t?n[1]=t:(n[1]=t=>{"error"===t.type?(Object.defineProperties(t,{type:{value:"processorerror"}}),e(t)):e(new ErrorEvent(n[0],h({},t)))},r.set(e,n[1]))}}return p.call(t,"error",n[1],n[2]),p.call(t,...n)}),t.removeEventListener=(d=t.removeEventListener,function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if("processorerror"===n[0]){const e=r.get(n[1]);void 0!==e&&(r.delete(n[1]),n[1]=e)}return d.call(t,"error",n[1],n[2]),d.call(t,n[0],n[1],n[2])}),0!==u.numberOfOutputs){const e=n(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(e).connect(a.destination);return o(t,(()=>e.disconnect()),(()=>e.connect(a.destination)))}return t}catch(f){if(11===f.code)throw r();throw f}var d,p;if(void 0===l)throw r();return(e=>{const{port1:t}=new MessageChannel;try{t.postMessage(e)}finally{t.close()}})(u),t(a,s,l,u)})(nr,ts,kr,Ar,Wo),rs=((e,t,n,r,o,a,s,i,c,l,u,h,d,p,f,m)=>(g,y,b)=>{const v=new WeakMap;let w=null;return{render(x,k){i(k,x);const S=v.get(k);return void 0!==S?Promise.resolve(S):(async(i,x)=>{let k=u(i),S=null;const _=rn(k,x),C=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(null===h){const e=C.reduce(((e,t)=>e+t),0),n=o(x,{channelCount:Math.max(1,e),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,e)}),a=[];for(let t=0;t<i.numberOfOutputs;t+=1)a.push(r(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:C[t]}));const l=s(x,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});l.connect=t.bind(null,a),l.disconnect=c.bind(null,a),S=[n,a,l]}else _||(k=new h(x,g));if(v.set(x,null===S?k:S[2]),null!==S){if(null===w){if(void 0===b)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const e=i.channelCount*i.numberOfInputs,t=void 0===b.parameterDescriptors?0:b.parameterDescriptors.length,n=e+t,c=async()=>{const c=new d(n,128*Math.ceil(i.context.length/128),x.sampleRate),l=[],u=[];for(let e=0;e<y.numberOfInputs;e+=1)l.push(s(c,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),u.push(o(c,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const h=await Promise.all(Array.from(i.parameters.values()).map((async e=>{const t=a(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e.value});return await p(c,e,t.offset),t}))),g=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,e+t)});for(let e=0;e<y.numberOfInputs;e+=1){l[e].connect(u[e]);for(let t=0;t<y.channelCount;t+=1)u[e].connect(g,t,e*y.channelCount+t)}for(const[t,n]of h.entries())n.connect(g,0,e+t),n.start(0);return g.connect(c.destination),await Promise.all(l.map((e=>f(i,c,e)))),m(c)};w=Gn(i,0===n?null:await c(),x,y,C,b,l)}const e=await w,t=n(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,u,h]=S;null!==e&&(t.buffer=e,t.start(0)),t.connect(c);for(let n=0,r=0;n<i.numberOfOutputs;n+=1){const e=u[n];for(let t=0;t<C[n];t+=1)c.connect(e,r+t,t);r+=C[n]}return h}if(_)for(const[t,n]of i.parameters.entries())await e(x,n,k.parameters.get(t));else for(const[e,t]of i.parameters.entries())await p(x,t,k.parameters.get(e));return await f(i,x,k),k})(x,k)}}})(Ao,Ya,Ro,Vo,br,Qo,kr,Ja,Za,Da,En,yo,co,Oo,oo,la),os=(e=>t=>e.get(t))(Fa),as=(e=>(t,n)=>{e.set(t,n)})($a),ss=Pa?((e,t,n,r,o,a,s,i,c,l,u,d,p,f)=>class extends t{constructor(t,f,m){var g;const y=i(t),b=c(y),v=u(h(h({},Wn),m));p(v);const w=Wt.get(y),x=null===w||void 0===w?void 0:w.get(f),k=b||"closed"!==y.state?y:null!==(g=s(y))&&void 0!==g?g:y,S=o(k,b?null:t.baseLatency,l,f,x,v);super(t,!0,S,b?r(f,v,x):null);const _=[];S.parameters.forEach(((e,t)=>{const r=n(this,b,e);_.push([t,r])})),this._nativeAudioWorkletNode=S,this._onprocessorerror=null,this._parameters=new qn(_),b&&e(y,this);const{activeInputs:C}=a(this);d(S,C)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(e){const t="function"===typeof e?f(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===t?e:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Qa,bo,Po,rs,ns,pn,os,so,lo,yo,(e=>h(h({},e),{},{outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(()=>1))})),as,(e=>{const{port1:t,port2:n}=new MessageChannel;try{t.postMessage(e)}finally{t.close(),n.close()}}),Hr):void 0,is=(((e,t,n,r,o)=>{})(nr,Ar,Fr,ma,po),((e,t)=>(n,r,o)=>{if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(n,r,o)}catch(a){if("SyntaxError"===a.name)throw e();throw a}})(Ar,co)),cs=((e,t,n,r,o,a,s,i)=>(c,l)=>n(c).render(c,l).then((()=>Promise.all(Array.from(r(l)).map((e=>n(e).render(e,l)))))).then((()=>o(l))).then((n=>("function"!==typeof n.copyFromChannel?(s(n),sn(n)):t(a,(()=>a(n)))||i(n),e.add(n),n))))(xo,Zr,ro,Xa,la,on,Co,Io),ls=(((e,t,n,r,o)=>{})(Zr,nr,is,ma,cs),((e,t,n,r,o)=>class extends e{constructor(e,n,o){let a;if("number"===typeof e&&void 0!==n&&void 0!==o)a={length:n,numberOfChannels:e,sampleRate:o};else{if("object"!==typeof e)throw new Error("The given parameters are not valid.");a=e}const{length:s,numberOfChannels:i,sampleRate:c}=h(h({},Rr),a),l=r(i,s,c);t(ir,(()=>ir(l)))||l.addEventListener("statechange",(()=>{let e=0;const t=n=>{"running"===this._state&&(e>0?(l.removeEventListener("statechange",t),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):e+=1)};return t})()),super(l,i),this._length=s,this._nativeOfflineAudioContext=l,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",o(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,gn(this)})))}_waitForThePromiseToSettle(e){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((()=>this._waitForThePromiseToSettle(e)))}})(Wa,Zr,nr,is,cs)),us=((e,t)=>n=>{const r=e.get(n);return t(r)||t(n)})(zt,fo),hs=((e,t)=>n=>e.has(n)||t(n))(Dt,mo),ds=((e,t)=>n=>e.has(n)||t(n))(Lt,go),ps=((e,t)=>n=>{const r=e.get(n);return t(r)||t(n)})(zt,lo);function fs(e){return void 0===e}function ms(e){return void 0!==e}function gs(e){return"number"===typeof e}function ys(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function bs(e){return"boolean"===typeof e}function vs(e){return Array.isArray(e)}function ws(e){return"string"===typeof e}function xs(e){return ws(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}function ks(e,t){if(!e)throw new Error(t)}function Ss(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;if(!(t<=e&&e<=n))throw new RangeError("Value must be within [".concat(t,", ").concat(n,"], got: ").concat(e))}function _s(e){e.isOffline||"running"===e.state||Es('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Cs=!1,Is=!1;function Ts(e){Cs=e}let Ns=console;function Es(){Ns.warn(...arguments)}const As="object"===typeof self?self:null,Rs=As&&(As.hasOwnProperty("AudioContext")||As.hasOwnProperty("webkitAudioContext"));function Os(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s}function Ms(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{c(r.next(e))}catch(F2){a(F2)}}function i(e){try{c(r.throw(e))}catch(F2){a(F2)}}function c(e){e.done?o(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,i)}c((r=r.apply(e,t||[])).next())}))}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;class Ps{constructor(e,t,n,r){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(r||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const e=new Blob(["\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ".concat((1e3*this._updateInterval).toFixed(1),";\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t")],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(F2){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),"worker"===this._type&&(null===(t=this._worker)||void 0===t||t.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Ds(e){return ds(e)}function Fs(e){return hs(e)}function Ls(e){return ps(e)}function zs(e){return us(e)}function Bs(e,t){return"value"===e||Ds(t)||Fs(t)||function(e){return e instanceof To}(t)}function qs(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!n.length)return e;const o=n.shift();if(ys(e)&&ys(o))for(const a in o)Bs(a,o[a])?e[a]=o[a]:ys(o[a])?(e[a]||Object.assign(e,{[a]:{}}),qs(e[a],o[a])):Object.assign(e,{[a]:o[a]});return qs(e,...n)}function Ws(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;const o={},a=Array.from(t);if(ys(a[0])&&r&&!Reflect.has(a[0],r)){Object.keys(a[0]).some((t=>Reflect.has(e,t)))||(qs(o,{[r]:a[0]}),n.splice(n.indexOf(r),1),a.shift())}if(1===a.length&&ys(a[0]))qs(o,a[0]);else for(let s=0;s<n.length;s++)ms(a[s])&&(o[n[s]]=a[s]);return qs(e,o)}function js(e,t){return fs(e)?t:e}function Vs(e,t){return t.forEach((t=>{Reflect.has(e,t)&&delete e[t]})),e}class Us{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(){if(this.debug||As&&this.toString()===As.TONE_DEBUG_CLASS){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];!function(){Ns.log(...arguments)}(this,...t)}}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Us.version=Rt;const Gs=1e-6;function Hs(e,t){return e>t+Gs}function Ks(e,t){return Hs(e,t)||Qs(e,t)}function Xs(e,t){return e+Gs<t}function Qs(e,t){return Math.abs(e-t)<Gs}function Ys(e,t,n){return Math.max(Math.min(e,n),t)}class Js extends Us{constructor(){super(),this.name="Timeline",this._timeline=[];const e=Ws(Js.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(ks(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];ks(Ks(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(e){const t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time";const n=this._search(e,t);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time";const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Qs(this._timeline[t].time,e)){for(let n=t;n>=0&&Qs(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&Ks(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time";if(0===this._timeline.length)return-1;let n=0;const r=this._timeline.length;let o=r;if(r>0&&this._timeline[r-1][t]<=e)return r-1;for(;n<o;){let r=Math.floor(n+(o-n)/2);const a=this._timeline[r],s=this._timeline[r+1];if(Qs(a[t],e)){for(let n=r;n<this._timeline.length;n++){if(!Qs(this._timeline[n][t],e))break;r=n}return r}if(Xs(a[t],e)&&Hs(s[t],e))return r;Hs(a[t],e)?o=r:n=r+1}return-1}_iterate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._timeline.length-1;this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return-1!==n&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let r=this._search(e),o=this._search(t);return-1!==r&&-1!==o?(this._timeline[r].time!==e&&(r+=1),this._timeline[o].time===t&&(o-=1),this._iterate(n,r,o)):-1===r&&this._iterate(n,0,o),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(-1!==n&&Qs(this._timeline[n].time,e)){let r=n;for(let t=n;t>=0&&Qs(this._timeline[t].time,e);t--)r=t;this._iterate((e=>{t(e)}),r,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const Zs=[];function $s(e){Zs.push(e)}const ei=[];function ti(e){ei.push(e)}class ni extends Us{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach((e=>{fs(this._events)&&(this._events={}),this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t)})),this}once(e,t){var n=this;const r=function(){t(...arguments),n.off(e,r)};return this.on(e,r),this}off(e,t){return e.split(/\W+/).forEach((e=>{if(fs(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(fs(t))this._events[e]=[];else{const n=this._events[e];for(let e=n.length-1;e>=0;e--)n[e]===t&&n.splice(e,1)}})),this}emit(e){if(this._events&&this._events.hasOwnProperty(e)){const o=this._events[e].slice(0);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(let e=0,t=o.length;e<t;e++)o[e].apply(this,n)}return this}static mixin(e){["on","once","off","emit"].forEach((t=>{const n=Object.getOwnPropertyDescriptor(ni.prototype,t);Object.defineProperty(e.prototype,t,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class ri extends ni{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class oi extends ri{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Js,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=Ws(oi.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=(null===(e=arguments[0])||void 0===e?void 0:e.latencyHint)||""):(this._context=function(e){return new Ka(e)}({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new Ps(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[(null===(t=arguments[0])||void 0===t?void 0:t.hasOwnProperty("updateInterval"))?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var e;return this._initialized||(e=this,Zs.forEach((t=>t(e))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){ks(zs(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(e)}createMediaElementSource(e){ks(zs(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(e)}createMediaStreamDestination(){ks(zs(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){ks(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){ks(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){ks(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){ks(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return function(e,t,n){return ks(ms(ss),"AudioWorkletNode only works in a secure context (https or localhost)"),new(e instanceof(null===As||void 0===As?void 0:As.BaseAudioContext)?null===As||void 0===As?void 0:As.AudioWorkletNode:ss)(e,t,n)}(this.rawContext,e,t)}addAudioWorkletModule(e){return Ms(this,void 0,void 0,(function*(){ks(ms(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise}))}workletsAreReady(){return Ms(this,void 0,void 0,(function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return zs(this._context)?this._context.resume():Promise.resolve()}close(){return Ms(this,void 0,void 0,(function*(){var e;zs(this._context)&&"closed"!==this.state&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(e=this,ei.forEach((t=>t(e))))}))}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let o=0;o<n.length;o++)n[o]=e;const r=this._context.createBufferSource();return r.channelCount=1,r.channelCountMode="explicit",r.buffer=t,r.loop=!0,r.start(0),this._constants.set(e,r),r}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((e=>this._constants[e].disconnect())),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,(e=>{e.callback(),this._timeouts.remove(e)}))}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach((t=>{t.id===e&&this._timeouts.remove(t)})),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,r=()=>{const o=this.now();this._timeouts.add({callback:()=>{e(),r()},id:n,time:o+t})};return r(),n}}function ai(e,t){vs(t)?t.forEach((t=>ai(e,t))):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function si(e,t){vs(t)?t.forEach((t=>si(e,t))):Object.defineProperty(e,t,{writable:!0})}const ii=()=>{};class ci extends Us{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ii;const e=Ws(ci.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,ws(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:ii,onload:ii,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:di().sampleRate}set(e){return e instanceof ci?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Ms(this,void 0,void 0,(function*(){const t=ci.load(e).then((e=>{this.set(e),this.onload(this)}));ci.downloads.push(t);try{yield t}finally{const e=ci.downloads.indexOf(t);ci.downloads.splice(e,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=vs(e)&&e[0].length>0,n=t?e.length:1,r=t?e[0].length:e.length,o=di(),a=o.createBuffer(n,r,o.sampleRate),s=t||1!==n?e:[e];for(let i=0;i<n;i++)a.copyToChannel(s[i],i);return this._buffer=a,this}toMono(e){if(gs(e))this.fromArray(this.toArray(e));else{let e=new Float32Array(this.length);const t=this.numberOfChannels;for(let n=0;n<t;n++){const t=this.toArray(n);for(let n=0;n<t.length;n++)e[n]+=t[n]}e=e.map((e=>e/t)),this.fromArray(e)}return this}toArray(e){if(gs(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);{const e=[];for(let t=0;t<this.numberOfChannels;t++)e[t]=this.getChannelData(t);return e}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration;ks(this.loaded,"Buffer is not loaded");const n=Math.floor(e*this.sampleRate),r=Math.floor(t*this.sampleRate);ks(n<r,"The start time must be less than the end time");const o=r-n,a=di().createBuffer(this.numberOfChannels,o,this.sampleRate);for(let s=0;s<this.numberOfChannels;s++)a.copyToChannel(this.getChannelData(s).subarray(n,r),s);return new ci(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return(new ci).fromArray(e)}static fromUrl(e){return Ms(this,void 0,void 0,(function*(){const t=new ci;return yield t.load(e)}))}static load(e){return Ms(this,void 0,void 0,(function*(){const t=""===ci.baseUrl||ci.baseUrl.endsWith("/")?ci.baseUrl:ci.baseUrl+"/",n=yield fetch(t+e);if(!n.ok)throw new Error("could not load url: ".concat(e));const r=yield n.arrayBuffer();return yield di().decodeAudioData(r)}))}static supportsType(e){const t=e.split("."),n=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Ms(this,void 0,void 0,(function*(){for(yield Promise.resolve();ci.downloads.length;)yield ci.downloads[0]}))}}ci.baseUrl="",ci.downloads=[];class li extends oi{constructor(){var e,t,n;super({clockSource:"offline",context:Ls(arguments[0])?arguments[0]:(e=arguments[0],t=arguments[1]*arguments[2],n=arguments[2],new ls(e,t,n)),lookAhead:0,updateInterval:Ls(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ls(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Ms(this,void 0,void 0,(function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise((e=>setTimeout(e,1))))}}))}render(){return Ms(this,arguments,void 0,(function(){var e=this;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function*(){yield e.workletsAreReady(),yield e._renderClock(t);const n=yield e._context.startRendering();return new ci(n)}()}))}close(){return Promise.resolve()}}const ui=new class extends ri{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Ms(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}};let hi=ui;function di(){return hi===ui&&Rs&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&hi.dispose();hi=zs(e)?new oi(e):Ls(e)?new li(e):e}(new oi),hi}function pi(){return hi.resume()}if(As&&!As.TONE_SILENCE_LOGGING){let e="v";0;const t=" * Tone.js ".concat(e).concat(Rt," * ");console.log("%c".concat(t),"background: #000; color: #fff")}function fi(e){return Math.pow(10,e/20)}function mi(e){return Math.log(e)/Math.LN10*20}function gi(e){return Math.pow(2,e/12)}let yi=440;function bi(e){return Math.round(vi(e))}function vi(e){return 69+12*Math.log2(e/yi)}function wi(e){return yi*Math.pow(2,(e-69)/12)}class xi extends Us{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),r="."===t?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*r:this._beatsToUnits(4/n)*r},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let r=0;return e&&"0"!==e&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r+=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r+=this._beatsToUnits(parseFloat(n)/4)),r},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof xi&&this.fromType(this._val),fs(this._val))return this._noArg();if(ws(this._val)&&fs(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(ys(this._val)){let e=0;for(const t in this._val)if(ms(this._val[t])){const n=this._val[t];e+=new this.constructor(this.context,t).valueOf()*n}return e}if(ms(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}return ws(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class ki extends xi{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new ki(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=new this.constructor(this.context,e).valueOf(),r=this.valueOf();return r+(Math.round(r/n)*n-r)*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let o=1;o<9;o++){const e=Math.pow(2,o);t.push(e+"n."),t.push(e+"n"),t.push(e+"t")}t.push("0");let n=t[0],r=new ki(this.context,t[0]).toSeconds();return t.forEach((t=>{const o=new ki(this.context,t).toSeconds();Math.abs(o-e)<Math.abs(r-e)&&(n=t,r=o)})),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let r=t%1*4;t=Math.floor(t)%this._getTimeSignature();const o=r.toString();o.length>3&&(r=parseFloat(parseFloat(o).toFixed(3)));return[n,t,r].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return bi(this.toFrequency())}_now(){return this.context.now()}}class Si extends ki{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return yi}static set A4(e){!function(e){yi=e}(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:Si.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const n=_i[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?n:Si.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let r=1;return e&&"0"!==e&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}})}transpose(e){return new Si(this.context,this.valueOf()*gi(e))}harmonize(e){return e.map((e=>this.transpose(e)))}toMidi(){return bi(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Si.A4);let n=Math.round(12*t)+57;const r=Math.floor(n/12);r<0&&(n+=-12*r);return Ci[n%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return wi(e)}static ftom(e){return bi(e)}}const _i={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Ci=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ii extends ki{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ti extends Us{constructor(){super();const e=Ws(Ti.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:di()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return function(e){fs(e)&&Cs&&!Is&&(Is=!0,Es("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}(e),new ki(this.context,e).toSeconds()}toFrequency(e){return new Si(this.context,e).toFrequency()}toTicks(e){return new Ii(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach((n=>{fs(e[n])&&delete t[n]})),t}get(){const e=function(e){return e.constructor.getDefaults()}(this);return Object.keys(e).forEach((t=>{if(Reflect.has(this,t)){const n=this[t];ms(n)&&ms(n.value)&&ms(n.setValueAtTime)?e[t]=n.value:n instanceof Ti?e[t]=n._getPartialProperties(e[t]):vs(n)||gs(n)||ws(n)||bs(n)?e[t]=n:delete e[t]}})),e}set(e){return Object.keys(e).forEach((t=>{Reflect.has(this,t)&&ms(this[t])&&(this[t]&&ms(this[t].value)&&ms(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Ti?this[t].set(e[t]):this[t]=e[t])})),this}}class Ni extends Js{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stopped";super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return null!==t?t.state:this._initial}setStateAtTime(e,t,n){return Ss(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){for(let n=this._search(t);n>=0;n--){const t=this._timeline[n];if(t.state===e)return t}}getNextState(e,t){const n=this._search(t);if(-1!==n)for(let r=n;r<this._timeline.length;r++){const t=this._timeline[r];if(t.state===e)return t}}}class Ei extends Ti{constructor(){const e=Ws(Ei.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,ks(ms(e.param)&&(Ds(e.param)||e.param instanceof Ei),"param must be an AudioParam");!Ds(e.param);)e.param=e.param._param;this._swappable=!!ms(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Js(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,ms(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ti.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return ms(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return ms(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return ms(this.maxValue)&&ms(this.minValue)&&Ss(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?fi(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&"decibels"===this.units?mi(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),r=this._fromType(e);return ks(isFinite(r)&&isFinite(n),"Invalid argument(s) to setValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._assertRange(r),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),r=this._events.get(t);let o=this._initialValue;if(null===r)o=this._initialValue;else if("setTargetAtTime"!==r.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)o=r.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let e=r.value;if("setTargetAtTime"===r.type){const t=this._events.getBefore(r.time);e=null===t?this._initialValue:t.value}o="linearRampToValueAtTime"===n.type?this._linearInterpolate(r.time,e,n.time,n.value,t):this._exponentialInterpolate(r.time,e,n.time,n.value,t)}else o=r.value;else{const e=this._events.getBefore(r.time);let n;n=null===e?this._initialValue:e.value,"setTargetAtTime"===r.type&&(o=this._exponentialApproach(r.time,n,r.value,r.constant,t))}return this._toType(o)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),r=this.toSeconds(t);return ks(isFinite(n)&&isFinite(r),"Invalid argument(s) to linearRampToValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,r),this._param.linearRampToValueAtTime(n,r),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=Qs(n,0)?this._minOutput:n,this._assertRange(n);const r=this.toSeconds(t);return ks(isFinite(n)&&isFinite(r),"Invalid argument(s) to exponentialRampToValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,r),this._param.exponentialRampToValueAtTime(n,r),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const r=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,r),this.cancelAndHoldAtTime(t+.9*n),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const r=this._fromType(e);ks(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const o=this.toSeconds(t);return this._assertRange(r),ks(isFinite(r)&&isFinite(o),"Invalid argument(s) to setTargetAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._events.add({constant:n,time:o,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",e,o,n),this._param.setTargetAtTime(r,o,n),this}setValueCurveAtTime(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n=this.toSeconds(n),t=this.toSeconds(t);const o=this._fromType(e[0])*r;this.setValueAtTime(this._toType(o),t);const a=n/(e.length-1);for(let s=1;s<e.length;s++){const n=this._fromType(e[s])*r;this.linearRampToValueAtTime(this._toType(n),t+s*a)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return ks(isFinite(t),"Invalid argument to cancelScheduledValues: ".concat(JSON.stringify(e))),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));ks(isFinite(t),"Invalid argument to cancelAndHoldAtTime: ".concat(JSON.stringify(e))),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const r=this._events.get(t),o=this._events.getAfter(t);return r&&Qs(r.time,t)?o?(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):o&&(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time),"linearRampToValueAtTime"===o.type?this.linearRampToValueAtTime(this._toType(n),t):"exponentialRampToValueAtTime"===o.type&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=arguments.length>2?arguments[2]:void 0;return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&"setTargetAtTime"===n.type){const r=this._events.getAfter(n.time),o=r?r.time:t+2,a=(o-t)/10;for(let n=t;n<o;n+=a)e.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(t=>{"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}setParam(e){ks(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,r,o){return n+(t-n)*Math.exp(-(o-e)/r)}_linearInterpolate(e,t,n,r,o){return t+(o-e)/(n-e)*(r-t)}_exponentialInterpolate(e,t,n,r,o){return t*Math.pow(r/t,(o-e)/(n-e))}}class Ai extends Ti{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return ms(this.input)?Ds(this.input)||this.input instanceof Ei?1:this.input.numberOfInputs:0}get numberOfOutputs(){return ms(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return ms(e)&&(e instanceof Ai||Fs(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach((t=>{t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}_getChannelProperties(){const e=this._getInternalNodes();ks(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e){return Oi(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Es("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e){return Mi(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),this}chain(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ri(this,...t),this}fan(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach((e=>this.connect(e))),this}dispose(){return super.dispose(),ms(this.input)&&(this.input instanceof Ai?this.input.dispose():Fs(this.input)&&this.input.disconnect()),ms(this.output)&&(this.output instanceof Ai?this.output.dispose():Fs(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Ri(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.shift();t.reduce(((e,t)=>(e instanceof Ai?e.connect(t):Fs(e)&&Oi(e,t),t)),r)}function Oi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(ks(ms(e),"Cannot connect from undefined node"),ks(ms(t),"Cannot connect to undefined node"),(t instanceof Ai||Fs(t))&&ks(t.numberOfInputs>0,"Cannot connect to node with no inputs"),ks(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof Ai||t instanceof Ei;)ms(t.input)&&(t=t.input);for(;e instanceof Ai;)ms(e.output)&&(e=e.output);Ds(t)?e.connect(t,n):e.connect(t,n,r)}function Mi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(ms(t))for(;t instanceof Ai;)t=t.input;for(;!Fs(e);)ms(e.output)&&(e=e.output);Ds(t)?e.disconnect(t,n):Fs(t)?e.disconnect(t,n,r):e.disconnect()}class Pi extends Ai{constructor(){const e=Ws(Pi.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Ei({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),ai(this,"gain")}static getDefaults(){return Object.assign(Ai.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Di extends Ai{constructor(e){super(e),this.onended=ii,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Pi({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Ai.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ii})}_startGain(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;ks(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){ks(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const e="exponential"===this._curve?2*t:0;this._stopSource(this.now()+e),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ii&&(this.onended(this),this.onended=ii,!this.context.isOffline)){const e=()=>this.dispose();"undefined"!==typeof requestIdleCallback?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),ks(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ii,this}}class Fi extends Di{constructor(){const e=Ws(Fi.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Oi(this._source,this._gainNode),this.offset=new Ei({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Di.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Li extends Ai{constructor(){const e=Ws(Li.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new Fi({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Ai.getDefaults(),{convert:!0,units:"number",value:0})}connect(e){return zi(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,r){return this._param.setValueCurveAtTime(e,t,n,r),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function zi(e,t,n,r){(t instanceof Ei||Ds(t)||t instanceof Li&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof Li&&(t.overridden=!0)),Oi(e,t,n,r)}class Bi extends Ei{constructor(){const e=Ws(Bi.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Js(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ei.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const r=this._fromType(e),o=this._events.get(t),a=Math.round(Math.max(1/n,1));for(let s=0;s<=a;s++){const e=n*s+t,a=this._exponentialApproach(o.time,o.value,r,n,e);this.linearRampToValueAtTime(this._toType(a),e)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const r=this._events.get(n),o=this._events.previousEvent(r),a=this._getTicksUntilEvent(o,n);return r.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const r=this._events.get(n),o=this._events.previousEvent(r),a=this._getTicksUntilEvent(o,n);return r.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(10*(t-r.time),1)),a=(t-r.time)/o;for(let s=0;s<=o;s++){const e=a*s+r.time,o=this._exponentialInterpolate(r.time,r.value,t,n,e);this.linearRampToValueAtTime(this._toType(o),e)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(fs(e.ticks)){const t=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(t,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let r=this._fromType(this.getValueAtTime(t));const o=this._events.get(t);return o&&o.time===t&&"setValueAtTime"===o.type&&(r=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+r)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),r=this.getTicksAtTime(t);return this.getTimeOfTick(r+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&"linearRampToValueAtTime"===n.type&&t.value!==n.value){const r=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-t.time),a=Math.sqrt(Math.pow(r,2)-2*o*(t.ticks-e)),s=(-r+a)/o;return(s>0?s:(-r-a)/o)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),r=this.toSeconds(e),o=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-o}_fromType(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class qi extends Li{constructor(){const e=Ws(qi.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new Bi({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Li.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class Wi extends Ti{constructor(){const e=Ws(Wi.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new Ni,this._tickOffset=new Js,this._ticksAtTime=new Js,this._secondsAtTime=new Js,this.frequency=new qi({context:this.context,units:e.units,value:e.frequency}),ai(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ti.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),ms(t)&&this.setTicksAtTime(t,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){const t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){const e=this._state.get(t);e&&e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),r=this._ticksAtTime.get(t),o={state:"paused",time:t};this._state.add(o);let a=r||n,s=r?r.ticks:0,i=null;return this._state.forEachBetween(a.time,t+this.sampleTime,(e=>{let t=a.time;const n=this._tickOffset.get(e.time);n&&n.time>=a.time&&(s=n.ticks,t=n.time),"started"===a.state&&"started"!==e.state&&(s+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(t),e.time!==o.time&&(i={state:e.state,time:e.time,ticks:s})),a=e})),this._state.remove(o),i&&this._ticksAtTime.add(i),s}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);const r=this._secondsAtTime.get(e);let o=r||t,a=r?r.seconds:0,s=null;return this._state.forEachBetween(o.time,e+this.sampleTime,(e=>{let t=o.time;const r=this._tickOffset.get(e.time);r&&r.time>=o.time&&(a=r.seconds,t=r.time),"started"===o.state&&"started"!==e.state&&(a+=e.time-t,e.time!==n.time&&(s={state:e.state,time:e.time,seconds:a})),o=e})),this._state.remove(n),s&&this._secondsAtTime.add(s),a}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now();const n=this._tickOffset.get(t),r=this._state.get(t),o=Math.max(n.time,r.time),a=this.frequency.getTicksAtTime(o)+e-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,t,n){let r=this._state.get(e);this._state.forEachBetween(e,t,(t=>{r&&"started"===r.state&&"started"!==t.state&&this.forEachTickBetween(Math.max(r.time,e),t.time-this.sampleTime,n),r=t}));let o=null;if(r&&"started"===r.state){const a=Math.max(r.time,e),s=this.frequency.getTicksAtTime(a),i=s-this.frequency.getTicksAtTime(r.time);let c=Math.ceil(i)-i;c=Qs(c,1)?0:c;let l=this.frequency.getTimeOfTick(s+c);for(;l<t;){try{n(l,Math.round(this.getTicksAtTime(l)))}catch(F2){o=F2;break}l+=this.frequency.getDurationOfTicks(1,l)}}if(o)throw o;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class ji extends Ti{constructor(){const e=Ws(ji.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=ii,this._lastUpdate=0,this._state=new Ni("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new Wi({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ai(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ti.getDefaults(),{callback:ii,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){_s(this.context);const n=this.toSeconds(e);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now();return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,(e=>{switch(e.state){case"started":const t=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,t);break;case"stopped":0!==e.time&&this.emit("stop",e.time);break;case"paused":this.emit("pause",e.time)}})),this._tickSource.forEachTickBetween(e,t,((e,t)=>{this.callback(e,t)})))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}ni.mixin(ji);class Vi extends Ai{constructor(){const e=Ws(Vi.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Pi({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,ai(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Ai.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Ui extends Ai{constructor(){const e=Ws(Ui.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Vi({context:this.context}),this.output=new Pi({context:this.context}),this.volume=this.input.volume,Ri(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Ai.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(){this.input.disconnect();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift(this.input),t.push(this.output),Ri(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}$s((e=>{e.destination=new Ui({context:e})})),ti((e=>{e.destination.dispose()}));class Gi extends Ai{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ei({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ei({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ei({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ei({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ei({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ei({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ei({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ei({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ei({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Ai.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}$s((e=>{e.listener=new Gi({context:e})})),ti((e=>{e.listener.dispose()}));class Hi extends Us{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=Ws(Hi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach((t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:ii,onload:ii,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return ks(this.has(e),"ToneAudioBuffers has no buffer named: ".concat(e)),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,0===this._loadingCount&&e&&e()}get loaded(){return Array.from(this._buffers).every((e=>{let[t,n]=e;return n.loaded}))}add(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ii,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ii;return ws(t)?(this.baseUrl&&"data:audio/"===t.trim().substring(0,11).toLowerCase()&&(this.baseUrl=""),this._buffers.set(e.toString(),new ci(this.baseUrl+t,n,r))):this._buffers.set(e.toString(),new ci(t,n,r)),this}dispose(){return super.dispose(),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this}}class Ki extends Ii{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Xi extends Ti{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Js,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,(t=>{e-t.time<=this.expiration&&t.callback(),this._events.remove(t)})),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}$s((e=>{e.draw=new Xi({context:e})})),ti((e=>{e.draw.dispose()}));class Qi extends Us{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){ks(ms(e.time),"Events must have a time property"),ks(ms(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new Yi(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(null!==this._root){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,(e=>this.remove(e))),this}_setRoot(e){this._root=e,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{let t,n=null;if(e.getBalance()>0)if(null===e.left.right)t=e.left,t.right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)t=e.right,t.left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),n&&this._rebalance(n)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),r=e.right;r&&(e.right=r.left,r.left=e),null!==t?n?t.left=r:t.right=r:this._setRoot(r)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),r=e.left;r&&(e.left=r.right,r.right=e),null!==t?n?t.left=r:t.right=r:this._setRoot(r)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(null!==this._root){const t=[];if(this._root.search(e,t),t.length>0){let e=t[0];for(let n=1;n<t.length;n++)t[n].low>e.low&&(e=t[n]);return e.event}}return null}forEach(e){if(null!==this._root){const t=[];this._root.traverse((e=>t.push(e))),t.forEach((t=>{t.event&&e(t.event)}))}return this}forEachAtTime(e,t){if(null!==this._root){const n=[];this._root.search(e,n),n.forEach((e=>{e.event&&t(e.event)}))}return this}forEachFrom(e,t){if(null!==this._root){const n=[];this._root.searchAfter(e,n),n.forEach((e=>{e.event&&t(e.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((e=>e.dispose())),this._root=null,this}}class Yi{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}traverse(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Ji extends Us{constructor(e){super(),this.name="TimelineValue",this._timeline=new Js({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Zi extends Ai{constructor(){super(Ws(Zi.getDefaults(),arguments,["context"]))}connect(e){return zi(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),this}}class $i extends Zi{constructor(){const e=Ws($i.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,vs(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):"function"===typeof e.mapping&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Li.getDefaults(),{length:1024})}setMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=new Float32Array(t);for(let r=0,o=t;r<o;r++){const t=r/(o-1)*2-1;n[r]=e(t,r)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){ks(["none","2x","4x"].some((t=>t.includes(e))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ec extends Zi{constructor(){const e=Ws(ec.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new $i({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Zi.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class tc{constructor(e,t){this.id=tc._eventId++,this._remainderTime=0;const n=Object.assign(tc.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:ii,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}tc._eventId=0;class nc extends tc{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(nc.getDefaults(),t);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},tc.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Xs(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ki(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Xs(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ki(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Hs(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class rc extends Ti{constructor(){const e=Ws(rc.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new Ji(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Js,this._repeatedEvents=new Qi,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new ji({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),ai(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Ti.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(2*this._swingTicks)!==0){const n=t%(2*this._swingTicks)/(2*this._swingTicks),r=Math.sin(n*Math.PI)*this._swingAmount;e+=new Ki(this.context,2*this._swingTicks/3).toSeconds()*r}Ts(!0),this._timeline.forEachAtTime(t,(t=>t.invoke(e))),Ts(!1)}schedule(e,t){const n=new tc(this,{callback:e,time:new Ii(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const o=new nc(this,{callback:e,duration:new ki(this.context,r).toTicks(),interval:new ki(this.context,t).toTicks(),time:new Ii(this.context,n).toTicks()});return this._addEvent(o,this._repeatedEvents)}scheduleOnce(e,t){const n=new tc(this,{callback:e,once:!0,time:new Ii(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this.toTicks(e);return this._timeline.forEachFrom(t,(e=>this.clear(e.id))),this._repeatedEvents.forEachFrom(t,(e=>this.clear(e.id))),this}_bindClockEvents(){this._clock.on("start",((e,t)=>{t=new Ki(this.context,t).toSeconds(),this.emit("start",e,t)})),this._clock.on("stop",(e=>{this.emit("stop",e)})),this._clock.on("pause",(e=>{this.emit("pause",e)}))}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return this.context.resume(),ms(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){vs(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new ki(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new ki(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Ki(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Ki(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(t),r=t+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t);this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),"started"!==this.state)return 0;{const t=this.now(),n=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(n,t)}}syncSignal(e,t){const n=this.now();let r=this.bpm,o=1/(60/r.getValueAtTime(n)/this.PPQ),a=[];if("time"===e.units){const e=1/64/o,t=new Pi(e),n=new ec(-1),s=new Pi(e);r.chain(t,n,s),r=s,o=1/o,a=[t,n,s]}t||(t=0!==e.getValueAtTime(n)?e.getValueAtTime(n)/o:0);const s=new Pi(t);return r.connect(s),s.connect(e._param),a.push(s),this._syncedSignals.push({initial:e.value,nodes:a,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.nodes.forEach((e=>e.dispose())),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),si(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}ni.mixin(rc),$s((e=>{e.transport=new rc({context:e})})),ti((e=>{e.transport.dispose()}));class oc extends Ai{constructor(e){super(e),this.input=void 0,this._state=new Ni("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ii,this._syncedStop=ii,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Vi({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,ai(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Ai.getDefaults(),{mute:!1,onstop:ii,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let r=fs(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(r=this._clampToCurrentTime(r),this._synced||"started"!==this._state.getValueAtTime(r))if(this.log("start",r),this._state.setStateAtTime("started",r),this._synced){const e=this._state.get(r);e&&(e.offset=this.toSeconds(js(t,0)),e.duration=n?this.toSeconds(n):void 0);const o=this.context.transport.schedule((e=>{this._start(e,t,n)}),r);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>r&&this._syncedStart(this.now(),this.context.transport.seconds)}else _s(this.context),this._start(r,t,n);else ks(Hs(r,this._state.get(r).time),"Start time must be strictly greater than previous start time"),this._state.cancel(r),this._state.setStateAtTime("started",r),this.log("restart",r),this.restart(r,t,n);return this}stop(e){let t=fs(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||ms(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const e=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Hs(t,0)){const n=this._state.get(t);if(n&&"started"===n.state&&n.time!==t){const r=t-this.toSeconds(n.time);let o;n.duration&&(o=this.toSeconds(n.duration)-r),this._start(e,this.toSeconds(n.offset)+r,o)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((e=>this.context.transport.clear(e))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ii,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ac extends Di{constructor(){const e=Ws(ac.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Oi(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ei({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ci(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Di.getDefaults(),{url:new ci,loop:!1,loopEnd:0,loopStart:0,onload:ii,onerror:ii,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;ks(this.buffer.loaded,"buffer is either not set or not loaded");const o=this.toSeconds(e);this._startGain(o,r),t=this.loop?js(t,this.loopStart):js(t,0);let a=Math.max(this.toSeconds(t),0);if(this.loop){const e=this.toSeconds(this.loopEnd)||this.buffer.duration,t=this.toSeconds(this.loopStart),n=e-t;Ks(a,e)&&(a=(a-t)%n+t),Qs(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Xs(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(o,a)),ms(n)){let e=this.toSeconds(n);e=Math.max(e,0),this.stop(o+e)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function sc(e,t){return Ms(this,void 0,void 0,(function*(){const n=t/e.context.sampleRate,r=new li(1,n,e.context.sampleRate);new e.constructor(Object.assign(e.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0);return(yield r.render()).getChannelData(0)}))}class ic extends Di{constructor(){const e=Ws(ic.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Oi(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Ei({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Ei({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),ai(this,["frequency","detune"])}static getDefaults(){return Object.assign(Di.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class cc extends oc{constructor(){const e=Ws(cc.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new Li({context:this.context,units:"frequency",value:e.frequency}),ai(this,"frequency"),this.detune=new Li({context:this.context,units:"cents",value:e.detune}),ai(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&"custom"!==e.type&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(oc.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new ic({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){const e=cc._periodicWaveCache.find((e=>{return e.phase===this._phase&&(t=e.partials,n=this._partials,t.length===n.length&&t.every(((e,t)=>n[t]===e)));var t,n}));return e}{const e=cc._periodicWaveCache.find((e=>e.type===this._type&&e.phase===this._phase));return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{const t=this._getCachedPeriodicWave();if(ms(t)){const{partials:e,wave:n}=t;this._wave=n,this._partials=e,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[t,n]=this._getRealImaginary(e,this._phase),r=this.context.createPeriodicWave(t,n);this._wave=r,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),cc._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:t,type:this._type,wave:this._wave}),cc._periodicWaveCache.length>100&&cc._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&"custom"!==this._type&&"custom"!==e?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Ss(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{const t=new Float32Array(e);this._partials.forEach(((e,n)=>t[n]=e)),this._partials=Array.from(t),this.type=this._type}}_getRealImaginary(e,t){let n=2048;const r=new Float32Array(n),o=new Float32Array(n);let a=1;if("custom"===e){if(a=this._partials.length+1,this._partialCount=this._partials.length,n=a,0===this._partials.length)return[r,o]}else{const t=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);t?(a=parseInt(t[2],10)+1,this._partialCount=parseInt(t[2],10),e=t[1],a=Math.max(a,2),n=a):this._partialCount=0,this._partials=[]}for(let s=1;s<n;++s){const n=2/(s*Math.PI);let i;switch(e){case"sine":i=s<=a?1:0,this._partials[s-1]=i;break;case"square":i=1&s?2*n:0,this._partials[s-1]=i;break;case"sawtooth":i=n*(1&s?1:-1),this._partials[s-1]=i;break;case"triangle":i=1&s?n*n*2*(s-1>>1&1?-1:1):0,this._partials[s-1]=i;break;case"custom":i=this._partials[s-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==i?(r[s]=-i*Math.sin(t*s),o[s]=i*Math.cos(t*s)):(r[s]=0,o[s]=0)}return[r,o]}_inverseFFT(e,t,n){let r=0;const o=e.length;for(let a=0;a<o;a++)r+=e[a]*Math.cos(a*n)+t[a]*Math.sin(a*n);return r}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const r=2*Math.PI;for(let o=0;o<32;o++)n=Math.max(this._inverseFFT(e,t,o/32*r),n);return Ys(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}cc._periodicWaveCache=[];class lc extends Zi{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new $i({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class uc extends Li{constructor(){const e=Ws(uc.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Pi({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Li.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class hc extends oc{constructor(){const e=Ws(hc.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new lc({context:this.context}),this._modulationNode=new Pi({context:this.context}),this._carrier=new cc({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new cc({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new uc({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ai(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(cc.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class dc extends oc{constructor(){const e=Ws(dc.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Pi({context:this.context,gain:0}),this._carrier=new cc({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Li({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new cc({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new uc({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new uc({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ai(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(cc.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class pc extends oc{constructor(){const e=Ws(pc.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Pi({context:this.context,gain:0}),this._thresh=new $i({context:this.context,mapping:e=>e<=0?-1:1}),this.width=new Li({context:this.context,units:"audioRange",value:e.width}),this._triangle=new cc({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ai(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(oc.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class fc extends oc{constructor(){const e=Ws(fc.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Li({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Li({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,ai(this,["frequency","detune"])}static getDefaults(){return Object.assign(cc.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach((t=>t.start(e)))}_stop(e){e=this.toSeconds(e),this._forEach((t=>t.stop(e)))}_restart(e){this._forEach((t=>t.restart(e)))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach((t=>t.type=e))}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach(((e,r)=>e.detune.value=t+n*r))}}get count(){return this._oscillators.length}set count(e){if(Ss(e,1),this._oscillators.length!==e){this._forEach((e=>e.dispose())),this._oscillators=[];for(let t=0;t<e;t++){const n=new cc({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:0===t?()=>this.onstop(this):ii});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,"started"===this.state&&this._forEach((e=>e.start()))}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach(((e,t)=>e.phase=this._phase+t/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach((t=>t.baseType=e)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach((t=>t.partials=e)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach((t=>t.partialCount=e)),this._type=this._oscillators[0].type}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((e=>e.dispose())),this}}class mc extends oc{constructor(){const e=Ws(mc.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new uc({context:this.context,value:2}),this._pulse=new pc({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new cc({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ai(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(oc.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const gc={am:hc,fat:fc,fm:dc,oscillator:cc,pulse:pc,pwm:mc};class yc extends oc{constructor(){const e=Ws(yc.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Li({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Li({context:this.context,units:"cents",value:e.detune}),ai(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(cc.getDefaults(),dc.getDefaults(),hc.getDefaults(),fc.getDefaults(),pc.getDefaults(),mc.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some((e=>this._sourceType===e))&&(e=this._sourceType),e+this._oscillator.type}set type(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=gc[e],n=this.now();if(this._oscillator){const e=this._oscillator;e.stop(n),this.context.setTimeout((()=>e.dispose()),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}_getOscType(e,t){return e instanceof gc[t]}get baseType(){return this._oscillator.baseType}set baseType(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===e||"pwm"===e||(this._oscillator.baseType=e)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(e){this._getOscType(this._oscillator,"fat")&&gs(e)&&(this._oscillator.count=e)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(e){this._getOscType(this._oscillator,"fat")&&gs(e)&&(this._oscillator.spread=e)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ws(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){return sc(e,t)}()}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function bc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;const n=new WeakMap;return function(r,o){Reflect.defineProperty(r,o,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){Ss(r,e,t),n.set(this,r)}})}}function vc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;const n=new WeakMap;return function(r,o){Reflect.defineProperty(r,o,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){Ss(this.toSeconds(r),e,t),n.set(this,r)}})}}class wc extends oc{constructor(){const e=Ws(wc.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new ci({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(oc.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ii,onerror:ii,playbackRate:1,reverse:!1})}load(e){return Ms(this,void 0,void 0,(function*(){return yield this._buffer.load(e),this._onload(),this}))}_onload(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ii)(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){t=this._loop?js(t,this._loopStart):js(t,0);const r=this.toSeconds(t),o=n;n=js(n,Math.max(this._buffer.duration-r,0));let a=this.toSeconds(n);a/=this._playbackRate,e=this.toSeconds(e);const s=new ac({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(s),this._loop&&fs(o)?s.start(e,r):s.start(e,r,a-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach((e=>e.stop(t)))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){var r;null===(r=[...this._activeSources].pop())||void 0===r||r.stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){const t=this.toSeconds(e);this._stop(n),this._start(n,t)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Ss(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopStart=e}))}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Ss(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopEnd=e}))}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((t=>{t.loop=e})),e)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((e=>e.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(e,t)}))}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((e=>e.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Os([vc(0)],wc.prototype,"fadeIn",void 0),Os([vc(0)],wc.prototype,"fadeOut",void 0);class xc extends Ai{constructor(){const e=Ws(xc.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Li({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Ai.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(ws(e))return e;{let n;for(n in kc)if(kc[n][t]===e)return n;return e}}_setCurve(e,t,n){if(ws(n)&&Reflect.has(kc,n)){const r=kc[n];ys(r)?"_decayCurve"!==e&&(this[e]=r[t]):this[e]=r}else{if(!vs(n)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+n);this[e]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.log("triggerAttack",e,t),e=this.toSeconds(e);let n=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){n=(1-o)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,n,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,n,e);else{this._sig.cancelAndHoldAtTime(e);let r=this._attackCurve;for(let e=1;e<r.length;e++)if(r[e-1]<=o&&o<=r[e]){r=this._attackCurve.slice(e),r[0]=o;break}this._sig.setValueCurveAtTime(r,e,n,t)}if(r&&this.sustain<1){const o=t*this.sustain,a=e+n;this.log("decay",a),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(o,r+a):this._sig.exponentialApproachValueAtTime(o,a,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,e):(ks(vs(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e){return zi(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),this}asArray(){return Ms(this,arguments,void 0,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return function*(){const n=t/e.context.sampleRate,r=new li(1,n,e.context.sampleRate),o=e.toSeconds(e.attack)+e.toSeconds(e.decay),a=o+e.toSeconds(e.release),s=.1*a,i=a+s,c=new e.constructor(Object.assign(e.get(),{attack:n*e.toSeconds(e.attack)/i,decay:n*e.toSeconds(e.decay)/i,release:n*e.toSeconds(e.release)/i,context:r}));c._sig.toDestination(),c.triggerAttackRelease(n*(o+s)/i,0);return(yield r.render()).getChannelData(0)}()}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Os([vc(0)],xc.prototype,"attack",void 0),Os([vc(0)],xc.prototype,"decay",void 0),Os([bc(0,1)],xc.prototype,"sustain",void 0),Os([vc(0)],xc.prototype,"release",void 0);const kc=(()=>{const e=128;let t,n;const r=[];for(t=0;t<e;t++)r[t]=Math.sin(t/127*(Math.PI/2));const o=[];for(t=0;t<127;t++){n=t/127;const e=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;o[t]=e/10+.83*n}o[127]=1;const a=[];for(t=0;t<e;t++)a[t]=Math.ceil(t/127*5)/5;const s=[];for(t=0;t<e;t++)n=t/127,s[t]=.5*(1-Math.cos(Math.PI*n));const i=[];for(t=0;t<e;t++){n=t/127;const e=4*Math.pow(n,3)+.2,r=Math.cos(e*Math.PI*2*n);i[t]=Math.abs(r*(1-n))}function c(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=1-e[n];return t}return{bounce:{In:c(i),Out:i},cosine:{In:r,Out:(l=r,l.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:o,Out:c(o)},sine:{In:s,Out:c(s)},step:{In:a,Out:c(a)}};var l})();class Sc extends Ai{constructor(){const e=Ws(Sc.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=e=>this._original_triggerRelease(e),this._volume=this.output=new Vi({context:this.context,volume:e.volume}),this.volume=this._volume.volume,ai(this,"volume")}static getDefaults(){return Object.assign(Ai.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){var n=this;const r=this["_original_"+e]=this[e];this[e]=function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];const s=o[t],i=n.context.transport.schedule((e=>{o[t]=e,r.apply(n,o)}),s);n._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((e=>this.context.transport.clear(e))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,n,r){const o=this.toSeconds(n),a=this.toSeconds(t);return this.triggerAttack(e,o,r),this.triggerRelease(o+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class _c extends Sc{constructor(){const e=Ws(_c.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Sc.getDefaults(),{detune:0,onsilence:ii,portamento:0})}triggerAttack(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.log("triggerAttack",e,t,n);const r=this.toSeconds(t);return this._triggerEnvelopeAttack(r,n),this.setNote(e,r),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),r=e instanceof Si?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const e=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,e,n)}else this.frequency.setValueAtTime(r,n);return this}}Os([vc(0)],_c.prototype,"portamento",void 0);class Cc extends xc{constructor(){super(Ws(Cc.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Pi({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ic extends _c{constructor(){const e=Ws(Ic.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new yc(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Cc(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),ai(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(_c.getDefaults(),{envelope:Object.assign(Vs(xc.getDefaults(),Object.keys(Ai.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Vs(yc.getDefaults(),[...Object.keys(oc.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){const t=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+t+n)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Tc extends Ic{constructor(){const e=Ws(Tc.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,ai(this,["oscillator","envelope"])}static getDefaults(){return qs(_c.getDefaults(),Ic.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),r=this.toFrequency(e instanceof Si?e.toFrequency():e),o=r*this.octaves;return this.oscillator.frequency.setValueAtTime(o,n),this.oscillator.frequency.exponentialRampToValueAtTime(r,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Os([bc(0)],Tc.prototype,"octaves",void 0),Os([vc(0)],Tc.prototype,"pitchDecay",void 0);const Nc=new Set;function Ec(e){Nc.add(e)}function Ac(e,t){const n='registerProcessor("'.concat(e,'", ').concat(t,")");Nc.add(n)}Ec('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Ec("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Ec("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");const Rc="feedback-comb-filter";Ac(Rc,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Oc extends Sc{constructor(){const e=Ws(Oc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach((n=>{const r=parseInt(n,10);if(ks(xs(n)||gs(r)&&isFinite(r),"url key is neither a note or midi pitch: ".concat(n)),xs(n)){const r=new Si(this.context,n).toMidi();t[r]=e.urls[n]}else gs(r)&&isFinite(r)&&(t[r]=e.urls[r])})),this._buffers=new Hi({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Sc.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ii,onerror:ii,release:.1,urls:{}})}_findClosest(e){let t=0;for(;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error("No available buffers for note: ".concat(e))}triggerAttack(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach((e=>{const r=vi(new Si(this.context,e).toFrequency()),o=Math.round(r),a=r-o,s=this._findClosest(o),i=o-s,c=this._buffers.get(i),l=gi(s+a),u=new ac({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:l}).connect(this.output);u.start(t,0,c.duration/l,n),vs(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const e=this._activeSources.get(o),t=e.indexOf(u);-1!==t&&e.splice(t,1)}}})),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((e=>{const n=new Si(this.context,e).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const e=this._activeSources.get(n);t=this.toSeconds(t),e.forEach((e=>{e.stop(t)})),this._activeSources.set(n,[])}})),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach((e=>{for(;e.length;){e.shift().stop(t)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const o=this.toSeconds(n);return this.triggerAttack(e,o,r),vs(t)?(ks(vs(e),"notes must be an array when duration is array"),e.forEach(((e,n)=>{const r=t[Math.min(n,t.length-1)];this.triggerRelease(e,o+this.toSeconds(r))}))):this.triggerRelease(e,o+this.toSeconds(t)),this}add(e,t,n){if(ks(xs(e)||isFinite(e),"note must be a pitch or midi: ".concat(e)),xs(e)){const r=new Si(this.context,e).toMidi();this._buffers.add(r,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((e=>{e.forEach((e=>e.dispose()))})),this._activeSources.clear(),this}}Os([vc(0)],Oc.prototype,"attack",void 0),Os([vc(0)],Oc.prototype,"release",void 0);class Mc extends Ai{constructor(){const e=Ws(Mc.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Ei({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",ai(this,"pan")}static getDefaults(){return Object.assign(Ai.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Pc="bit-crusher";Ac(Pc,"\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Dc extends Ai{constructor(){const e=Ws(Dc.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Pi({context:this.context}),Dc._allSolos.has(this.context)||Dc._allSolos.set(this.context,new Set),Dc._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Ai.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Dc._allSolos.get(this.context).forEach((e=>e._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){Dc._soloed.has(this.context)||Dc._soloed.set(this.context,new Set),Dc._soloed.get(this.context).add(this)}_removeSolo(){Dc._soloed.has(this.context)&&Dc._soloed.get(this.context).delete(this)}_isSoloed(){return Dc._soloed.has(this.context)&&Dc._soloed.get(this.context).has(this)}_noSolos(){return!Dc._soloed.has(this.context)||Dc._soloed.has(this.context)&&0===Dc._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Dc._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Dc._allSolos=new Map,Dc._soloed=new Map;class Fc extends Ai{constructor(){const e=Ws(Fc.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new Mc({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Vi({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,ai(this,["pan","volume"])}static getDefaults(){return Object.assign(Ai.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Lc extends Ai{constructor(){const e=Ws(Lc.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new Dc({solo:e.solo,context:this.context}),this._panVol=this.output=new Fc({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ai(this,["pan","volume"])}static getDefaults(){return Object.assign(Ai.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Lc.buses.has(e)||Lc.buses.set(e,new Pi({context:this.context})),Lc.buses.get(e)}send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this._getBus(e),r=new Pi({context:this.context,units:"decibels",gain:t});return this.connect(r),r.connect(n),r}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Lc.buses=new Map;const zc=di().transport;di().destination,di().destination;di().listener;const Bc=di().draw;di();const qc=new class{constructor(){this.isPlaying=!1,this.bpm=120,this.transport=zc,this.sequences=[],this.instruments={},this.initialized=!1,this.playbackPosition={blockIndex:0,stepIndex:0},this.totalDuration=0,this.onPositionChange=null,this.onPrerollStart=null,this.onPrerollBeat=null,this.onPrerollCancel=null,this.loopedOriginalIndices=[],this.mutedTracks=new Set,this.isMetronomeEnabled=!1,this.metronomeSynth=null,this.accentMetronomeSynth=null,this.prerollSynths=null,this.prerollTimeouts=[],this.isPrerollActive=!1,this.currentSequencerStructure=null,this.currentTrackNames=null,this.currentCellsState=null,this.currentBarBlockMapping=null,this.effectiveSequencerStructure=[],this.originalIndexMapping=[],this.transport.bpm.value=this.bpm}async initialize(){if(this.initialized)return!0;const e=Object.entries(Ct).map((e=>{let[t,n]=e;return new Promise((e=>{const r=n.urls||{C4:"default.mp3"},o=n.baseUrl||"./samples/",a=new Oc({urls:r,baseUrl:o,onload:()=>{"number"===typeof n.volume&&(a.volume.value=n.volume),this.instruments[t]=a,e()}}).toDestination()}))}));return await Promise.all(e),this.initialized=!0,!0}getInstrument(e){return this.instruments[e]||null}setBPM(e){this.bpm=e,this.transport.bpm.value=e}setLoopedBlocks(e){this.loopedOriginalIndices=Array.isArray(e)?[...e]:[],console.log("AudioEngine: Looped blocks set to indices:",this.loopedOriginalIndices)}clearLoopedBlocks(){this.loopedOriginalIndices=[],console.log("AudioEngine: Looped blocks cleared.")}setMutedTracks(e){this.mutedTracks=new Set(e),console.log("AudioEngine: Muted tracks updated:",Array.from(this.mutedTracks))}setPositionCallback(e){this.onPositionChange=e}setPrerollStartCallback(e){this.onPrerollStart=e}setPrerollBeatCallback(e){this.onPrerollBeat=e}setPrerollCancelCallback(e){this.onPrerollCancel=e}setMetronomeEnabled(e){if(this.isMetronomeEnabled!==e)if(this.isMetronomeEnabled=e,console.log("[AudioEngine] Metronome ".concat(e?"enabled":"disabled",".")),e?(this.metronomeSynth||(this.metronomeSynth=new Tc({pitchDecay:.01,octaves:1,oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.05}}).toDestination(),this.metronomeSynth.volume.value=-20),this.accentMetronomeSynth||(this.accentMetronomeSynth=new Tc({pitchDecay:.01,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.15,sustain:0,release:.05}}).toDestination(),this.accentMetronomeSynth.volume.value=-14)):(this.metronomeSynth&&(this.metronomeSynth.dispose(),this.metronomeSynth=null),this.accentMetronomeSynth&&(this.accentMetronomeSynth.dispose(),this.accentMetronomeSynth=null)),this.initialized&&this.currentSequencerStructure&&this.currentTrackNames&&this.currentCellsState&&this.currentBarBlockMapping){console.log("[AudioEngine] Re-preparing sequencer due to metronome state change.");let e=0;this.isPlaying&&(e=this.getCurrentTransportTime()),this.prepareSequencer(this.currentSequencerStructure,this.currentTrackNames,this.currentCellsState,this.currentBarBlockMapping)}else console.log("[AudioEngine] Skipping re-prepare for metronome (missing data or not initialized).")}prepareSequencer(e,t,n,r){if(this.currentSequencerStructure=e,this.currentTrackNames=t,this.currentCellsState=n,this.currentBarBlockMapping=r,this.transport.cancel(),this.bpm<=0)return console.warn("AudioEngine: BPM is not positive. Timing calculations might be incorrect."),!1;const o=function(e,t){return new ki(di(),e,t)}("4n").toSeconds();if(o<=0||!isFinite(o))return console.warn("AudioEngine: Calculated quarterNoteSecs is invalid. BPM:",this.bpm),!1;this.effectiveSequencerStructure=[],this.originalIndexMapping=[];const a=e.length;if(this.loopedOriginalIndices.length>0&&a>0?(console.log("AudioEngine: Building effective structure from looped indices: [".concat(this.loopedOriginalIndices.join(", "),"]")),this.loopedOriginalIndices.forEach((t=>{t>=0&&t<a?(this.effectiveSequencerStructure.push(e[t]),this.originalIndexMapping.push(t)):console.warn("AudioEngine: Invalid index ".concat(t," found in loopedOriginalIndices. Skipping."))})),this.effectiveSequencerStructure.length>0?console.log("AudioEngine: Effective loop structure created. Original indices in order: [".concat(this.originalIndexMapping.join(", "),"]. Total effective blocks: ").concat(this.effectiveSequencerStructure.length)):console.warn("AudioEngine: Effective loop structure is empty after processing looped indices.")):(this.effectiveSequencerStructure=[...e],this.originalIndexMapping=e.map(((e,t)=>t)),a>0&&console.log("AudioEngine: Full sequence mode. Total effective blocks: ",this.effectiveSequencerStructure.length)),0===this.effectiveSequencerStructure.length)return console.warn("AudioEngine: Effective sequencer structure is empty. No events will be scheduled."),this.transport.loopEnd=0,!1;const s=new Set;r&&"object"===typeof r?Object.values(r).forEach((e=>{Array.isArray(e)&&e.length>0&&s.add(e[0])})):console.warn("[AudioEngine] barBlockMapping is missing or invalid. Metronome accentuation might be incorrect."),this.isMetronomeEnabled&&this.metronomeSynth&&this.accentMetronomeSynth?(console.log("[AudioEngine] Scheduling metronome clicks."),this.effectiveSequencerStructure.forEach(((e,t)=>{const n=this.originalIndexMapping[t],r=t*o,a=s.has(n);this.transport.schedule((e=>{(a?this.accentMetronomeSynth:this.metronomeSynth).triggerAttackRelease("C5","64n",e)}),r)}))):this.isMetronomeEnabled&&console.warn("[AudioEngine] Metronome is enabled, but synths are not ready. Skipping scheduling."),this.effectiveSequencerStructure.forEach(((e,r)=>{if(!e||!e.trackSteps)return;const a=this.originalIndexMapping[r];t.forEach((t=>{const s=e.trackSteps[t];if(!s||"number"!==typeof s||s<=0)return;if(this.mutedTracks.has(t))return;const i=1/s*o;for(let e=0;e<s;e++){const c="".concat(a,"-").concat(t,"-").concat(e),l=n[c];if(l&&l.instrumentId){const t=(r+e/s)*o;this.transport.schedule((e=>{const t=this.getInstrument(l.instrumentId);t&&t.triggerAttackRelease("C4",i,e)}),t)}}}));let s=0;Object.values(e.trackSteps).forEach((e=>{"number"===typeof e&&e>s&&(s=e)})),0===s&&Object.keys(e.trackSteps).length>0&&(s=1);for(let n=0;n<s;n++){const i=(r+n/s)*o;this.transport.schedule((r=>{let o=!1;t.forEach((t=>{!this.mutedTracks.has(t)&&e.trackSteps[t]>=s&&(o=!0)})),this.onPositionChange&&o&&(this.playbackPosition={blockIndex:a,stepIndex:n},this.onPositionChange(this.playbackPosition))}),i)}})),this.transport.loop=!0,this.transport.loopStart=0;const i=this.effectiveSequencerStructure.length*o;return this.transport.loopEnd=i,this.loopedOriginalIndices.length>0&&this.effectiveSequencerStructure.length>0?console.log("AudioEngine: Loop set from effective 0s to ".concat(i.toFixed(2),"s (orig. blocks in order: [").concat(this.originalIndexMapping.join(", "),"])")):console.log("AudioEngine: Full sequence loop from 0s to ".concat(i.toFixed(2),"s")),!0}async play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.transport.loopStart;this.initialized||await this.initialize(),await pi();const t="number"===typeof e&&isFinite(e)?e:this.transport.loopStart;return this.loopedOriginalIndices.length>0&&this.effectiveSequencerStructure.length>0?console.log("AudioEngine: \u0417\u0430\u043f\u0443\u0441\u043a \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0439 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 (Originals: ".concat(this.originalIndexMapping.join(", "),"). Start time: ").concat(t.toFixed(2),"s")):console.log("AudioEngine: \u0417\u0430\u043f\u0443\u0441\u043a \u0432\u043e\u0441\u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u043d\u043e\u0439 \u0441\u0435\u043a\u0432\u0435\u043d\u0446\u0438\u0438. Start time: ".concat(t.toFixed(2),"s")),this.transport.start(void 0,t),this.isPlaying=!0,!0}stop(){return this.transport.stop(),this.isPlaying=!1,this.onPositionChange&&(this.playbackPosition=null,this.onPositionChange(null)),!0}async togglePlay(){return this.isPlaying?this.stop():await this.play(),this.isPlaying}getPlaybackPosition(){return this.playbackPosition}getCurrentTransportTime(){return this.transport.seconds}async startPreroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.initialized||await this.initialize(),await pi(),this.isPrerollActive=!0,this.prerollTimeouts.forEach((e=>clearTimeout(e))),this.prerollTimeouts=[],this.prerollSynths&&(this.prerollSynths.clickSynth&&this.prerollSynths.clickSynth.dispose(),this.prerollSynths.accentSynth&&this.prerollSynths.accentSynth.dispose());const n=new Tc({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.3,sustain:0,release:.1}}).toDestination();n.volume.value=-10;const r=new Tc({pitchDecay:.008,octaves:3,oscillator:{type:"sine"},envelope:{attack:.001,decay:.3,sustain:0,release:.1}}).toDestination();r.volume.value=-6,this.prerollSynths={clickSynth:n,accentSynth:r};const o=60/this.bpm;for(let s=0;s<e;s++){const t=di().now()+s*o;0===s?r.triggerAttackRelease("C3","16n",t):n.triggerAttackRelease("C4","16n",t),this.onPrerollBeat&&Bc.schedule((()=>{this.onPrerollBeat(s,e)}),t)}const a=setTimeout((()=>{this.isPrerollActive=!1,this.prerollSynths&&(this.prerollSynths.clickSynth&&this.prerollSynths.clickSynth.dispose(),this.prerollSynths.accentSynth&&this.prerollSynths.accentSynth.dispose(),this.prerollSynths=null),this.onPositionChange&&this.onPositionChange(null),t&&t()}),e*o*1e3);return this.prerollTimeouts.push(a),this.onPrerollStart&&this.onPrerollStart(e),!0}cancelPreroll(){return!!this.isPrerollActive&&(console.log("AudioEngine: \u041e\u0442\u043c\u0435\u043d\u0430 \u043f\u0440\u0435\u0440\u043e\u043b\u043b\u0430"),this.prerollTimeouts.forEach((e=>clearTimeout(e))),this.prerollTimeouts=[],this.prerollSynths&&(this.prerollSynths.clickSynth&&this.prerollSynths.clickSynth.dispose(),this.prerollSynths.accentSynth&&this.prerollSynths.accentSynth.dispose(),this.prerollSynths=null),this.isPrerollActive=!1,this.onPrerollCancel&&this.onPrerollCancel(),!0)}},Wc=qc,jc=e=>{let{blocks:t,trackNames:n,cellsState:r,currentPlaybackPosition:a,handleCellClick:s,loopedBlockIndices:i,mutedTracks:c,handleMuteToggle:l}=e;const u=(0,o.useRef)([]),[d,p]=(0,o.useState)(0),[f,m]=(0,o.useState)(null),[g,y]=(0,o.useState)(null),[b,v]=(0,o.useState)("top");(0,o.useEffect)((()=>{let e=[];i&&i.length>0?(console.log("VerticalView: Building sequence from looped indices:",i),i.forEach(((n,r)=>{t&&n>=0&&n<t.length?e.push(h(h({},t[n]),{},{originalIndex:n,sequenceIndex:r})):console.warn("VerticalView: Invalid originalIndex ".concat(n," from loop list."))})),console.log("VerticalView: Effective loop sequence:",e)):t&&t.length>0&&(console.log("VerticalView: Building full sequence."),e=t.map(((e,t)=>h(h({},e),{},{originalIndex:void 0!==e.originalIndex?e.originalIndex:t,sequenceIndex:t})))),u.current=e,e.length>0?(m(e[0]),y(e.length>1?e[1]:e[0]),p(0),v("top")):(m(null),y(null))}),[t,i]),(0,o.useEffect)((()=>{if(!a||!u.current.length)return;const e=u.current.findIndex((e=>e.originalIndex===a.blockIndex));if(-1!==e&&e!==d){p(e);const t=e%2===0?"top":"bottom";if(v(t),"top"===t){m(u.current[e]);const t=(e+1)%u.current.length;y(u.current[t])}else{y(u.current[e]);const t=(e+1)%u.current.length;m(u.current[t])}}}),[a,d]);const w=(e,t,n)=>{const o="".concat(e,"-").concat(t,"-").concat(n);return r[o]||{instrumentId:null}};if(!f||!g)return(0,St.jsx)("div",{className:"vertical-view-loading",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."});const x=e=>e===b,k=e=>{switch(e.toLowerCase()){case"lf":return"#3fc73f";case"rf":return"#f44336";case"l":return"#29b6f6";case"r":return"#ff9800";default:return"#9c27b0"}},S=e=>{const t={lf:0,rf:1,l:2,r:3};return[...e].sort(((e,n)=>(void 0!==t[e.toLowerCase()]?t[e.toLowerCase()]:999)-(void 0!==t[n.toLowerCase()]?t[n.toLowerCase()]:999)))};return(0,St.jsxs)("div",{className:"vertical-view-container",children:[a&&(0,St.jsx)("div",{className:"vertical-progress-bar",children:(0,St.jsx)("div",{className:"vertical-progress-indicator",style:{width:"".concat((()=>{if(!a||!u.current||0===u.current.length)return 0;const e=u.current.findIndex((e=>e.originalIndex===a.blockIndex));if(-1===e)return 0;let t=0,n=0;return u.current.forEach(((r,o)=>{const s=(e=>Math.max(...Object.values(e.trackSteps||{}))||1)(r);t+=s,o<e?n+=s:o===e&&(n+=a.stepIndex)})),0===t?0:n/t*100})(),"%")}})}),(0,St.jsx)("div",{className:"vertical-header",children:S(n).map((e=>(0,St.jsx)("div",{className:"vertical-track-label ".concat(c instanceof Set&&c.has(e)?"muted":""),style:{backgroundColor:c instanceof Set&&c.has(e)?"transparent":k(e)},onClick:()=>{"function"===typeof l?l(e):console.error("VerticalView Error: handleMuteToggle is not a function when clicking label!",l)},children:e.toUpperCase()},"header-".concat(e))))}),(0,St.jsxs)("div",{className:"vertical-blocks-container",children:[(0,St.jsxs)("div",{className:"vertical-block ".concat(x("top")?"active-block":"inactive-block"),children:[(0,St.jsx)("div",{className:"block-number",children:f.sequenceIndex+1}),(0,St.jsx)("div",{className:"vertical-grid",children:S(n).map((e=>(0,St.jsx)("div",{className:"vertical-track-column ".concat(c instanceof Set&&c.has(e)?"muted":""),children:Array.from({length:f.trackSteps[e]},((t,n)=>{const r=void 0!==f.originalIndex?f.originalIndex:f.sequenceIndex,o="".concat(r,"-").concat(e,"-").concat(n),i=!!w(r,e,n).instrumentId;let l="";return a&&x("top")&&a.stepIndex===n&&!(c instanceof Set&&c.has(e))&&(l=i?"playing-active":"playing-empty"),(0,St.jsx)("div",{className:"vertical-grid-cell ".concat(i?"active":""," ").concat(l),onClick:()=>s(o),"data-cell-id":o,children:i&&(0,St.jsx)("div",{className:"cell-instrument-marker",style:{backgroundColor:k(e)}})},"top-".concat(o))}))},"top-".concat(e))))})]}),(0,St.jsxs)("div",{className:"vertical-block ".concat(x("bottom")?"active-block":"inactive-block"),children:[(0,St.jsx)("div",{className:"block-number",children:g.sequenceIndex+1}),(0,St.jsx)("div",{className:"vertical-grid",children:S(n).map((e=>(0,St.jsx)("div",{className:"vertical-track-column ".concat(c instanceof Set&&c.has(e)?"muted":""),children:Array.from({length:g.trackSteps[e]},((t,n)=>{const r=void 0!==g.originalIndex?g.originalIndex:g.sequenceIndex,o="".concat(r,"-").concat(e,"-").concat(n),i=!!w(r,e,n).instrumentId;let l="";return a&&x("bottom")&&a.stepIndex===n&&!(c instanceof Set&&c.has(e))&&(l=i?"playing-active":"playing-empty"),(0,St.jsx)("div",{className:"vertical-grid-cell ".concat(i?"active":""," ").concat(l),onClick:()=>s(o),"data-cell-id":o,children:i&&(0,St.jsx)("div",{className:"cell-instrument-marker",style:{backgroundColor:k(e)}})},"bottom-".concat(o))}))},"bottom-".concat(e))))})]})]})]})},Vc=e=>{let{isActive:t,blocks:n,trackNames:r,cellsState:o,currentPlaybackPosition:a,handleCellClick:s,currentBar:i,totalBars:c,onBarChange:l,currentBarInfo:u,sequencerStructure:h,onVerticalModeChange:d,isPlaying:p,bpm:f,isInitialized:m,isPrerollEnabled:g,isTransitioning:y,onPlayToggle:b,onBpmChange:v,onPrerollToggle:w,loopedBlockIndices:x,mutedTracks:k,handleMuteToggle:S}=e;if(!t)return null;return(0,St.jsxs)("div",{className:"vertical-view-overlay",children:[(0,St.jsx)("div",{className:"vertical-mode-toggle",children:(0,St.jsx)("button",{className:"vertical-mode-close-btn",onClick:()=>{d&&d("horizontal")},children:(0,St.jsx)("span",{children:"\u2715"})})}),(0,St.jsx)("div",{className:"vertical-view-content",children:(0,St.jsx)(jc,{blocks:n,trackNames:r,cellsState:o,currentPlaybackPosition:a,handleCellClick:s,loopedBlockIndices:x,mutedTracks:k,handleMuteToggle:S})}),(0,St.jsx)("div",{className:"vertical-view-player-menu",children:(0,St.jsx)(Nt,{sequencerStructure:h,trackNames:r,cellsState:o,currentBar:i,totalBars:c,onBarChange:l,currentBarInfo:u,onVerticalModeChange:d,inVerticalMode:!0,isPlaying:p,bpm:f,isInitialized:m,isPrerollEnabled:g,isTransitioning:y,onPlayToggle:b,onBpmChange:v,onPrerollToggle:w,loopedBlockIndices:x,mutedTracks:k,handleMuteToggle:S})})]})},Uc=()=>{const[e,t]=(0,o.useState)(!1),[n,r]=(0,o.useState)(!1),[a,s]=(0,o.useState)(0),[i,c]=(0,o.useState)(null);(0,o.useEffect)((()=>(Wc.setPrerollStartCallback((e=>{s(e),c(null),t(!0)})),Wc.setPrerollBeatCallback(((e,t)=>{c(e),e===t-1&&setTimeout((()=>{l()}),200)})),Wc.setPrerollCancelCallback((()=>{l()})),()=>{Wc.setPrerollStartCallback(null),Wc.setPrerollBeatCallback(null),Wc.setPrerollCancelCallback(null)})),[]);const l=()=>{r(!0),setTimeout((()=>{t(!1),r(!1)}),300)};if(!e)return null;const u=null!==i?i+1:"\u2022";return(0,St.jsx)("div",{className:"preroll-overlay ".concat(n?"fading-out":""),onClick:()=>{Wc.cancelPreroll(),l()},children:(0,St.jsxs)("div",{className:"preroll-content",children:[(0,St.jsx)("div",{className:"preroll-counter ".concat(null!==i?"animate":""),children:u}),(0,St.jsx)("div",{className:"preroll-progress",children:Array.from({length:a}).map(((e,t)=>(0,St.jsx)("div",{className:"progress-dot ".concat(t===i?"active":""," ").concat(t<i?"passed":"")},t)))})]})})};class Gc{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Hc{decComplexRef(e){}time(e){return Kc("time")}read(e){return Kc("read")}readSync(e){return Kc("readSync")}numDataIds(){return Kc("numDataIds")}disposeData(e){return Kc("disposeData")}write(e,t,n){return Kc("write")}move(e,t,n,r){return Kc("move")}memory(){return Kc("memory")}floatPrecision(){return Kc("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}batchMatMul(e,t,n,r){return Kc("batchMatMul")}fusedBatchMatMul(e){let{a:t,b:n,transposeA:r,transposeB:o,bias:a,activation:s,preluActivationWeights:i}=e;return Kc("fusedBatchMatMul")}slice(e,t,n){return Kc("slice")}stridedSlice(e,t,n,r){return Kc("stridedSlice")}unstack(e,t){return Kc("unstack")}reverse(e,t){return Kc("reverse")}concat(e,t){return Kc("concat")}neg(e){return Kc("neg")}add(e,t){return Kc("add")}addN(e){return Kc("addN")}subtract(e,t){return Kc("subtract")}multiply(e,t){return Kc("multiply")}realDivide(e,t){return Kc("realDivide")}floorDiv(e,t){return Kc("floorDiv")}sum(e,t){return Kc("sum")}prod(e,t){return Kc("prod")}unsortedSegmentSum(e,t,n){return Kc("unsortedSegmentSum")}argMin(e,t){return Kc("argMin")}argMax(e,t){return Kc("argMax")}equal(e,t){return Kc("equal")}notEqual(e,t){return Kc("notEqual")}less(e,t){return Kc("less")}lessEqual(e,t){return Kc("lessEqual")}greater(e,t){return Kc("greater")}greaterEqual(e,t){return Kc("greaterEqual")}logicalNot(e){return Kc("logicalNot")}logicalAnd(e,t){return Kc("logicalAnd")}logicalOr(e,t){return Kc("logicalOr")}where(e){return Kc("where")}select(e,t,n){return Kc("select")}topk(e,t,n){return Kc("topk")}min(e,t){return Kc("min")}minimum(e,t){return Kc("minimum")}mod(e,t){return Kc("mod")}max(e,t){return Kc("max")}maximum(e,t){return Kc("maximum")}all(e,t){return Kc("all")}any(e,t){return Kc("any")}squaredDifference(e,t){return Kc("squaredDifference")}ceil(e){return Kc("ceil")}floor(e){return Kc("floor")}round(e){return Kc("round")}sign(e){return Kc("sign")}isNaN(e){return Kc("isNaN")}isInf(e){return Kc("isInf")}isFinite(e){return Kc("isFinite")}pow(e,t){return Kc("pow")}exp(e){return Kc("exp")}expm1(e){return Kc("expm1")}softmax(e,t){return Kc("softmax")}log(e){return Kc("log")}log1p(e){return Kc("log1p")}sqrt(e){return Kc("sqrt")}rsqrt(e){return Kc("rsqrt")}square(e){return Kc("square")}reciprocal(e){return Kc("reciprocal")}relu(e){return Kc("relu")}relu6(e){return Kc("relu6")}prelu(e,t){return Kc("prelu")}elu(e){return Kc("elu")}eluDer(e,t){return Kc("eluDer")}selu(e){return Kc("selu")}int(e){return Kc("int")}clip(e,t,n){return Kc("clip")}abs(e){return Kc("abs")}complexAbs(e){return Kc("complexAbs")}sigmoid(e){return Kc("sigmoid")}softplus(e){return Kc("softplus")}sin(e){return Kc("sin")}cos(e){return Kc("cos")}tan(e){return Kc("tan")}asin(e){return Kc("asin")}acos(e){return Kc("acos")}atan(e){return Kc("atan")}atan2(e,t){return Kc("atan2")}sinh(e){return Kc("sinh")}cosh(e){return Kc("cosh")}tanh(e){return Kc("tanh")}asinh(e){return Kc("asinh")}acosh(e){return Kc("acosh")}atanh(e){return Kc("atanh")}erf(e){return Kc("erf")}step(e,t){return Kc("step")}fusedConv2d(e){let{input:t,filter:n,convInfo:r,bias:o,activation:a,preluActivationWeights:s}=e;return Kc("fusedConv2d")}conv2d(e,t,n){return Kc("conv2d")}conv2dDerInput(e,t,n){return Kc("conv2dDerInput")}conv2dDerFilter(e,t,n){return Kc("conv2dDerFilter")}fusedDepthwiseConv2D(e){let{input:t,filter:n,convInfo:r,bias:o,activation:a,preluActivationWeights:s}=e;return Kc("fusedDepthwiseConv2D")}depthwiseConv2D(e,t,n){return Kc("depthwiseConv2D")}depthwiseConv2DDerInput(e,t,n){return Kc("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(e,t,n){return Kc("depthwiseConv2DDerFilter")}conv3d(e,t,n){return Kc("conv3d")}conv3dDerInput(e,t,n){return Kc("conv3dDerInput")}conv3dDerFilter(e,t,n){return Kc("conv3dDerFilter")}maxPool(e,t){return Kc("maxPool")}maxPoolBackprop(e,t,n,r){return Kc("maxPoolBackprop")}avgPool(e,t){return Kc("avgPool")}avgPoolBackprop(e,t,n){return Kc("avgPoolBackprop")}avgPool3d(e,t){return Kc("avgPool3d")}avgPool3dBackprop(e,t,n){return Kc("avgPool3dBackprop")}maxPool3d(e,t){return Kc("maxPool3d")}maxPool3dBackprop(e,t,n,r){return Kc("maxPool3dBackprop")}reshape(e,t){return Kc("reshape")}cast(e,t){return Kc("cast")}tile(e,t){return Kc("tile")}pad(e,t,n){return Kc("pad")}transpose(e,t){return Kc("transpose")}gather(e,t,n){return Kc("gather")}gatherND(e,t){return Kc("gatherND")}scatterND(e,t,n){return Kc("scatterND")}batchToSpaceND(e,t,n){return Kc("batchToSpaceND")}spaceToBatchND(e,t,n){return Kc("spaceToBatchND")}resizeBilinear(e,t,n,r,o){return Kc("resizeBilinear")}resizeBilinearBackprop(e,t,n){return Kc("resizeBilinearBackprop")}resizeNearestNeighbor(e,t,n,r,o){return Kc("resizeNearestNeighbor")}resizeNearestNeighborBackprop(e,t,n){return Kc("resizeNearestNeighborBackprop")}batchNorm(e,t,n,r,o,a){return Kc("batchNorm")}localResponseNormalization4D(e,t,n,r,o){return Kc("localResponseNormalization4D")}LRNGrad(e,t,n,r,o,a,s){return Kc("LRNGrad")}multinomial(e,t,n,r){return Kc("multinomial")}oneHot(e,t,n,r){return Kc("oneHot")}cumsum(e,t,n,r){return Kc("cumsum")}nonMaxSuppression(e,t,n,r,o){return Kc("nonMaxSuppression")}fft(e){return Kc("fft")}ifft(e){return Kc("ifft")}complex(e,t){return Kc("complex")}real(e){return Kc("real")}imag(e){return Kc("imag")}cropAndResize(e,t,n,r,o,a){return Kc("cropAndResize")}depthToSpace(e,t,n){return Kc("depthToSpace")}split(e,t,n){return Kc("split")}sparseToDense(e,t,n,r){return Kc("sparseToDense")}diag(e){return Kc("diag")}fill(e,t,n){return Kc("fill")}onesLike(e){return Kc("onesLike")}zerosLike(e){return Kc("zerosLike")}linspace(e,t,n){return Kc("linspace")}dispose(){return Kc("dispose")}}function Kc(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Xc(e){let t=e.length,n=0,r=0;for(;t>0;)r=Math.random()*t|0,t--,n=e[t],e[t]=e[r],e[r]=n}function Qc(e,t,n){return Math.max(e,Math.min(t,n))}function Yc(e){return e%2===0?e:e+1}function Jc(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function Zc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Jc(nl(e,t),(()=>n+" Shapes ".concat(e," and ").concat(t," must match")))}function $c(e){Jc(null!=e,(()=>"The input to the tensor constructor must be a non-null value."))}function el(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||pl(e)&&!n)for(let r=0;r<e.length;++r)el(e[r],t,n);else t.push(e);return t}function tl(e){if(0===e.length)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function nl(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function rl(e){return e%1===0}function ol(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function al(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function sl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>0,n=arguments.length>2?arguments[2]:void 0;return new Promise(((r,o)=>{let a=0;const s=()=>{if(e())return void r();a++;const i=t(a);null!=n&&a>=n?o():setTimeout(s,i)};s()}))}function il(e,t){let n=1,r=-1;for(let a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));const o=e.slice();return o[r]=t/n,o}function cl(e,t){const n=t.length;return e=null==e?t.map(((e,t)=>t)):[].concat(e),Jc(e.every((e=>e>=-n&&e<n)),(()=>"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e))),Jc(e.every((e=>rl(e))),(()=>"All values in axis param must be integers but "+"got axis ".concat(e))),e.map((e=>e<0?n+e:e))}function ll(e,t){const n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||o?null:cl(t,e).sort();let s=0;for(let i=0;i<e.length;++i){if(null!=a){if(a[s]===i&&1!==e[i])throw new Error("Can't squeeze axis ".concat(i," since its dim '").concat(e[i],"' is not 1"));(null==a[s]||a[s]>i)&&1===e[i]&&(n.push(e[i]),r.push(i)),a[s]<=i&&s++}1!==e[i]&&(n.push(e[i]),r.push(i))}return{newShape:n,keptDims:r}}function ul(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function hl(e,t){let n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function dl(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function pl(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function fl(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function ml(e){return"string"===typeof e||e instanceof String}function gl(e){return"number"===typeof e}function yl(e){return Array.isArray(e)?yl(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":gl(e)?"float32":ml(e)?"string":function(e){return"boolean"===typeof e}(e)?"bool":"float32"}function bl(e){return!!(e&&e.constructor&&e.call&&e.apply)}function vl(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function wl(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function xl(e,t,n){const r=new Array;if(1===t.length){const o=t[0];for(let t=0;t<o;t++)r[t]=n[e+t]}else{const o=t[0],a=t.slice(1),s=a.reduce(((e,t)=>e*t));for(let t=0;t<o;t++)r[t]=xl(e+t*s,a,n)}return r}function kl(e,t){if(0===e.length)return t[0];const n=e.reduce(((e,t)=>e*t));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return xl(0,e,t)}function Sl(e,t){const n=_l(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function _l(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Cl(e,t){const n=e.reduce(((e,t)=>e*t),1);if(null==t||"float32"===t)return kl(e,new Float32Array(n));if("int32"===t)return kl(e,new Int32Array(n));if("bool"===t)return kl(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Il(e){e.forEach((t=>{Jc(Number.isInteger(t)&&t>=0,(()=>"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")))}))}function Tl(e,t,n){if(0===t)return 0;if(1===t)return e[0];let r=e[e.length-1];for(let o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function Nl(e,t,n){if(0===t)return[];if(1===t)return[e];const r=new Array(t);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}function El(e){return e&&e.then&&"function"===typeof e.then}const Al="tfjsflags";class Rl{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(t,".")),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){const t=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(t,".")),this.set(e,t)}}async getAsync(e){return e in this.flags||(this.flags[e]=await this.evaluateFlag(e)),this.flags[e]}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(El(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const e=function(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}(this.global.location.search);if(Al in e){e[Al].split(",").forEach((e=>{const[t,n]=e.split(":");this.urlFlags[t]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(t,n)}))}}}function Ol(){return Pl}let Ml,Pl=null;function Dl(){if(null==Ml){let e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof __webpack_require__.g)e=__webpack_require__.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}Ml=e}return Ml}function Fl(e,t){const n=function(){const e=Dl();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const Ll="Abs",zl="Acos",Bl="Acosh",ql="Add",Wl="AddN",jl="All",Vl="Any",Ul="ArgMax",Gl="ArgMin",Hl="Asin",Kl="Asinh",Xl="Atan",Ql="Atanh",Yl="Atan2",Jl="AvgPool",Zl="AvgPoolGrad",$l="AvgPool3D",eu="AvgPool3DGrad",tu="BatchMatMul",nu="BatchToSpaceND",ru="Bincount",ou="Cast",au="Ceil",su="ClipByValue",iu="Complex",cu="ComplexAbs",lu="Concat",uu="Conv2D",hu="Conv2DBackpropFilter",du="Conv2DBackpropInput",pu="Conv3D",fu="Conv3DBackpropFilterV2",mu="Conv3DBackpropInputV2",gu="Cos",yu="Cosh",bu="Cumsum",vu="CropAndResize",wu="DenseBincount",xu="DepthToSpace",ku="DepthwiseConv2dNative",Su="DepthwiseConv2dNativeBackpropFilter",_u="DepthwiseConv2dNativeBackpropInput",Cu="Diag",Iu="Dilation2D",Tu="Dilation2DBackpropInput",Nu="Dilation2DBackpropFilter",Eu="RealDiv",Au="Elu",Ru="EluGrad",Ou="Erf",Mu="Equal",Pu="Exp",Du="ExpandDims",Fu="Expm1",Lu="FFT",zu="Fill",Bu="FlipLeftRight",qu="Floor",Wu="FloorDiv",ju="FusedBatchNorm",Vu="GatherV2",Uu="GatherNd",Gu="Greater",Hu="GreaterEqual",Ku="Identity",Xu="IFFT",Qu="Imag",Yu="IsFinite",Ju="IsInf",Zu="IsNan",$u="LeakyRelu",eh="Less",th="LessEqual",nh="LinSpace",rh="Log",oh="Log1p",ah="LogicalAnd",sh="LogicalNot",ih="LogicalOr",ch="LRN",lh="LRNGrad",uh="Max",hh="Maximum",dh="MaxPool",ph="MaxPoolGrad",fh="MaxPool3D",mh="MaxPool3DGrad",gh="MaxPoolWithArgmax",yh="Mean",bh="Min",vh="Minimum",wh="MirrorPad",xh="Mod",kh="Multinomial",Sh="Multiply",_h="Neg",Ch="NotEqual",Ih="NonMaxSuppressionV3",Th="NonMaxSuppressionV4",Nh="NonMaxSuppressionV5",Eh="OnesLike",Ah="OneHot",Rh="Pack",Oh="PadV2",Mh="Pow",Ph="Prelu",Dh="Prod",Fh="Range",Lh="Real",zh="Reciprocal",Bh="Relu",qh="Reshape",Wh="ResizeNearestNeighbor",jh="ResizeNearestNeighborGrad",Vh="ResizeBilinear",Uh="ResizeBilinearGrad",Gh="Relu6",Hh="Reverse",Kh="Round",Xh="Rsqrt",Qh="ScatterNd",Yh="Select",Jh="Selu",Zh="Slice",$h="Sin",ed="Sinh",td="Sign",nd="Sigmoid",rd="Softplus",od="Sqrt",ad="Sum",sd="SpaceToBatchND",id="SplitV",cd="Softmax",ld="SquaredDifference",ud="Square",hd="Sub",dd="SparseToDense",pd="StridedSlice",fd="Tan",md="Tanh",gd="Tile",yd="TopK",bd="Transpose",vd="Unique",wd="Unpack",xd="UnsortedSegmentSum",kd="ZerosLike",Sd="Step",_d="FromPixels",Cd="RotateWithOffset",Id="_FusedMatMul",Td="FusedConv2D",Nd="FusedDepthwiseConv2D",Ed=Fl("kernelRegistry",(()=>new Map)),Ad=Fl("gradRegistry",(()=>new Map));function Rd(e,t){const n=Fd(e,t);return Ed.get(n)}function Od(e){return Ad.get(e)}function Md(e){const t=Ed.entries(),n=[];for(;;){const{done:r,value:o}=t.next();if(r)break;const[a,s]=o,[i]=a.split("_");i===e&&n.push(s)}return n}function Pd(e){const{kernelName:t,backendName:n}=e,r=Fd(t,n);Ed.has(r)&&console.warn("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),Ed.set(r,e)}function Dd(e){const{kernelName:t}=e;Ad.has(t)&&Ol().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),Ad.set(t,e)}function Fd(e,t){return"".concat(t,"_").concat(e)}class Ld{constructor(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Bd)}profileKernel(e,t,n){let r;const o=this.backendTimer.time((()=>{r=n()}));if(Ol().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let a=0;a<r.length;a++){const t=r[a];t.data().then((n=>{zd(n,t.dtype,e)}))}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then((e=>e.kernelMs)),extraInfo:o.then((e=>null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""))}}logKernelProfile(e){const{kernelName:t,outputs:n,timeMs:r,inputs:o,extraInfo:a}=e;n.forEach((e=>{Promise.all([e.data(),r,a]).then((n=>{this.logger.logKernelProfile(t,e,n[0],n[1],o,n[2])}))}))}}function zd(e,t,n){if("float32"!==t)return!1;for(let r=0;r<e.length;r++){const t=e[r];if(isNaN(t)||!isFinite(t))return console.warn("Found ".concat(t," in the result of '").concat(n,"'")),!0}return!1}class Bd{logKernelProfile(e,t,n,r,o,a){const s="number"===typeof r?al("".concat(r,"ms"),9):r.error,i=al(e,25),c=t.rank,l=t.size,u=al(t.shape.toString(),14);let h="";for(const d in o){const e=o[d];if(null!=e){const n=e.shape||t.shape,r=n.length;h+="".concat(d,": ").concat(r,"D ").concat(r>0?n:""," ")}}console.log("%c".concat(i,"\t%c").concat(s,"\t%c").concat(c,"D ").concat(u,"\t%c").concat(l,"\t%c").concat(h,"\t%c").concat(a),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function qd(e,t,n,r){const o=wl(t),a=function(e,t,n,r){const o=tl(t),a=r[r.length-1],s=new Array(a).fill(0),i=t.length,c="complex64"===n?Ud(e):e;if(i>1)for(let l=0;l<o/a;l++){const e=l*a;for(let t=0;t<a;t++)s[t]=Math.max(s[t],Wd(c[e+t],0,n).length)}return s}(e,t,n,o),s=t.length,i=Vd(e,t,n,o,a),c=["Tensor"];return r&&(c.push("  dtype: ".concat(n)),c.push("  rank: ".concat(s)),c.push("  shape: [".concat(t,"]")),c.push("  values:")),c.push(i.map((e=>"    "+e)).join("\n")),c.join("\n")}function Wd(e,t,n){let r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):ml(e)?"'".concat(e,"'"):"bool"===n?jd(e):parseFloat(e.toFixed(7)).toString(),al(r,t)}function jd(e){return 0===e?"false":"true"}function Vd(e,t,n,r,o){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s="complex64"===n?2:1,i=t[0],c=t.length;if(0===c){if("complex64"===n){return[Wd(Ud(e)[0],0,n)]}return"bool"===n?[jd(e[0])]:[e[0].toString()]}if(1===c){if(i>20){const t=3*s;let r=Array.from(e.slice(0,t)),a=Array.from(e.slice((i-3)*s,i*s));return"complex64"===n&&(r=Ud(r),a=Ud(a)),["["+r.map(((e,t)=>Wd(e,o[t],n))).join(", ")+", ..., "+a.map(((e,t)=>Wd(e,o[i-3+t],n))).join(", ")+"]"]}return["["+("complex64"===n?Ud(e):Array.from(e)).map(((e,t)=>Wd(e,o[t],n))).join(", ")+"]"]}const l=t.slice(1),u=r.slice(1),h=r[0]*s,d=[];if(i>20){for(let t=0;t<3;t++){const r=t*h,a=r+h;d.push(...Vd(e.slice(r,a),l,n,u,o,!1))}d.push("...");for(let t=i-3;t<i;t++){const r=t*h,a=r+h;d.push(...Vd(e.slice(r,a),l,n,u,o,t===i-1))}}else for(let m=0;m<i;m++){const t=m*h,r=t+h;d.push(...Vd(e.slice(t,r),l,n,u,o,m===i-1))}const p=2===c?",":"";d[0]="["+d[0]+p;for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+p;let f=",\n";for(let m=2;m<c;m++)f+="\n";return d[d.length-1]=" "+d[d.length-1]+"]"+(a?"":f),d}function Ud(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function Gd(e,t){return"string"===t?Xd(e):Hd([e],t)}function Hd(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=el(e)),Ol().getBool("DEBUG")&&function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){const t=new Uint8Array(e.length);for(let n=0;n<t.length;++n)0!==Math.round(e[n])&&(t[n]=1);return t}throw new Error("Unknown data type ".concat(t))}function Kd(){return Ol().platform.now()}function Xd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Ol().platform.encode(e,t)}function Qd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Ol().platform.decode(e,t)}class Yd{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=tl(e),null!=n){const e=n.length;Jc(e===this.size,(()=>"Length of values '".concat(e,"' does not match the size ")+"inferred by the shape '".concat(this.size,"'.")))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||hl(t,this.size),this.strides=wl(e)}set(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Jc(n.length===this.rank,(()=>"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(this.rank,")")));const o=this.locToIndex(n);this.values[o]=e}get(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);let r=0;for(const a of t){if(a<0||a>=this.shape[r]){const e="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(e)}r++}let o=t[t.length-1];for(let a=0;a<t.length-1;++a)o+=this.strides[a]*t[a];return this.values[o]}locToIndex(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(0===this.rank)return[];if(1===this.rank)return[e];const t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Jd().makeTensor(this.values,this.shape,this.dtype)}}let Jd=null,Zd=null,$d=null;class ep{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=tl(e),this.strides=wl(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Zd.buffer(this.shape,this.dtype,e)}bufferSync(){return Zd.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return kl(this.shape,e)}arraySync(){return kl(this.shape,this.dataSync())}async data(){this.throwIfDisposed();const e=Jd().read(this.dataId);if("string"===this.dtype){const t=await e;try{return t.map((e=>Qd(e)))}catch($Y){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataSync(){this.throwIfDisposed();const e=Jd().readSync(this.dataId);if("string"===this.dtype)try{return e.map((e=>Qd(e)))}catch($Y){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Jd().read(this.dataId);return"string"===this.dtype?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Jd().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Zd.print(this,e)}clone(){return this.throwIfDisposed(),Zd.clone(this)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return qd(this.dataSync(),this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Zd.cast(this,e)}variable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Jd().makeVariable(this,e,t,n)}}Object.defineProperty(ep,Symbol.hasInstance,{value:e=>!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed});class tp extends ep{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!nl(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));Jd().disposeTensor(this),this.dataId=e.dataId,Jd().incRef(this,null)}dispose(){Jd().disposeVariable(this),this.isDisposedInternal=!0}}var np,rp,op,ap,sp;Object.defineProperty(tp,Symbol.hasInstance,{value:e=>e instanceof ep&&null!=e.assign&&e.assign instanceof Function}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(np||(np={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(rp||(rp={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(op||(op={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ap||(ap={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(sp||(sp={}));const ip={float32:ap,int32:rp,bool:op,complex64:sp};function cp(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return ip[e][t]}function lp(e){return cp(e,"int32")}function up(e,t){if(e.dtype===t.dtype)return[e,t];const n=cp(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function hp(e,t){return t.some((t=>t.id===e.id))}function dp(e){const t=[];return pp(e,t,new Set),t}function pp(e,t,n){if(null==e)return;if(e instanceof ep)return void t.push(e);if(r=e,!Array.isArray(r)&&"object"!==typeof r)return;var r;const o=e;for(const a in o){const e=o[a];n.has(e)||(n.add(e),pp(e,t,n))}}class fp{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((e=>e.name))))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class mp{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new fp}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error("The highest priority backend '".concat(e,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;{const{asyncInit:t}=this.initializeBackend(e);if(t)return null}}return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(null==this.registryFactory[e])throw new Error("Backend name '".concat(e,"' not found in registry"));if(this.backendName=e,null==this.registry[e]){this.backendInstance=null;const{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Ld(this.backendInstance),!0}setupRegisteredKernels(){Md(this.backendName).forEach((e=>{null!=e.setupFunc&&e.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(e){Md(e).forEach((t=>{null!=t.disposeFunc&&t.disposeFunc(this.registry[e])}))}initializeBackend(e){const t=this.registryFactory[e];if(null==t)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{const n=t.factory();if(!n||n instanceof Hc||"function"!==typeof n.then)return this.registry[e]=n,{success:!0,asyncInit:!1};{const t=++this.pendingBackendInitId,r=n.then((n=>!(t<this.pendingBackendInitId)&&(this.registry[e]=n,this.pendingBackendInit=null,!0))).catch((n=>(t<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(n){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority))}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const n=e[t],{success:r,asyncInit:o}=this.initializeBackend(n);if(o||r)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n,r=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=t(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(e,t,n){e();try{const e=n();return t(),e}catch(r){throw t(),r}}nextTensorId(){return mp.nextTensorId++}nextVariableId(){return mp.nextVariableId++}clone(e){const t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(e=>({x:()=>{const t="float32",n={x:e},r={dtype:t};return yp.runKernelFunc((n=>n.cast(e,t)),n,null,ou,r)}})),[],{}),t}runKernel(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){const r=this.backend.numDataIds();let o=0;n.forEach((e=>{o+="complex64"===e.dtype?3:1}));const a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=r-t-o-a;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))}runKernelFunc(e,t,n,r,o,a,s){let i,c=[];const l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");const u=this.state.numBytes,h=this.state.numTensors;let d;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const p=Rd(r,this.backendName);let f,m;if(null!=p)d=()=>{const e=this.backend.numDataIds();f=p.kernelFunc({inputs:t,attrs:o,backend:this.backend});const n=Array.isArray(f)?f:[f];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,e,n);const i=n.map((e=>{if(null!=e.rank)return e;const{dataId:t,shape:n,dtype:r}=e;return this.makeTensorFromDataId(t,n,r)}));if(l){let e=this.getTensorsForGradient(r,t,i);if(null==e){null==s&&(s=[]);const t=i.filter(((e,t)=>s[t]));e=(a||[]).slice().concat(t)}c=this.saveTensorsForBackwardMode(e)}return i};else{if(null==e)throw new Error("Error running ".concat(r,": Neither modular kernel nor forward func passed"));const t=e=>{l&&(c=e.map((e=>this.keep(this.clone(e)))))};d=()=>{const n=this.backend.numDataIds();f=this.tidy((()=>e(this.backend,t)));const o=Array.isArray(f)?f:[f];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,n,o),o}}return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(m=this.profiler.profileKernel(r,t,(()=>d())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),i=m.outputs):i=d()})),l&&this.addTapeNode(r,t,i,n,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-u,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((e=>null!=t[e]?t[e].shape:null)),outputShapes:i.map((e=>e.shape)),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(f)?i:i[0]}saveTensorsForBackwardMode(e){return e.map((e=>this.keep(this.clone(e))))}getTensorsForGradient(e,t,n){const r=Od(e);if(null!=r){const e=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(Jc(Array.isArray(t),(()=>"saveAllInputs is true, expected inputs to be an array.")),a=Object.keys(t).map((e=>t[e]))):a=e.map((e=>t[e]));const s=n.filter(((e,t)=>o[t]));return a.concat(s)}return null}makeTensor(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let o=e;"string"===n&&ml(e[0])&&(o=e.map((e=>Xd(e))));const a=r.write(o,t,n),s=new ep(t,n,a,this.nextTensorId());if(this.incRef(s,r),"string"===n){const e=this.state.tensorInfo.get(a),t=function(e){if(null==e)return 0;let t=0;return e.forEach((e=>t+=e.length)),t}(o);this.state.numBytes+=t-e.bytes,e.bytes=t}return s}makeTensorFromDataId(e,t,n,r){const o=new ep(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o}makeVariable(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));const o=new tp(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name ".concat(o.name," was already registered"));return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}incRef(e,t){const n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;let n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*fl(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof tp||this.track(e)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;const t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):(t.backend.decComplexRef(e.dataId),this.state.tensorInfo.get(e.dataId).refCount--)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((e=>e.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(e,t,n,r,o,a){const s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},i=Od(e);null!=i&&(r=i.gradFunc),null!=r&&(s.gradient=e=>(e=e.map(((e,t)=>{if(null==e){const e=n[t],r=_l(e.size,e.dtype);return this.makeTensor(r,e.shape,e.dtype)}return e})),r(e.length>1?e:e[0],o,a))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=dp(e),n=new Set(t.map((e=>e.id)));for(let o=0;o<this.state.activeScope.track.length;o++){const e=this.state.activeScope.track[o];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach((e=>{e.kept||e.scopeId!==r.id||this.track(e)}))}gradients(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Jc(t.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));const o=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",e)));Jc(o instanceof ep,(()=>"The result y returned by f() must be a tensor."));const a=function(e,t,n){const r={},o={};for(let c=0;c<t.length;c++)r[t[c].id]=!0;for(let c=0;c<e.length;c++){const n=e[c],a=n.inputs;for(const e in a){const s=a[e];let i=!1;for(let e=0;e<t.length;e++)if(r[s.id]){n.outputs.forEach((e=>r[e.id]=!0)),i=!0,o[n.id]=!0;break}if(i)break}}const a={};a[n.id]=!0;const s={};for(let c=e.length-1;c>=0;c--){const t=e[c],n=t.inputs;for(let e=0;e<t.outputs.length;e++)if(a[t.outputs[e].id]){for(const e in n)a[n[e].id]=!0,s[t.id]=!0;break}}const i=[];for(let c=0;c<e.length;c++){const t=e[c];if(o[t.id]&&s[t.id]){const e={};for(const o in t.inputs){const n=t.inputs[o];r[n.id]&&(e[o]=n)}const n=Object.assign({},t);n.inputs=e,n.outputs=t.outputs,i.push(n)}}return i}(this.state.activeTape,t,o);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const e={};e[o.id]=null==n?function(e){const t=Sl(tl(e),"float32");return yp.makeTensor(t,e,"float32")}(o.shape):n,function(e,t,n,r){for(let o=t.length-1;o>=0;o--){const a=t[o],s=[];if(a.outputs.forEach((t=>{const n=e[t.id];null!=n?s.push(n):s.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));const i=a.gradient(s);for(const t in a.inputs){if(!(t in i))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(i),"."));const o=n((()=>i[t]()));if("float32"!==o.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(o.dtype,"'"));const s=a.inputs[t];if(!nl(o.shape,s.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(o.shape,"', which does not match ")+"the shape of the input '".concat(s.shape,"'"));if(null==e[s.id])e[s.id]=o;else{const t=e[s.id];e[s.id]=r(t,o),t.dispose()}}}}(e,a,(e=>this.tidy(e)),bp);const r=t.map((t=>e[t.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((e=>{for(const t of e.saved)t.dispose()})),this.state.activeTape=null),{value:o,grads:r}}))}customGrad(e){var t=this;return Jc(bl(e),(()=>"The f passed in customGrad(f) must be a function.")),function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];let a;Jc(r.every((e=>e instanceof ep)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const s={};return r.forEach(((e,t)=>{s[t]=e})),t.runKernelFunc(((t,n)=>(a=e(...r,n),Jc(a.value instanceof ep,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),Jc(bl(a.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),a.value)),s,((e,t)=>{const n=a.gradFunc(e,t),o=Array.isArray(n)?n:[n];Jc(o.length===r.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),Jc(o.every((e=>e instanceof ep)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const s={};return o.forEach(((e,t)=>{s[t]=()=>e})),s}))}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){const t=Kd(),n=await this.backend.time(e);return n.wallMs=Kd()-t,n}track(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new fp;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function gp(){const e=Dl();if(null==e._tfengine){const t=new Rl(e);e._tfengine=new mp(t)}var t;return t=e._tfengine.ENV,Pl=t,Jd=()=>e._tfengine,e._tfengine}mp.nextTensorId=0,mp.nextVariableId=0;const yp=gp();function bp(e,t){const n={a:e,b:t};return yp.runKernel(ql,n)}function vp(){if("undefined"!==typeof navigator&&null!=navigator){const e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function wp(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}const xp=Ol();function kp(e,t){let n=e;if(pl(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||pl(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Ol().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Sp(e,r,[]),r}function Sp(e,t,n){if(n=n||[],!Array.isArray(e)&&!pl(e))return void Jc(0===t.length,(()=>"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")));Jc(t.length>0,(()=>"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements"))),Jc(e.length===t[0],(()=>"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")));const r=t.slice(1);for(let o=0;o<e.length;++o)Sp(e[o],r,n.concat(o))}function _p(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function Cp(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof ep)return _p(r,e.dtype,t,n),e;let o=yl(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),_p(r,o,t,n),null==e||!pl(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){const r=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(r,"'"))}const a=kp(e,o);pl(e)||Array.isArray(e)||(e=[e]);const s="string"!==o?Hd(e,o):el(e,[],!0);return yp.makeTensor(s,a,o)}function Ip(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map(((e,o)=>Cp(e,"".concat(t,"[").concat(o,"]"),n,r)))}xp.registerFlag("DEBUG",(()=>!1),(e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),xp.registerFlag("IS_BROWSER",(()=>wp())),xp.registerFlag("IS_NODE",(()=>"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node)),xp.registerFlag("IS_CHROME",(()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),xp.registerFlag("PROD",(()=>!1)),xp.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>xp.getBool("DEBUG"))),xp.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),xp.registerFlag("IS_TEST",(()=>!1)),xp.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0));function Tp(e){const t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";const o=function(){yp.startScope(n);try{const e=r(...arguments);return El(e)&&console.error("Cannot return a Promise inside of tidy."),yp.endScope(e),e}catch(e){throw yp.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}const Np=Tp({complex_:function(e,t){const n=Cp(e,"real","complex"),r=Cp(t,"imag","complex");Zc(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");const o={real:n,imag:r};return yp.runKernel(iu,o)}});function Ep(e,t,n,r){if(null==r&&(r=yl(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!pl(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Il(t);const e=tl(t),r=tl(n);Jc(e===r,(()=>"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(e," values but has ").concat(r)));for(let o=0;o<n.length;++o){const e=n[o],r=o!==n.length-1||e!==tl(t.slice(o));Jc(n[o]===t[o]||!r,(()=>"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")))}}return pl(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Hd(e,r):el(e,[],!0),yp.makeTensor(e,t,r)}function Ap(e,t,n){return Ep(e,t,kp(e,n),n)}const Rp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function Op(e,t){const n=[],r=[],o=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);for(let a=0;a<o.length;++a){const s=o[a],i=Array.isArray(e)?e[a].tensor:e[s];if("float32"!==i.dtype&&"int32"!==i.dtype&&"bool"!==i.dtype&&"string"!==i.dtype&&"complex64"!==i.dtype)throw new Error("Unsupported dtype in weight '".concat(s,"': ").concat(i.dtype));const c={name:s,shape:i.shape,dtype:i.dtype};if("string"===i.dtype){const e=new Promise((async e=>{const t=await i.bytes(),n=t.reduce(((e,t)=>e+t.length),0)+4*t.length,r=new Uint8Array(n);let o=0;for(let a=0;a<t.length;a++){const e=t[a],n=new Uint8Array(new Uint32Array([e.length]).buffer);r.set(n,o),o+=4,r.set(e,o),o+=e.length}e(r)}));r.push(e)}else r.push(i.data());null!=t&&(c.group=t),n.push(c)}return{data:Mp(await Promise.all(r)),specs:n}}function Mp(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));let t=0;const n=[];e.forEach((e=>{if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));const r=new Uint8Array(t);let o=0;return n.forEach((e=>{r.set(new Uint8Array(e.buffer),o),o+=e.byteLength})),r.buffer}const Pp="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function Dp(e){return Pp?Buffer.byteLength(e):new Blob([e]).size}function Fp(e){if(1===e.length)return e[0];let t=0;e.forEach((e=>{t+=e.byteLength}));const n=new Uint8Array(t);let r=0;return e.forEach((e=>{n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Lp(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Dp(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Dp(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function zp(){const e=function(){const e=e=>{let t=e<<13,n=0;for(;0===(8388608&t);)n-=8388608,t<<=1;return t&=-8388609,n+=947912704,t|n},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}(),t=function(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}(),n=function(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return r=>{const o=new ArrayBuffer(4*r.length),a=new Uint32Array(o);for(let s=0;s<r.length;s++){const o=r[s],i=e[n[o>>10]+(1023&o)]+t[o>>10];a[s]=i}return new Float32Array(o)}}class Bp{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Bp.instance&&(Bp.instance=new Bp),Bp.instance}static registerSaveRouter(e){Bp.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Bp.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Bp.getHandlers(e,"save")}static getLoadHandlers(e,t){return Bp.getHandlers(e,"load",t)}static getHandlers(e,t,n){const r=[];return("load"===t?Bp.getInstance().loadRouters:Bp.getInstance().saveRouters).forEach((t=>{const o=t(e,n);null!==o&&r.push(o)})),r}}const qp="tensorflowjs",Wp="models_store",jp="model_info_store";function Vp(){if(!Ol().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Up(e){const t=e.result;t.createObjectStore(Wp,{keyPath:"modelPath"}),t.createObjectStore(jp,{keyPath:"modelPath"})}class Gp{constructor(e){if(this.indexedDB=Vp(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise(((e,n)=>{const r=this.indexedDB.open(qp,1);r.onupgradeneeded=()=>Up(r),r.onsuccess=()=>{const o=r.result;if(null==t){const t=o.transaction(Wp,"readonly"),r=t.objectStore(Wp).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return o.close(),n(new Error("Cannot find model with path '".concat(this.modelPath,"' ")+"in IndexedDB."));e(r.result.modelArtifacts)},r.onerror=e=>(o.close(),n(r.error)),t.oncomplete=()=>o.close()}else{const r=Lp(t),a=o.transaction(jp,"readwrite");let s=a.objectStore(jp);const i=s.put({modelPath:this.modelPath,modelArtifactsInfo:r});let c;i.onsuccess=()=>{c=o.transaction(Wp,"readwrite");const i=c.objectStore(Wp).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:r});i.onsuccess=()=>e({modelArtifactsInfo:r}),i.onerror=e=>{s=a.objectStore(jp);const t=s.delete(this.modelPath);t.onsuccess=()=>(o.close(),n(i.error)),t.onerror=e=>(o.close(),n(i.error))}},i.onerror=e=>(o.close(),n(i.error)),a.oncomplete=()=>{null==c?o.close():c.oncomplete=()=>o.close()}}},r.onerror=e=>n(r.error)}))}}Gp.URL_SCHEME="indexeddb://";const Hp=e=>{return Ol().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Gp.URL_SCHEME)?(t=e.slice(Gp.URL_SCHEME.length),new Gp(t)):null;var t};Bp.registerSaveRouter(Hp),Bp.registerLoadRouter(Hp);class Kp{constructor(){this.indexedDB=Vp()}async listModels(){return new Promise(((e,t)=>{const n=this.indexedDB.open(qp,1);n.onupgradeneeded=()=>Up(n),n.onsuccess=()=>{const r=n.result,o=r.transaction(jp,"readonly"),a=o.objectStore(jp).getAll();a.onsuccess=()=>{const t={};for(const e of a.result)t[e.modelPath]=e.modelArtifactsInfo;e(t)},a.onerror=e=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},n.onerror=e=>t(n.error)}))}async removeModel(e){var t;return e=(t=e).startsWith(Gp.URL_SCHEME)?t.slice(Gp.URL_SCHEME.length):t,new Promise(((t,n)=>{const r=this.indexedDB.open(qp,1);r.onupgradeneeded=()=>Up(r),r.onsuccess=()=>{const o=r.result,a=o.transaction(jp,"readwrite"),s=a.objectStore(jp),i=s.get(e);let c;i.onsuccess=()=>{if(null==i.result)return o.close(),n(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));{const r=s.delete(e),a=()=>{c=o.transaction(Wp,"readwrite");const r=c.objectStore(Wp).delete(e);r.onsuccess=()=>t(i.result.modelArtifactsInfo),r.onerror=e=>n(i.error)};r.onsuccess=a,r.onerror=e=>(a(),o.close(),n(i.error))}},i.onerror=e=>(o.close(),n(i.error)),a.oncomplete=()=>{null==c?o.close():c.oncomplete=()=>o.close()}},r.onerror=e=>n(r.error)}))}}const Xp="/",Qp="tensorflowjs_models",Yp="info",Jp="model_topology",Zp="weight_specs",$p="weight_data",ef="model_metadata";function tf(e){return{info:[Qp,e,Yp].join(Xp),topology:[Qp,e,Jp].join(Xp),weightSpecs:[Qp,e,Zp].join(Xp),weightData:[Qp,e,$p].join(Xp),modelMetadata:[Qp,e,ef].join(Xp)}}function nf(e){const t=e.split(Xp);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(Xp)}class rf{constructor(e){if(!Ol().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=tf(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),o=Lp(e);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(Pp)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData));const t={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(t)),{modelArtifactsInfo:o}}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(o.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(o.weightSpecsBytes,", ")+"weightDataBytes=".concat(o.weightDataBytes,"."))}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(null==e)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");t.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(null!=o){const e=JSON.parse(o);t.format=e.format,t.generatedBy=e.generatedBy,t.convertedBy=e.convertedBy,null!=e.signature&&(t.signature=e.signature),null!=e.userDefinedMetadata&&(t.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(t.modelInitializer=e.modelInitializer)}const a=this.LS.getItem(this.keys.weightData);if(null==a)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=function(e){if(Pp){const t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}(a),t}}rf.URL_SCHEME="localstorage://";const of=e=>{return Ol().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(rf.URL_SCHEME)?(t=e.slice(rf.URL_SCHEME.length),new rf(t)):null;var t};Bp.registerSaveRouter(of),Bp.registerLoadRouter(of);class af{constructor(){Jc(Ol().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),Jc("undefined"===typeof window||"undefined"!==typeof window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const e={},t=Qp+Xp,n=Xp+Yp;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(n)){e[nf(o)]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){var t;const n=tf(e=(t=e).startsWith(rf.URL_SCHEME)?t.slice(rf.URL_SCHEME.length):t);if(null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '".concat(e,"'"));const r=JSON.parse(this.LS.getItem(n.info));return this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r}}const sf="://";class cf{constructor(){this.managers={}}static getInstance(){return null==cf.instance&&(cf.instance=new cf),cf.instance}static registerManager(e,t){Jc(null!=e,(()=>"scheme must not be undefined or null.")),e.endsWith(sf)&&(e=e.slice(0,e.indexOf(sf))),Jc(e.length>0,(()=>"scheme must not be an empty string."));const n=cf.getInstance();Jc(null==n.managers[e],(()=>"A model store manager is already registered for scheme '".concat(e,"'."))),n.managers[e]=t}static getManager(e){const t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}static getSchemes(){return Object.keys(this.getInstance().managers)}}class lf{fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}}if(Ol().get("IS_BROWSER")){Ol().setPlatform("browser",new lf);try{cf.registerManager(rf.URL_SCHEME,new af)}catch(L2){}try{cf.registerManager(Gp.URL_SCHEME,new Kp)}catch(L2){}}const uf=()=>__webpack_require__(5817);let hf;class df{constructor(){this.util=__webpack_require__(8590),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return null!=Ol().global.fetch?Ol().global.fetch(e,t):(null==hf&&(hf=uf()),hf(e,t))}now(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}encode(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}decode(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}function pf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Il(e),new Yd(e,t,n)}Ol().get("IS_NODE")&&Ol().setPlatform("node",new df);const ff=Tp({cast_:function(e,t){const n=Cp(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const r={x:n},o={dtype:t};return yp.runKernel(ou,r,o)}});const mf=Tp({clone_:function(e){const t={x:Cp(e,"x","clone","string_or_numeric")};return yp.runKernel(Ku,t)}});gp();const gf={buffer:pf,cast:ff,clone:mf,print:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};!function(e){Zd=e}(gf);function yf(e){return new Promise((e=>setTimeout(e))).then(e)}class bf{constructor(e){if(!Ol().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(bf.URL_SCHEME)&&(e=e.slice(bf.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}async save(e){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n};null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer);const o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=o,await yf((()=>a.dispatchEvent(new MouseEvent("click")))),null!=e.weightData){const e=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;e.download=this.weightDataFileName,e.href=t,await yf((()=>e.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:Lp(e)}}}}bf.URL_SCHEME="downloads://";function vf(e,t,n,r){!function(e){Jc(null!=e&&Array.isArray(e)&&e.length>0,(()=>"promises must be a none empty array"))}(e),function(e,t){Jc(e>=0&&e<=1,(()=>"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e))),Jc(t>=0&&t<=1,(()=>"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t))),Jc(t>=e,(()=>"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)))}(n=null==n?0:n,r=null==r?1:r);let o=0;return Promise.all(e.map((a=>(a.then((a=>{const s=n+ ++o/e.length*(r-n);return t(s),a})),a))))}async function wf(e,t){null==t&&(t={});const n=null==t.fetchFunc?Ol().platform.fetch:t.fetchFunc,r=e.map((e=>n(e,t.requestInit,{isBinary:!0}))),o=(null==t.onProgress?await Promise.all(r):await vf(r,t.onProgress,0,.5)).map((e=>e.arrayBuffer()));return null==t.onProgress?await Promise.all(o):await vf(o,t.onProgress,.5,1)}async function xf(e){let t=arguments.length>3?arguments[3]:void 0;const n=(r=e=>wf(e,{requestInit:t}),async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;const o=e.map((()=>!1)),a={},s=null!=n?n.map((()=>!1)):[],i=[];if(e.forEach(((e,t)=>{let r=0;e.weights.forEach((e=>{const c="quantization"in e?e.quantization.dtype:e.dtype,l=Rp[c]*tl(e.shape),u=()=>{o[t]=!0,null==a[t]&&(a[t]=[]),a[t].push({manifestEntry:e,groupOffset:r,sizeBytes:l})};null!=n?n.forEach(((t,n)=>{t===e.name&&(u(),s[n]=!0)})):u(),i.push(e.name),r+=l}))})),!s.every((e=>e))){const e=n.filter(((e,t)=>!s[t]));throw new Error("Could not find weights in manifest with names: "+"".concat(e.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(i.join(", "),"."))}const c=o.reduce(((e,t,n)=>(t&&e.push(n),e)),[]),l=[];c.forEach((n=>{e[n].paths.forEach((e=>{const n=t+(t.endsWith("/")?"":"/")+e;l.push(n)}))}));const u=await r(l),h={};let d=0;return c.forEach((t=>{const n=e[t].paths.length;let r=0;for(let e=0;e<n;e++)r+=u[d+e].byteLength;const o=new ArrayBuffer(r),s=new Uint8Array(o);let i=0;for(let e=0;e<n;e++){const t=new Uint8Array(u[d+e]);s.set(t,i),i+=t.byteLength}a[t].forEach((e=>{const t=function(e,t){const n={};let r,o=0;for(const a of t){const t=a.name,s=a.dtype,i=a.shape,c=tl(i);let l;if("quantization"in a){const n=a.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error("Weight ".concat(a.name," with quantization ").concat(n.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==n.dtype)throw new Error("Weight ".concat(a.name," has unknown ")+"quantization dtype ".concat(n.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==s)throw new Error("Weight ".concat(a.name," is quantized with ").concat(n.dtype," ")+"which only supports weights of type float32 not ".concat(s,"."))}const i=Rp[n.dtype],u=e.slice(o,o+c*i),h="uint8"===n.dtype?new Uint8Array(u):new Uint16Array(u);if("float32"===s)if("uint8"===n.dtype||"uint16"===n.dtype){l=new Float32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];l[e]=t*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error("Unsupported quantization type ".concat(n.dtype," ")+"for weight type float32.");void 0===r&&(r=zp()),l=r(h)}else{if("int32"!==s)throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(s));if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error("Unsupported quantization type ".concat(n.dtype," ")+"for weight type int32.");l=new Int32Array(h.length);for(let e=0;e<h.length;e++){const t=h[e];l[e]=Math.round(t*n.scale+n.min)}}o+=c*i}else if("string"===s){const t=tl(a.shape);l=[];for(let n=0;n<t;n++){const t=new Uint32Array(e.slice(o,o+4))[0];o+=4;const n=new Uint8Array(e.slice(o,o+t));l.push(n),o+=t}}else{const r=Rp[s],a=e.slice(o,o+c*r);if("float32"===s)l=new Float32Array(a);else if("int32"===s)l=new Int32Array(a);else if("bool"===s)l=new Uint8Array(a);else{if("complex64"!==s)throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(s));{l=new Float32Array(a);const e=new Float32Array(l.length/2),r=new Float32Array(l.length/2);for(let t=0;t<e.length;t++)e[t]=l[2*t],r[t]=l[2*t+1];const o=Ap(e,i,"float32"),s=Ap(r,i,"float32");n[t]=Np(o,s),o.dispose(),s.dispose()}}o+=c*r}"complex64"!==s&&(n[t]=Ap(l,i,s))}return n}(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(const n in t)h[n]=t[n]})),d+=n})),h});var r;return n(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0)}Bp.registerSaveRouter((e=>Ol().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(bf.URL_SCHEME)?function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new bf(e)}(e.slice(bf.URL_SCHEME.length)):null));class kf{constructor(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,null!=t.fetchFunc?(Jc("function"===typeof t.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=t.fetchFunc):this.fetch=Ol().platform.fetch,Jc(null!=e&&e.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(e)&&Jc(2===e.length,(()=>"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,")."))),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n};null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin");const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:Lp(e),responses:[o]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");let t;try{t=await e.json()}catch(F2){let t="Failed to parse model JSON of response from ".concat(this.path,".");throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=t.modelTopology,r=t.weightsManifest,o=t.generatedBy,a=t.convertedBy,s=t.format,i=t.signature,c=t.userDefinedMetadata;if(null==n&&null==r)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");let l,u;if(null!=r){const e=await this.loadWeights(r);[l,u]=e}const h={modelTopology:n,weightSpecs:l,weightData:u,generatedBy:o,convertedBy:a,format:s};null!=i&&(h.signature=i),null!=c&&(h.userDefinedMetadata=c);const d=t.modelInitializer;return d&&(h.modelInitializer=d),h}async loadWeights(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),o=n>t?e.substring(n):"";return[r+"/",o]}(t),o=this.weightPathPrefix||n,a=[];for(const c of e)a.push(...c.weights);const s=[],i=[];for(const c of e)for(const e of c.paths)null!=this.weightUrlConverter?i.push(this.weightUrlConverter(e)):s.push(o+e+r);this.weightUrlConverter&&s.push(...await Promise.all(i));return[a,Fp(await wf(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function Sf(e){return null!=e.match(kf.URL_SCHEME_REGEX)}kf.URL_SCHEME_REGEX=/^https?:\/\//;const _f=(e,t)=>{if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;{let n=!0;if(n=Array.isArray(e)?e.every((e=>Sf(e))):Sf(e),n)return Cf(e,t)}return null};function Cf(e,t){return new kf(e,t)}Bp.registerSaveRouter(_f),Bp.registerLoadRouter(_f);let If;Tp({fromPixels_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,o=!1,a=!1,s=!1,i=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));i=!0}if(o){const t=2;if(o&&e.readyState<t)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Rd(_d,yp.backendName)){const n={pixels:e},r={numChannels:t};return yp.runKernel(_d,n,r)}const[c,l]=o?[e.videoWidth,e.videoHeight]:[e.width,e.height];let u,h;if(s?u=e.getContext("2d").getImageData(0,0,c,l).data:r||n?u=e.data:(a||o||i)&&(null==If&&(If=document.createElement("canvas").getContext("2d")),If.canvas.width=c,If.canvas.height=l,If.drawImage(e,0,0,c,l),u=If.getImageData(0,0,c,l).data),4===t)h=new Int32Array(u);else{const e=c*l;h=new Int32Array(e*t);for(let n=0;n<e;n++)for(let e=0;e<t;++e)h[n*t+e]=u[4*n+e]}return function(e,t,n){if($c(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");const r=kp(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ep(e,t,r,n)}(h,[l,c,t],"int32")}});function Tf(e,t,n){const r=e.shape.length;Jc(r===t.length,(()=>"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,")."))),Jc(r===n.length,(()=>"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")));for(let o=0;o<r;++o)Jc(t[o]+n[o]<=e.shape[o],(()=>"Error in slice".concat(r,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(t[o]+n[o],") would overflow input.shape[").concat(o,"] (").concat(e.shape[o],")")))}function Nf(e){const t=[];let n=0;for(;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Ef(e,t,n){const r=[];for(let o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function Af(e,t,n,r){const o=[...e];for(let a=o.length;a<r.length;a++)o.push(1);for(let a=0;a<n;a++)0===a?o[t]=1:(o.splice(t,0,1),o.pop());return o}function Rf(e,t,n){return n<=e?n:n-(t-1)}function Of(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function Mf(e,t,n,r,o,a,s,i,c){const l=e.length;let u=new Array(l),h=new Array(l),d=new Array(l);if(t.length&&n>0){const c=t[0],l=n+1;u=Pf(s,c,l,r,e),h=Df(i,c,l,o,e),d=Af(a,c,l,e)}else for(let p=0;p<l;p++)u[p]=Lf(s,r,a,e,p,c),h[p]=zf(i,o,a,e,p,c),d[p]=Ff(a,p,c);return{begin:u,end:h,strides:d}}function Pf(e,t,n,r,o){const a=[...o],s=Of(n,t);for(let i=0;i<a.length;i++)if(s.indexOf(i)>-1)a[i]=0;else{const o=Rf(t,n,i);let s=r[o];e&1<<o&&(s=0),a[i]=s}return a}function Df(e,t,n,r,o){const a=[...o],s=Of(n,t);for(let i=0;i<a.length;i++)if(s.indexOf(i)>-1)a[i]=Number.MAX_SAFE_INTEGER;else{const o=Rf(t,n,i);let s=r[o];e&1<<o&&(s=Number.MAX_SAFE_INTEGER),a[i]=s}for(let i=0;i<a.length;i++){const e=o[i];a[i]<0&&(a[i]+=e),a[i]=Qc(0,a[i],o[i])}return a}function Ff(e,t,n){let r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Lf(e,t,n,r,o,a){let s=t[o];const i=n[o]||1;(e&1<<o||a&1<<o||null==s)&&(s=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const c=r[o];return s<0&&(s+=c),s=Qc(0,s,c-1),s}function zf(e,t,n,r,o,a){let s=t[o];const i=n[o]||1;(e&1<<o||a&1<<o||null==s)&&(s=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const c=r[o];return s<0&&(s+=c),s=i>0?Qc(0,s,c):Qc(-1,s,c-1),s}function Bf(e,t,n){let r=n.length;for(let o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(let o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function qf(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Wf(e,t,n){let r;const o=e.shape.length;let a;return r="number"===typeof t?[t,...new Array(o-1).fill(0)]:t.length<o?t.concat(new Array(o-t.length).fill(0)):t.slice(),r.forEach((e=>{Jc(-1!==e,(()=>"slice() does not support negative begin indexing."))})),a=null==n?new Array(o).fill(-1):"number"===typeof n?[n,...new Array(o-1).fill(-1)]:n.length<o?n.concat(new Array(o-n.length).fill(-1)):n,a=a.map(((t,n)=>t>=0?t:(Jc(-1===t,(()=>"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,"."))),e.shape[n]-r[n]))),[r,a]}function jf(e,t,n,r,o,a,s,i,c){let l=t.slice(),u=n.slice(),h=r;null==r&&(h=new Array(l.length));const d=Nf(s);if(d.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==s&&0!==i)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==s&&0!==c)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const p=e.length-l.length,f=Nf(i),m=e.slice();f.forEach((e=>{l[e]=0,u[e]=1,m.splice(e,0,1)}));const{begin:g,end:y,strides:b}=Mf(m,d,p,l,u,h,o,a,s);l=g,u=y,h=b;const v=Nf(c);v.forEach((e=>{u[e]=l[e]+1,h[e]=1}));const w=Ef(l,u,h),x=w.filter(((e,t)=>-1===v.indexOf(t)));return{nonStrided:h.every((e=>1===e)),$begin:l,$end:u,$strides:h,size:w,newShape:m,outShape:x}}class Vf{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Uf{constructor(){this.classNameMap={}}static getMap(){return null==Uf.instance&&(Uf.instance=new Uf),Uf.instance}static register(e){Uf.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Gf(e){Jc(null!=e.className,(()=>"Class being registered does not have the static className property defined.")),Jc("string"===typeof e.className,(()=>"className is required to be a string, but got type "+typeof e.className)),Jc(e.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),Uf.register(e)}function Hf(e){Ol().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Kf(){return yp}function Xf(){return yp.memory()}function Qf(e,t){return yp.tidy(e,t)}function Yf(e){dp(e).forEach((e=>e.dispose()))}function Jf(e){return yp.keep(e)}function Zf(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return yp.registerBackend(e,t,n)}function $f(e){return yp.customGrad(e)}function em(e,t){if((pl(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&pl(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ep(e,[],[],t)}$d=Hf;class tm extends Vf{minimize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const{value:r,grads:o}=this.computeGradients(e,n);if(null!=n){const e=n.map((e=>({name:e.name,tensor:o[e.name]})));this.applyGradients(e)}else this.applyGradients(o);return Yf(o),t?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return function(e,t){Jc(bl(e),(()=>"The f passed in variableGrads(f) must be a function")),Jc(null==t||Array.isArray(t)&&t.every((e=>e instanceof tp)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=t;if(!n){t=[];for(const e in yp.registeredVariables)t.push(yp.registeredVariables[e])}const r=n?t.filter((e=>!e.trainable)):null,o=t.length;t=t.filter((e=>e.trainable)),Jc(t.length>0,(()=>"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(o," variables is ")+"trainable."));const{value:a,grads:s}=yp.gradients(e,t,null,!0);Jc(s.some((e=>null!=e)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),Jc(0===a.rank,(()=>"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(a.rank," tensor")));const i={};return t.forEach(((e,t)=>{null!=s[t]&&(i[e.name]=s[t])})),null!=r&&r.forEach((e=>i[e.name]=null)),{value:a,grads:i}}(e,t)}dispose(){null!=this.iterations_&&Yf(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:em(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(tm,Symbol.hasInstance,{value:e=>null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients});const nm=Tp({abs_:function(e){const t=Cp(e,"x","abs");if("complex64"===t.dtype){const e={x:t};return yp.runKernel(cu,e)}{const e={x:t};return yp.runKernel(Ll,e)}}});const rm=Tp({add_:function(e,t){let n=Cp(e,"a","add"),r=Cp(t,"b","add");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(ql,o)}});const om=Tp({all_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:Cp(e,"x","all","bool")},o={axis:t,keepDims:n};return yp.runKernel(jl,r,o)}});const am=Tp({any_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:Cp(e,"x","any","bool")},o={axis:t,keepDims:n};return yp.runKernel(Vl,r,o)}});const sm=Tp({argMax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:Cp(e,"x","argMax")},r={axis:t};return yp.runKernel(Ul,n,r)}});function im(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",a=arguments.length>5?arguments[5]:void 0;return um(e,[...t,e[3]],n,a,r,null,null,vm(o))}function cm(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast";const[i,c]=pm(t);let l;if("channelsLast"===s)l=[i,c,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));l=[i,c,e[1],e[1]]}return um(e,l,n,r,o,a,!1,s)}function lm(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC";const[i,c,l]=fm(t);let u,h;if("NDHWC"===s)h="channelsLast",u=[i,c,l,e[4],e[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat ".concat(s));h="channelsFirst",u=[i,c,l,e[1],e[1]]}return hm(e,u,n,r,o,!1,h,a)}function um(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",[c,l,u,h]=[-1,-1,-1,-1];if("channelsLast"===i)[c,l,u,h]=e;else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat ".concat(i));[c,h,l,u]=e}const[d,p,,f]=t,[m,g]=pm(n),[y,b]=pm(r),v=mm(d,y),w=mm(p,b),{padInfo:x,outHeight:k,outWidth:S}=function(e,t,n,r,o,a,s,i,c){let l,u,h;if("number"===typeof e){l={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};const o=function(e,t,n,r,o){null==r&&(r=dm(e,t,n));const a=e[0],s=e[1],i=gm((a-t+2*r)/n+1,o),c=gm((s-t+2*r)/n+1,o);return[i,c]}([t,n],a,r,e,i);u=o[0],h=o[1]}else if("same"===e){u=Math.ceil(t/r),h=Math.ceil(n/o);const e=Math.max(0,(u-1)*r+a-t),i=Math.max(0,(h-1)*o+s-n),c=Math.floor(e/2),d=e-c,p=Math.floor(i/2);l={top:c,bottom:d,left:p,right:i-p,type:"SAME"}}else if("valid"===e)l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-a+1)/r),h=Math.ceil((n-s+1)/o);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));{const d="channelsLast"===c?e[1][0]:e[2][0],p="channelsLast"===c?e[1][1]:e[2][1],f="channelsLast"===c?e[2][0]:e[3][0],m="channelsLast"===c?e[2][1]:e[3][1];l={top:d,bottom:p,left:f,right:m,type:0===d&&0===p&&0===f&&0===m?"VALID":"EXPLICIT"},u=gm((t-a+d+p)/r+1,i),h=gm((n-s+f+m)/o+1,i)}}return{padInfo:l,outHeight:u,outWidth:h}}(o,l,u,m,g,v,w,a,i),_=s?f*h:f;let C;return"channelsFirst"===i?C=[c,_,k,S]:"channelsLast"===i&&(C=[c,k,S,_]),{batchSize:c,dataFormat:i,inHeight:l,inWidth:u,inChannels:h,outHeight:k,outWidth:S,outChannels:_,padInfo:x,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:e,outShape:C,filterShape:t}}function hm(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",i=arguments.length>7?arguments[7]:void 0,[c,l,u,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===s)[c,l,u,h,d]=e;else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));[c,d,l,u,h]=e}const[p,f,m,,g]=t,[y,b,v]=fm(n),[w,x,k]=fm(r),S=mm(p,w),_=mm(f,x),C=mm(m,k),{padInfo:I,outDepth:T,outHeight:N,outWidth:E}=function(e,t,n,r,o,a,s,i,c,l,u){let h,d,p,f;if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};const a=function(e,t,n,r,o,a){null==o&&(o=dm(e,t,r));const s=e[0],i=e[1],c=e[2],l=gm((s-t+2*o)/r+1,a),u=gm((i-t+2*o)/r+1,a),h=gm((c-t+2*o)/r+1,a);return[l,u,h,n]}([t,n,r,1],i,1,o,e,u);d=a[0],p=a[1],f=a[2]}else if("same"===e){d=Math.ceil(t/o),p=Math.ceil(n/a),f=Math.ceil(r/s);const e=(d-1)*o+i-t,u=(p-1)*a+c-n,m=(f-1)*s+l-r,g=Math.floor(e/2),y=e-g,b=Math.floor(u/2),v=u-b,w=Math.floor(m/2);h={top:b,bottom:v,left:w,right:m-w,front:g,back:y,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-i+1)/o),p=Math.ceil((n-c+1)/a),f=Math.ceil((r-l+1)/s)}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(o,l,u,h,y,b,v,S,_,C,i),A=a?g*d:g;let R;return"channelsFirst"===s?R=[c,A,T,N,E]:"channelsLast"===s&&(R=[c,T,N,E,A]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:u,inWidth:h,inChannels:d,outDepth:T,outHeight:N,outWidth:E,outChannels:A,padInfo:I,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:_,effectiveFilterWidth:C,dilationDepth:w,dilationHeight:x,dilationWidth:k,inShape:e,outShape:R,filterShape:t}}function dm(e,t,n){const r=mm(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function pm(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function fm(e){return"number"===typeof e?[e,e,e]:e}function mm(e,t){return t<=1?e:e+(e-1)*(t-1)}function gm(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function ym(e){const[t,n,r]=pm(e);return 1===t&&1===n&&1===r}function bm(e,t){return ym(e)||ym(t)}function vm(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}const wm=Tp({reshape_:function(e,t){const n={x:Cp(e,"x","reshape","string_or_numeric")},r={shape:t};return yp.runKernel(qh,n,r)}});const xm=Tp({avgPool_:function(e,t,n,r,o){const a=Cp(e,"x","avgPool","float32");Jc(bm(n,1),(()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")));let s=a,i=!1;3===a.rank&&(i=!0,s=wm(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Jc(4===s.rank,(()=>"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,"."))),null!=o&&Jc(rl(r),(()=>"Error in avgPool: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")));const c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:o};let u=yp.runKernel(Jl,c,l);return u=ff(u,a.dtype),i?wm(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const km=Tp({avgPool3d_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",s=arguments.length>6?arguments[6]:void 0;null==s?s=[1,1,1]:Hf("dilations is deprecated, this field will be gone in v3.0.0.");const i=Cp(e,"x","avgPool3d","float32");let c=i,l=!1;4===i.rank&&(l=!0,c=wm(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),Jc(5===c.rank,(()=>"Error in avgPool3d: x must be rank 5 but got rank ".concat(c.rank,"."))),Jc("NDHWC"===a,(()=>"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(a))),Jc(bm(n,s),(()=>"Error in avgPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(s,"'"))),null!=o&&Jc(rl(r),(()=>"Error in avgPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")));const u={x:c},h={filterSize:t,strides:n,pad:r,dimRoundingMode:o,dataFormat:a,dilations:s};let d=yp.runKernel($l,u,h);return d=ff(d,c.dtype),l?wm(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const Sm=Tp({concat_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Jc(e.length>=1,(()=>"Pass at least one tensor to concat"));const n=Ip(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((e=>{if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return mf(n[0]);const r=n,o={axis:t};return yp.runKernel(lu,r,o)}});const _m=Tp({matMul_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Cp(e,"a","matMul"),a=Cp(t,"b","matMul");[o,a]=up(o,a);const s={a:o,b:a},i={transposeA:n,transposeB:r};return yp.runKernel(tu,s,i)}});const Cm=Tp({mul_:function(e,t){let n=Cp(e,"a","mul"),r=Cp(t,"b","mul");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(Sh,o)}});const Im=Tp({sigmoid_:function(e){const t={x:Cp(e,"x","sigmoid")};return yp.runKernel(nd,t)}});const Tm=Tp({slice_:function(e,t,n){const r=Cp(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");const o={x:r},a={begin:t,size:n};return yp.runKernel(Zh,o,a)}});const Nm=Tp({tanh_:function(e){const t={x:Cp(e,"x","tanh")};return yp.runKernel(md,t)}});const Em=Tp({basicLSTMCell_:function(e,t,n,r,o,a){const s=Cp(e,"forgetBias","basicLSTMCell"),i=Cp(t,"lstmKernel","basicLSTMCell"),c=Cp(n,"lstmBias","basicLSTMCell"),l=Cp(r,"data","basicLSTMCell"),u=Cp(o,"c","basicLSTMCell"),h=Cp(a,"h","basicLSTMCell"),d=Sm([l,h],1),p=_m(d,i),f=rm(p,c),m=f.shape[0],g=f.shape[1]/4,y=[m,g],b=Tm(f,[0,0],y),v=Tm(f,[0,g],y),w=Tm(f,[0,2*g],y),x=Tm(f,[0,3*g],y),k=rm(Cm(Im(b),Nm(v)),Cm(u,Im(rm(s,w))));return[k,Cm(Nm(k),Im(x))]}});const Am=Tp({batchNorm_:function(e,t,n,r,o,a){null==a&&(a=.001);const s=Cp(e,"x","batchNorm"),i=Cp(t,"mean","batchNorm"),c=Cp(n,"variance","batchNorm");let l,u;null!=o&&(l=Cp(o,"scale","batchNorm")),null!=r&&(u=Cp(r,"offset","batchNorm")),Jc(i.rank===c.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Jc(null==u||i.rank===u.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Jc(null==l||i.rank===l.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const h=function(e){let t;return t=0===e.rank||1===e.rank?wm(e,[1,1,1,e.size]):2===e.rank?wm(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?wm(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e,t}(s),d={x:h,scale:l,offset:u,mean:i,variance:c},p={varianceEpsilon:a},f=yp.runKernel(ju,d,p);return wm(f,s.shape)}});const Rm=Tp({batchNorm2d_:function(e,t,n,r,o,a){const s=Cp(e,"x","batchNorm"),i=Cp(t,"mean","batchNorm"),c=Cp(n,"variance","batchNorm");let l,u;return null!=o&&(l=Cp(o,"scale","batchNorm")),null!=r&&(u=Cp(r,"offset","batchNorm")),Jc(2===s.rank,(()=>"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(s.rank,"."))),Jc(2===i.rank||1===i.rank,(()=>"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(i.rank,"."))),Jc(2===c.rank||1===c.rank,(()=>"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,"."))),null!=l&&Jc(2===l.rank||1===l.rank,(()=>"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,"."))),null!=u&&Jc(2===u.rank||1===u.rank,(()=>"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,"."))),Am(s,i,c,u,l,a)}});const Om=Tp({batchNorm3d_:function(e,t,n,r,o,a){const s=Cp(e,"x","batchNorm"),i=Cp(t,"mean","batchNorm"),c=Cp(n,"variance","batchNorm");let l,u;return null!=o&&(l=Cp(o,"scale","batchNorm")),null!=r&&(u=Cp(r,"offset","batchNorm")),Jc(3===s.rank,(()=>"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(s.rank,"."))),Jc(3===i.rank||1===i.rank,(()=>"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(i.rank,"."))),Jc(3===c.rank||1===c.rank,(()=>"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,"."))),null!=l&&Jc(3===l.rank||1===l.rank,(()=>"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,"."))),null!=u&&Jc(3===u.rank||1===u.rank,(()=>"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,"."))),Am(s,i,c,u,l,a)}});const Mm=Tp({batchNorm4d_:function(e,t,n,r,o,a){const s=Cp(e,"x","batchNorm"),i=Cp(t,"mean","batchNorm"),c=Cp(n,"variance","batchNorm");let l,u;return null!=o&&(l=Cp(o,"scale","batchNorm")),null!=r&&(u=Cp(r,"offset","batchNorm")),Jc(4===s.rank,(()=>"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(s.rank,"."))),Jc(4===i.rank||1===i.rank,(()=>"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(i.rank,"."))),Jc(4===c.rank||1===c.rank,(()=>"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,"."))),null!=l&&Jc(4===l.rank||1===l.rank,(()=>"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,"."))),null!=u&&Jc(4===u.rank||1===u.rank,(()=>"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,"."))),Am(s,i,c,u,l,a)}});const Pm=Tp({clipByValue_:function(e,t,n){const r=Cp(e,"x","clipByValue");Jc(t<=n,(()=>"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")));const o={x:r},a={clipValueMin:t,clipValueMax:n};return yp.runKernel(su,o,a)}});const Dm=Tp({concat1d_:function(e){return Sm(e,0)}});const Fm=Tp({concat2d_:function(e,t){return Sm(e,t)}});const Lm=Tp({concat3d_:function(e,t){return Sm(e,t)}});const zm=Tp({concat4d_:function(e,t){return Sm(e,t)}});const Bm=Tp({conv2d_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0;const i=Cp(e,"x","conv2d"),c=Cp(t,"filter","conv2d");let l=i,u=!1;3===i.rank&&(u=!0,l=wm(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Jc(4===l.rank,(()=>"Error in conv2d: input must be rank 4, but got rank ".concat(l.rank,"."))),Jc(4===c.rank,(()=>"Error in conv2d: filter must be rank 4, but got rank "+"".concat(c.rank,"."))),null!=s&&Jc(rl(r),(()=>"Error in conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(r,".")));const h="NHWC"===o?l.shape[3]:l.shape[1];Jc(h===c.shape[2],(()=>"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(c.shape[2],"."))),Jc(bm(n,a),(()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(a,"'")));const d={x:l,filter:c},p={strides:n,pad:r,dataFormat:o,dilations:a,dimRoundingMode:s},f=yp.runKernel(uu,d,p);return u?wm(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const qm=Tp({conv1d_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0;const i=Cp(e,"x","conv1d"),c=Cp(t,"filter","conv1d");let l=i,u=!1;2===i.rank&&(u=!0,l=wm(i,[1,i.shape[0],i.shape[1]])),Jc(3===l.rank,(()=>"Error in conv1d: input must be rank 3, but got rank ".concat(l.rank,"."))),Jc(3===c.rank,(()=>"Error in conv1d: filter must be rank 3, but got rank "+"".concat(c.rank,"."))),null!=s&&Jc(rl(r),(()=>"Error in conv1d: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(r,"."))),Jc(l.shape[2]===c.shape[1],(()=>"Error in conv1d: depth of input (".concat(l.shape[2],") must match ")+"input depth for filter ".concat(c.shape[1],"."))),Jc(bm(n,a),(()=>"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(a,"'"))),Jc("NWC"===o,(()=>"Error in conv1d: got dataFormat of ".concat(o," but only NWC is currently supported.")));const h=wm(c,[1,c.shape[0],c.shape[1],c.shape[2]]),d=wm(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=Bm(d,h,[1,n],r,"NHWC",[1,a],s);return wm(p,u?[p.shape[2],p.shape[3]]:[p.shape[0],p.shape[2],p.shape[3]])}});const Wm=Tp({conv2DBackpropInput_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0;Jc(e.length===t.rank,(()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")));let i=e,c=t,l=!1;3===t.rank&&(l=!0,c=wm(t,[1,t.shape[0],t.shape[1],t.shape[2]]),i=[1,e[0],e[1],e[2]]),Jc(4===i.length,(()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(i.length,"."))),Jc(4===c.rank,(()=>"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(c.rank))),Jc(4===n.rank,(()=>"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)));const u="NHWC"===a?i[3]:i[1],h="NHWC"===a?c.shape[3]:c.shape[1];Jc(u===n.shape[2],(()=>"Error in conv2dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[2],"."))),Jc(h===n.shape[3],(()=>"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],"."))),null!=s&&Jc(rl(o),(()=>"Error in conv2dDerInput: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(o,".")));const d={dy:c,filter:n},p={strides:r,pad:o,dataFormat:a,dimRoundingMode:s,inputShape:i},f=yp.runKernel(du,d,p);return l?wm(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});const jm=Tp({conv2dTranspose_:function(e,t,n,r,o,a){const s=Cp(e,"x","conv2dTranspose"),i=Cp(t,"filter","conv2dTranspose");return Wm(n,s,i,r,o,"NHWC",a)}});const Vm=Tp({conv3d_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1];const s=Cp(e,"x","conv3d"),i=Cp(t,"filter","conv3d");let c=s,l=!1;4===s.rank&&(l=!0,c=wm(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Jc(5===c.rank,(()=>"Error in conv3d: input must be rank 5, but got rank ".concat(c.rank,"."))),Jc(5===i.rank,(()=>"Error in conv3d: filter must be rank 5, but got rank "+"".concat(i.rank,"."))),Jc(c.shape[4]===i.shape[3],(()=>"Error in conv3d: depth of input (".concat(c.shape[4],") must match ")+"input depth for filter ".concat(i.shape[3],"."))),Jc(bm(n,a),(()=>"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(a,"'"))),Jc("NDHWC"===o,(()=>"Error in conv3d: got dataFormat of ".concat(o," but only NDHWC is currently supported.")));const u={x:c,filter:i},h={strides:n,pad:r,dataFormat:o,dilations:a},d=yp.runKernel(pu,u,h);return l?wm(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const Um=Tp({depthwiseConv2d_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0;const i=Cp(e,"x","depthwiseConv2d"),c=Cp(t,"filter","depthwiseConv2d");let l=i,u=!1;3===i.rank&&(u=!0,l=wm(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Jc(4===l.rank,(()=>"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,"."))),Jc(4===c.rank,(()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(c.rank,"."))),Jc(l.shape[3]===c.shape[2],(()=>"Error in depthwiseConv2d: number of input channels "+"(".concat(l.shape[3],") must match the inChannels dimension in ")+"filter ".concat(c.shape[2],"."))),null!=s&&Jc(rl(r),(()=>"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(r,".")));const h={x:l,filter:c},d={strides:n,pad:r,dataFormat:o,dilations:a,dimRoundingMode:s},p=yp.runKernel(ku,h,d);return u?wm(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});const Gm=Tp({floorDiv_:function(e,t){let n=Cp(e,"a","floorDiv"),r=Cp(t,"b","floorDiv");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(Wu,o)}});const Hm=Tp({div_:function(e,t){let n=Cp(e,"a","div"),r=Cp(t,"b","div");if([n,r]=up(n,r),"int32"===n.dtype&&"int32"===r.dtype)return Gm(n,r);const o={a:n,b:r};return yp.runKernel(Eu,o,{})}});const Km=Tp({elu_:function(e){const t={x:Cp(e,"x","elu")};return yp.runKernel(Au,t)}});function Xm(e,t){const n=e.length,r=[];for(let o=0;o<n;o++){const a=n-1-o,s=e[a]||1;(t[t.length-1-o]||1)>1&&1===s&&r.unshift(a)}return r}function Qm(e,t){const n=[];for(let r=0;r<t.length;r++){const o=e[e.length-r-1],a=t.length-r-1,s=t[a];(null==o||1===o&&s>1)&&n.unshift(a)}return n}function Ym(e,t){const n=[],r=Math.max(e.length,t.length);for(let o=0;o<r;o++){let r=e[e.length-o-1];null==r&&(r=1);let a=t[t.length-o-1];if(null==a&&(a=1),1===r)n.unshift(a);else if(1===a)n.unshift(r);else{if(r!==a){const n="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(n)}n.unshift(r)}}return n}const Jm=Tp({equal_:function(e,t){let n=Cp(e,"a","equal"),r=Cp(t,"b","equal");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(Mu,o)}});const Zm=Tp({expandDims_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Cp(e,"x","expandDims","string_or_numeric");Jc(t<=n.rank,(()=>"Axis must be <= rank of the tensor"));const r={input:n},o={dim:t};return yp.runKernel(Du,r,o)}});const $m=Tp({tile_:function(e,t){const n=Cp(e,"x","tile","string_or_numeric");Jc(n.rank===t.length,(()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")));const r={x:n},o={reps:t};return yp.runKernel(gd,r,o)}});const eg=Tp({eye_:function(e,t,n){null==t&&(t=e);const r=pf([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),o=e<=t?e:t;for(let s=0;s<o;++s)r.set(1,s,s);const a=wm(r.toTensor(),[e,t]);if(null==n)return a;if(1===n.length)return $m(Zm(a,0),[n[0],1,1]);if(2===n.length)return $m(Zm(Zm(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return $m(Zm(Zm(Zm(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});function tg(e,t,n){const r={shape:e,value:t,dtype:n};return yp.runKernel(zu,{},r)}const ng=Tp({floor_:function(e){const t={x:Cp(e,"x","floor")};return yp.runKernel(qu,t)}});const rg=Tp({gather_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o={x:Cp(e,"x","gather"),indices:Cp(t,"indices","gather","int32")},a={axis:n,batchDims:r};return yp.runKernel(Vu,o,a)}});const og=Tp({greater_:function(e,t){let n=Cp(e,"a","greater"),r=Cp(t,"b","greater");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(Gu,o)}});const ag=Tp({greaterEqual_:function(e,t){let n=Cp(e,"a","greaterEqual"),r=Cp(t,"b","greaterEqual");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(Hu,o)}});const sg=Tp({leakyRelu_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;const n={x:Cp(e,"x","leakyRelu")},r={alpha:t};return yp.runKernel($u,n,r)}});const ig=Tp({log_:function(e){const t={x:Cp(e,"x","log")};return yp.runKernel(rh,t)}});const cg=Tp({exp_:function(e){const t={x:Cp(e,"x","exp")};return yp.runKernel(Pu,t)}});const lg=Tp({max_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:Cp(e,"x","max")},o={reductionIndices:t,keepDims:n};return yp.runKernel(uh,r,o)}});const ug=Tp({sub_:function(e,t){let n=Cp(e,"a","sub"),r=Cp(t,"b","sub");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(hd,o)}});const hg=Tp({sum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Cp(e,"x","sum");"bool"===r.dtype&&(r=ff(r,"int32"));const o={x:r},a={axis:t,keepDims:n};return yp.runKernel(ad,o,a)}});const dg=Tp({logSoftmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=Cp(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));const r=$f(((e,n)=>{const r=lg(e,t,!0),o=ug(e,r),a=ug(ff(o,"float32"),ig(hg(cg(o),t,!0)));n([a]);return{value:a,gradFunc:(e,n)=>{const[r]=n,o=cg(r);return ug(e,Cm(hg(e,t,!0),o))}}}));return r(n)}});const pg=Tp({logicalAnd_:function(e,t){const n=Cp(e,"a","logicalAnd","bool"),r=Cp(t,"b","logicalAnd","bool");Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(ah,o)}});const fg=Tp({maxPool_:function(e,t,n,r,o){const a=Cp(e,"x","maxPool");let s=a,i=!1;3===a.rank&&(i=!0,s=wm(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Jc(4===s.rank,(()=>"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,"."))),Jc(bm(n,1),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'"))),null!=o&&Jc(rl(r),(()=>"Error in maxPool: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")));const c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:o},u=yp.runKernel(dh,c,l);return i?wm(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});const mg=Tp({maxPool3d_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",s=arguments.length>6?arguments[6]:void 0;null==s?s=[1,1,1]:Hf("dilations is deprecated, this field will be gone in v3.0.0.");const i=Cp(e,"x","maxPool3d");let c=i,l=!1;4===i.rank&&(l=!0,c=wm(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),Jc(5===c.rank,(()=>"Error in maxPool3d: x must be rank 5 but got rank ".concat(c.rank,"."))),Jc("NDHWC"===a,(()=>"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(a))),Jc(bm(n,s),(()=>"Error in maxPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(s,"'"))),null!=o&&Jc(rl(r),(()=>"Error in maxPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")));const u={x:c},h={filterSize:t,strides:n,pad:r,dimRoundingMode:o,dataFormat:a,dilations:s},d=yp.runKernel(fh,u,h);return l?wm(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});const gg=Tp({maximum_:function(e,t){let n=Cp(e,"a","maximum"),r=Cp(t,"b","maximum");[n,r]=up(n,r),"bool"===n.dtype&&(n=ff(n,"int32"),r=ff(r,"int32")),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(hh,o)}});const yg=Tp({mean_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:Cp(e,"x","mean")},o={axis:t,keepDims:n};return yp.runKernel(yh,r,o)}});const bg=Tp({min_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={x:Cp(e,"x","min")},o={axis:t,keepDims:n};return yp.runKernel(bh,r,o)}});const vg=Tp({minimum_:function(e,t){let n=Cp(e,"a","minimum"),r=Cp(t,"b","minimum");[n,r]=up(n,r),"bool"===n.dtype&&(n=ff(n,"int32"),r=ff(r,"int32")),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(vh,o)}});function wg(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function xg(e,t,n){const r=e.length+t.length,o=[];let a=0,s=0;for(let i=0;i<r;i++)-1===n.indexOf(i)?o.push(e[a++]):o.push(t[s++]);return o}function kg(e,t){const n=[],r=e.length;for(let o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map((t=>e[t]))]}function Sg(e,t){return xg(e,t.map((e=>1)),t)}function _g(e,t,n){Jc(wg(t,n),(()=>"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")))}function Cg(e,t){if(wg(e,t))return null;const n=[];for(let r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((e=>n.push(e))),n}function Ig(e){return e.map(((e,t)=>[t,e])).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]))}function Tg(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}const Ng=Tp({square_:function(e){const t=Cp(e,"x","square");return yp.runKernel("Square",{x:t},{})}});const Eg=Tp({moments_:function(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=cl(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=Cp(e,"x","moments")).shape),r=yg(e,n,t);let o=r.shape;t||(o=Sg(r.shape,n));const a=Ng(ug(ff(e,"float32"),wm(r,o)));return{mean:r,variance:yg(a,n,t)}}});const Ag=Tp({multiRNNCell_:function(e,t,n,r){const o=Cp(t,"data","multiRNNCell"),a=Ip(n,"c","multiRNNCell"),s=Ip(r,"h","multiRNNCell");let i=o;const c=[];for(let h=0;h<e.length;h++){const t=e[h](i,a[h],s[h]);c.push(t[0]),c.push(t[1]),i=t[1]}const l=[],u=[];for(let h=0;h<c.length;h+=2)l.push(c[h]),u.push(c[h+1]);return[l,u]}});const Rg=Tp({multinomial_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=Cp(e,"logits","multinomial"),a=o.size,s=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(a,"."));if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(s));n=n||Math.random();const i={logits:1===s?wm(o,[1,-1]):o},c={numSamples:t,seed:n,normalized:r},l=yp.runKernel(kh,i,c);return 1===s?wm(l,[l.size]):l}});const Og=Tp({neg_:function(e){const t={x:Cp(e,"x","neg")};return yp.runKernel(_h,t)}});const Mg=Tp({notEqual_:function(e,t){let n=Cp(e,"a","notEqual"),r=Cp(t,"b","notEqual");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(Ch,o)}});const Pg=Tp({oneHot_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));const o={indices:Cp(e,"indices","oneHot","int32")},a={depth:t,onValue:n,offValue:r};return yp.runKernel(Ah,o,a)}});function Dg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){const t=Dg(e,"float32"),n=Dg(e,"float32");return Np(t,n)}const n=_l(tl(e),t);return yp.makeTensor(n,e,t)}function Fg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){const t=Fg(e,"float32"),n=Dg(e,"float32");return Np(t,n)}const n=Sl(tl(e),t);return yp.makeTensor(n,e,t)}const Lg=Tp({onesLike_:function(e){const t={x:Cp(e,"x","onesLike")};return yp.runKernel(Eh,t)}});const zg=Tp({pad_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Cp(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:t,constantValue:n},a={x:r};return yp.runKernel(Oh,a,o)}});const Bg=Tp({prelu_:function(e,t){const n={x:Cp(e,"x","prelu"),alpha:Cp(t,"alpha","prelu")};return yp.runKernel(Ph,n)}});var qg=__webpack_require__(9815);class Wg{constructor(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const a=o||Math.random();this.random=qg.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const e=this.nextVal;return this.nextVal=NaN,e}let e,t,n=!1;for(;!n;){let r,o,a;do{r=2*this.random()-1,o=2*this.random()-1,a=r*r+o*o}while(a>=1||0===a);const s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*s,t=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(e)||(n=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class jg{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"===typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=qg.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const Vg=Tp({randomNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));const a=new Wg(t,n,r,!1,o),s=pf(e,r);for(let i=0;i<s.values.length;i++)s.values[i]=a.nextValue();return s.toTensor()}});const Ug=Tp({randomUniform_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>4?arguments[4]:void 0;const o=pf(e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=new jg(t,n,null,r);for(let s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}});const Gg=Tp({relu_:function(e){const t={x:Cp(e,"x","relu")};return yp.runKernel(Bh,t)}});const Hg=Tp({reverse_:function(e,t){const n={x:Cp(e,"x","reverse")},r={dims:t};return yp.runKernel(Hh,n,r)}});const Kg=Tp({selu_:function(e){const t={x:Cp(e,"x","selu")};return yp.runKernel(Jh,t)}});const Xg=Tp({separableConv2d_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC";const i=Cp(e,"x","separableConv2d"),c=Cp(t,"depthwiseFilter","separableConv2d"),l=Cp(n,"pointwiseFilter","separableConv2d");let u=i,h=!1;if(3===i.rank&&(h=!0,u=wm(i,[1,i.shape[0],i.shape[1],i.shape[2]])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Jc(4===u.rank,(()=>"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(u.rank,"."))),Jc(4===c.rank,(()=>"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(c.rank,"."))),Jc(4===l.rank,(()=>"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(c.rank,"."))),Jc(1===l.shape[0],(()=>"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(l.shape[0],"."))),Jc(1===l.shape[1],(()=>"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(l.shape[1],".")));const d=c.shape[2],p=c.shape[3];Jc(l.shape[2]===d*p,(()=>"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(d*p,", ")+"but got ".concat(l.shape[2],".")));const f=Um(u,c,r,o,s,a),m=Bm(f,l,1,"valid",s);return h?wm(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});const Qg=Tp({slice1d_:function(e,t,n){const r=Cp(e,"x","slice1d");return Jc(1===r.rank,(()=>"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor"))),Tm(r,[t],[n])}});const Yg=Tp({slice2d_:function(e,t,n){const r=Cp(e,"x","slice2d");return Jc(2===r.rank,(()=>"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor"))),Tm(r,t,n)}});const Jg=Tp({slice3d_:function(e,t,n){const r=Cp(e,"x","slice3d");return Jc(3===r.rank,(()=>"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor"))),Tm(r,t,n)}});const Zg=Tp({slice4d_:function(e,t,n){const r=Cp(e,"x","slice4d");return Jc(4===r.rank,(()=>"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor"))),Tm(r,t,n)}});const $g=Tp({softmax_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=Cp(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));const r={logits:n},o={dim:t};return yp.runKernel(cd,r,o)}});const ey=Tp({softplus_:function(e){const t={x:Cp(e,"x","softplus")};return yp.runKernel(rd,t)}});const ty=Tp({split_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={x:Cp(e,"x","split")},o={numOrSizeSplits:t,axis:n};return yp.runKernel(id,r,o)}});const ny=Tp({sqrt_:function(e){const t={x:Cp(e,"x","sqrt")};return yp.runKernel(od,t)}});const ry=Tp({squeeze_:function(e,t){const n=Cp(e,"x","squeeze");return wm(n,ll(n.shape,t).newShape)}});const oy=Tp({stack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Ip(e,"tensors","stack","string_or_numeric");Jc(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&Jc(t<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const r=n,o={axis:t};return yp.runKernel(Rh,r,o)}});function ay(e,t){$c(e);const n=kp(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ep(e,null,n,t)}function sy(e,t,n){if($c(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");const r=kp(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ep(e,t,r,n)}const iy=Tp({truncatedNormal_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const a=new Wg(t,n,r,!0,o),s=pf(e,r);for(let i=0;i<s.values.length;i++)s.values[i]=a.nextValue();return s.toTensor()}});const cy=Tp({unstack_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Cp(e,"x","unstack","string_or_numeric");Jc(t>=-n.shape.length&&t<n.shape.length,(()=>"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")));const r={value:n},o={axis:t};return yp.runKernel(wd,r,o)}});const ly=Tp({broadcastTo_:function(e,t){let n=Cp(e,"broadcastTo","x");const r=n.shape;if(t.some((e=>!(e>0)||e%1!==0)))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){const e=n.shape.slice();for(;e.length<t.length;)e.unshift(1);n=wm(n,e)}const o=n.shape,a=Array.from(t);for(let l=t.length-1;l>=0;l--)if(o[l]===t[l])a[l]=1;else if(1!==n.shape[l])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));const s=a.map(((e,t)=>e>1?t:-1)).filter((e=>e>=0));if(0===s.length)return mf(n);const i={x:n},c={reps:a};return yp.runKernel(gd,i,c)}});const uy=Tp({where_:function(e,t,n){const r=Cp(t,"a","where"),o=Cp(n,"b","where"),a=Cp(e,"condition","where","bool"),s=Ym(r.shape,o.shape),i=ly(r,s),c=ly(o,s);1===a.rank&&Jc(a.shape[0]===r.shape[0],(()=>"The first dimension of `a` must match the size of `condition`.")),1!==a.rank&&Zc(a.shape,c.shape,"Error in where: ");const l={condition:a,t:i,e:c};return yp.runKernel(Yh,l)}});const hy=Tp({zerosLike_:function(e){const t={x:Cp(e,"x","zerosLike")};return yp.runKernel(kd,t)}});const dy=Tp({transpose_:function(e,t){const n=Cp(e,"x","transpose");if(null==t&&(t=n.shape.map(((e,t)=>t)).reverse()),Jc(n.rank===t.length,(()=>"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(t,"."))),t.forEach((e=>{Jc(e>=0&&e<n.rank,(()=>"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(t)))})),n.rank<=1)return n.clone();const r={x:n},o={perm:t};return yp.runKernel(bd,r,o)}});const py=Tp({dropout_:function(e,t,n,r){const o=Cp(e,"x","dropout");if(Jc("float32"===o.dtype,(()=>"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(o.dtype," tensor instead."))),Jc(t>=0&&t<1,(()=>"rate must be a float in the range [0, 1), but got ".concat(t,"."))),0===t)return e instanceof ep?o.clone():o;const a=function(e,t){if(null==t)return e.shape.slice();if(nl(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),s=1-t,i=Hm(ng(rm(Ug(a,0,1,"float32",r),s)),s);return Cm(o,i)}});const fy=Tp({imag_:function(e){const t={input:Cp(e,"input","imag")};return yp.runKernel(Qu,t)}});const my=Tp({real_:function(e){const t={input:Cp(e,"input","real")};return yp.runKernel(Lh,t)}});const gy=Tp({fft_:function(e){Jc("complex64"===e.dtype,(()=>"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")));const t={input:e};return yp.runKernel(Lu,t)}});const yy=Tp({rfft_:function(e,t){Jc("float32"===e.dtype,(()=>"The dtype for rfft() must be real value but got ".concat(e.dtype)));let n=e.shape[e.shape.length-1];const r=e.size/n;let o;if(null!=t&&t<n){const r=e.shape.map((e=>0)),a=e.shape.map((e=>e));a[e.shape.length-1]=t,o=Tm(e,r,a),n=t}else if(null!=t&&t>n){const r=e.shape.map((e=>e));r[e.shape.length-1]=t-n,o=Sm([e,Dg(r)],e.shape.length-1),n=t}else o=e;const a=hy(o),s=wm(Np(o,a),[r,n]),i=gy(s),c=Math.floor(n/2)+1,l=my(i),u=fy(i),h=ty(l,[c,n-c],l.shape.length-1),d=ty(u,[c,n-c],u.shape.length-1),p=o.shape.slice();return p[o.shape.length-1]=c,wm(Np(h[0],d[0]),p)}});const by=Tp({ifft_:function(e){Jc("complex64"===e.dtype,(()=>"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")));const t={input:e};return yp.runKernel(Xu,t)}});const vy=Tp({irfft_:function(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const o=wm(e,[n,t]);r=by(o)}else{const o=[n,2*(t-1)],a=wm(my(e),[n,t]),s=wm(fy(e),[n,t]),i=Hg(Tm(a,[0,1],[n,t-2]),1),c=Cm(Hg(Tm(s,[0,1],[n,t-2]),1),em(-1)),l=Sm([a,i],1),u=Sm([s,c],1),h=wm(Np(l,u),[o[0],o[1]]);r=by(h)}if(r=my(r),3===e.rank&&0!==e.shape[0]){const t=r,n=e.shape[0];r=wm(r,[n,r.shape[0]/n,r.shape[1]]),t.dispose()}return r}});const wy=Tp({conv2DBackpropFilter_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",s=arguments.length>6?arguments[6]:void 0,i=e;3===e.rank&&(i=wm(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;3===c.rank&&(c=wm(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Jc(4===i.rank,(()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(i.shape,"."))),Jc(4===c.rank,(()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(c.shape,"."))),Jc(4===n.length,(()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")));const l="NHWC"===a?i.shape[3]:i.shape[1],u="NHWC"===a?c.shape[3]:c.shape[1];Jc(l===n[2],(()=>"Error in conv2dDerFilter: depth of input ".concat(l,") must ")+"match input depth in filter (".concat(n[2],"."))),Jc(u===n[3],(()=>"Error in conv2dDerFilter: depth of dy (".concat(u,") must ")+"match output depth for filter (".concat(n[3],")."))),null!=s&&Jc(rl(o),(()=>"Error in conv2dDerFilter: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(o,".")));const h={x:i,dy:c},d={strides:r,pad:o,dataFormat:a,dimRoundingMode:s,filterShape:n};return yp.runKernel(hu,h,d)}});const xy=Tp({relu6_:function(e){const t={x:Cp(e,"x","relu6")};return yp.runKernel(Gh,t)}});const ky=Tp({step_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:Cp(e,"x","step")},r={alpha:t};return yp.runKernel(Sd,n,r)}});function Sy(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Cm(e,ky(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function _y(e,t){let n=t;const r=Qm(e.shape,t.shape);return r.length>0&&(n=hg(n,r)),wm(n,e.shape)}function Cy(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Gg(e);if("elu"===t)return Km(e);if("relu6"===t)return xy(e);if("prelu"===t)return Bg(e,n);if("leakyrelu"===t)return sg(e,r);throw new Error("Unknown fused activation ".concat(t,"."))}const Iy=(e,t)=>!(e>0)||"linear"===t;const Ty=Tp({fusedConv2d_:function(e){let{x:t,filter:n,strides:r,pad:o,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:c,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(l=l||"linear",!1===Iy(yp.state.gradientDepth,l)){let e=Bm(t,n,r,o,a,s,i);return null!=c&&(e=rm(e,c)),Cy(e,l,u,h)}const d=Cp(t,"x","conv2d"),p=Cp(n,"filter","conv2d");let f=d,m=!1;3===d.rank&&(m=!0,f=wm(d,[1,d.shape[0],d.shape[1],d.shape[2]])),Jc(4===f.rank,(()=>"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(f.rank,"."))),Jc(4===p.rank,(()=>"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(p.rank,"."))),null!=i&&Jc(rl(o),(()=>"Error in fused conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(i," but got pad ").concat(o,"."))),Jc(f.shape[3]===p.shape[2],(()=>"Error in conv2d: depth of input (".concat(f.shape[3],") must match ")+"input depth for filter ".concat(p.shape[2],"."))),Jc(bm(r,s),(()=>"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(s,"'"))),Jc("NHWC"===a,(()=>"Error in conv2d: got dataFormat of ".concat(a," but only NHWC is currently supported.")));const g=um(f.shape,p.shape,r,s,o,i);let y,b;null!=c&&(y=Cp(c,"bias","fused conv2d"),[y]=up(y,d),Ym(g.outShape,y.shape)),null!=u&&(b=Cp(u,"prelu weights","fused conv2d"));const v=(e,t)=>{const[n,a,i,c]=t,u=Sy(e,i,l);Jc(ym(s),(()=>"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(s,"'")));const h=[Wm(a.shape,u,n,r,o),wy(a,u,n.shape,r,o)];if(null!=c){const e=_y(c,u);h.push(e)}return h},w={x:f,filter:p,bias:y,preluActivationWeights:b},x={strides:r,pad:o,dataFormat:a,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:h};if(null==c){const e=$f(((e,t,n)=>{let r=yp.runKernel(Td,w,x);return n([t,e,r]),m&&(r=wm(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return e(f,p)}{const e=$f(((e,t,n,r)=>{let o=yp.runKernel(Td,w,x);return r([t,e,o,n]),m&&(o=wm(o,[o.shape[1],o.shape[2],o.shape[3]])),{value:o,gradFunc:v}}));return e(f,p,y)}}});const Ny=Tp({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,i=e;3===e.rank&&(i=wm(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;3===c.rank&&(c=wm(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:i,dy:c},u={strides:r,pad:o,dimRoundingMode:s,dilations:a,filterShape:n};return yp.runKernel(Su,l,u)}});const Ey=Tp({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],s=arguments.length>6?arguments[6]:void 0,i=t,c=!1;3===t.rank&&(c=!0,i=wm(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:i,filter:n},u={strides:r,pad:o,dimRoundingMode:s,dilations:a,inputShape:e},h=yp.runKernel(_u,l,u);return c?wm(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});Tp({fusedDepthwiseConv2d_:function(e){let{x:t,filter:n,strides:r,pad:o,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:c,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}=e;if(!1===Iy(yp.state.gradientDepth,l)){let e=Um(t,n,r,o,a,s,i);return null!=c&&(e=rm(e,c)),Cy(e,l,u,h)}const d=Cp(t,"x","depthwiseConv2d"),p=Cp(n,"filter","depthwiseConv2d");let f=d,m=!1;3===d.rank&&(m=!0,f=wm(d,[1,d.shape[0],d.shape[1],d.shape[2]])),Jc(4===f.rank,(()=>"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(f.rank,"."))),Jc(4===p.rank,(()=>"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(p.rank,"."))),Jc(f.shape[3]===p.shape[2],(()=>"Error in fused depthwiseConv2d: number of input channels "+"(".concat(f.shape[3],") must match the inChannels dimension in ")+"filter ".concat(p.shape[2],"."))),null==s&&(s=[1,1]),Jc(bm(r,s),(()=>"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(s,"'"))),null!=i&&Jc(rl(o),(()=>"Error in fused depthwiseConv2d: pad must be an integer when "+"using dimRoundingMode ".concat(i," but got pad ").concat(o,".")));const g=um(f.shape,p.shape,r,s,o,i,!0);let y,b;null!=c&&(y=Cp(c,"bias","fused conv2d"),[y]=up(y,d),Ym(g.outShape,y.shape)),null!=u&&(b=Cp(u,"prelu weights","fused depthwiseConv2d"));const v=(e,t)=>{Jc(ym(s),(()=>"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")));const[n,a,c,u]=t,h=Sy(e,c,l),d=Ey(a.shape,h,n,r,o,s,i),p=Ny(a,h,n.shape,r,o,s,i);if(null!=u){return[d,p,_y(y,h)]}return[d,p]},w={x:f,filter:p,bias:y,preluActivationWeights:b},x={strides:r,pad:o,dataFormat:a,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:h};if(null==c){const e=$f(((e,t,n)=>{let r=yp.runKernel(Nd,w,x);return n([t,e,r]),m&&(r=wm(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:v}}));return e(f,p)}{const e=$f(((e,t,n,r)=>{let o=yp.runKernel(Nd,w,x);return r([t,e,o,n]),m&&(o=wm(o,[o.shape[1],o.shape[2],o.shape[3]])),{value:o,gradFunc:v}}));return e(f,p,y)}}});const Ay=Tp({fusedMatMul_:function(e){let{a:t,b:n,transposeA:r=!1,transposeB:o=!1,bias:a,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:c}=e;if(!1===Iy(yp.state.gradientDepth,s)){let e=_m(t,n,r,o);return null!=a&&(e=rm(e,a)),Cy(e,s,i,c)}let l=Cp(t,"a","fused matMul"),u=Cp(n,"b","fused matMul");[l,u]=up(l,u);const h=r?l.shape[l.rank-2]:l.shape[l.rank-1],d=o?u.shape[u.rank-1]:u.shape[u.rank-2],p=r?l.shape[l.rank-1]:l.shape[l.rank-2],f=o?u.shape[u.rank-2]:u.shape[u.rank-1],m=l.shape.slice(0,-2),g=u.shape.slice(0,-2),y=tl(m),b=tl(g);Jc(l.rank>=2&&u.rank>=2&&l.rank===u.rank,(()=>"Error in fused matMul: inputs must have the same rank of at "+"least 2, got ranks ".concat(l.rank," and ").concat(u.rank,"."))),Jc(nl(m,g),(()=>"Error in fused matMul: outer dimensions (".concat(m,") and (")+"".concat(g,") of Tensors with shapes ").concat(l.shape," and ")+"".concat(u.shape," must match."))),Jc(h===d,(()=>"Error in fused matMul: inner shapes (".concat(h,") and (")+"".concat(d,") of Tensors with shapes ").concat(l.shape," and ")+"".concat(u.shape," and transposeA=").concat(r)+" and transposeB=".concat(o," must match.")));const v=l.shape.slice(0,-2).concat([p,f]),w=wm(l,r?[y,h,p]:[y,p,h]),x=wm(u,o?[b,f,d]:[b,d,f]);let k,S;null!=a&&(k=Cp(a,"bias","fused matMul"),[k]=up(k,l),Ym(v,k.shape)),null!=i&&(S=Cp(i,"prelu weights","fused matMul"));const _=(e,t)=>{const[n,i,c,l]=t,u=Sy(wm(e,c.shape),c,s);let h,d;if(r||o?!r&&o?(h=_m(u,i,!1,!1),d=_m(u,n,!0,!1)):r&&!o?(h=_m(i,u,!1,!0),d=_m(n,u,!1,!1)):(h=_m(i,u,!0,!0),d=_m(u,n,!0,!0)):(h=_m(u,i,!1,!0),d=_m(n,u,!0,!1)),null!=a){return[h,d,_y(l,u)]}return[h,d]},C={a:w,b:x,bias:k,preluActivationWeights:S},I={transposeA:r,transposeB:o,activation:s,leakyreluAlpha:c};if(null==a){const e=$f(((e,t,n)=>{const r=yp.runKernel(Id,C,I);return n([e,t,r]),{value:wm(r,v),gradFunc:_}}));return e(w,x)}{const e=$f(((e,t,n,r)=>{const o=yp.runKernel(Id,C,I);return r([e,t,o,n]),{value:wm(o,v),gradFunc:_}}));return e(w,x,k)}}});function Ry(e,t,n){const r=1-e%2,o=new Float32Array(e);for(let a=0;a<e;++a){const s=2*Math.PI*a/(e+r-1);o[a]=t-n*Math.cos(s)}return ay(o,"float32")}Tp({hammingWindow_:function(e){return Ry(e,.54,.46)}});const Oy=Tp({hannWindow_:function(e){return Ry(e,.5,.5)}});const My=Tp({frame_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=0;const s=[];for(;a+t<=e.size;)s.push(Tm(e,a,t)),a+=n;if(r)for(;a<e.size;){const r=a+t-e.size,i=Sm([Tm(e,a,t-r),tg([r],o)]);s.push(i),a+=n}return 0===s.length?sy([],[0,t]):wm(Sm(s),[s.length,t])}});Tp({stft_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oy;null==r&&(r=function(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}(t));const a=My(e,t,n),s=Cm(a,o(t)),i=[];for(let c=0;c<a.shape[0];c++)i.push(yy(Tm(s,[c,0],[1,t]),r));return Sm(i)}});Tp({cropAndResize_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=Cp(e,"image","cropAndResize"),i=Cp(t,"boxes","cropAndResize","float32"),c=Cp(n,"boxInd","cropAndResize","int32"),l=i.shape[0];Jc(4===s.rank,(()=>"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(s.rank,"."))),Jc(2===i.rank&&4===i.shape[1],(()=>"Error in cropAndResize: boxes must be have size [".concat(l,",4] ")+"but had shape ".concat(i.shape,"."))),Jc(1===c.rank&&c.shape[0]===l,(()=>"Error in cropAndResize: boxInd must be have size [".concat(l,"] ")+"but had shape ".concat(i.shape,"."))),Jc(2===r.length,(()=>"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,"."))),Jc(r[0]>=1&&r[1]>=1,(()=>"cropSize must be atleast [1,1], but was ".concat(r))),Jc("bilinear"===o||"nearest"===o,(()=>"method must be bilinear or nearest, but was ".concat(o)));const u={image:s,boxes:i,boxInd:c},h={method:o,extrapolationValue:a,cropSize:r};return yp.runKernel(vu,u,h)}});Tp({flipLeftRight_:function(e){const t=Cp(e,"image","flipLeftRight","float32");Jc(4===t.rank,(()=>"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")));const n={image:t};return yp.runKernel(Bu,n,{})}});Tp({rotateWithOffset_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;const o=Cp(e,"image","rotateWithOffset","float32");Jc(4===o.rank,(()=>"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(o.rank,".")));const a={image:o},s={radians:t,fillValue:n,center:r};return yp.runKernel(Cd,a,s)}});function Py(e,t,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);const s=e.shape[0];return n=Math.min(n,s),Jc(0<=r&&r<=1,(()=>"iouThreshold must be in [0, 1], but was '".concat(r,"'"))),Jc(2===e.rank,(()=>"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'"))),Jc(4===e.shape[1],(()=>"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1]))),Jc(1===t.rank,(()=>"scores must be a 1D tensor")),Jc(t.shape[0]===s,(()=>"scores has incompatible shape with boxes. Expected ".concat(s,", ")+"but was ".concat(t.shape[0]))),Jc(0<=a&&a<=1,(()=>"softNmsSigma must be in [0, 1], but was '".concat(a,"'"))),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}Tp({nonMaxSuppression_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY;const a=Cp(e,"boxes","nonMaxSuppression"),s=Cp(t,"scores","nonMaxSuppression"),i=Py(a,s,n,r,o);n=i.maxOutputSize,r=i.iouThreshold,o=i.scoreThreshold;const c={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return yp.runKernel(Ih,{boxes:a,scores:s},c)}});function Dy(e,t,n){const r=function(e,t,n){return function(e,t,n){let r=0,o=e.length,a=0,s=!1;for(;r<o;){a=r+(o-r>>>1);const i=n(t,e[a]);i>0?r=a+1:(o=a,s=!i)}return s?r:-r-1}(e,t,n||Fy)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function Fy(e,t){return e>t?1:e<t?-1:0}function Ly(e,t,n,r,o){return qy(e,t,n,r,o,0)}function zy(e,t,n,r,o,a){return qy(e,t,n,r,o,0,!1,a,!0)}function By(e,t,n,r,o,a){return qy(e,t,n,r,o,a,!0)}function qy(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const l=[];for(let g=0;g<t.length;g++)t[g]>o&&l.push({score:t[g],boxIndex:g,suppressBeginIndex:0});l.sort(Vy);const u=a>0?-.5/a:0,h=[],d=[];for(;h.length<n&&l.length>0;){const t=l.pop(),{score:n,boxIndex:a,suppressBeginIndex:s}=t;if(n<o)break;let i=!1;for(let c=h.length-1;c>=s;--c){const n=Wy(e,a,h[c]);if(n>=r){i=!0;break}if(t.score=t.score*jy(r,u,n),t.score<=o)break}t.suppressBeginIndex=h.length,i||(t.score===n?(h.push(a),d.push(t.score)):t.score>o&&Dy(l,t,Vy))}const p=h.length,f=n-p;i&&f>0&&(h.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));const m={selectedIndices:h};return s&&(m.selectedScores=d),c&&(m.validOutputs=p),m}function Wy(e,t,n){const r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),i=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),p=(i-a)*(c-s),f=(h-l)*(d-u);if(p<=0||f<=0)return 0;const m=Math.max(a,l),g=Math.max(s,u),y=Math.min(i,h),b=Math.min(c,d),v=Math.max(y-m,0)*Math.max(b-g,0);return v/(p+f-v)}function jy(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function Vy(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}Tp({nonMaxSuppressionWithScore_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=Cp(e,"boxes","nonMaxSuppression"),i=Cp(t,"scores","nonMaxSuppression"),c=Py(s,i,n,r,o,a);n=c.maxOutputSize,r=c.iouThreshold,o=c.scoreThreshold,a=c.softNmsSigma;const l={boxes:s,scores:i},u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a},h=yp.runKernel(Nh,l,u);return{selectedIndices:h[0],selectedScores:h[1]}}});Tp({nonMaxSuppressionPadded_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=Cp(e,"boxes","nonMaxSuppression"),i=Cp(t,"scores","nonMaxSuppression"),c=Py(s,i,n,r,o,null),l={boxes:s,scores:i},u={maxOutputSize:c.maxOutputSize,iouThreshold:c.iouThreshold,scoreThreshold:c.scoreThreshold,padToMaxOutputSize:a},h=yp.runKernel(Th,l,u);return{selectedIndices:h[0],validOutputs:h[1]}}});const Uy=Tp({resizeBilinear_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=Cp(e,"images","resizeBilinear");Jc(3===o.rank||4===o.rank,(()=>"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(o.rank,"."))),Jc(2===t.length,(()=>"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,"."))),Jc(!1===r||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let a=o,s=!1;3===o.rank&&(s=!0,a=wm(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const[]=t,i={images:a},c={alignCorners:n,halfPixelCenters:r,size:t},l=yp.runKernel(Vh,i,c);return s?wm(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const Gy=Tp({resizeNearestNeighbor_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=Cp(e,"images","resizeNearestNeighbor");Jc(3===o.rank||4===o.rank,(()=>"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(o.rank,"."))),Jc(2===t.length,(()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,"."))),Jc("float32"===o.dtype||"int32"===o.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),Jc(!1===r||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let a=o,s=!1;3===o.rank&&(s=!0,a=wm(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const[]=t,i={images:a},c={alignCorners:n,halfPixelCenters:r,size:t},l=yp.runKernel(Wh,i,c);return s?wm(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});const Hy=Tp({lessEqual_:function(e,t){let n=Cp(e,"a","lessEqual"),r=Cp(t,"b","lessEqual");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(th,o)}});function Ky(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");const o={start:e,stop:t,step:n,dtype:r};return yp.runKernel(Fh,{},o)}const Xy=Tp({bandPart_:function(e,t,n){Jc(t%1===0,(()=>"bandPart(): numLower must be an integer, got ".concat(t,"."))),Jc(n%1===0,(()=>"bandPart(): numUpper must be an integer, got ".concat(n,".")));const r=Cp(e,"a","bandPart");Jc(r.rank>=2,(()=>"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")));const o=r.shape,[a,s]=r.shape.slice(-2);if(!(t<=a))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(a,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,")."));t<0&&(t=a),n<0&&(n=s);const i=wm(Ky(0,a,1,"int32"),[-1,1]),c=Ky(0,s,1,"int32"),l=ug(i,c),u=pg(Hy(l,em(+t,"int32")),ag(l,em(-n,"int32"))),h=Dg([a,s],r.dtype);return wm(oy(cy(wm(r,[-1,a,s])).map((e=>uy(u,e,h)))),o)}});const Qy=Tp({pow_:function(e,t){let n=Cp(e,"base","pow"),r=Cp(t,"exp","pow");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(Mh,o)}});function Yy(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return nm(e);if(1!==e.rank&&null===n)return Yy(wm(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return hg(nm(e),n);if(t===1/0)return lg(nm(e),n);if(t===-1/0)return bg(nm(e),n);if("euclidean"===t||2===t)return ny(hg(Qy(nm(e),em(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return lg(hg(nm(e),n[0]),n[1]-1);if(t===1/0)return lg(hg(nm(e),n[1]),n[0]);if(t===-1/0)return bg(hg(nm(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return ny(hg(Ng(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}const Jy=Tp({norm_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=Yy(e=Cp(e,"x","norm"),t,n);let a=o.shape;if(r){const t=cl(n,e.shape);a=Sg(o.shape,t)}return wm(o,a)}});const Zy=Tp({gramSchmidt_:function(e){let t;if(Array.isArray(e)){t=!1,Jc(null!=e&&e.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=e[0].shape[0];for(let t=1;t<e.length;++t)Jc(e[t].shape[0]===n,(()=>"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")))}else t=!0,e=ty(e,e.shape[0],0).map((e=>ry(e,[0])));Jc(e.length<=e[0].shape[0],(()=>"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")));const n=[],r=e;for(let o=0;o<e.length;++o)n.push(yp.tidy((()=>{let e=r[o];if(o>0)for(let t=0;t<o;++t){const r=Cm(hg(Cm(n[t],e)),n[t]);e=ug(e,r)}return Hm(e,Jy(e,"euclidean"))})));return t?oy(n,0):n}});function $y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return yp.tidy((()=>{Jc(2===e.shape.length,(()=>"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")));const n=e.shape[0],r=e.shape[1];let o=eg(n),a=mf(e);const s=sy([[1]],[1,1]);let i=mf(s);const c=n>=r?r:n;for(let e=0;e<c;++e){const t=a,c=i,l=o;[i,a,o]=yp.tidy((()=>{const t=Tm(a,[e,e],[n-e,1]),c=Jy(t),l=Tm(a,[e,e],[1,1]),u=uy(og(l,0),sy([[-1]]),sy([[1]])),h=ug(l,Cm(u,c)),d=Hm(t,h);i=1===d.shape[0]?mf(s):Sm([s,Tm(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const p=Og(Hm(_m(u,h),c)),f=Tm(a,[e,0],[n-e,r]),m=Cm(p,i),g=dy(i);if(0===e)a=ug(f,_m(m,_m(g,f)));else{const t=ug(f,_m(m,_m(g,f)));a=Sm([Tm(a,[0,0],[e,r]),t],0)}const y=dy(m),b=Tm(o,[0,e],[n,o.shape[1]-e]);if(0===e)o=ug(b,_m(_m(b,i),y));else{const t=ug(b,_m(_m(b,i),y));o=Sm([Tm(o,[0,0],[n,e]),t],1)}return[i,a,o]})),Yf([t,c,l])}return!t&&n>r&&(o=Tm(o,[0,0],[n,r]),a=Tm(a,[0,0],[r,r])),[o,a]}))}const eb=Tp({qr_:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Jc(e.rank>=2,(()=>"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank))),2===e.rank)return $y(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce(((e,t)=>e*t)),r=cy(wm(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];r.forEach((e=>{const[n,r]=$y(e,t);o.push(n),a.push(r)}));return[wm(oy(o,0),e.shape),wm(oy(a,0),e.shape)]}}});var tb;!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(tb||(tb={}));const nb=Tp({computeWeightedLoss_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tb.SUM_BY_NONZERO_WEIGHTS;const r=Cp(e,"losses","computeWeightedLoss");let o=null;null!=t&&(o=Cp(t,"weights","computeWeightedLoss"));const a=null==o?r:Cm(r,o);if(n===tb.NONE)return a;if(n===tb.SUM)return hg(a);if(n===tb.MEAN){if(null==o)return yg(a);{const e=r.size/o.size,t=Hm(hg(a),hg(o));return e>1?Hm(t,em(e)):t}}if(n===tb.SUM_BY_NONZERO_WEIGHTS){if(null==o)return Hm(hg(a),em(r.size));{const e=Cm(o,Fg(r.shape)),t=ff(hg(Mg(e,em(0))),"float32");return Hm(hg(a),t)}}throw Error("Unknown reduction: ".concat(n))}});Tp({absoluteDifference_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tb.SUM_BY_NONZERO_WEIGHTS;const o=Cp(e,"labels","absoluteDifference"),a=Cp(t,"predictions","absoluteDifference");let s=null;null!=n&&(s=Cp(n,"weights","absoluteDifference")),Zc(o.shape,a.shape,"Error in absoluteDifference: ");const i=nm(ug(o,a));return nb(i,s,r)}});Tp({cosineDistance_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tb.SUM_BY_NONZERO_WEIGHTS;const a=Cp(e,"labels","cosineDistance"),s=Cp(t,"predictions","cosineDistance");let i=null;null!=r&&(i=Cp(r,"weights","cosineDistance")),Zc(a.shape,s.shape,"Error in cosineDistance: ");const c=em(1),l=ug(c,hg(Cm(a,s),n,!0));return nb(l,i,o)}});Tp({hingeLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tb.SUM_BY_NONZERO_WEIGHTS,o=Cp(e,"labels","hingeLoss");const a=Cp(t,"predictions","hingeLoss");let s=null;null!=n&&(s=Cp(n,"weights","hingeLoss")),Zc(o.shape,a.shape,"Error in hingeLoss: ");const i=em(1);o=ug(Cm(em(2),o),i);const c=Gg(ug(i,Cm(o,a)));return nb(c,s,r)}});Tp({huberLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tb.SUM_BY_NONZERO_WEIGHTS;const a=Cp(e,"labels","huberLoss"),s=Cp(t,"predictions","huberLoss");let i=null;null!=n&&(i=Cp(n,"weights","huberLoss")),Zc(a.shape,s.shape,"Error in huberLoss: ");const c=em(r),l=nm(ug(s,a)),u=vg(l,c),h=ug(l,u),d=rm(Cm(em(.5),Ng(u)),Cm(c,h));return nb(d,i,o)}});Tp({logLoss_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tb.SUM_BY_NONZERO_WEIGHTS;const a=Cp(e,"labels","logLoss"),s=Cp(t,"predictions","logLoss");let i=null;null!=n&&(i=Cp(n,"weights","logLoss")),Zc(a.shape,s.shape,"Error in logLoss: ");const c=em(1),l=em(r),u=Og(Cm(a,ig(rm(s,l)))),h=Cm(ug(c,a),ig(rm(ug(c,s),l))),d=ug(u,h);return nb(d,i,o)}});const rb=Tp({squaredDifference_:function(e,t){let n=Cp(e,"a","squaredDifference"),r=Cp(t,"b","squaredDifference");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(ld,o,{})}});Tp({meanSquaredError_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tb.SUM_BY_NONZERO_WEIGHTS;const o=Cp(e,"labels","meanSquaredError"),a=Cp(t,"predictions","meanSquaredError");let s=null;null!=n&&(s=Cp(n,"weights","meanSquaredError")),Zc(o.shape,a.shape,"Error in meanSquaredError: ");const i=rb(o,a);return nb(i,s,r)}});const ob=Tp({log1p_:function(e){const t={x:Cp(e,"x","log1p")};return yp.runKernel(oh,t)}});Tp({sigmoidCrossEntropy_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tb.SUM_BY_NONZERO_WEIGHTS,a=Cp(e,"multiClassLabels","sigmoidCrossEntropy");const s=Cp(t,"logits","sigmoidCrossEntropy");let i=null;if(null!=n&&(i=Cp(n,"weights","sigmoidCrossEntropy")),Zc(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){const e=em(r),t=em(1),n=em(.5);a=rm(Cm(a,ug(t,e)),Cm(n,e))}const c=function(e,t){const n=Cp(e,"labels","sigmoidCrossEntropyWithLogits"),r=Cp(t,"logits","sigmoidCrossEntropyWithLogits");Zc(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const o=Gg(r),a=Cm(r,n),s=ob(cg(Og(nm(r))));return rm(ug(o,a),s)}(a,s);return nb(c,i,o)}});const ab=Tp({logSumExp_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Cp(e,"x","logSumExp"),o=cl(t,r.shape),a=lg(r,o,!0),s=ug(r,a),i=cg(s),c=hg(i,o),l=ig(c),u=rm(wm(a,l.shape),l);if(n){const e=Sg(u.shape,o);return wm(u,e)}return u}});Tp({softmaxCrossEntropy_:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tb.SUM_BY_NONZERO_WEIGHTS,a=Cp(e,"onehotLabels","softmaxCrossEntropy");const s=Cp(t,"logits","softmaxCrossEntropy");let i=null;if(null!=n&&(i=Cp(n,"weights","softmaxCrossEntropy")),Zc(a.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){const e=em(r),t=em(1),n=em(a.shape[1]);a=rm(Cm(a,ug(t,e)),Hm(e,n))}const c=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));const r=$f(((e,t,r)=>{const o=ab(t,[n],!0),a=ug(ff(t,"float32"),o);r([e,a]);const s=Og(Cm(a,e));return{value:hg(s,[n]),gradFunc:(e,t)=>{const[r,o]=t,a=Sg(e.shape,[n]);return[Cm(wm(e,a),ug(ff(r,"float32"),cg(o))),Cm(wm(e,a),ug(cg(o),ff(r,"float32")))]}}}));return r(e,t)}(a,s);return nb(c,i,o)}});const sb={bandPart:Xy,gramSchmidt:Zy,qr:eb};class ib extends tm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=yp.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yp.registeredVariables[t],o=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:"".concat(t,"/accum_grad"),variable:Qf((()=>hy(r).variable(o)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:"".concat(t,"/accum_var"),variable:Qf((()=>hy(r).variable(o)))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const s=this.accumulatedGrads[n].variable,i=this.accumulatedUpdates[n].variable;Qf((()=>{const e=rm(Cm(s,this.rho),Cm(Ng(a),1-this.rho)),t=Cm(Hm(ny(rm(i,this.epsilon)),ny(rm(s,this.epsilon))),a),n=rm(Cm(i,this.rho),Cm(Ng(t),1-this.rho));s.assign(e),i.assign(n);const o=rm(Cm(t,-this.learningRate),r);r.assign(o)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Yf(this.accumulatedGrads.map((e=>e.variable))),Yf(this.accumulatedUpdates.map((e=>e.variable))))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){const t=(e=await this.extractIterations(e)).length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedUpdates=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}ib.className="Adadelta",Gf(ib);class cb extends tm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yp.registeredVariables[t];if(null==this.accumulatedGrads[n]){const e=!1;this.accumulatedGrads[n]={originalName:"".concat(t,"/accumulator"),variable:Qf((()=>tg(r.shape,this.initialAccumulatorValue).variable(e)))}}const o=Array.isArray(e)?e[n].tensor:e[t];if(null==o)return;const a=this.accumulatedGrads[n].variable;Qf((()=>{const e=rm(a,Ng(o));a.assign(e);const t=rm(Cm(Hm(o,ny(rm(e,yp.backend.epsilon()))),-this.learningRate),r);r.assign(t)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Yf(this.accumulatedGrads.map((e=>e.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulatedGrads=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}cb.className="Adagrad",Gf(cb);class lb extends tm{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Qf((()=>{this.accBeta1=em(t).variable(),this.accBeta2=em(n).variable()})),null==r&&(this.epsilon=yp.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);Qf((()=>{const n=ug(1,this.accBeta1),r=ug(1,this.accBeta2);t.forEach(((t,o)=>{const a=yp.registeredVariables[t],s=!1;null==this.accumulatedFirstMoment[o]&&(this.accumulatedFirstMoment[o]={originalName:"".concat(t,"/m"),variable:Qf((()=>hy(a).variable(s)))}),null==this.accumulatedSecondMoment[o]&&(this.accumulatedSecondMoment[o]={originalName:"".concat(t,"/v"),variable:Qf((()=>hy(a).variable(s)))});const i=Array.isArray(e)?e[o].tensor:e[t];if(null==i)return;const c=this.accumulatedFirstMoment[o].variable,l=this.accumulatedSecondMoment[o].variable,u=rm(Cm(c,this.beta1),Cm(i,1-this.beta1)),h=rm(Cm(l,this.beta2),Cm(Ng(i),1-this.beta2)),d=Hm(u,n),p=Hm(h,r);c.assign(u),l.assign(h);const f=rm(Cm(Hm(d,rm(ny(p),this.epsilon)),-this.learningRate),a);a.assign(f)})),this.accBeta1.assign(Cm(this.accBeta1,this.beta1)),this.accBeta2.assign(Cm(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Yf(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedSecondMoment&&Yf(this.accumulatedSecondMoment.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e),Qf((()=>{this.accBeta1.assign(Qy(this.beta1,this.iterations_+1)),this.accBeta2.assign(Qy(this.beta2,this.iterations_+1))}));const t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedSecondMoment=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}lb.className="Adam",Gf(lb);class ub extends tm{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Qf((()=>{this.iteration=em(0).variable(),this.accBeta1=em(t).variable()})),null==r&&(this.epsilon=yp.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map((e=>e.name)):Object.keys(e);Qf((()=>{const n=ug(1,this.accBeta1),r=Hm(-this.learningRate,rm(Cm(this.iteration,this.decay),1));t.forEach(((t,o)=>{const a=yp.registeredVariables[t],s=!1;null==this.accumulatedFirstMoment[o]&&(this.accumulatedFirstMoment[o]={originalName:"".concat(t,"/m"),variable:hy(a).variable(s)}),null==this.accumulatedWeightedInfNorm[o]&&(this.accumulatedWeightedInfNorm[o]={originalName:"".concat(t,"/v"),variable:hy(a).variable(s)});const i=Array.isArray(e)?e[o].tensor:e[t];if(null==i)return;const c=this.accumulatedFirstMoment[o].variable,l=this.accumulatedWeightedInfNorm[o].variable,u=rm(Cm(c,this.beta1),Cm(i,1-this.beta1)),h=Cm(l,this.beta2),d=nm(i),p=gg(h,d);c.assign(u),l.assign(p);const f=rm(Cm(Hm(r,n),Hm(u,rm(p,this.epsilon))),a);a.assign(f)})),this.iteration.assign(rm(this.iteration,1)),this.accBeta1.assign(Cm(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Yf(this.accumulatedFirstMoment.map((e=>e.variable))),null!=this.accumulatedWeightedInfNorm&&Yf(this.accumulatedWeightedInfNorm.map((e=>e.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}ub.className="Adamax",Gf(ub);class hb extends tm{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=Array.isArray(e)?e[n].tensor:e[t];if(null==r)return;const o=yp.registeredVariables[t];Qf((()=>{const e=rm(Cm(this.c,r),o);o.assign(e)}))})),this.incrementIterations()}setLearningRate(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Jf(em(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(0!==(e=await this.extractIterations(e)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}hb.className="SGD",Gf(hb);class db extends hb{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=em(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yp.registeredVariables[t];if(null==this.accumulations[n]){const e=!1;this.accumulations[n]={originalName:"".concat(t,"/momentum"),variable:Qf((()=>hy(r).variable(e)))}}const o=this.accumulations[n].variable,a=Array.isArray(e)?e[n].tensor:e[t];null!=a&&Qf((()=>{let e;const t=rm(Cm(this.m,o),a);e=this.useNesterov?rm(Cm(this.c,rm(a,Cm(t,this.m))),r):rm(Cm(this.c,t),r),o.assign(t),r.assign(e)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Yf(this.accumulations.map((e=>e.variable)))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);this.accumulations=e.map((e=>({originalName:e.name,variable:e.tensor.variable(false)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}db.className="Momentum",Gf(db);class pb extends tm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,null==r&&(this.epsilon=yp.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map((e=>e.name)):Object.keys(e)).forEach(((t,n)=>{const r=yp.registeredVariables[t],o=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:"".concat(t,"/rms"),variable:Qf((()=>hy(r).variable(o)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:"".concat(t,"/momentum"),variable:Qf((()=>hy(r).variable(o)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:"".concat(t,"/mg"),variable:Qf((()=>hy(r).variable(o)))});const a=Array.isArray(e)?e[n].tensor:e[t];if(null==a)return;const s=this.accumulatedMeanSquares[n].variable,i=this.accumulatedMoments[n].variable;Qf((()=>{const e=rm(Cm(s,this.decay),Cm(Ng(a),1-this.decay));if(this.centered){const t=this.accumulatedMeanGrads[n].variable,o=rm(Cm(t,this.decay),Cm(a,1-this.decay)),c=Hm(Cm(a,this.learningRate),ny(ug(e,rm(Ng(o),this.epsilon)))),l=rm(Cm(i,this.momentum),c);s.assign(e),t.assign(o),i.assign(l);const u=ug(r,l);r.assign(u)}else{const e=rm(Cm(s,this.decay),Cm(Ng(a),1-this.decay)),t=rm(Cm(i,this.momentum),Hm(Cm(a,this.learningRate),ny(rm(e,this.epsilon))));s.assign(e),i.assign(t);const n=ug(r,t);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Yf(this.accumulatedMeanSquares.map((e=>e.variable))),null!=this.accumulatedMeanGrads&&this.centered&&Yf(this.accumulatedMeanGrads.map((e=>e.variable))),null!=this.accumulatedMoments&&Yf(this.accumulatedMoments.map((e=>e.variable)))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map((e=>({name:e.originalName,tensor:e.variable}))))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.accumulatedMoments=e.slice(t,2*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((e=>({originalName:e.name,variable:e.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}pb.className="RMSProp",Gf(pb);class fb{static sgd(e){return new hb(e)}static momentum(e,t){return new db(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}static rmsprop(e){return new pb(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}static adam(){return new lb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}static adadelta(){return new ib(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}static adamax(){return new ub(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}static adagrad(e){return new cb(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}const mb={sgd:fb.sgd,momentum:fb.momentum,adadelta:fb.adadelta,adagrad:fb.adagrad,rmsprop:fb.rmsprop,adamax:fb.adamax,adam:fb.adam},gb="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:e=>e();function yb(){return new Promise((e=>gb((()=>e()))))}function bb(e,t){const n=e[0].length;e.forEach(((e,t)=>{Jc(e.length===n,(()=>"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")))})),Jc(t>=0&&t<n,(()=>"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")));const r=e[0];e.forEach(((e,o)=>{for(let a=0;a<n;a++)Jc(a===t||e[a]===r[a],(()=>"Error in concat".concat(n,"D: Shape of tensors[").concat(o,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(o,".")))}))}function vb(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}const wb=30;function xb(e){return e<=wb?e:vl(e,Math.floor(Math.sqrt(e)))}function kb(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function Sb(e,t,n){let r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])r=r.concat(t.slice(0)),r.push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);const n=t.length;for(let o=0;o<n;++o)r=r.concat([e[o+1]/t[o],t[o]]);r=r.concat(e.slice(n+1))}return r}function _b(e,t){const n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(let r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{const r=[],o=[];for(let n=1;n<e;++n)n>=2*t+1||n%2===1?o.push(n):r.push(n);n.push(...r),n.push(0),n.push(...o)}return n}function Cb(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(let a=1;a<e.length;++a)a<=t.length?r?o.push(t[a-1]*e[a]):o.push(e[a]/t[a-1]):o.push(e[a]);return o}function Ib(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function Tb(e,t,n){const r=e.slice(0,1);for(let o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function Nb(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===tl(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));const o=t.shape,a=o[o.length-1];let s=1;for(let h=0;h<o.length-1;++h)s*=o[h];const i=e.shape,c=o.slice();c.pop();let l=1;for(let h=a;h<n;++h)l*=i[h],c.push(i[h]);const u=[...wl(e.shape).map((e=>e/l)),1].slice(0,a);return[c,s,l,u]}function Eb(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(o,".");if(n.rank<o)throw new Error(a+" update.rank < ".concat(o,". "));if(e.length<r+(n.rank-o))throw new Error(a+" Output shape length < ".concat(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(a+" update.rank != ".concat(o+e.length-r));for(let s=0;s<o;++s)if(n.shape[s]!==t.shape[s])throw new Error(a+" updates.shape[".concat(s,"] (").concat(n.shape[s],") != indices.shape[").concat(s,"] (").concat(t.shape[s],")."));for(let s=0;s<n.rank-o;++s)if(n.shape[s+o]!==e[s+r])throw new Error(a+" updates.shape[".concat(s+o,"] (").concat(n.shape[s+o],") != shape[").concat(s+o,"] (").concat(e[s+o],")"))}function Ab(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Eb(n,t,e)}function Rb(e,t,n){const r=t.shape.length,o=r>1?t.shape[r-1]:1,a=n.length;let s=1;for(let c=o;c<a;++c)s*=n[c];const i=o<1?1:o;return{sliceRank:o,numUpdates:tl(t.shape)/i,sliceSize:s,strides:[...wl(n.slice(0,o)),1],outputSize:tl(n)}}const Ob=1.7580993408473768,Mb=1.0507009873554805,Pb=.3275911,Db=.254829592,Fb=-.284496736,Lb=1.421413741,zb=-1.453152027,Bb=1.061405429;function qb(){Ol().getBool("IS_TEST")||console.warn(...arguments)}function Wb(){Ol().getBool("IS_TEST")||console.log(...arguments)}function jb(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));const n=new Float32Array(2*e.length);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Vb(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Ub(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}function Gb(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}function Hb(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Kb(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Xb(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let o=0;o<Math.ceil(e/2);o++){const a=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}function Qb(e,t,n){const r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Yb(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)Jc(e.shape[n]%t===0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(t).fill(e.shape[n]/t);else{const o=t.reduce(((e,t)=>(-1===t&&(e+=1),e)),0);Jc(o<=1,(()=>"There should be only one negative value in split array."));const a=t.indexOf(-1);if(-1!==a){const r=t.reduce(((e,t)=>t>0?e+t:e));t[a]=e.shape[n]-r}Jc(e.shape[n]===t.reduce(((e,t)=>e+t)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=t}return r}function Jb(e,t){let n,r=!1;for(e<=wb?(n=e,r=!0):n=vl(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=vl(e,n+1);return n}function Zb(e,t,n){const r=[],o=e.length;for(let a=0;a<o;a++)a!==t?r.push(e[a]):r.push(n);return r}function $b(e,t,n,r){const o=t.shape.length,a=e.shape.length;if(0!==r&&(r<-o||r>o))throw new Error("Expect batchDims in the range of [-".concat(o,", ").concat(o,"], but got ").concat(r));if(r<0&&(r+=o),r>a)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(a,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error("x.shape[".concat(h,"]: ").concat(e.shape[h]," should be equal to indices.shape[").concat(h,"]: ").concat(t.shape[h],"."));const s=e.shape[n],i=[];let c=1,l=1,u=1;for(let h=0;h<r;++h)i.push(e.shape[h]),c*=e.shape[h];for(let h=r;h<n;h++)i.push(e.shape[h]),l*=e.shape[h];for(let h=r;h<o;h++)i.push(t.shape[h]);for(let h=n+1;h<a;h++)i.push(e.shape[h]),u*=e.shape[h];return{batchSize:c,sliceSize:u,outerSize:l,dimSize:s,outputShape:i}}function ev(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();const t=Dg(e.shape),r=ff(e,"float32"),o=n.complex(r,t);return t.dispose(),r.dispose(),o}if(!dl(e.dtype,t))return yp.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){const r=n.real(e),o=ff(r,t);return r.dispose(),o}if("int32"===t)return n.int(e);if("bool"===t){const t=em(0,e.dtype),r=n.notEqual(e,t);return t.dispose(),r}throw new Error("Error in Cast: failed to cast ".concat(e.dtype," to ").concat(t))}function tv(e,t){return yp.makeTensorFromDataId(e.dataId,t,e.dtype)}function nv(e){try{return e.map((e=>Qd(e)))}catch(L2){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(L2))}}function rv(e){return e.map((e=>Xd(e)))}function ov(e,t){const n=[];for(let a=0;a<t.length;a++)t[a]&&n.push(a);const r=pf(e,"int32"),o=pf([n.length,e.length],"int32");for(let a=0;a<n.length;a++){const t=r.indexToLoc(n[a]),s=a*e.length;o.values.set(t,s)}return o.toTensor()}const av={kernelName:Ll,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,ky(ff(n,"float32"),-1))}}},sv={kernelName:zl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=Ng(ff(n,"float32")),r=ny(ug(em(1),t));return Og(Hm(e,r))}}}},iv={kernelName:Bl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=ny(ug(Ng(ff(n,"float32")),1));return Hm(e,t)}}}},cv={kernelName:ql,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{let t=e;const r=Qm(n.shape,o);return r.length>0&&(t=hg(t,r)),wm(t,n.shape)},b:()=>{let t=e;const n=Qm(r.shape,o);return n.length>0&&(t=hg(t,n)),wm(t,r.shape)}}}},lv={kernelName:Wl,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach(((t,r)=>{n[r]=()=>e.clone()})),n}},uv={kernelName:Ul,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>hy(n)}}},hv={kernelName:Gl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>hy(n)}}},dv={kernelName:Hl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,ny(ug(em(1),Ng(ff(n,"float32")))))}}},pv={kernelName:Kl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=ny(rm(em(1),Ng(ff(n,"float32"))));return Hm(e,t)}}}},fv={kernelName:Yl,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{const t=rm(Ng(n),Ng(r));let a=Cm(e,Hm(r,t));const s=Qm(n.shape,o);return s.length>0&&(a=hg(a,s)),wm(a,n.shape)},b:()=>{const t=rm(Ng(n),Ng(r));let a=Og(Cm(e,Hm(n,t)));const s=Qm(r.shape,o);return s.length>0&&(a=hg(a,s)),wm(a,r.shape)}}}},mv={kernelName:Xl,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,rm(Ng(ff(n,"float32")),1))}}},gv={kernelName:Ql,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,ug(em(1),Ng(ff(n,"float32"))))}}};const yv=Tp({avgPool3dGrad_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;const i=Cp(e,"dy","avgPool3dGrad"),c=Cp(t,"input","avgPool3dGrad");let l=i,u=c,h=!1;4===c.rank&&(h=!0,l=wm(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=wm(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Jc(5===l.rank,(()=>"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,"."))),Jc(5===u.rank,(()=>"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(u.rank,"."))),Jc(bm(r,o),(()=>"Error in avgPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(r," and dilations '").concat(o,"'"))),null!=s&&Jc(rl(a),(()=>"Error in avgPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(s," but got pad ").concat(a,".")));const d={dy:l,input:u},p={filterSize:n,strides:r,dilations:o,pad:a,dimRoundingMode:s},f=yp.runKernel(eu,d,p);return h?wm(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),bv={kernelName:$l,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:o,strides:a,dilations:s,pad:i,dimRoundingMode:c}=n,l=null==s?[1,1,1]:s;return{x:()=>yv(e,r,o,a,l,i,c)}}};const vv=Tp({avgPoolGrad_:function(e,t,n,r,o){const a=Cp(e,"dy","avgPoolGrad"),s=Cp(t,"input","avgPoolGrad");Jc(s.rank===a.rank,(()=>"Rank of input (".concat(s.rank,") does not match rank of dy (").concat(a.rank,")")));let i=s,c=a,l=!1;3===s.rank&&(l=!0,i=wm(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=wm(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Jc(4===c.rank,(()=>"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(c.rank,"."))),Jc(4===i.rank,(()=>"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(i.rank,".")));const u={dy:c,input:i},h={filterSize:n,strides:r,pad:o},d=yp.runKernel(Zl,u,h);return l?wm(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),wv={kernelName:Jl,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:o,strides:a,pad:s}=n;return{x:()=>vv(e,r,o,a,s)}}},xv={kernelName:tu,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,o]=t,{transposeA:a,transposeB:s}=n;return a||s?!a&&s?{a:()=>_m(e,o,!1,!1),b:()=>_m(e,r,!0,!1)}:a&&!s?{a:()=>_m(o,e,!1,!0),b:()=>_m(r,e,!1,!1)}:{a:()=>_m(o,e,!0,!0),b:()=>_m(e,r,!0,!0)}:{a:()=>_m(e,o,!1,!0),b:()=>_m(r,e,!0,!1)}}};const kv=Tp({spaceToBatchND_:function(e,t,n){const r=Cp(e,"x","spaceToBatchND");Jc(r.rank>=1+t.length,(()=>"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length))),Jc(n.length===t.length,(()=>"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length))),Jc(r.shape.reduce(((e,r,o)=>o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]===0:e),!0),(()=>"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())));const o={x:r},a={blockShape:t,paddings:n};return yp.runKernel(sd,o,a)}}),Sv={kernelName:nu,gradFunc:(e,t,n)=>{const{blockShape:r,crops:o}=n;return{x:()=>kv(e,r,o)}}},_v={kernelName:"BroadcastTo",gradFunc:(e,t,n)=>{const r=n,o=r.inputShape,a=r.shape,s=Array.from(a);for(let c=o.length-1;c>=0;c--)if(o[c]===a[c])s[c]=1;else if(1!==o[c])throw new Error("broadcastTo(): [".concat(o,"] cannot be broadcast to [").concat(a,"]."));const i=[];for(let c=0;c<s.length;c++)s[c]>1&&i.push(c);return{x:()=>hg(e,i,!0)}}},Cv={kernelName:ou,gradFunc:e=>({x:()=>e.clone()})},Iv={kernelName:au,gradFunc:e=>({x:()=>hy(e)})},Tv={kernelName:su,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:o,clipValueMax:a}=n;return{x:()=>uy(pg(ag(r,o),Hy(r,a)),e,hy(e))}}},Nv={kernelName:cu,inputsToSave:["x"],gradFunc:av.gradFunc},Ev={kernelName:lu,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map((e=>e.shape)),{axis:o}=n,a=cl(o,t[0].shape)[0],s=r.map((e=>e[a]));return ty(e,s,a).map((e=>()=>e))}},Av={kernelName:uu,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,o]=t,{dilations:a,strides:s,pad:i,dataFormat:c}=n;return Jc(ym(a),(()=>"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(a,"'"))),{x:()=>Wm(r.shape,e,o,s,i,c),filter:()=>wy(r,e,o.shape,s,i,c)}}},Rv={kernelName:du,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,o]=t,{strides:a,pad:s,dataFormat:i,dimRoundingMode:c}=n;return{dy:()=>Bm(e,o,a,s,i,1,c),filter:()=>wy(e,r,o.shape,a,s,i,c)}}};const Ov=Tp({conv3DBackpropFilter_:function(e,t,n,r,o){let a=e;4===e.rank&&(a=wm(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let s=t;4===s.rank&&(s=wm(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Jc(5===a.rank,(()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(a.shape,"."))),Jc(5===s.rank,(()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(s.shape,"."))),Jc(5===n.length,(()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,"."))),Jc(a.shape[4]===n[3],(()=>"Error in conv3dDerFilter: depth of input ".concat(a.shape[4],") must ")+"match input depth in filter (".concat(n[3],"."))),Jc(s.shape[4]===n[4],(()=>"Error in conv3dDerFilter: depth of dy (".concat(s.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")));const i={x:a,dy:s},c={strides:r,pad:o,filterShape:n};return yp.runKernel(fu,i,c)}});const Mv=Tp({conv3DBackpropInput_:function(e,t,n,r,o){Jc(e.length===t.rank,(()=>"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")));let a=e,s=t,i=!1;4===t.rank&&(i=!0,s=wm(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),a=[1,e[0],e[1],e[2],e[3]]);const c=a[4],l=s.shape[4];Jc(5===a.length,(()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(a.length,"."))),Jc(5===s.rank,(()=>"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(s.rank))),Jc(5===n.rank,(()=>"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank))),Jc(c===n.shape[3],(()=>"Error in conv3dDerInput: depth of input (".concat(c,") must ")+"match input depth for filter ".concat(n.shape[3],"."))),Jc(l===n.shape[4],(()=>"Error in conv3dDerInput: depth of output (".concat(l,") must ")+"match output depth for filter ".concat(n.shape[4],".")));const u={dy:s,filter:n},h={pad:o,strides:r,inputShape:a},d=yp.runKernel(mu,u,h);return i?wm(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),Pv={kernelName:pu,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:o,pad:a}=n;Jc(ym(r),(()=>"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")));const[s,i]=t;return{x:()=>Mv(s.shape,e,i,o,a),filter:()=>Ov(s,e,i.shape,o,a)}}};const Dv=Tp({sin_:function(e){const t={x:Cp(e,"x","sin")};return yp.runKernel($h,t)}}),Fv={kernelName:gu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(Og(Dv(ff(n,"float32"))),e)}}};const Lv=Tp({sinh_:function(e){const t={x:Cp(e,"x","sinh")};return yp.runKernel(ed,t)}}),zv={kernelName:yu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(Lv(ff(n,"float32")),e)}}};const Bv=Tp({cumsum_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o={x:Cp(e,"x","cumsum")},a={axis:t,exclusive:n,reverse:r};return yp.runKernel(bu,o,a)}}),qv={kernelName:bu,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:o,exclusive:a,reverse:s}=n;return{x:()=>{const t=Cg([o],r.rank);let n=Bv(e,o,a,!s);return null!=t&&(n=dy(n,t)),n}}}},Wv={kernelName:ku,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:o,pad:a,dimRoundingMode:s}=n,i=null==r?[1,1]:r;Jc(ym(i),(()=>"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(i,"'")));const[c,l]=t;return Jc(4===c.rank,(()=>"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,"."))),Jc(4===l.rank,(()=>"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,"."))),Jc(c.shape[3]===l.shape[2],(()=>"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],"."))),Jc(bm(o,i),(()=>"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(o," and dilations ")+"'".concat(i,"'."))),null!=s&&Jc(rl(a),(()=>"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(a,"."))),{x:()=>Ey(c.shape,e,l,o,a,r,s),filter:()=>Ny(c,e,l.shape,o,a,r,s)}}},jv={kernelName:Iu,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,o]=t,a={x:r,filter:o,dy:e},s={x:r,filter:o,dy:e};return{x:()=>yp.runKernel(Tu,a,n),filter:()=>yp.runKernel(Nu,s,n)}}},Vv={kernelName:Au,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>yp.runKernel(Ru,r)}}},Uv={kernelName:Ou,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Cm(cg(Og(Ng(n))),2/Math.sqrt(Math.PI));return{x:()=>Cm(e,r)}}},Gv={kernelName:Pu,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,n)}}},Hv={kernelName:Du,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>wm(e,n.shape)}}},Kv={kernelName:Fu,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,cg(n))}}},Xv={kernelName:qu,gradFunc:e=>({x:()=>hy(e)})},Qv={kernelName:Wu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{const t=Hm(e,ff(r,"float32")),a=Qm(n.shape,o);return a.length>0?wm(hg(t,a),n.shape):t},b:()=>{let t=Cm(e,ff(n,"float32"));const a=Qm(r.shape,o);a.length>0&&(t=wm(hg(t,a),r.shape));const s=Ng(r);return Og(Hm(t,ff(s,"float32")))}}}};const Yv=Tp({rsqrt_:function(e){const t={x:Cp(e,"x","rsqrt")};return yp.runKernel(Xh,t)}}),Jv={kernelName:ju,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[o,a,s,i]=t,c=null==i?em(1):i,l=Qm(a.shape,o.shape),u=[];if(1===a.rank){for(let e=0;e<o.shape.length-1;++e)u.push(o.shape[e]);u.push(1)}const h=ug(o,a),d=Cm(e,c),p=Yv(rm(s,em(r))),f=Cm(Cm(Cm(p,p),p),em(-.5));return{x:()=>1===a.rank?wm(Cm(Cm(e,$m(wm(p,[1,1,1,a.shape[0]]),u)),c),o.shape):wm(Cm(Cm(e,p),c),o.shape),mean:()=>{let e=Cm(Cm(p,em(-1)),d);return 1===a.rank&&(e=hg(e,l)),wm(e,a.shape)},variance:()=>{let e=Cm(Cm(f,h),d);return 1===a.rank&&(e=hg(e,l)),wm(e,a.shape)},scale:()=>{const t=Cm(h,p);let n=Cm(e,t);return 1===a.rank&&(n=hg(n,l)),wm(n,a.shape)},offset:()=>{let t=e;return 1===a.rank&&(t=hg(t,l)),wm(t,a.shape)}}}};const Zv=Tp({unsortedSegmentSum_:function(e,t,n){const r=Cp(e,"x","unsortedSegmentSum"),o=Cp(t,"segmentIds","unsortedSegmentSum","int32");Jc(rl(n),(()=>"numSegments must be of dtype int"));const a={x:r,segmentIds:o},s={numSegments:n};return yp.runKernel(xd,a,s)}}),$v={kernelName:Vu,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,o]=t,{axis:a}=n,s=cl(a,r.shape)[0];return{x:()=>{const t=r.shape,n=o.size,i=t.slice(0,s),c=i.length,l=t.slice(a,t.length).slice(1),u=l.length,h=ew(0,c),d=ew(c+1,c+1+u),p=tw([i,[n],l]),f=wm(e,p),m=wm(o,[n]),g=tw([[c],h,d]),y=dy(f,g);let b=Zv(y,m,r.shape[s]);const v=Ig(g);return b=dy(b,v),b},indices:()=>o}}};function ew(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function tw(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}const nw={kernelName:Hu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>hy(n),b:()=>hy(r)}}},rw={kernelName:Ku,gradFunc:e=>({x:()=>ff(e,"float32")})},ow={kernelName:Yu,gradFunc:e=>({x:()=>hy(e)})},aw={kernelName:Ju,gradFunc:e=>({x:()=>hy(e)})},sw={kernelName:Zu,gradFunc:e=>({x:()=>hy(e)})},iw={kernelName:$u,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:o}=n,a=og(r,0);return{x:()=>uy(a,e,Cm(e,o))}}},cw={kernelName:oh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,rm(n,1))}}},lw={kernelName:rh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,ff(n,"float32"))}}},uw={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:o}=n;return{logits:()=>{const t=cg(r);return ug(e,Cm(hg(e,o,!0),t))}}}};const hw=Tp({localResponseNormalizationBackprop_:function(e,t,n){const r={x:e,y:t,dy:n},o={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return yp.runKernel(lh,r,o)}}),dw={kernelName:ch,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,o]=t,{depthRadius:a,bias:s,alpha:i,beta:c}=n;return{x:()=>hw(r,o,e,a,s,i,c)}}};function pw(e,t,n,r){return t.rank<n.rank&&(t=wm(t,Sg(t.shape,r))),e.rank<n.rank&&(e=wm(e,Sg(e.shape,r))),{x:()=>Cm(e,ff(Jm(n,t),e.dtype))}}const fw={kernelName:uh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:o}=r,a=t[0],s=pw(e,t[1],a,cl(o,a.shape));return{x:()=>s.x()}}};const mw=Tp({less_:function(e,t){let n=Cp(e,"a","less"),r=Cp(t,"b","less");[n,r]=up(n,r),Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(eh,o)}}),gw={kernelName:hh,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Cm(e,ff(ag(n,r),"float32")),b:()=>Cm(e,ff(mw(n,r),"float32"))}}};const yw=Tp({maxPool3dGrad_:function(e,t,n,r,o){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],s=arguments.length>6?arguments[6]:void 0,i=arguments.length>7?arguments[7]:void 0;const c=Cp(e,"dy","maxPool3dGrad"),l=Cp(t,"input","maxPool3dGrad"),u=Cp(n,"output","maxPool3dGrad");let h=c,d=l,p=u,f=!1;4===l.rank&&(f=!0,h=wm(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=wm(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=wm(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),Jc(5===h.rank,(()=>"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(h.rank,"."))),Jc(5===d.rank,(()=>"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(d.rank,"."))),Jc(5===p.rank,(()=>"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(p.rank,"."))),Jc(bm(o,a),(()=>"Error in maxPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(o," and dilations '").concat(a,"'"))),null!=i&&Jc(rl(s),(()=>"Error in maxPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(i," but got pad ").concat(s,".")));const m={dy:h,input:d,output:p},g={filterSize:r,strides:o,dilations:a,pad:s,dimRoundingMode:i},y=yp.runKernel(mh,m,g);return f?wm(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}}),bw={kernelName:fh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,o]=t,{filterSize:a,strides:s,dilations:i,pad:c,dimRoundingMode:l}=n,u=null==i?[1,1,1]:i;return{x:()=>yw(e,r,o,a,s,u,c,l)}}};const vw=Tp({maxPoolGrad_:function(e,t,n,r,o,a,s){const i=Cp(e,"dy","maxPoolGrad"),c=Cp(t,"input","maxPoolGrad"),l=Cp(n,"output","maxPoolGrad");Jc(c.rank===i.rank,(()=>"Rank of input (".concat(c.rank,") does not match rank of dy ")+"(".concat(i.rank,")"))),Jc(4===i.rank,(()=>"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(i.rank,"."))),Jc(4===c.rank,(()=>"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(c.rank,"."))),null!=s&&Jc(rl(a),(()=>"Error in maxPoolGrad: pad must be an integer when using, "+"dimRoundingMode ".concat(s," but got pad ").concat(a,".")));const u={dy:i,input:c,output:l},h={filterSize:r,strides:o,pad:a,dimRoundingMode:s};return yp.runKernel(ph,u,h)}}),ww={kernelName:dh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,o]=t,{filterSize:a,strides:s,pad:i}=n;return{x:()=>vw(e,r,o,a,s,i)}}},xw={kernelName:yh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:o}=n,a=cl(o,r.shape),s=tl(kg(r.shape,a)[1]);return{x:()=>{const t=r.shape.slice();a.forEach((e=>{t[e]=1}));const n=wm(e,t);return Hm(Cm(n,Fg(r.shape,"float32")),s)}}}},kw={kernelName:bh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:o}=r,[a,s]=t,i=pw(e,s,a,cl(o,a.shape));return{x:()=>i.x()}}},Sw={kernelName:vh,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>Cm(e,ff(Hy(n,r),"float32")),b:()=>Cm(e,ff(og(n,r),"float32"))}}},_w={kernelName:wh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:o}=n,a=o.map((e=>e[0]));return{x:()=>Tm(e,a,r.shape)}}},Cw={kernelName:xh,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{const t=Qm(n.shape,o);return t.length>0?wm(hg(e,t),n.shape):e},b:()=>{const t=Cm(e,Og(ng(Hm(n,r)))),a=Qm(r.shape,o);return a.length>0?wm(hg(t,a),r.shape):t}}}},Iw={kernelName:Sh,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{const t=Cm(e,ff(r,"float32")),a=Qm(n.shape,o);return a.length>0?wm(hg(t,a),n.shape):t},b:()=>{const t=Cm(e,ff(n,"float32")),a=Qm(r.shape,o);return a.length>0?wm(hg(t,a),r.shape):t}}}},Tw={kernelName:_h,gradFunc:e=>({x:()=>Og(e)})},Nw={kernelName:Ah,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>Dg(n.shape,"float32")}}},Ew={kernelName:Eh,gradFunc:e=>({x:()=>hy(e)})},Aw={kernelName:Rh,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return cy(e,r).map((e=>()=>e))}},Rw={kernelName:Oh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:o}=n,a=o.map((e=>e[0]));return{x:()=>Tm(e,a,r.shape)}}},Ow={kernelName:Mh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,o]=t,a=n,s=r,i=Ym(a.shape,s.shape);return{a:()=>{const t=ff(s,"float32");let n=Cm(e,Cm(t,Qy(a,ug(t,em(1)))));const r=Qm(a.shape,i);return r.length>0&&(n=hg(n,r)),wm(n,a.shape)},b:()=>{const t=og(a,0),n=uy(t,ig(a),hy(a));let r=Cm(e,Cm(o,n));const c=Qm(s.shape,i);return c.length>0&&(r=hg(r,c)),wm(r,s.shape)}}}},Mw={kernelName:Ph,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,o=og(n,0);return{x:()=>uy(o,e,Cm(e,r)),alpha:()=>{let t=uy(o,hy(e),Cm(e,n));const a=Qm(r.shape,e.shape);return a.length>0&&(t=hg(t,a)),wm(t,r.shape)}}}},Pw={kernelName:Eu,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{const t=Hm(e,ff(r,"float32")),a=Qm(n.shape,o);return a.length>0?wm(hg(t,a),n.shape):t},b:()=>{let t=Cm(e,ff(n,"float32"));const a=Qm(r.shape,o);a.length>0&&(t=wm(hg(t,a),r.shape));const s=Ng(r);return Og(Hm(t,ff(s,"float32")))}}}},Dw={kernelName:zh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,Og(Ng(n)))}}},Fw={kernelName:Gh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=Cm(Hy(n,6),ky(n));return{x:()=>Cm(e,ff(r,"float32"))}}},Lw={kernelName:Bh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,ff(ky(n),"float32"))}}},zw={kernelName:qh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>wm(e,n.shape)}}},Bw={kernelName:Vh,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,o={dy:e,images:r};return{images:()=>yp.runKernel(Uh,o,n)}}},qw={kernelName:Wh,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,o={dy:e,images:r};return{images:()=>yp.runKernel(jh,o,n)}}},Ww={kernelName:Hh,gradFunc:(e,t,n)=>{const{dims:r}=n,o=cl(r,e.shape);return{x:()=>Hg(e,o)}}},jw={kernelName:Kh,gradFunc:e=>({x:()=>hy(e)})},Vw={kernelName:Xh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Og(Hm(e,Cm(Qy(n,1.5),2)))}}};const Uw=Tp({logicalNot_:function(e){const t={x:Cp(e,"x","logicalNot","bool")};return yp.runKernel(sh,t)}}),Gw={kernelName:Yh,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>ff(hy(n),"float32"),t:()=>Cm(e,ff(n,e.dtype)),e:()=>Cm(e,ff(Uw(n),e.dtype))}}},Hw={kernelName:Jh,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const t=og(n,em(0)),r=em(Ob),o=em(Mb),a=Cm(e,o),s=Cm(Cm(e,r),cg(ff(n,"float32")));return uy(t,a,s)}}}},Kw={kernelName:nd,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,Cm(n,ug(em(1),n)))}}},Xw={kernelName:td,gradFunc:e=>({x:()=>hy(e)})};const Qw=Tp({cos_:function(e){const t={x:Cp(e,"x","cos")};return yp.runKernel(gu,t)}}),Yw={kernelName:$h,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(Qw(ff(n,"float32")),e)}}};const Jw=Tp({cosh_:function(e){const t={x:Cp(e,"x","cosh")};return yp.runKernel(yu,t)}}),Zw={kernelName:ed,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(Jw(ff(n,"float32")),e)}}},$w={kernelName:Zh,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:o,size:a}=n,s=r.shape,[i,c]=Wf(r,o,a),l=[];for(let u=0;u<e.rank;u++)l.push([i[u],s[u]-i[u]-c[u]]);return{x:()=>zg(e,l)}}},ex={kernelName:cd,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:o}=n,a=Cm(e,r);return{logits:()=>ug(a,Cm(hg(a,[o],true),r))}}},tx={kernelName:rd,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,Im(n))}}};const nx=Tp({batchToSpaceND_:function(e,t,n){const r=Cp(e,"x","batchToSpaceND"),o=t.reduce(((e,t)=>e*t));Jc(r.rank>=1+t.length,(()=>"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length))),Jc(n.length===t.length,(()=>"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length))),Jc(r.shape[0]%o===0,(()=>"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(o)));const a={x:r},s={blockShape:t,crops:n};return yp.runKernel(nu,a,s)}}),rx={kernelName:sd,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:o}=n;return{x:()=>nx(e,r,o)}}},ox={kernelName:id,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>Sm(e,r)}}},ax={kernelName:od,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,Cm(ny(ff(n,"float32")),2))}}},sx={kernelName:ud,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(e,Cm(ff(n,"float32"),2))}}},ix={kernelName:ld,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=em(2);return{a:()=>Cm(e,Cm(o,ug(n,r))),b:()=>Cm(e,Cm(o,ug(r,n)))}}},cx={kernelName:hd,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,o=Ym(n.shape,r.shape);return{a:()=>{let t=e;const r=Qm(n.shape,o);return r.length>0&&(t=hg(t,r)),wm(t,n.shape)},b:()=>{let t=e;const n=Qm(r.shape,o);return n.length>0&&(t=hg(t,n)),wm(Og(t),r.shape)}}}},lx={kernelName:ad,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,o=r.shape.slice(),{axis:a}=n;cl(a,r.shape).forEach((e=>{o[e]=1}));const s=wm(e,o),i=Cm(s,Fg(r.shape,"float32"));return{x:()=>i}}},ux={kernelName:fd,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Hm(e,Ng(Qw(n)))}}},hx={kernelName:gd,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:o}=n;return{x:()=>{let t=hy(r);if(1===r.rank)for(let n=0;n<o[0];++n)t=rm(t,Tm(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<o[0];++n)for(let a=0;a<o[1];++a)t=rm(t,Tm(e,[n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<o[0];++n)for(let a=0;a<o[1];++a)for(let s=0;s<o[2];++s)t=rm(t,Tm(e,[n*r.shape[0],a*r.shape[1],s*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(let n=0;n<o[0];++n)for(let a=0;a<o[1];++a)for(let s=0;s<o[2];++s)for(let i=0;i<o[3];++i)t=rm(t,Tm(e,[n*r.shape[0],a*r.shape[1],s*r.shape[2],i*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},dx={kernelName:xd,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>function(e,t){const n=gg(t,hy(t)),r=rg(e,n);let o=ag(t,em(0,"int32"));const a=r.rank-o.rank;for(let i=0;i<a;++i)o=Zm(o,i+1);o=pg(o,Fg(r.shape,"bool"));const s=hy(r);return uy(o,r,s)}(e,n)}}};const px=[av,sv,iv,cv,lv,uv,hv,dv,pv,fv,mv,gv,bv,wv,xv,Sv,_v,Cv,Iv,Tv,Nv,Ev,Rv,Av,Pv,Fv,zv,qv,Wv,jv,Pw,Vv,Uv,Gv,Hv,Kv,Qv,Xv,Jv,$v,nw,rw,ow,aw,sw,iw,cw,lw,uw,dw,fw,fw,gw,bw,ww,xw,kw,Sw,_w,Cw,Iw,Tw,Nw,Ew,Aw,Rw,Rw,Ow,Mw,Dw,Fw,Lw,zw,Bw,qw,Ww,jw,Vw,Gw,Hw,Kw,Xw,Yw,Zw,$w,ex,tx,rx,rx,ox,ox,ax,ix,sx,{kernelName:Sd,gradFunc:e=>({x:()=>hy(e)})},cx,lx,ux,{kernelName:md,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Cm(ug(em(1),Ng(n)),e)}}},hx,{kernelName:bd,gradFunc:(e,t,n)=>{const r=n,{perm:o}=r,a=Ig(o);return{x:()=>dy(e,a)}}},{kernelName:wd,gradFunc:(e,t,n)=>{const r=n,{axis:o}=r;return{value:()=>oy(e,o)}}},dx,{kernelName:kd,gradFunc:e=>({x:()=>hy(e)})}];for(const z2 of px)Dd(z2);ep.prototype.abs=function(){return this.throwIfDisposed(),nm(this)};const fx=Tp({acos_:function(e){const t={x:Cp(e,"x","acos")};return yp.runKernel(zl,t)}});ep.prototype.acos=function(){return this.throwIfDisposed(),fx(this)};const mx=Tp({acosh_:function(e){const t={x:Cp(e,"x","acosh")};return yp.runKernel(Bl,t)}});ep.prototype.acosh=function(){return this.throwIfDisposed(),mx(this)};const gx=Tp({mod_:function(e,t){let n=Cp(e,"a","mod"),r=Cp(t,"b","mod");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(xh,o)}});const yx=Tp({addStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","addStrict"),r=Cp(t,"b","addStrict");return Zc(n.shape,r.shape,"Error in addStrict: "),rm(n,r)}}),bx=Tp({divStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","div"),r=Cp(t,"b","div");return Zc(n.shape,r.shape,"Error in divideStrict: "),Hm(n,r)}}),vx=Tp({maximumStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","maximumStrict"),r=Cp(t,"b","maximumStrict");return Zc(n.shape,r.shape,"Error in maximumStrict: "),gg(n,r)}}),wx=Tp({minimumStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","minimumStrict"),r=Cp(t,"b","minimumStrict");return Zc(n.shape,r.shape,"Error in minimumStrict: "),vg(n,r)}}),xx=Tp({modStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","modStrict"),r=Cp(t,"b","modStrict");return Zc(n.shape,r.shape,"Error in modStrict: "),gx(n,r)}}),kx=Tp({mulStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","mul"),r=Cp(t,"b","mul");return Zc(n.shape,r.shape,"Error in multiplyStrict: "),Cm(n,r)}}),Sx=Tp({powStrict_:function(e,t){return Hf("strict variants of ops have been deprecated and will be removed in future"),Zc(e.shape,t.shape,"Error in powStrict: "),Qy(e,t)}}),_x=Tp({squaredDifferenceStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","squaredDifferenceStrict"),r=Cp(t,"b","squaredDifferenceStrict");return Zc(n.shape,r.shape,"Error in squaredDifferenceStrict: "),rb(n,r)}}),Cx=Tp({subStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","subStrict"),r=Cp(t,"b","subStrict");return Zc(n.shape,r.shape,"Error in subStrict: "),ug(n,r)}});ep.prototype.addStrict=function(e){return this.throwIfDisposed(),yx(this,e)},ep.prototype.add=function(e){return this.throwIfDisposed(),rm(this,e)},ep.prototype.all=function(e,t){return this.throwIfDisposed(),om(this,e,t)},ep.prototype.any=function(e,t){return this.throwIfDisposed(),am(this,e,t)},ep.prototype.argMax=function(e){return this.throwIfDisposed(),sm(this,e)};const Ix=Tp({argMin_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n={x:Cp(e,"x","argMin")},r={axis:t};return yp.runKernel(Gl,n,r)}});ep.prototype.argMin=function(e){return this.throwIfDisposed(),Ix(this,e)},ep.prototype.asScalar=function(){return this.throwIfDisposed(),Jc(1===this.size,(()=>"The array must have only 1 element.")),wm(this,[])},ep.prototype.asType=function(e){return this.throwIfDisposed(),ff(this,e)},ep.prototype.as1D=function(){return this.throwIfDisposed(),wm(this,[this.size])},ep.prototype.as2D=function(e,t){return this.throwIfDisposed(),wm(this,[e,t])},ep.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),wm(this,[e,t,n])},ep.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),wm(this,[e,t,n,r])},ep.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),wm(this,[e,t,n,r,o])};const Tx=Tp({asin_:function(e){const t={x:Cp(e,"x","asin")};return yp.runKernel(Hl,t)}});ep.prototype.asin=function(){return this.throwIfDisposed(),Tx(this)};const Nx=Tp({asinh_:function(e){const t={x:Cp(e,"x","asinh")};return yp.runKernel(Kl,t)}});ep.prototype.asinh=function(){return this.throwIfDisposed(),Nx(this)};const Ex=Tp({atan_:function(e){const t={x:Cp(e,"x","atan")};return yp.runKernel(Xl,t)}});ep.prototype.atan=function(){return this.throwIfDisposed(),Ex(this)};const Ax=Tp({atan2_:function(e,t){let n=Cp(e,"a","atan2"),r=Cp(t,"b","atan2");[n,r]=up(n,r);const o={a:n,b:r};return yp.runKernel(Yl,o)}});ep.prototype.atan2=function(e){return this.throwIfDisposed(),Ax(this,e)};const Rx=Tp({atanh_:function(e){const t={x:Cp(e,"x","atanh")};return yp.runKernel(Ql,t)}});ep.prototype.atanh=function(){return this.throwIfDisposed(),Rx(this)},ep.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),xm(this,e,t,n,r)},ep.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),nx(this,e,t)},ep.prototype.batchNorm=function(e,t,n,r,o){return this.throwIfDisposed(),Am(this,e,t,n,r,o)},ep.prototype.broadcastTo=function(e){return this.throwIfDisposed(),ly(this,e)},ep.prototype.cast=function(e){return this.throwIfDisposed(),ff(this,e)};const Ox=Tp({ceil_:function(e){const t={x:Cp(e,"x","ceil")};return yp.runKernel(au,t)}});ep.prototype.ceil=function(){return this.throwIfDisposed(),Ox(this)},ep.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Pm(this,e,t)},ep.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof ep&&(e=[e]),Sm([this,...e],t)},ep.prototype.conv1d=function(e,t,n,r,o,a){return this.throwIfDisposed(),qm(this,e,t,n,r,o,a)},ep.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),jm(this,e,t,n,r,o)},ep.prototype.conv2d=function(e,t,n,r,o,a){return this.throwIfDisposed(),Bm(this,e,t,n,r,o,a)},ep.prototype.cos=function(){return this.throwIfDisposed(),Qw(this)},ep.prototype.cosh=function(){return this.throwIfDisposed(),Jw(this)},ep.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Bv(this,e,t,n)};const Mx=Tp({depthToSpace_:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC";const r=Cp(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],s="NHWC"===n?r.shape[3]:r.shape[1];Jc(o*t>=0,(()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(o," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape))),Jc(a*t>=0,(()=>"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape))),Jc(s%(t*t)===0,(()=>"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(s," for depthToSpace with input shape ").concat(r.shape)));const i={x:r},c={blockSize:t,dataFormat:n};return yp.runKernel(xu,i,c)}});ep.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Mx(this,e,t)},ep.prototype.depthwiseConv2D=function(e,t,n,r,o,a){return Hf("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),Um(this,e,t,n,r,o,a)},ep.prototype.depthwiseConv2d=function(e,t,n,r,o,a){return this.throwIfDisposed(),Um(this,e,t,n,r,o,a)};const Px=Tp({dilation2d_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC";const s=Cp(e,"x","dilation2d"),i=Cp(t,"filter","dilation2d");Jc(3===s.rank||4===s.rank,(()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(s.rank,"."))),Jc(3===i.rank,(()=>"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(i.rank,"."))),Jc("NHWC"===a,(()=>"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(a)));let c=s,l=!1;3===s.rank&&(c=wm(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=!0);const u={x:c,filter:i},h={strides:n,pad:r,dilations:o},d=yp.runKernel(Iu,u,h);return l?wm(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});ep.prototype.dilation2d=function(e,t,n,r,o){return this.throwIfDisposed(),Px(this,e,t,n,r,o)};const Dx=Tp({divNoNan_:function(e,t){let n=Cp(e,"a","div"),r=Cp(t,"b","div");[n,r]=up(n,r);const o=Hm(n,r),a=hy(o),s=Jm(r,a);return uy(s,a,o)}});ep.prototype.divNoNan=function(e){return this.throwIfDisposed(),Dx(this,e)},ep.prototype.divStrict=function(e){return this.throwIfDisposed(),bx(this,e)},ep.prototype.div=function(e){return this.throwIfDisposed(),Hm(this,e)};const Fx=Tp({dot_:function(e,t){const n=Cp(e,"t1","dot"),r=Cp(t,"t2","dot");Jc((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(()=>"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")));const o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];if(Jc(o===a,(()=>"Error in dot: inner dimensions of inputs must match, but got "+"".concat(o," and ").concat(a,"."))),1===n.rank&&1===r.rank){const e=wm(n,[1,-1]),t=wm(r,[-1,1]),o=_m(e,t);return wm(o,[])}if(1===n.rank&&2===r.rank){const e=wm(n,[1,-1]),t=wm(r,[r.shape[0],r.shape[1]]),o=_m(e,t);return wm(o,[o.size])}if(2===n.rank&&1===r.rank){const e=wm(r,[-1,1]),t=_m(n,e);return wm(t,[t.size])}{const e=wm(r,[r.shape[0],r.shape[1]]);return _m(n,e)}}});ep.prototype.dot=function(e){return this.throwIfDisposed(),Fx(this,e)},ep.prototype.elu=function(){return this.throwIfDisposed(),Km(this)};const Lx=Tp({equalStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","equalStrict"),r=Cp(t,"b","equalStrict");return Zc(n.shape,r.shape,"Error in equalStrict: "),Jm(n,r)}}),zx=Tp({greaterEqualStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","greaterEqualStrict"),r=Cp(t,"b","greaterEqualStrict");return Zc(n.shape,r.shape,"Error in greaterEqualStrict: "),ag(n,r)}}),Bx=Tp({greaterStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","greaterStrict"),r=Cp(t,"b","greaterStrict");return Zc(n.shape,r.shape,"Error in greaterStrict: "),og(n,r)}}),qx=Tp({lessEqualStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","lessEqualStrict"),r=Cp(t,"b","lessEqualStrict");return Zc(n.shape,r.shape,"Error in lessEqualStrict: "),Hy(n,r)}}),Wx=Tp({lessStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","lessStrict"),r=Cp(t,"b","lessStrict");return Zc(n.shape,r.shape,"Error in lessStrict: "),mw(n,r)}}),jx=Tp({notEqualStrict_:function(e,t){Hf("strict variants of ops have been deprecated and will be removed in future");const n=Cp(e,"a","notEqualStrict"),r=Cp(t,"b","notEqualStrict");return Zc(n.shape,r.shape,"Error in notEqualStrict: "),Mg(n,r)}});ep.prototype.equalStrict=function(e){return this.throwIfDisposed(),Lx(this,e)},ep.prototype.equal=function(e){return this.throwIfDisposed(),Jm(this,e)};const Vx=Tp({erf_:function(e){let t=Cp(e,"x","erf");Jc("int32"===t.dtype||"float32"===t.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===t.dtype&&(t=ff(t,"float32"));const n={x:t};return yp.runKernel(Ou,n)}});ep.prototype.erf=function(){return this.throwIfDisposed(),Vx(this)},ep.prototype.exp=function(){return this.throwIfDisposed(),cg(this)},ep.prototype.expandDims=function(e){return this.throwIfDisposed(),Zm(this,e)};const Ux=Tp({expm1_:function(e){const t={x:Cp(e,"x","expm1")};return yp.runKernel(Fu,t)}});ep.prototype.expm1=function(){return this.throwIfDisposed(),Ux(this)},ep.prototype.fft=function(){return this.throwIfDisposed(),gy(this)},ep.prototype.flatten=function(){return this.throwIfDisposed(),wm(this,[this.size])},ep.prototype.floor=function(){return this.throwIfDisposed(),ng(this)},ep.prototype.floorDiv=function(e){return this.throwIfDisposed(),Gm(this,e)},ep.prototype.gather=function(e,t){return this.throwIfDisposed(),rg(this,e,t)},ep.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),zx(this,e)},ep.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ag(this,e)},ep.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Bx(this,e)},ep.prototype.greater=function(e){return this.throwIfDisposed(),og(this,e)},ep.prototype.ifft=function(){return this.throwIfDisposed(),by(this)},ep.prototype.irfft=function(){return this.throwIfDisposed(),vy(this)};const Gx=Tp({isFinite_:function(e){const t={x:Cp(e,"x","isFinite")};return yp.runKernel(Yu,t)}});ep.prototype.isFinite=function(){return this.throwIfDisposed(),Gx(this)};const Hx=Tp({isInf_:function(e){const t={x:Cp(e,"x","isInf")};return yp.runKernel(Ju,t)}});ep.prototype.isInf=function(){return this.throwIfDisposed(),Hx(this)};const Kx=Tp({isNaN_:function(e){const t={x:Cp(e,"x","isNaN")};return yp.runKernel(Zu,t)}});ep.prototype.isNaN=function(){return this.throwIfDisposed(),Kx(this)},ep.prototype.leakyRelu=function(e){return this.throwIfDisposed(),sg(this,e)},ep.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),qx(this,e)},ep.prototype.lessEqual=function(e){return this.throwIfDisposed(),Hy(this,e)},ep.prototype.lessStrict=function(e){return this.throwIfDisposed(),Wx(this,e)},ep.prototype.less=function(e){return this.throwIfDisposed(),mw(this,e)};const Xx=Tp({localResponseNormalization_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;const a=Cp(e,"x","localResponseNormalization");Jc(4===a.rank||3===a.rank,(()=>"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(a.rank,"."))),Jc(rl(t),(()=>"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")));let s=a,i=!1;3===a.rank&&(i=!0,s=wm(a,[1,a.shape[0],a.shape[1],a.shape[2]]));const c={x:s},l={depthRadius:t,bias:n,alpha:r,beta:o},u=yp.runKernel(ch,c,l);return i?wm(u,[u.shape[1],u.shape[2],u.shape[3]]):u}});ep.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Xx(this,e,t,n,r)};const Qx=Tp({logSigmoid_:function(e){const t=Cp(e,"x","logSigmoid"),n=$f((e=>({value:Og(ey(Og(e))),gradFunc:t=>Cm(t,Im(Og(e)))})));return n(t)}});ep.prototype.logSigmoid=function(){return this.throwIfDisposed(),Qx(this)},ep.prototype.logSoftmax=function(e){return this.throwIfDisposed(),dg(this,e)},ep.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),ab(this,e,t)},ep.prototype.log=function(){return this.throwIfDisposed(),ig(this)},ep.prototype.log1p=function(){return this.throwIfDisposed(),ob(this)},ep.prototype.logicalAnd=function(e){return this.throwIfDisposed(),pg(this,e)},ep.prototype.logicalNot=function(){return this.throwIfDisposed(),Uw(this)};const Yx=Tp({logicalOr_:function(e,t){const n=Cp(e,"a","logicalOr","bool"),r=Cp(t,"b","logicalOr","bool");Ym(n.shape,r.shape);const o={a:n,b:r};return yp.runKernel(ih,o)}});ep.prototype.logicalOr=function(e){return this.throwIfDisposed(),Yx(this,e)};const Jx=Tp({logicalXor_:function(e,t){const n=Cp(e,"a","logicalXor","bool"),r=Cp(t,"b","logicalXor","bool");return Ym(n.shape,r.shape),pg(Yx(e,t),Uw(pg(e,t)))}});ep.prototype.logicalXor=function(e){return this.throwIfDisposed(),Jx(this,e)},ep.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),_m(this,e,t,n)},ep.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),fg(this,e,t,n,r)},ep.prototype.max=function(e,t){return this.throwIfDisposed(),lg(this,e,t)},ep.prototype.maximumStrict=function(e){return this.throwIfDisposed(),vx(this,e)},ep.prototype.maximum=function(e){return this.throwIfDisposed(),gg(this,e)},ep.prototype.mean=function(e,t){return this.throwIfDisposed(),yg(this,e,t)},ep.prototype.min=function(e,t){return this.throwIfDisposed(),bg(this,e,t)},ep.prototype.minimumStrict=function(e){return this.throwIfDisposed(),wx(this,e)},ep.prototype.minimum=function(e){return this.throwIfDisposed(),vg(this,e)};const Zx=Tp({mirrorPad_:function(e,t,n){Jc("reflect"===n||"symmetric"===n,(()=>"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")));const r=Cp(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Jc(t.length===r.rank,(()=>"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")));const o="reflect"===n?1:0;for(let i=0;i<r.rank;i++)Jc(2===t[i].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),Jc(t[i][0]>=0&&t[i][0]<=r.shape[i]-o&&t[i][1]>=0&&t[i][1]<=r.shape[i]-o,(()=>"Padding in dimension ".concat(i," cannot be greater than or equal ")+"to ".concat(r.shape[i]-o," or less than 0 for input of ")+"shape ".concat(r.shape)));const a={paddings:t,mode:n},s={x:r};return yp.runKernel(wh,s,a)}});ep.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Zx(this,e,t)},ep.prototype.modStrict=function(e){return this.throwIfDisposed(),xx(this,e)},ep.prototype.mod=function(e){return this.throwIfDisposed(),gx(this,e)},ep.prototype.mulStrict=function(e){return this.throwIfDisposed(),kx(this,e)},ep.prototype.mul=function(e){return this.throwIfDisposed(),Cm(this,e)},ep.prototype.neg=function(){return this.throwIfDisposed(),Og(this)},ep.prototype.norm=function(e,t,n){return this.throwIfDisposed(),Jy(this,e,t,n)},ep.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),jx(this,e)},ep.prototype.notEqual=function(e){return this.throwIfDisposed(),Mg(this,e)},ep.prototype.oneHot=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Pg(this,e,t,n)},ep.prototype.onesLike=function(){return this.throwIfDisposed(),Lg(this)},ep.prototype.pad=function(e,t){return this.throwIfDisposed(),zg(this,e,t)};const $x=Tp({pool_:function(e,t,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");const s=Cp(e,"x","maxPool");let i=s,c=!1;3===s.rank&&(c=!0,i=wm(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Jc(bm(a,o),(()=>"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(o,"'")));const l=cm(i.shape,t,a,o,r),u=[l.dilationHeight,l.dilationWidth];let h;h="same"===r?function(e,t){const n=e.map(((e,n)=>e+(e-1)*(t[n]-1))),r=n.map((e=>e-1)),o=r.map((e=>Math.floor(e/2))),a=r.map(((e,t)=>e-o[t]));return r.map(((e,t)=>[o[t],a[t]]))}([l.filterHeight,l.filterWidth],u):[[0,0],[0,0]];const d=1===u[0]&&1===u[1],[p,f]=function(e,t,n){const r=n.map((e=>e[0])),o=n.map((e=>e[1])),a=e.concat(r,o),s=t.map(((e,t)=>(e-a[t]%e)%e)),i=o.map(((e,t)=>e+s[t])),c=t.map(((e,t)=>[r[t],i[t]])),l=t.map(((e,t)=>[0,s[t]]));return[c,l]}([l.inHeight,l.inWidth],u,h),m=d?r:"valid",g=d?i:kv(i,u,p),y=("avg"===n?()=>xm(g,t,a,m):()=>fg(g,t,a,m))(),b=d?y:nx(y,u,f);return c?wm(b,[b.shape[1],b.shape[2],b.shape[3]]):b}});ep.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),$x(this,e,t,n,r,o)},ep.prototype.powStrict=function(e){return this.throwIfDisposed(),Sx(this,e)},ep.prototype.pow=function(e){return this.throwIfDisposed(),Qy(this,e)},ep.prototype.prelu=function(e){return this.throwIfDisposed(),Bg(this,e)};const ek=Tp({prod_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Cp(e,"x","prod");"bool"===r.dtype&&(r=ff(r,"int32"));const o={x:r},a={axis:t,keepDims:n};return yp.runKernel(Dh,o,a)}});ep.prototype.prod=function(e,t){return this.throwIfDisposed(),ek(this,e,t)};const tk=Tp({reciprocal_:function(e){const t={x:Cp(e,"x","reciprocal")};return yp.runKernel(zh,t)}});ep.prototype.reciprocal=function(){return this.throwIfDisposed(),tk(this)},ep.prototype.relu=function(){return this.throwIfDisposed(),Gg(this)},ep.prototype.relu6=function(){return this.throwIfDisposed(),xy(this)},ep.prototype.reshapeAs=function(e){return this.throwIfDisposed(),wm(this,e.shape)},ep.prototype.reshape=function(e){return this.throwIfDisposed(),wm(this,e)},ep.prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Uy(this,e,t,n)},ep.prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Gy(this,e,t,n)},ep.prototype.reverse=function(e){return this.throwIfDisposed(),Hg(this,e)},ep.prototype.rfft=function(){return this.throwIfDisposed(),yy(this)};const nk=Tp({round_:function(e){const t={x:Cp(e,"x","round")};return yp.runKernel(Kh,t)}});ep.prototype.round=function(){return this.throwIfDisposed(),nk(this)},ep.prototype.rsqrt=function(){return this.throwIfDisposed(),Yv(this)},ep.prototype.selu=function(){return this.throwIfDisposed(),Kg(this)},ep.prototype.separableConv2d=function(e,t,n,r,o,a){return this.throwIfDisposed(),Xg(this,e,t,n,r,o,a)},ep.prototype.sigmoid=function(){return this.throwIfDisposed(),Im(this)};const rk=Tp({sign_:function(e){const t={x:Cp(e,"x","sign")};return yp.runKernel(td,t)}});ep.prototype.sign=function(){return this.throwIfDisposed(),rk(this)},ep.prototype.sin=function(){return this.throwIfDisposed(),Dv(this)},ep.prototype.sinh=function(){return this.throwIfDisposed(),Lv(this)},ep.prototype.slice=function(e,t){return this.throwIfDisposed(),Tm(this,e,t)},ep.prototype.softmax=function(e){return this.throwIfDisposed(),$g(this,e)},ep.prototype.softplus=function(){return this.throwIfDisposed(),ey(this)},ep.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),kv(this,e,t)},ep.prototype.split=function(e,t){return this.throwIfDisposed(),ty(this,e,t)},ep.prototype.sqrt=function(){return this.throwIfDisposed(),ny(this)},ep.prototype.square=function(){return this.throwIfDisposed(),Ng(this)},ep.prototype.squaredDifference=function(e){return this.throwIfDisposed(),rb(this,e)},ep.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),_x(this,e)},ep.prototype.squeeze=function(e){return this.throwIfDisposed(),ry(this,e)},ep.prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof ep?[this,e]:[this,...e];return oy(n,t)},ep.prototype.step=function(e){return this.throwIfDisposed(),ky(this,e)};const ok=Tp({stridedSlice_:function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const l={x:Cp(e,"x","stridedSlice")},u={begin:t,end:n,strides:r,beginMask:o,endMask:a,ellipsisMask:s,newAxisMask:i,shrinkAxisMask:c};return yp.runKernel(pd,l,u)}});ep.prototype.stridedSlice=function(e,t,n,r,o,a,s,i){return this.throwIfDisposed(),ok(this,e,t,n,r,o,a,s,i)},ep.prototype.subStrict=function(e){return this.throwIfDisposed(),Cx(this,e)},ep.prototype.sub=function(e){return this.throwIfDisposed(),ug(this,e)},ep.prototype.sum=function(e,t){return this.throwIfDisposed(),hg(this,e,t)};const ak=Tp({tan_:function(e){const t={x:Cp(e,"x","tan")};return yp.runKernel(fd,t)}});ep.prototype.tan=function(){return this.throwIfDisposed(),ak(this)},ep.prototype.tanh=function(){return this.throwIfDisposed(),Nm(this)},ep.prototype.tile=function(e){return this.throwIfDisposed(),$m(this,e)},ep.prototype.toBool=function(){return this.throwIfDisposed(),ff(this,"bool")},ep.prototype.toFloat=function(){return this.throwIfDisposed(),ff(this,"float32")},ep.prototype.toInt=function(){return this.throwIfDisposed(),ff(this,"int32")};const sk=Tp({topk_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Cp(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(o,") ")+"but got ".concat(t));const a={x:r},s={k:t,sorted:n},[i,c]=yp.runKernel(yd,a,s);return{values:i,indices:c}}});ep.prototype.topk=function(e,t){return this.throwIfDisposed(),sk(this,e,t)},ep.prototype.transpose=function(e){return this.throwIfDisposed(),dy(this,e)};const ik=Tp({unique_:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Cp(e,"x","unique","string_or_numeric");Jc(n.rank>0,(()=>"The input tensor must be at least 1D"));const r={x:n},o={axis:t},[a,s]=yp.runKernel(vd,r,o);return{values:a,indices:s}}});let ck;function lk(){return null==ck&&(ck=yp.backend.epsilon()),ck}ep.prototype.unique=function(e){return this.throwIfDisposed(),ik(this,e)},ep.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Zv(this,e,t)},ep.prototype.unstack=function(e){return this.throwIfDisposed(),cy(this,e)},ep.prototype.where=function(e,t){return this.throwIfDisposed(),uy(e,this,t)},ep.prototype.zerosLike=function(){return this.throwIfDisposed(),hy(this)};class uk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,uk.prototype)}}class hk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,hk.prototype)}}class dk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,dk.prototype)}}class pk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pk.prototype)}}class fk extends Error{constructor(e){super(e),Object.setPrototypeOf(this,fk.prototype)}}Error;function mk(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}{const n=new Array(t);return n.fill(e),n}}function gk(e,t){if(!e)throw new fk(t)}function yk(e,t){let n=0;for(const r of e)r===t&&n++;return n}function bk(e){return 1===e.length?e[0]:e}function vk(e){return Array.isArray(e)?e:[e]}function wk(e){const t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function xk(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,((e,t)=>t.toUpperCase()))}let kk={};function Sk(e){if(null===e||void 0===e)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function _k(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((e=>_k(e)));else{const t=Object.keys(e);for(const n of t){const t=e[n];null!=t&&"object"===typeof t&&(Array.isArray(t)||"ndarray"!==t.type||"number"!==typeof t.value?_k(t):e[n]=t.value)}}}function Ck(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){const o=e;let a;if(o in n)a=n[o];else if(o in kk)a=kk[o];else if(a=t[o],null==a)throw new dk("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return a}{const a=e;if(null==a.className||null==a.config)throw new dk("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(a),".\n")+"'className' and 'config' must set.");const s=a.className;let i,c;if(s in n?[i,c]=n[s]:s in kk?[i,c]=kk.className:s in t&&([i,c]=t[s]),null==i)throw new dk("Unknown ".concat(r,": ").concat(s,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){const e={};for(const n of Object.keys(kk))e[n]=kk[n];for(const o of Object.keys(n))e[o]=n[o];a.config.customObjects=e;const t=Object.assign({},kk);for(const o of Object.keys(n))kk[o]=n[o];_k(a.config);const r=c(i,a.config,n,o);return kk=Object.assign({},t),r}{const e=Object.assign({},kk);for(const r of Object.keys(n))kk[r]=n[r];const t=new i(a.config);return kk=Object.assign({},e),t}}}function Ik(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Tk(e){if(null==e)return e;const t=[];for(const n of e)-1===t.indexOf(n)&&t.push(n);return t}function Nk(e){if(null==e)throw new dk("Invalid value in obj: ".concat(JSON.stringify(e)));for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function Ek(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new dk("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Ak(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return gk(n>=0),gk(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((e=>typeof e===t))}function Rk(e,t){Array.isArray(e)?(Jc(e.length>0,(()=>"".concat(t," is unexpectedly an empty array."))),e.forEach(((e,n)=>Rk(e,"element ".concat(n+1," of ").concat(t))))):Jc(Number.isInteger(e)&&e>0,(()=>"Expected ".concat(t," to be a positive integer, but got ")+"".concat(Ok(e),".")))}function Ok(e){return null===e?"null":Array.isArray(e)?"["+e.map((e=>Ok(e))).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function Mk(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function Pk(e,t){return Qf((()=>ny(hg(Cm(e,e),t,!0))))}class Dk extends Vf{getConfig(){return{}}}class Fk extends Dk{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Qf((()=>{const t=Pk(e,this.axis),n=Pm(t,0,this.maxValue);return Cm(e,Hm(n,rm(lk(),t)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Fk.className="MaxNorm",Gf(Fk);class Lk extends Dk{constructor(e){super(),this.defaultAxis=0,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Qf((()=>Hm(e,rm(lk(),Pk(e,this.axis)))))}getConfig(){return{axis:this.axis}}}Lk.className="UnitNorm",Gf(Lk);class zk extends Dk{apply(e){return Gg(e)}}zk.className="NonNeg",Gf(zk);class Bk extends Dk{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=e.minValue?e.minValue:this.defaultMinValue,this.maxValue=null!=e.maxValue?e.maxValue:this.defaultMaxValue,this.rate=null!=e.rate?e.rate:this.defaultRate,this.axis=null!=e.axis?e.axis:this.defaultAxis}apply(e){return Qf((()=>{const t=Pk(e,this.axis),n=rm(Cm(this.rate,Pm(t,this.minValue,this.maxValue)),Cm(1-this.rate,t));return Cm(e,Hm(n,rm(lk(),t)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Bk.className="MinMaxNorm",Gf(Bk);const qk={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Wk(e){return Sk(e)}function jk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ck(e,Uf.getMap().classNameMap,t,"constraint")}function Vk(e){if(null==e)return null;if("string"===typeof e){return jk({className:e in qk?qk[e]:e,config:{}})}return e instanceof Dk?e:jk(e)}const Uk=["channelsFirst","channelsLast"],Gk=["nearest","bilinear"],Hk=["valid","same","causal"],Kk=["max","avg"],Xk=["sum","mul","concat","ave"],Qk=new Map;function Yk(e){Ek(Uk,"DataFormat",e)}function Jk(e){Ek(Hk,"PaddingMode",e)}function Zk(e){Ek(Kk,"PoolMode",e)}const $k=[];function eS(e,t){$k.push(e);try{const e=t();return $k.pop(),e}catch(F2){throw $k.pop(),F2}}function tS(e){if(!oS(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===$k.length?"":$k.join("/")+"/")+e}function nS(e){if(!oS(e))throw new Error("Not a valid tensor name: '"+e+"'");Qk.has(e)||Qk.set(e,0);const t=Qk.get(e);if(Qk.set(e,Qk.get(e)+1),t>0){const n="".concat(e,"_").concat(t);return Qk.set(n,1),n}return e}const rS=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function oS(e){return!!e.match(rS)}function aS(e){return e===parseInt(e.toString(),10)}function sS(e,t,n){null==t&&(t=0),null==n&&(n=e.length);let r=1;for(let o=t;o<n;++o)r*=e[o];return r}function iS(e){return ay(e=Array.isArray(e)?new Float32Array(e):e)}function cS(e){return bg(iS(e)).dataSync()[0]}function lS(e){return lg(iS(e)).dataSync()[0]}function uS(e,t){if(t<e)throw new dk("end (".concat(t,") < begin (").concat(e,") is forbidden."));const n=[];for(let r=e;r<t;++r)n.push(r);return n}function hS(e,t){return e.asType(t)}function dS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function pS(e,t,n){return Qf((()=>{switch(e.rank){case 1:return Qg(e,t,n);case 2:return Yg(e,[t,0],[n,e.shape[1]]);case 3:return Jg(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Zg(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Tm(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Tm(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new dk("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function fS(e,t,n){return Qf((()=>{switch(e.rank){case 1:return Qg(e,t,n);case 2:return Yg(e,[0,t],[e.shape[0],n]);case 3:return Jg(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Zg(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new dk("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function mS(e,t,n,r){return Qf((()=>{switch(e.rank){case 1:return Qg(e,t,n);case 2:switch(r){case 1:return pS(e,t,n);case 2:return fS(e,t,n);default:throw new dk("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return pS(e,t,n);case 2:return Jg(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return fS(e,t,n);default:throw new dk("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return pS(e,t,n);case 2:return Zg(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Zg(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return fS(e,t,n);default:throw new dk("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new dk("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function gS(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(t=e[0].rank,n=0!==t?t:0),n===e[0].rank&&(n=-1),Sm(e,n)}function yS(e,t){switch(e.rank){case 1:return Dm([e,t]);case 2:return Fm([e,t],0);case 3:return Lm([e,t],0);case 4:return zm([e,t],0);default:throw new dk("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function bS(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new dk("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return $m(e,t)}function vS(e){return Vg(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function wS(e,t,n,r){if(e.rank<2||t.rank<2)throw new pk("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3){if(e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new pk("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape))}if(2===e.rank&&2===t.rank){return Ay({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?SS(e.rank,r,"channelsLast"):null,activation:n})}{const o=e.shape.slice(),a=o.pop();e=e.reshape([-1,a]);const s=t.shape.slice(),i=s.pop(),c=s.pop(),l=[...s,i],u=Array.from({length:t.rank},((e,n)=>0===n?t.rank-2:n<=t.rank-2?n-1:n));t=t.transpose(u).reshape([c,-1]);const h=[...o,...l];return Ay({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?SS(e.rank,r,"channelsLast"):null,activation:n}).reshape(h)}}function xS(e,t,n){return Qf((()=>(t=Array.isArray(t)?ay(t,"int32"):t.toInt(),rg(e,t,n))))}function kS(e){return Cm(e,e)}function SS(e,t,n){const r=t.shape;if(1!==t.rank&&t.rank!==e)throw new dk("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1,1]):t.reshape([1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,1,r[0]]):t.reshape([1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1]):t.reshape([1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,r[0]]):t.reshape([1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1]):t.reshape([1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,r[0]]):t.reshape([1].concat(r))}else if(e<3)return t;throw new dk("Unsupported input rank by biasAdd: ".concat(t.rank))}function _S(e,t,n){return Qf((()=>(null==n&&(n="channelsLast"),Yk(n),e.add(SS(e.rank,t,n)))))}function CS(e,t,n,r){return Qf((()=>py(e,t,n,r)))}function IS(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}const TS=["fanIn","fanOut","fanAvg"],NS=["normal","uniform","truncatedNormal"];class ES extends Vf{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class AS extends ES{apply(e,t){return Dg(e,t)}}AS.className="Zeros",Gf(AS);class RS extends ES{apply(e,t){return Fg(e,t)}}RS.className="Ones",Gf(RS);class OS extends ES{constructor(e){if(super(),"object"!==typeof e)throw new dk("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new dk("config must have value set but got ".concat(e));this.value=e.value}apply(e,t){return Qf((()=>Cm(em(this.value),Fg(e,t))))}getConfig(){return{value:this.value}}}OS.className="Constant",Gf(OS);class MS extends ES{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Ug(e,this.minval,this.maxval,t)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}MS.className="RandomUniform",Gf(MS);class PS extends ES{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pk("randomNormal does not support dType ".concat(t,"."));return vS(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}PS.className="RandomNormal",Gf(PS);class DS extends ES{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pk("truncatedNormal does not support dType ".concat(t,"."));return iy(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}DS.className="TruncatedNormal",Gf(DS);class FS extends ES{constructor(e){super(),this.gain=null!=e.gain?e.gain:1}apply(e,t){return Qf((()=>{if(2!==e.length||e[0]!==e[1])throw new dk("Identity matrix initializer can only be used for 2D square matrices.");return Cm(this.gain,eg(e[0]))}))}getConfig(){return{gain:this.gain}}}FS.className="Identity",Gf(FS);class LS extends ES{constructor(e){if(super(),e.scale<0)throw new dk("scale must be a positive float. Got: ".concat(e.scale));this.scale=null==e.scale?1:e.scale,this.mode=null==e.mode?"fanIn":e.mode,function(e){Ek(TS,"FanMode",e)}(this.mode),this.distribution=null==e.distribution?"normal":e.distribution,function(e){Ek(NS,"Distribution",e)}(this.distribution),this.seed=e.seed}apply(e,t){const n=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Yk(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){const r=sS(e,2);t=e[1]*r,n=e[0]*r}else if("channelsLast"===r){const r=sS(e,0,e.length-2);t=e[e.length-2]*r,n=e[e.length-1]*r}}else{const r=sS(e);t=Math.sqrt(r),n=Math.sqrt(r)}return[t,n]}(e),r=n[0],o=n[1];let a=this.scale;if("fanIn"===this.mode?a/=Math.max(1,r):"fanOut"===this.mode?a/=Math.max(1,o):a/=Math.max(1,(r+o)/2),"normal"===this.distribution){const n=Math.sqrt(a);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new pk("".concat(this.getClassName()," does not support dType ").concat(t,"."));return iy(e,0,n,t,this.seed)}{const n=Math.sqrt(3*a);return Ug(e,-n,n,t)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}LS.className="VarianceScaling",Gf(LS);class zS extends LS{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return LS.className}}zS.className="GlorotUniform",Gf(zS);class BS extends LS{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return LS.className}}BS.className="GlorotNormal",Gf(BS);class qS extends LS{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return LS.className}}qS.className="HeNormal",Gf(qS);class WS extends LS{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return LS.className}}WS.className="HeUniform",Gf(WS);class jS extends LS{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}getClassName(){return LS.className}}jS.className="LeCunNormal",Gf(jS);class VS extends LS{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}getClassName(){return LS.className}}VS.className="LeCunNormal",Gf(VS);class US extends ES{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=null==e.gain?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,null!=this.seed)throw new pk("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,t){return Qf((()=>{if(e.length<2)throw new pk("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");const t=vS(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32");let n=sb.gramSchmidt(t);return e[0]>e[1]&&(n=n.transpose()),Cm(this.gain,n)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}US.className="Orthogonal",Gf(US);const GS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function HS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ck(e,Uf.getMap().classNameMap,t,"initializer")}function KS(e){return Sk(e)}function XS(e){if("string"===typeof e){const t=e in GS?GS[e]:e;if("GlorotNormal"===t)return new BS;if("GlorotUniform"===t)return new zS;if("HeNormal"===t)return new qS;if("HeUniform"===t)return new WS;if("LeCunNormal"===t)return new jS;if("LeCunUniform"===t)return new VS;{const e={};return e.className=t,e.config={},HS(e)}}return e instanceof ES?e:HS(e)}let QS=0;function YS(){return QS++}const JS={};function ZS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in JS||(JS[e]=0),JS[e]+=1,e+JS[e].toString()}function $S(e){return Array.isArray(e)&&Array.isArray(e[0])}function e_(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function t_(e){let t;if(Array.isArray(e)){if(1!==e.length)throw new dk("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function n_(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new dk("Expected exactly 1 Shape; got ".concat(e.length))}return e}function r_(e){let t=0;for(const n of e)0===n.shape.length?t+=1:t+=n.shape.reduce(((e,t)=>e*t));return t}const o_="Variable";class a_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o_,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=YS(),n=null==n?o_:n,this.originalName=tS(n),this.name=nS(this.originalName),this.trainable_=r,this.constraint=o,this.val=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return yp.makeVariable(e,t,n,r)}(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function s_(e){return e.map((e=>e.read()))}function i_(e){e.forEach((e=>{e[0].write(e[1])}))}class c_{constructor(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class l_{constructor(e,t,n,r,o,a,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=o,this.outputTensorIndex=s,this.id=YS(),null!=a&&(this.originalName=tS(a),this.name=nS(this.originalName)),this.rank=t.length}}let u_=0;class h_{constructor(e,t){this.callArgs=t,this.id=u_++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)null!=n&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)null!=t?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let d_=0;class p_ extends Vf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=d_++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const e=this.getClassName();t=wk(e)+"_"+ZS(e)}if(this.name=t,this.trainable_=null==e.trainable||e.trainable,null!=e.inputShape||null!=e.batchInputShape){let t;if(null!=e.batchInputShape)t=e.batchInputShape;else if(null!=e.inputShape){let n=null;null!=e.batchSize&&(n=e.batchSize),t=[n].concat(e.inputShape)}this.batchInputShape=t;let n=e.dtype;null==n&&(n=e.inputDType),null==n&&(n="float32"),this.dtype=n}null!=e.weights?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(0===this.inboundNodes.length)throw new hk("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new dk("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}getInputAt(e){return bk(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return bk(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new uk("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new uk("Layer ".concat(this.name)+" is not connected, no input to return.");return bk(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new uk("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new uk("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return bk(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((e=>e()))}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach((t=>t.trainable=e)),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((e=>e.trainable)):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((e=>!e.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=vk(e),null==this.inputSpec||0===this.inputSpec.length)return;const t=vk(this.inputSpec);if(e.length!==t.length)throw new dk("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(let n=0;n<e.length;n++){const r=e[n],o=t[n];if(null==o)continue;const a=r.rank;if(null!=o.ndim&&a!==o.ndim)throw new dk("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(o.ndim,", found ndim=").concat(a));if(null!=o.maxNDim&&a>o.maxNDim)throw new dk("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(o.maxNDim,", found ndim=").concat(a));if(null!=o.minNDim&&a<o.minNDim)throw new dk("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(o.minNDim,", found ndim=").concat(a,"."));if(null!=o.dtype&&r.dtype!==o.dtype)throw new dk("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(o.dtype,", found dtype=").concat(r.dtype,"."));if(o.axes){const e=r.shape;for(const t in o.axes){const r=Number(t),a=o.axes[t],s=r>=0?e[r]:e[e.length+r];if(null!=a&&-1===[a,null].indexOf(s))throw new dk("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(r," of input shape to ")+"have value ".concat(a," but got shape ").concat(e,"."))}}if(null!=o.shape)for(let e=0;e<o.shape.length;++e){const t=o.shape[e],a=r.shape[e];if(null!=t&&null!=a&&t!==a)throw new dk("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(o.shape,", ")+"found shape=".concat(r.shape,"."))}}}call(e,t){return e}invokeCallHook(e,t){null!=this._callHook&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const n=vk(e);let r=!0;for(const a of n)if(!(a instanceof l_)){r=!1;break}let o=!0;for(const a of n)if(a instanceof l_){o=!1;break}if(r===o)throw new dk("Arguments to apply() must be all SymbolicTensors or all Tensors");return eS(this.name,(()=>{if(!this.built){this.assertInputCompatibility(e);const t=[];for(const n of vk(e))t.push(n.shape);this.build(bk(t)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let r=this.call(e,t);const o=vk(r),a=[];for(let e of o)-1!==n.indexOf(e)&&(e=e.clone()),a.push(e);if(r=bk(a),null!=this.activityRegularizer)throw new pk("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(e){e=vk(e);const t=[];for(const n of e)t.push(n.shape);return bk(t)}(e),r=this.computeOutputShape(n);let o;const a="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(e)?n[0]:n),o=null!=r&&r.length>0&&Array.isArray(r[0])?r.map(((n,r)=>new l_(a,n,this,vk(e),t,this.name,r))):new l_(a,r,this,vk(e),t,this.name),this.addInboundNode(e,o,null,null,n,r,t),this._refCount++,null!=this.activityRegularizer)throw new pk("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}}))}warnOnIncompatibleInputShape(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{let t=!1;this.batchInputShape.forEach(((n,r)=>{null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new uk("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");const e=[];for(const t of this.inboundNodes){const n=JSON.stringify(t.outputShapes);-1===e.indexOf(n)&&e.push(n)}if(1===e.length){const e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&1===e.length?e[0]:e}throw new uk("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}countParams(){if(!this.built)throw new hk("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return r_(this.weights)}build(e){this.built=!0}getWeights(){return s_(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}setWeights(e){Qf((()=>{const t=this.weights;if(t.length!==e.length)throw new dk('You called setWeights(weights) on layer "'.concat(this.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(t.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0===t.length)return;const n=[],r=s_(t);for(let o=0;o<r.length;++o){const a=r[o],s=t[o],i=e[o];if(!nl(a.shape,i.shape))throw new dk("Layer weight shape ".concat(a.shape," ")+"not compatible with provided weight shape ".concat(i.shape));n.push([s,i])}i_(n)}))}addWeight(e,t,n,r,o,a,s){if(-1!==this._addedWeightNames.indexOf(e))throw new dk("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=XS("zeros"));const i=r.apply(t,n),c=new a_(i,n,e,a,s);return i.dispose(),null!=o&&this.addLoss((()=>o.apply(c.read()))),null==a&&(a=!0),a?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){null==e||Array.isArray(e)&&0===e.length||(e=vk(e),void 0!==this._losses&&null!==this._losses&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((e=>{if(null!=e)throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}addInboundNode(e,t,n,r,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const i=vk(e);t=vk(t),n=vk(n),r=vk(r),o=e_(o),a=e_(a);const c=[],l=[],u=[];for(const h of i)c.push(h.sourceLayer),l.push(h.nodeIndex),u.push(h.tensorIndex);new h_({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:u,inputTensors:i,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:o,outputShapes:a},s);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach((e=>e.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}dispose(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();let e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function f_(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];{const e=t.inboundNodes[n];if(0===e.inboundLayers.length)return e.inputTensors;{const t=[];for(let n=0;n<e.inboundLayers.length;n++){const r=f_(e.inputTensors[n],e.inboundLayers[n],e.nodeIndices[n]);for(const e of r)-1===t.indexOf(e)&&t.push(e)}return t}}}class m_ extends p_{constructor(e){if(super({dtype:e.dtype,name:null!=e.name?e.name:ZS("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new dk("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(null==t){if(null==e.inputShape)throw new dk("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new dk("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];const r=new l_(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new h_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new dk("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}async function g_(e){if(null==e)return;const t=[],n=[],r=[];for(const o in e){const a=e[o];if("number"!==typeof a){const e=a;t.push(e.data()),n.push(o),r.push(e)}}if(t.length>0){const o=await Promise.all(t);for(let t=0;t<o.length;++t)e[n[t]]=o[t][0];Yf(r)}}function y_(e){if(null!=e)for(const t in e){const n=e[t];"number"!==typeof n&&n.dispose()}}var b_;m_.className="InputLayer",Gf(m_),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(b_||(b_={}));class v_{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class w_{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;null==e&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){null==t&&(t={});for(const n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){null==e&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class x_ extends v_{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){null==t&&(t={});const n=null==t.size?0:t.size;this.seen+=n;for(const r in t){const e=t[r];if("number"===typeof e)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+e*n;else{let t;r in this.totals?t=this.totals[r]:this.totals[r]=0;const o=Qf((()=>rm(this.totals[r],Cm(e,n))));this.totals[r]=o,null!=t&&t.dispose()}}}async onEpochEnd(e,t){if(null!=t)for(const n of this.params.metrics)null!=this.totals[n]&&("number"===typeof this.totals[n]?t[n]=this.totals[n]/this.seen:Qf((()=>{const e=Cm(Hm(1,this.seen),this.totals[n]);t[n]=e,this.totals[n].dispose(),Jf(t[n])})))}}class k_ extends v_{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){null==t&&(t={}),this.epoch.push(e);for(const n in t)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){const e=[],t=[],n=[];for(const o in this.history){const r=this.history[o];for(let a=0;a<r.length;++a)if("number"!==typeof r[a]){const s=r[a];e.push(s.data()),t.push(o),n.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o){this.history[t[o]][n[o]].dispose(),this.history[t[o]][n[o]]=r[o][0]}}}class S_ extends v_{constructor(e,t){if(super(),this.currentEpoch=0,this.yieldEvery=t||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");gl(this.yieldEvery)&&(this.maybeWait=function(e,t){let n,r=Kd();return function(){const o=Kd();return o-r<t||(r=o,n=e(...arguments)),n}}(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){const r=[];null!=this.yield&&(await g_(n),r.push(this.yield(e,t,n))),r.push(yb()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,null!=this.epochBegin&&(await g_(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const n=[];null!=this.epochEnd&&(await g_(t),n.push(this.epochEnd(e,t))),"epoch"===this.yieldEvery&&n.push(yb()),await Promise.all(n)}async onBatchBegin(e,t){null!=this.batchBegin&&(await g_(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const n=[];null!=this.batchEnd&&(await g_(t),n.push(this.batchEnd(e,t))),"batch"===this.yieldEvery?n.push(yb()):gl(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){null!=this.trainBegin&&(await g_(e),await this.trainBegin(e))}async onTrainEnd(e){null!=this.trainEnd&&(await g_(e),await this.trainEnd(e))}}function __(e,t){if(null==e&&(e={}),e instanceof v_)return[e];if(Array.isArray(e)&&e[0]instanceof v_)return e;return vk(e).map((e=>new S_(e,t)))}class C_{constructor(){}static registerCallbackConstructor(e,t){Jc(e>=0&&Number.isInteger(e),(()=>"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e))),C_.checkForDuplicate(t),null==C_.constructors[e]&&(C_.constructors[e]=[]),C_.constructors[e].push(t)}static checkForDuplicate(e){for(const t in C_.constructors){C_.constructors[+t].forEach((t=>{if(t===e)throw new dk("Duplicate callback constructor.")}))}}static clear(){C_.constructors={}}static createCallbacks(e){const t=[];for(const n in C_.constructors){const r=+n;e>=r&&t.push(...C_.constructors[r])}return t.map((e=>new e))}}function I_(e,t,n,r,o,a,s,i,c){const l=new k_,u=[new x_,...C_.createCallbacks(t)];null!=e&&u.push(...e),u.push(l);const h=new w_(u);return h.setParams({epochs:n,initialEpoch:r,samples:o,steps:a,batchSize:s,verbose:t,doValidation:i,metrics:c}),{callbackList:h,history:l}}function T_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ck(e,Uf.getMap().classNameMap,t,"layer",n)}function N_(e,t){return Qf((()=>{"float32"!==e.dtype&&(e=e.asType("float32"));const n=hg(kS(e),t,!0),r=tg(n.shape,lk()),o=ny(gg(n,r));return Hm(e,o)}))}function E_(e,t){return Qf((()=>yg(kS(ug(t,e)),-1)))}function A_(e,t){return Qf((()=>yg(nm(ug(t,e)),-1)))}function R_(e,t){return Qf((()=>{const n=ug(e,t),r=Pm(nm(e),lk(),Number.MAX_VALUE),o=nm(Hm(n,r));return Cm(100,yg(o,-1))}))}function O_(e,t){return Qf((()=>{const n=Pm(t,lk(),Number.MAX_VALUE),r=ig(rm(1,n)),o=Pm(e,lk(),Number.MAX_VALUE),a=ig(rm(1,o));return yg(kS(ug(r,a)),-1)}))}function M_(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Qf((()=>{if(n)t=$g(t);else{const e=hg(t,t.shape.length-1,!0);t=Hm(t,e)}return t=Pm(t,lk(),1-lk()),Og(hg(Cm(e.toFloat(),ig(t)),t.shape.length-1))}))}function P_(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Qf((()=>{const r=ng(function(e){const t=[sS(e.shape)];return e.reshape(t)}(e)).toInt(),o=(t=Pm(t,lk(),1-lk())).shape;return M_(Pg(r,o[o.length-1]).reshape(o),t,n)}))}function D_(e,t){return Qf((()=>{let n;return n=Pm(t,lk(),1-lk()),n=ig(Hm(n,ug(1,n))),yg(function(e,t){if(!nl(e.shape,t.shape))throw new dk("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Qf((()=>{const n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function F_(e,t){return Qf((()=>{const n=Pm(e,lk(),1),r=Pm(t,lk(),1);return hg(Cm(e,ig(Hm(n,r))),-1)}))}function L_(e,t){return Qf((()=>{const n=N_(e,-1),r=N_(t,-1),o=Cm(n,r);return Og(hg(o,-1))}))}C_.constructors={};const z_={meanSquaredError:E_,meanAbsoluteError:A_,meanAbsolutePercentageError:R_,meanSquaredLogarithmicError:O_,squaredHinge:function(e,t){return Qf((()=>{const n=gg(0,ug(1,Cm(e,t)));return yg(kS(n),-1)}))},hinge:function(e,t){return Qf((()=>{const n=gg(0,ug(1,Cm(e,t)));return yg(n,-1)}))},categoricalHinge:function(e,t){return Qf((()=>{const n=hg(Cm(e,t),-1),r=lg(Cm(ug(1,e),t),-1);return gg(0,rm(1,ug(r,n)))}))},logcosh:function(e,t){return Qf((()=>{const n=Math.log(2),r=ug(t,e),o=ug(rm(r,ey(Cm(-2,r))),n);return yg(o,-1)}))},categoricalCrossentropy:M_,sparseCategoricalCrossentropy:P_,binaryCrossentropy:D_,kullbackLeiblerDivergence:F_,poisson:function(e,t){return Qf((()=>{const n=ig(rm(lk(),t));return yg(ug(t,Cm(e,n)),-1)}))},cosineProximity:L_};function B_(e){if("string"===typeof e){if(e in z_)return z_[e];let t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new dk(t)}return e}function q_(e,t){return Qf((()=>{const n=Cm(.5,Lg(t)),r=hS(og(t,n),e.dtype);return yg(Jm(e,r),-1)}))}function W_(e,t){return Qf((()=>hS(Jm(sm(e,-1),sm(t,-1)),"float32")))}function j_(e,t){return Qf((()=>pg(e.equal(1),t.equal(1)).sum().cast("float32")))}function V_(e,t){return D_(e,t)}function U_(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),Jm(e,t).asType("float32")}const G_=M_,H_=P_,K_={binaryAccuracy:q_,categoricalAccuracy:W_,precision:function(e,t){return Qf((()=>{const n=j_(e,t),r=function(e,t){return Qf((()=>pg(e.equal(0),t.equal(1)).sum().cast("float32")))}(e,t),o=n.add(r);return uy(og(o,0),n.div(o),0).cast("float32")}))},categoricalCrossentropy:G_,sparseCategoricalCrossentropy:H_,mse:E_,MSE:E_,mae:A_,MAE:A_,mape:R_,MAPE:R_,cosine:L_};function X_(e){if("string"===typeof e&&e in K_)return K_[e];if("string"!==typeof e&&null!=e)return e;throw new dk("Unknown metric ".concat(e))}function Q_(e){if(gk(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;{let t;for(const n of Object.keys(z_))if(z_[n]===e){t=n;break}if(void 0!==t)return t;for(const n of Object.keys(K_))if(K_[n]===e){t=n;break}return void 0!==t?t:e.name}}const Y_=1048576;function J_(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Z_(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(e);n.length>Y_&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(Y_,"."))}}function Z_(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t){if("string"!==typeof n)return!1;if(!Z_(e[n]))return!1}return!0}if(Array.isArray(e)){for(const t of e)if(!Z_(t))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}function $_(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log;const o=function(e){let t=!0;const n=[],r=[];for(const o in e.nodesByDepth)n.push(e.nodesByDepth[o]);for(const o of n){if(o.length>1||1===o.length&&o[0].inboundLayers.length>1){t=!1;break}r.push(...o)}if(t)for(const o of e.layers){let e=!1;for(const n of o.inboundNodes)if(-1!==r.indexOf(n)){if(e){t=!1;break}e=!0}if(!t)break}return t}(e),a=["Layer (type)","Output shape","Param #"];let s;if(o?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((e=>Math.floor(t*e)))),!o){a.push("Receives inputs"),s=[];for(const t in e.nodesByDepth)s.push(...e.nodesByDepth[t])}r("_".repeat(t)),eC(a,n,r),r("=".repeat(t));const i=e.layers;for(let u=0;u<i.length;++u)o?tC(i[u],n,r):nC(i[u],n,s,r),r((u===i.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const c=function(e){let t;t=null!=e.collectedTrainableWeights?r_(e.collectedTrainableWeights):r_(e.trainableWeights);return t}(e),l=r_(e.nonTrainableWeights);r("Total params: ".concat(c+l)),r("Trainable params: ".concat(c)),r("Non-trainable params: ".concat(l)),r("_".repeat(t))}function eC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="";for(let o=0;o<e.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=e[o],r=r.slice(0,t[o]),r+=" ".repeat(t[o]-r.length);n(r)}function tC(e,t,n){let r;try{r=JSON.stringify(e.outputShape)}catch(L2){r="multiple"}const o=e.name,a=e.getClassName();eC(["".concat(o," (").concat(a,")"),r,e.countParams().toString()],t,n)}function nC(e,t,n,r){let o;try{o=JSON.stringify(e.outputShape)}catch(L2){o="multiple"}const a=[];for(const l of e.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(l)))for(let e=0;e<l.inboundLayers.length;++e){const t=l.inboundLayers[e].name,n=l.nodeIndices[e],r=l.tensorIndices[e];a.push("".concat(t,"[").concat(n,"][").concat(r,"]"))}const s=e.name,i=e.getClassName(),c=0===a.length?"":a[0];eC(["".concat(s," (").concat(i,")"),o,e.countParams().toString(),c],t,r);for(let l=1;l<a.length;++l)eC(["","","",a[l]],t,r)}function rC(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function oC(e,t){if(null===e)return null;if("string"===typeof e)return xk(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let o=0;o<r;++o){const r=e[o];rC(t,o,r)?n.push(r):n.push(oC(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n];if("name"===n&&"string"===typeof r)t[n]=r;else{const e=xk(n);t[e]=oC(r,e)}}return t}}function aC(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return wk(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){const n=[],r=e.length;for(let o=0;o<r;++o){const r=e[o];rC(t,o,r)?n.push(r):n.push(aC(r,t))}return n}{const t={};for(const n of Object.keys(e)){const r=e[n],o=wk(n);t[o]="name"!==n&&"className"!==n||"string"!==typeof r?aC(r,n):r}return t}}const sC="2.8.6";class iC{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof iC)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(null==e)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,n){if(null!=this.id2Value[e.id])throw new dk("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return ff(t,e.dtype)}catch(L2){throw new dk("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return null!=this.id2Value[e.id]}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof l_){if(null==this.id2Value[e.id])throw new dk("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}{const t=this.name2Id[e];if(null==t)throw new dk("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}}getMask(e){if(e instanceof l_){if(null==this.id2Value[e.id])throw new dk("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}{const t=this.name2Id[e];if(null==t)throw new dk("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}}disposeMasks(){null!=this.id2Mask&&Yf(this.id2Mask)}}const cC={},lC={};function uC(e,t,n,r){const o=null!=n&&n.training,a=Array.isArray(e),s=a?e:[e],i=s.map((e=>e.name)),c=[],l=t.names();for(const f of i)-1!==l.indexOf(f)?c.push(t.getValue(f)):c.push(null);null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const u=i.join(",")+"|"+t.names().join(",");let h,d;if(null==cC[u]){const e=function(e,t){Jc(null!=e&&e.length>0,(()=>"Expected at least one fetch, got none"));let n=[],r={};if(1===e.length){const o=dC(e[0],t);n=o.sorted,r=o.recipientMap}else{const o=new Set;for(const a of e){const{sorted:e,recipientMap:s}=dC(a,t);for(const t of e)o.has(t.name)||(n.push(t),o.add(t.name));for(const t in s)null==r[t]&&(r[t]=new Set),s[t].forEach((e=>r[t].add(e)))}}return{sorted:n,recipientCounts:hC(r)}}(s,t);h=e.sorted,d=e.recipientCounts,cC[u]=h,lC[u]=d}h=cC[u],d={},o||Object.assign(d,lC[u]);const p=new iC(t);for(let f=0;f<h.length;++f){if(null!=r){const e=Xf().numTensors;e>r.maxNumTensors&&(r.maxNumTensors=e),e<r.minNumTensors&&(r.minNumTensors=e)}const e=h[f],a=e.sourceLayer;if(a instanceof m_)continue;const s=[],l=[],u=[];let m=!1;for(const n of e.inputs){const e=p.getValue(n),r=p.getMask(n);s.push(e),l.push(r),null!=r&&(m=!0),o||(d[n.name]--,0!==d[n.name]||t.hasKey(n)||-1!==i.indexOf(n.name)||e.isDisposed||!0===n.sourceLayer.stateful||u.push(e))}m&&((n=n||{}).mask=l[0]);const g=vk(a.apply(s,n));let y=null;a.supportsMasking&&(y=a.computeMask(s,l));const b=pC(e),v=Array.isArray(b)?b:[b];for(let t=0;t<v.length;++t){p.hasKey(v[t])||p.add(v[t],g[t],Array.isArray(y)?y[0]:y);const e=i.indexOf(v[t].name);-1!==e&&(c[e]=g[t])}o||Yf(u)}return p.disposeMasks(),a?c:c[0]}function hC(e){const t={};for(const n in e)t[n]=e[n].size;return t}function dC(e,t){const n=new Set,r=[],o={};for(const i of t.names())n.add(i);const a=[],s=[];for(a.push(e);a.length>0;){const e=a[a.length-1];if(n.has(e.name)){a.pop();continue}const t=s[s.length-1]===a.length-1;if(0===e.inputs.length||t)a.pop(),r.push(e),n.add(e.name),t&&s.pop();else{s.push(a.length-1);for(const t of e.inputs)null==o[t.name]&&(o[t.name]=new Set),o[t.name].add(e.name),n.has(t.name)||a.push(t)}}return{sorted:r,recipientMap:o}}function pC(e){let t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{let n=null;for(let t=0;t<e.sourceLayer.inboundNodes.length;++t)for(const r of e.sourceLayer.inboundNodes[t].outputTensors)if(r.id===e.id){n=t;break}t=e.sourceLayer.getOutputAt(n)}return t}class fC extends p_{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,null==this.name){const e=this.getClassName().toLowerCase();this.name=ZS(e)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Tk(this.inputs).length!==this.inputs.length)throw new dk("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(this.inputs.map((e=>e.name))));Tk(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(this.outputs.map((e=>e.name)))),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const e=y.sourceLayer,t=y.nodeIndex,n=y.tensorIndex;this.outputLayers.push(e),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(n)}for(const y of this.inputs){const e=y.sourceLayer,t=y.nodeIndex,n=y.tensorIndex;gk(0===t,"input layer has >1 nodes"),gk(0===n,"input layer has >1 tensors"),this.inputLayers.push(e),this.inputLayersNodeIndices.push(t),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const t=this.inputLayers[y];if(!(t instanceof m_))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(y," (0-based) originates ")+"from layer type ".concat(t.getClassName(),"."));this.inputNames.push(t.name),this.feedInputShapes.push(t.batchInputShape),this.feedInputNames.push(t.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map((e=>e.shape)),this.internalOutputShapes=this.outputs.map((e=>e.shape));const t={},n={},r={},o={},a={},s=[],i=(e,t,n,r,o,c)=>{null!=r&&null!=o&&null!=c||(r=e.sourceLayer,o=e.nodeIndex,c=e.tensorIndex);const l=r.inboundNodes[o];if(-1!==n.indexOf(l))throw new hk("The tensor ".concat(e.name,' at layer "').concat(r.name,'" ')+"is part of a cycle.");if(-1!==t.indexOf(l))return;this.containerNodes.add(fC.nodeKey(r,o)),r.id in a||(a[r.id]=Object.keys(a).length),-1===n.indexOf(l)&&n.push(l);const u=l.inboundLayers.length;for(let a=0;a<u;a++){const e=l.inputTensors[a],r=l.inboundLayers[a],o=l.nodeIndices[a],s=l.tensorIndices[a];i(e,t,n,r,o,s)}for(t.push(l);n.indexOf(l)>=0;)n.splice(n.indexOf(l),1);s.push(l)},c=[],l=[];for(const y of this.outputs)i(y,c,l);const u=s.slice().reverse();for(const y of u){n[y.id]=y,y.id in t||(t[y.id]=0);let e=t[y.id];const a=null==r[y.outboundLayer.id]?0:r[y.outboundLayer.id];e=Math.max(e,a),r[y.outboundLayer.id]=e,o[y.outboundLayer.id]=y.outboundLayer,t[y.id]=e;for(let r=0;r<y.inboundLayers.length;r++){const o=y.inboundLayers[r],a=y.nodeIndices[r],s=o.inboundNodes[a],i=null==t[s.id]?0:t[s.id];t[s.id]=Math.max(e+1,i),n[s.id]=s}}const h={};for(const y in t){const e=t[y];e in h||(h[e]=[]),h[e].push(n[y])}const d={};for(const y in r){const e=r[y];e in d||(d[e]=[]),d[e].push(o[y])}let p=Object.keys(d).map((e=>parseInt(e,10))).sort(Ik);this.layers=[];for(const y of p){const e=d[y];e.sort(((e,t)=>{const n=a[e.id],r=a[t.id];return n<r?-1:n>r?1:0}));for(const t of e)t instanceof fC&&this.internalContainerRefs.push(t),this.layers.push(t)}this.layersByDepth=d,p=Object.keys(h).map((e=>parseInt(e,10))).sort(Ik);const f=this.inputs.slice(),m=[];for(const y of p)for(const e of h[y]){const t=e.outboundLayer;if(null!=t){for(const n of e.inputTensors)if(-1===f.indexOf(n))throw new hk("Graph disconnected: cannot obtain value for tensor ".concat(n)+' at layer "'.concat(t.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(m));for(const t of e.outputTensors)f.push(t);m.push(t.name)}}this.nodesByDepth=h;const g=this.layers.map((e=>e.name));for(const y of g){const e=g.filter((e=>e===y)).length;if(1!==e)throw new hk('The name "'.concat(y,'" is used ').concat(e," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new h_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((e=>null)),outputMasks:this.outputs.map((e=>null)),inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs.map((e=>e.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach((t=>{t._trainableWeights.forEach((t=>t.trainable=e))})),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new dk("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.layers)t.push(...e.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n={};let r=0;for(const a of this.layers)for(const e of a.weights){if(null!=n[e.originalName])throw new dk("Duplicate weight name: ".concat(e.originalName));n[e.originalName]=e,r++}const o=[];for(const a in e){let r=a;if(null==n[a]){const e=a.split("/");r=e.slice(0,-2).concat([e[e.length-1]]).join("/")}if(null!=n[r])o.push([n[r],e[a]]);else if(t)throw new dk("Provided weight data has no target variable: ".concat(a));delete n[r]}if(t){const e=[];for(const t in n)e.push(t);if(e.length>0)throw new dk("".concat(e.length," of ").concat(r," weights are not set: ")+"".concat(e))}i_(o)}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(sC),t.backend="TensorFlow.js",t}toJSON(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=aC(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return Qf((()=>{e=vk(e);const n=new iC;for(let t=0;t<this.inputs.length;++t)n.add(this.inputs[t],e[t]);return uC(this.outputs,n,t)}))}computeMask(e,t){return Qf((()=>{let n;return e=vk(e),n=null==t?mk(null,e.length):vk(t),this.runInternalGraph(e,n)[1]}))}computeOutputShape(e){const t=e_(e);if(t.length!==this.inputLayers.length)throw new dk("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));const n={};for(let s=0;s<t.length;s++){const e=this.inputLayers[s],r=t[s];n[e.name+"_0_0"]=r}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(Ik);if(r.length>1)for(const s of r){const e=this.nodesByDepth[s];for(const t of e){const e=t.outboundLayer;if(-1!==this.inputLayers.map((e=>e.id)).indexOf(e.id))continue;const r=[];for(let s=0;s<t.inboundLayers.length;s++){const e=t.inboundLayers[s],o=t.nodeIndices[s],a=t.tensorIndices[s],i=n["".concat(e.name,"_").concat(o,"_").concat(a)];r.push(i)}const o=e_(e.computeOutputShape(bk(r))),a=e.inboundNodes.indexOf(t);for(let t=0;t<o.length;t++){n["".concat(e.name,"_").concat(a,"_").concat(t)]=o[t]}}}const o=[],a=[];for(let s=0;s<this.outputLayers.length;s++){const e=this.outputLayers[s],t=this.outputLayersNodeIndices[s],n=this.outputLayersTensorIndices[s],r="".concat(e.name,"_").concat(t,"_").concat(n);a.push(r)}for(let s=0;s<a.length;s++){const e=a[s];gk(e in n),o.push(n[e])}return bk(o)}runInternalGraph(e,t){null==t&&(t=mk(null,e.length));const n={};for(let i=0;i<this.inputs.length;++i){const r=this.inputs[i],o=e[i],a=t[i];n[r.id]=[o,a]}const r=Object.keys(this.nodesByDepth).map((e=>parseInt(e,10))).sort(Ik);for(const i of r){const e=this.nodesByDepth[i];for(const t of e){const e=t.outboundLayer,r=t.inputTensors,o=t.outputTensors,a=new Array;for(const t of r)t.id in n&&a.push(n[t.id]);if(a.length===r.length){let r,s,i,c,l={};if(null!=t.callArgs&&(l=t.callArgs),1===a.length){const[t,n]=a[0];null==l.mask&&(l.mask=n),i=vk(e.call(t,l)),c=vk(e.computeMask(t,n)),r=[t],s=[n]}else r=a.map((e=>e[0])),s=a.map((e=>e[1])),null==l.mask&&(l.mask=s),i=vk(e.call(r,l)),c=vk(e.computeMask(r,s));if(e.activityRegularizer)throw new pk("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let e=0;e<o.length;++e){const t=o[e],r=i[e],a=c[e];n[t.id]=[r,a]}}}}const o=[],a=[],s=[];for(const i of this.outputs){gk(i.id in n,"Could not compute output ".concat(i.name," : ").concat(i.id));const[e,t]=n[i.id];s.push(e.shape),o.push(e),a.push(t)}return[o,a,s]}buildNodeConversionMap(e){const t={};let n;for(const r of this.layers){n=r instanceof fC?1:0;for(let e=0;e<r.inboundNodes.length;e++){const o=fC.nodeKey(r,e);this.containerNodes.has(o)&&(t[o]=n,n+=1)}}return t}getLayer(e,t){if(null!=t){if(this.layers.length<=t)throw new dk("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new dk("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===e)return n;throw new dk("No such layer: ".concat(e))}calculateLosses(){return Qf((()=>{const e=[];for(const t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){const r=fC.nodeKey(t,n);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e}))}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(const a of this.layers){const e=a.getClassName(),r=a.getConfig(),o=[];for(let n=0;n<a.inboundNodes.length;n++){const e=a.inboundNodes[n],r=fC.nodeKey(a,n);let s={};if(this.containerNodes.has(r)){if(e.callArgs)try{JSON.stringify(e.callArgs),s=e.callArgs}catch(L2){console.warn("Layer ".concat(a.name," was passed ")+"non-serializable keyword arguments: "+"".concat(e.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),s={}}if(e.inboundLayers.length>0){const n=[];for(let r=0;r<e.inboundLayers.length;r++){const o=e.inboundLayers[r],a=e.nodeIndices[r],i=e.tensorIndices[r];let c=t[fC.nodeKey(o,a)];null==c&&(c=0),n.push([o.name,c,i,s])}o.push(n)}}}const s={};s.name=a.name,s.className=e,s.config=r,s.inboundNodes=o,n.push(s)}e.layers=n;const r=[];for(let a=0;a<this.inputLayers.length;a++){const e=this.inputLayers[a],n=this.inputLayersNodeIndices[a],o=fC.nodeKey(e,n);if(!this.containerNodes.has(o))continue;let s=t[o];null!==s&&void 0!==s||(s=0);const i=this.inputLayersTensorIndices[a];r.push([e.name,s,i])}e.inputLayers=r;const o=[];for(let a=0;a<this.outputLayers.length;a++){const e=this.outputLayers[a],n=this.outputLayersNodeIndices[a],r=fC.nodeKey(e,n);if(!this.containerNodes.has(r))continue;let s=t[r];null!==s&&void 0!==s||(s=0);const i=this.outputLayersTensorIndices[a];o.push([e.name,s,i])}return e.outputLayers=o,e}static fromConfig(e,t){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={},o={};function a(e,t){e.name in o?o[e.name].push(t):o[e.name]=[t]}function s(e,t){const n=[];let o;for(const s of t){const i=s[0],c=s[1],l=s[2];if(o=null==s[3]?{}:s[3],!(i in r))return void a(e,t);const u=r[i];if(u.inboundNodes.length<=c)return void a(e,t);const h=u.inboundNodes[c];n.push(h.outputTensors[l])}n.length>0&&e.apply(bk(n),o)}function i(e){const o=e.name,s=T_(e,null!=t.customObjects?t.customObjects:{});s.setFastWeightInitDuringBuild(n),r[o]=s;e.inboundNodes.forEach((e=>{if(!(e instanceof Array))throw new dk("Corrupted configuration, expected array for nodeData: ".concat(e));a(s,e)}))}const c=t.name,l=t.layers;for(const f of l)i(f);for(;!Nk(o);)for(const e of l){const t=r[e.name];if(t.name in o){const e=o[t.name];delete o[t.name];for(const n of e)s(t,n)}}const u=[],h=[],d=t.inputLayers;for(const f of d){const e=f[0],t=f[1],n=f[2];gk(e in r);const o=r[e].inboundNodes[t].outputTensors;u.push(o[n])}const p=t.outputLayers;for(const f of p){const e=f[0],t=f[1],n=f[2];gk(e in r);const o=r[e].inboundNodes[t].outputTensors;h.push(o[n])}return new e({inputs:u,outputs:h,name:c})}get stateful(){if(this._stateful)throw new dk("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Qf((()=>{this.layers.forEach((e=>{e.stateful&&e.resetStates()}))}))}}function mC(e,t,n){const r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>null));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){const n=[];return t.forEach((t=>{t in e?n.push(e[t]):n.push(null)})),n}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function gC(e,t){return mC(e,t,"classWeight")}async function yC(e,t,n,r){if(null!=t||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const t=Qf((()=>{if(1===e.shape.length)return e.clone();if(2===e.shape.length){if(e.shape[1]>1){const t=1;return e.argMax(t)}if(1===e.shape[1])return e.reshape([e.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(e.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(e.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),r=Array.from(await t.data());Yf(t);const o=[];return r.forEach((e=>{if(null==n[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");o.push(n[e])})),ay(o,"float32")}return null}function bC(e,t){return Cm(e,t)}function vC(e,t){let n,r;const o=t;n=o.xs,r=o.ys,Jc(null!=n&&null!=r,(()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)));const a=wC("input",e.inputNames,n),s=wC("output",e.outputNames,r),i=a[0].shape[0];Jc(a.length===e.inputs.length,(()=>"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(a.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")"))),Jc(s.length===e.outputs.length,(()=>"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(s.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")));for(let c=0;c<a.length;c++)Jc(a[c].shape[0]===i,(()=>"Batch size mismatch: input "+"".concat(e.inputNames[c]," has ").concat(a[c].shape[0],"; ")+"expected  ".concat(i," based on input ").concat(e.inputNames[0],".")));for(let c=0;c<s.length;c++)Jc(s[c].shape[0]===i,(()=>"Batch size mismatch: output "+"".concat(e.outputNames[c]," has ").concat(s[c].shape[0],"; ")+"expected  ".concat(i," based on input ").concat(e.inputNames[0],".")));return{xs:a,ys:s}}function wC(e,t,n){if(n instanceof ep)return[n];if(Array.isArray(n))return Jc(n.length===t.length,(()=>"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,"."))),n;{const r=[];for(const o of t){if(null==n[o])throw new dk("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));r.push(n[o])}return r}}async function xC(e,t,n){const r=null!=n.batchesPerEpoch;if(Jc(null!=e.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),Jc(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),Jc(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(n.epochs))),Jc(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(n.batchesPerEpoch))),Jc(null==n.validationSplit,(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const o=null!=n.validationData;let a,s;if(o)if(kC(n.validationData))Jc(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(n.validationBatches)));else{const e=function(e){if(3===e.length)throw new pk("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(n.validationData);a=e.xs,s=e.ys}const i=e.makeTrainFunction(),c=e.getDedupedMetricsNames();let l;l=o?c.slice().concat(c.map((e=>"val_"+e))):c.slice();const u=__(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:d,history:p}=I_(u,h,n.epochs,null,null,function(e,t){let n=null;null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size);return n}(t,n),null,o,l);d.setModel(e),e.history=p,await d.onTrainBegin(),e.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,m=await t.iterator();for(;f<n.epochs;){const l={};await d.onEpochBegin(f);let u=0,h=0;for(r||(m=await t.iterator());!r||u<n.batchesPerEpoch;){const t=await m.next();if(r&&t.done){console.warn("You provided `batchesPerEpoch` as "+"".concat(n.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(u," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(n.batchesPerEpoch*n.epochs," batches). ")+"You may need to use the repeat() function when building your dataset.");break}if(null!=t.value){const{xs:r,ys:o}=vC(e,t.value),a={};a.batch=h,a.size=r[0].shape[0],await d.onBatchBegin(h,a);const s=[];if(null!=n.classWeight){const t=gC(n.classWeight,e.outputNames);for(let e=0;e<t.length;++e)s.push(await yC(o[e],null,t[e]))}const l=r.concat(o).concat(s),p=i(l);Yf(l);for(let e=0;e<c.length;++e){const t=c[e],n=p[e];a[t]=n,Jf(n)}await d.onBatchEnd(h,a),y_(a),h++,u++}if(r?u>=n.batchesPerEpoch:t.done){if(o){let t;t=kC(n.validationData)?vk(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):vk(e.evaluate(a,s,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<e.metricsNames.length;++n)l["val_".concat(e.metricsNames[n])]=t[n]}break}if(e.stopTraining_)break}if(await d.onEpochEnd(f,l),f++,e.stopTraining_)break}return await d.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function kC(e){return"function"===typeof e.iterator}function SC(e){Jc(e>0&&Number.isInteger(e),(()=>"batchSize is required to be a positive integer, but got ".concat(e)))}function _C(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((e=>pS(e,t,n-t))):pS(e,t,n-t)}function CC(e,t){return Qf((()=>null==e?null:Array.isArray(e)?e.map((e=>CC(e,t))):xS(e,"int32"===t.dtype?t:t.toInt())))}function IC(e,t){const n=[];let r=0,o=null;for(;r<e;)o=r+t,o>=e&&(o=e),n.push([r,o]),r=o;return n}async function TC(e,t,n){let r,o,a,s,i,c,l,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const h=null==u.batchSize?32:u.batchSize;SC(h);const d=!1,p=await e.standardizeUserData(t,n,u.sampleWeight,u.classWeight,d,h);r=p[0],o=p[1],l=p[2];let f,m=!1;if(null!=u.validationData&&u.validationData.length>0){if(m=!0,2!==u.validationData.length)throw 3===u.validationData.length?new pk("validationData including sample weights is not supported yet."):new dk("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(u.validationData," is invalid."));a=u.validationData[0],s=u.validationData[1];const t=!0,n=await e.standardizeUserData(a,s,null,null,t,h);i=n[0],c=n[1],f=i.concat(c)}else if(null!=u.validationSplit&&u.validationSplit>0&&u.validationSplit<1){m=!0;const e=Math.floor(r[0].shape[0]*(1-u.validationSplit)),t=r[0].shape[0];i=_C(r,e,t),r=_C(r,0,e),c=_C(o,e,t),o=_C(o,0,e),f=i.concat(c)}else null!=u.validationSteps&&(m=!0);const g=r.concat(o).concat(l);e.checkTrainableWeightsConsistency();const y=e.makeTrainFunction(),b=e.getDedupedMetricsNames();let v,w;m?(e.makeTestFunction(),v=e.testFunction,w=b.slice().concat(b.map((e=>"val_"+e)))):(v=null,f=[],w=b.slice());const x=__(u.callbacks,u.yieldEvery),k=await async function(e,t,n,r,o,a,s,i,c,l,u,h,d,p,f){null==o&&(o=32),null==a&&(a=1),null==u&&(u=!0),null==d&&(d=0);let m=!1;if(null!=c&&null!=l&&(m=!0),null!=f&&(m=!0,null==p))throw new dk("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=e.checkNumSamples(n,o,p,"steps_per_epoch");let y;null!=g&&(y=uS(0,g)),null==s&&(s=1);const{callbackList:b,history:v}=I_(i,s,a,d,g,p,o,m,h);b.setModel(e),e.history=v,await b.onTrainBegin(),e.stopTraining_=!1;for(let w=d;w<a;++w){await b.onEpochBegin(w);const a={};if(null!=p)throw new pk("stepsPerEpoch mode is not implemented yet.");{if("batch"===u)throw new pk("batch shuffling is not implemneted yet");u&&Xc(y);const s=ay(y),i=IC(g,o);for(let u=0;u<i.length;++u){const h={};if(await b.onBatchBegin(u,h),Qf((()=>{const d=i[u][0],p=i[u][1],f=pS(s,d,p-d);h.batch=u,h.size=p-d;const g=CC(n,f),y=t(g);for(let e=0;e<r.length;++e){const t=r[e],n=y[e];h[t]=n,Jf(n)}if(u===i.length-1&&m){const t=e.testLoop(c,l,o);for(let e=0;e<r.length;++e){const n=r[e],o=t[e];Jf(o),a["val_"+n]=o}}})),await b.onBatchEnd(u,h),y_(h),e.stopTraining_)break}s.dispose()}if(await b.onEpochEnd(w,a),e.stopTraining_)break}return await b.onTrainEnd(),await e.history.syncData(),e.history}(e,y,g,b,h,u.epochs,u.verbose,x,v,f,u.shuffle,w,u.initialEpoch,null,null);return k}finally{e.isTraining=!1,EC(r,t),EC(o,n),EC(i,a),EC(c,s),null!=l&&Yf(l)}}function NC(e){const t=[];e instanceof ep&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(1===r.rank)t.push(dS(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function EC(e,t){if(null==e)return;const n=[];if(t instanceof ep)n.push(t.id);else if(Array.isArray(t))t.forEach((e=>n.push(e.id)));else if(null!=t)for(const o in t){const e=t[o];n.push(e.id)}const r=[];if(e instanceof ep)-1===n.indexOf(e.id)&&r.push(e);else if(Array.isArray(e))e.forEach((e=>{-1===n.indexOf(e.id)&&r.push(e)}));else if(null!=e)for(const o in e){const t=e[o];-1===n.indexOf(t.id)&&r.push(t)}r.forEach((e=>{e.isDisposed||e.dispose()}))}function AC(e){return Array.isArray(e)}function RC(e){return!function(e){return e instanceof ep}(e)&&!AC(e)}function OC(e,t,n){let r,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){let t=!1;if(AC(e)&&e.length>0)t=!0;else if(RC(e)){for(const n in e)if(e.hasOwnProperty(n)){t=!0;break}}else t=!0;if(t)throw new dk("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((e=>null));if(RC(e)){r=[];for(const n of t){if(null==e[n])throw new dk('No data provided for "'.concat(n,'". Need data for each key in: ')+"".concat(t));r.push(e[n])}}else if(AC(e)){if(e.length!==t.length)throw new dk("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new dk("The model ".concat(a," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=NC(r),null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=r[s];if(e.shape.length!==n[s].length)throw new dk("Error when checking ".concat(a,": expected ").concat(t[s]," ")+"to have ".concat(n[s].length," dimension(s). but got array with ")+"shape ".concat(e.shape));for(let r=0;r<n[s].length;++r){if(0===r&&!o)continue;const i=e.shape[r],c=n[s][r];if(null!=c&&c>=0&&i!==c)throw new dk("Error when checking ".concat(a,": expected ").concat(t[s]," ")+"to have shape [".concat(n[s],"], but got array with shape ")+"[".concat(e.shape,"]."))}}return r}function MC(e,t,n){let r,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new dk("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new dk("The model expects ".concat(t.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(let s=0;s<t.length;++s){if(null==n[s])continue;const e=r[s];if(e.shape.length!==n[s].length)throw new dk("Error when checking ".concat(a,": expected ").concat(t[s]," ")+"to have ".concat(n[s].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(e.shape)));for(let r=0;r<n[s].length;++r){if(0===r&&!o)continue;const i=e.shape[r],c=n[s][r];if(null!=c&&c!==i)throw new dk("Error when checking ".concat(a,": expected ")+"".concat(t[s]," to have shape ").concat(JSON.stringify(n[s])," but ")+"got array with shape ".concat(JSON.stringify(e.shape),"."))}}}class PC extends fC{constructor(e){super(e),this.isTraining=!1}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new dk("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");$_(this,e,t,n)}compile(e){if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){const t={Adagrad:()=>mb.adagrad(.01),Adadelta:()=>mb.adadelta(1,.95,lk()),Adam:()=>mb.adam(.001,.9,.999,lk()),Adamax:()=>mb.adamax(.002,.9,.999,lk(),0),RMSProp:()=>mb.rmsprop(.001,.9,0,lk()),SGD:()=>mb.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new dk("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof tm))throw new dk("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new dk("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));const n=e.loss;t=n.map((e=>B_(e)))}else{const n=B_(e.loss);this.outputs.forEach((e=>{t.push(n)}))}else{e.loss=e.loss;for(const t in e.loss)if(-1===this.outputNames.indexOf(t))throw new dk('Unknown entry in loss dictionary: "'.concat(t,'". ')+"Only expected the following keys: ".concat(this.outputNames));for(const n of this.outputNames)null==e.loss[n]&&console.warn('Output "'.concat(n,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(n," during training")),t.push(B_(e.loss[n]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const e=this.internalOutputShapes[a],t=this.outputNames[a];this.feedOutputNames.push(t),this.feedOutputShapes.push(e),this.feedLossFns.push(this.lossFunctions[a])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],eS("loss",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;const t=this.lossFunctions[e];this.outputs.length>1&&(this.metricsTensors.push([t,e]),this.metricsNames.push(this.outputNames[e]+"_loss"))}}));const r=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((e=>[]));let n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((e=>n));{const e=[];for(const r of t){let t=n.hasOwnProperty(r)?n[r]:[];Array.isArray(t)||(t=[t]),e.push(t)}return e}}(e.metrics,this.outputNames),o=(e,t,n)=>{this.outputNames.length>1&&(t=this.outputNames[e]+"_"+t),this.metricsNames.push(t),this.metricsTensors.push([n,e])};eS("metric",(()=>{for(let e=0;e<this.outputs.length;++e){if(-1!==n.indexOf(e))continue;(t=>{let n,r,a;for(const s of t){if("string"===typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){const t=this.internalOutputShapes[e];let o;1===t[t.length-1]||this.lossFunctions[e]===D_?-1!==["accuracy","acc"].indexOf(s)?r=q_:-1!==["crossentropy","ce"].indexOf(s)&&(r=V_):this.lossFunctions[e]===P_?-1!==["accuracy","acc"].indexOf(s)?r=U_:-1!==["crossentropy","ce"].indexOf(s)&&(r=H_):-1!==["accuracy","acc"].indexOf(s)?r=W_:-1!==["crossentropy","ce"].indexOf(s)&&(r=G_),-1!==["accuracy","acc"].indexOf(s)?o="acc":-1!==["crossentropy","ce"].indexOf(s)&&(o="ce"),a=r,n=""+o}else{const e=X_(s);a=e,n=""+Q_(s)}let t;eS(n,(()=>{t=a})),o(e,n,t)}})(r[e])}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null==n.batchSize?32:n.batchSize;SC(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const e=o[0].concat(o[1]);this.makeTestFunction();const t=this.testFunction;return bk(this.testLoop(t,e,r,n.verbose,n.steps))}finally{EC(o[0],e),EC(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),async function(e,t,n){const r=null!=(n=n||{}).batches,o=e.testFunction;let a=[];if(n.verbose>0)throw new pk("Verbose mode is not implemented yet.");Jc(!r||n.batches>0&&Number.isInteger(n.batches),(()=>"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(n.batches))));const s="function"===typeof t.next?t:await t.iterator();let i=0,c=0;for(;!r||c<n.batches;){const t=await s.next();if(a=Qf((()=>{if(t.value){const{xs:n,ys:r}=vC(e,t.value),s=n.concat(r),l=Qf((()=>o(s)));if(Yf(s),0===c)for(let e=0;e<l.length;++e)a.push(em(0));const u=s[0].shape[0];for(let e=0;e<l.length;++e){const t=l[e],n=a[e];a[e]=Qf((()=>rm(a[e],Cm(u,t)))),c>0&&Yf(n)}Yf(l),i+=u,++c}return a})),t.done){r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(n.batches," batches). ")+"You may need to use the repeat() function when building your dataset.");break}}for(let l=0;l<a.length;++l){const e=a[l];a[l]=Hm(a[l],i),Yf(e)}return bk(a)}(this,e,t)}checkNumSamples(e,t,n){let r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new dk("If ".concat(o," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new dk("Either the input data should have a defined shape, or "+"".concat(o," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}execute(e,t){if(Array.isArray(t)&&0===t.length)throw new dk("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(t),r=n?t:[t],o=this.retrieveSymbolicTensors(r),a=new iC;if(e instanceof ep&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new dk("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(let t=0;t<this.inputs.length;++t)a.add(this.inputs[t],e[t])}else for(const i of this.inputs){const t=e[i.name];if(null==t)throw new dk("No value is provided for the model's input ".concat(i.name));a.add(i,t)}const s=uC(o,a);return n?s:s[0]}retrieveSymbolicTensors(e){const t=mk(null,e.length);let n=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],a=o.map((e=>e.name));for(let r=0;r<e.length;++r){const s=a.indexOf(e[r]);if(-1!==s&&(t[r]=o[s],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw t.forEach(((t,r)=>{null==t&&n.push(e[r])})),new dk("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(n)))}return t}predictLoop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Qf((()=>{const r=this.checkNumSamples(e);if(n)throw new pk("Verbose predictLoop() is not implemented yet.");const o=IC(r,t),a=this.outputs.map((e=>[]));for(let t=0;t<o.length;++t){const n=Qf((()=>{const n=o[t][0],r=o[t][1],a=_C(e,n,r),s=[];if(Array.isArray(a))for(let e=0;e<a.length;++e)s.push({key:this.inputs[e],value:a[e]});else s.push({key:this.inputs[0],value:a});const i=new iC(s);return uC(this.outputs,i)}));n.forEach(((e,t)=>a[t].push(e)))}return bk(a.map((e=>Sm(e,0))))}))}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=NC(e);MC(n,this.inputNames,this.feedInputShapes,!1);try{const e=null==t.batchSize?32:t.batchSize;return SC(e),this.predictLoop(n,e)}finally{EC(n,e)}}predictOnBatch(e){MC(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t){let n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new hk("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let o=0;o<this.feedOutputShapes.length;++o){const e=this.feedOutputShapes[o];this.feedLossFns[o]===P_?r.push(e.slice(0,e.length-1).concat([1])):r.push(e)}if(function(e,t){const n=Tk(e.map((e=>e.shape[0])));n.sort();const r=Tk(t.map((e=>e.shape[0])));if(r.sort(),n.length>1)throw new dk("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((e=>e.shape)))));if(r.length>1)throw new dk("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((e=>e.shape)))));if(n.length>0&&r.length>0&&!nl(n,r))throw new dk("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(r[0]," target ")+"sample(s).")}(e=OC(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=OC(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){const r=[E_,D_,M_];for(let o=0;o<e.length;++o){const a=e[o],s=t[o],i=n[o];if(null!=s){if(s===M_&&1===a.shape[a.shape.length-1])throw new dk("You are passing a target array of shape ".concat(a.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(s)){const e=a.shape.slice(1),t=i.slice(1);for(let n=0;n<e.length;++n){const r=e[n],o=t[n];if(null!=o&&r!==o)throw new dk("A target Tensor with shape ".concat(a.shape," was passed for an ")+"output of shape ".concat(i,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new dk("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}async standardizeUserData(e,t,n,r){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5?arguments[5]:void 0;const[s,i]=this.standardizeUserDataXY(e,t,o,a);if(null!=n)throw new Error("sample weight is not supported yet.");let c=null;if(null!=r){const e=gC(r,this.outputNames);c=[];for(let t=0;t<e.length;++t)c.push(await yC(i[t],null,e[t]))}return[s,i,c]}testLoop(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;return Qf((()=>{const a=this.checkNumSamples(t,n,o,"steps"),s=[];if(r>0)throw new pk("Verbose mode is not implemented yet.");if(null!=o)throw new pk("steps mode in testLoop() is not implemented yet");{const r=IC(a,n),o=ay(uS(0,a));for(let n=0;n<r.length;++n){const a=r[n][0],i=r[n][1],c=pS(o,a,i-a),l=CC(t,c),u=e(l);if(0===n)for(let e=0;e<u.length;++e)s.push(em(0));for(let e=0;e<u.length;++e){const t=u[e];s[e]=rm(s[e],Cm(i-a,t))}}for(let e=0;e<s.length;++e)s[e]=Hm(s[e],a)}return s}))}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){const r=e[n];let o=r;if(yk(e,r)>1){const t=yk(e.slice(0,n),r);o+="_".concat(t)}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),a=[],s=this.collectedTrainableWeights.map((e=>e.read())),i=this.optimizer_.minimize((()=>{const e=[];for(let t=0;t<this.inputs.length;++t)e.push({key:this.inputs[t],value:n[t]});const s=new iC(e),i=uC(this.outputs,s,{training:!0});let c;for(let n=0;n<this.lossFunctions.length;++n){let e=(0,this.lossFunctions[n])(r[n],i[n]);null!=o[n]&&(e=bC(e,o[n]));const a=yg(e);t.push(a),c=0===n?e:rm(c,e)}for(let n=0;n<this.metricsTensors.length;++n){let e;if(this.outputs.length>1&&n<this.outputs.length)e=t[n];else{const t=this.metricsTensors[n][0],o=this.metricsTensors[n][1];e=yg(t(r[o],i[o]))}Jf(e),a.push(e)}return c=yg(c),this.calculateLosses().forEach((e=>{c=rm(c,e)})),c}),!0,s);return[i].concat(a)}}makeTestFunction(){this.testFunction=e=>Qf((()=>{const t=[];let n;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let e=0;e<this.inputs.length;++e)a.push({key:this.inputs[e],value:r[e]});const s=new iC(a),i=uC(this.outputs,s);for(let e=0;e<this.lossFunctions.length;++e){const r=this.lossFunctions[e],a=yg(r(o[e],i[e]));n=0===e?a:rm(n,a),t.push(n)}for(let e=0;e<this.metricsTensors.length;++e){const n=this.metricsTensors[e][0],r=this.metricsTensors[e][1],a=yg(n(o[r],i[r]));t.push(a)}return t}))}async fit(e,t){return TC(this,e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async fitDataset(e,t){return xC(this,e,t)}async trainOnBatch(e,t){const n=await this.standardizeUserData(e,t),r=n[0],o=n[1],a=this.makeTrainFunction()(r.concat(o)),s=[];for(const i of a){const e=await i.data();s.push(e[0])}return Yf(a),bk(s)}getNamedWeights(e){const t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,o=this.getWeights(n);for(let a=0;a<r.length;++a)n&&!r[a].trainable||t.push({name:r[a].originalName,tensor:o[a]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const t=Xf().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Xf().numTensors}return e}getLossIdentifiers(){let e;if("string"===typeof this.loss)e=wk(this.loss);else if(Array.isArray(this.loss)){for(const e of this.loss)if("string"!==typeof e)throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map((e=>wk(e)))}else{const t=Object.keys(this.loss);e={};const n=this.loss;for(const r of t){if("string"!==typeof n[r])throw new Error("Serialization of non-string loss is not supported.");e[r]=wk(n[r])}}return e}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[wk(Q_(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((e=>wk(Q_(e))));{const e={};for(const t in this.metrics)e[t]=wk(Q_(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const t=T_(oC(e.optimizer_config));let n,r;if("string"===typeof e.loss)n=xk(e.loss);else if(Array.isArray(e.loss))n=e.loss.map((e=>xk(e)));else if(null!=e.loss){n={};for(const t in e.loss)n[t]=xk(e.loss[t])}if(Array.isArray(e.metrics))r=e.metrics.map((e=>xk(e)));else if(null!=e.metrics){r={};for(const t in e.metrics)r[t]=xk(e.metrics[t])}this.compile({loss:n,metrics:r,optimizer:t})}async save(e,t){if("string"===typeof e){const t=(e=>Bp.getSaveHandlers(e))(e);if(0===t.length)throw new dk("Cannot find any save handlers for URL '".concat(e,"'"));if(t.length>1)throw new dk("Found more than one (".concat(t.length,") save handlers for ")+"URL '".concat(e,"'"));e=t[0]}if(null==e.save)throw new dk("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await Op(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(sC),convertedBy:null};if(null!=t&&t.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const e="optimizer",{data:t,specs:o}=await Op(await this.optimizer.getWeights(),e);n.specs.push(...o),n.data=Fp([n.data,t])}if(null!=this.userDefinedMetadata){const e=!0;J_(this.userDefinedMetadata,this.name,e),r.userDefinedMetadata=this.userDefinedMetadata}return r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){J_(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}PC.className="Model",Gf(PC);class DC extends PC{}DC.className="Functional",Gf(DC);class FC extends PC{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=null!=e.name?e.name:ZS("sequential_"),null!=e.layers)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some((e=>e<0)))throw new dk("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}add(e){const t=e instanceof FC||e instanceof PC;let n;if(t){if(n=e,1!==n.outputs.length)throw new dk("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new dk("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new dk("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const t=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new dk("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));let n=e.dtype;return null==n&&(n="float32"),new m_({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(t)}if(t)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==e.inboundNodes.length)throw new dk("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new dk("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=f_(this.outputs[0])}this.inboundNodes=[],new h_({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:mk(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((e=>e.shape)),outputShapes:this.outputs[0].shape})}else{const t=e.apply(this.outputs[0]);if(Array.isArray(t))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[t],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return null==this.model&&this.build(),this.model.call(e,t)}build(e){if(n_(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new PC({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),super.summary(e,t,n)}setWeights(e){null==this.model&&this.build(),this.model.setWeights(e)}evaluate(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new hk("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}async evaluateDataset(e,t){if(!this.built)throw new hk("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new hk("The model needs to be compiled before being used.");return this.model.fit(e,t,n)}async fitDataset(e,t){if(!this.built)throw new hk("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t){let n,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new dk("Legacy serialization format not supported yet.");n=t}else Jc(null!=t.layers,(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),n=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof FC))throw new pk("Sequential.fromConfig called on non-Sequential input: ".concat(a));for(const s of n){const e=T_(s,void 0,r);r&&e.setFastWeightInitDuringBuild(!0),a.add(e)}return a}set stopTraining(e){if(null==this.model)throw new dk("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(null==this.model)throw new dk("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const n={};n.className=t.getClassName(),n.config=t.getConfig(),e.push(n)}return{name:this.name,layers:e}}}FC.className="Sequential",Gf(FC);class LC extends Vf{getConfig(){return{}}}class zC extends LC{apply(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new pk("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Km(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}zC.className="elu",Gf(zC);class BC extends LC{apply(e){return Kg(e)}}BC.className="selu",Gf(BC);class qC extends LC{apply(e){return Gg(e)}}qC.className="relu",Gf(qC);class WC extends LC{apply(e){return Qf((()=>vg(6,Gg(e))))}}WC.className="relu6",Gf(WC);class jC extends LC{apply(e){return e}}jC.className="linear",Gf(jC);class VC extends LC{apply(e){return Im(e)}}VC.className="sigmoid",Gf(VC);class UC extends LC{apply(e){return function(e){return Qf((()=>{const t=rm(.5,Cm(.2,e));return Pm(t,0,1)}))}(e)}}UC.className="hardSigmoid",Gf(UC);class GC extends LC{apply(e){return ey(e)}}GC.className="softplus",Gf(GC);class HC extends LC{apply(e){return function(e){return Qf((()=>Hm(e,nm(e).add(1))))}(e)}}HC.className="softsign",Gf(HC);class KC extends LC{apply(e){return Nm(e)}}KC.className="tanh",Gf(KC);class XC extends LC{apply(e){return $g(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}XC.className="softmax",Gf(XC);class QC extends LC{apply(e){return dg(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}QC.className="logSoftmax",Gf(QC);class YC extends LC{apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Qf((()=>Im(e.mul(t)).mul(e)))}}function JC(e){return e.getClassName()}function ZC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ck(e,Uf.getMap().classNameMap,t,"activation")}function $C(e){if(null==e){const e={className:"linear",config:{}};return ZC(e)}if("string"===typeof e){const t={};return t.className=e,t.config={},ZC(t)}return e instanceof LC?e:ZC(e)}function eI(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}YC.className="swish",Gf(YC);class tI extends Vf{}class nI extends tI{constructor(e){super(),eI(e),this.l1=null==e||null==e.l1?.01:e.l1,this.l2=null==e||null==e.l2?.01:e.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(e){return Qf((()=>{let t=Dg([1]);return this.hasL1&&(t=rm(t,hg(Cm(this.l1,nm(e))))),this.hasL2&&(t=rm(t,hg(Cm(this.l2,kS(e))))),t.asScalar()}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}nI.className="L1L2",Gf(nI);const rI={l1l2:"L1L2"};function oI(e){return Sk(e)}function aI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ck(e,Uf.getMap().classNameMap,t,"regularizer")}function sI(e){if(null==e)return null;if("string"===typeof e){return aI({className:e in rI?rI[e]:e,config:{}})}return e instanceof tI?e:aI(e)}class iI extends p_{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,null!=e&&(this.maxValue=e.maxValue)}call(e,t){e=t_(e);let n=Gg(e);return null!=this.maxValue&&(n=Pm(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}iI.className="ReLU",Gf(iI);class cI extends p_{constructor(e){super(null==e?{}:e),this.DEFAULT_ALPHA=.3,null==e&&(e={}),this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=t_(e);return sg(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}cI.className="LeakyReLU",Gf(cI);class lI extends p_{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),this.supportsMasking=!0,this.alphaInitializer=XS(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=sI(e.alphaRegularizer),this.alphaConstraint=Vk(e.alphaConstraint),null==e.sharedAxes)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new dk("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));this.sharedAxes=[e.sharedAxes]}}build(e){const t=(e=n_(e)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new c_({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=t_(e),Bg(e,this.alpha.read())}getConfig(){const e={alphaInitializer:KS(this.alphaInitializer),alphaRegularizer:oI(this.alphaRegularizer),alphaConstraint:Wk(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}lI.className="PReLU",Gf(lI);class uI extends p_{constructor(e){if(super(null==e?{}:e),this.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==this.DEFAULT_ALPHA)throw new pk("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");this.alpha=null==e.alpha?this.DEFAULT_ALPHA:e.alpha}call(e,t){const n=t_(e);return Km(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}uI.className="ELU",Gf(uI);class hI extends p_{constructor(e){super(null==e?{}:e),this.DEFAULT_THETA=1,null==e&&(e={}),this.theta=null==e.theta?this.DEFAULT_THETA:e.theta}call(e,t){const n=t_(e);return n.mul(hS(n.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}hI.className="ThresholdedReLU",Gf(hI);class dI extends p_{constructor(e){super(null==e?{}:e),this.DEFAULT_AXIS=1,null==e&&(e={}),this.softmax=(new XC).apply,this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis}call(e,t){const n=t_(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function pI(e,t,n){if("number"===typeof e)return mk(e,t);if(e.length!==t)throw new dk("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(let r=0;r<t;++r){const o=e[r];if(!aS(o))throw new dk("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(o))}return e}function fI(e,t,n,r){if(null==e)return e;let o;return o="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((o+r-1)/r)}function mI(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+lS([n-t,0]);else{if("same"!==r)throw new dk("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function gI(e,t){return Qf((()=>(Yk(t),"channelsFirst"===t?dy(e,[0,2,3,1]):e)))}function yI(e,t){return Qf((()=>(Yk(t),"channelsFirst"===t?dy(e,[0,2,3,4,1]):e)))}function bI(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Qf((()=>{if(null==a&&(a="channelsLast"),Yk(a),3!==e.shape.length)throw new dk("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new dk("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new dk("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===a&&(e=dy(e,[0,2,1])),"causal"===o)throw new pk("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let i=qm(e,t,r,"same"===o?"same":"valid","NWC",s);return null!=n&&(i=_S(i,n)),i}))}function vI(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Qf((()=>{if(null==a&&(a="channelsLast"),Yk(a),3!==e.rank&&4!==e.rank)throw new dk("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new dk("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));let c=gI(e,a);if("causal"===o)throw new pk("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=Ty({x:c,filter:t,strides:r,pad:"same"===o?"same":"valid",dilations:s,dataFormat:"NHWC",bias:n,activation:i}),"channelsFirst"===a&&(c=dy(c,[0,3,1,2])),c}))}function wI(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0;return Qf((()=>{if(null==a&&(a="channelsLast"),Yk(a),4!==e.rank&&5!==e.rank)throw new dk("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new dk("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));let i=yI(e,a);if("causal"===o)throw new pk("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return i=Vm(i,t,r,"same"===o?"same":"valid","NDHWC",s),null!=n&&(i=_S(i,n)),"channelsFirst"===a&&(i=dy(i,[0,4,1,2,3])),i}))}dI.className="Softmax",Gf(dI);class xI extends p_{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",xI.verifyArgs(t),this.rank=e,Rk(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new pk("Convolution layer for rank other than 1, 2, or 3 (".concat(this.rank,") is ")+"not implemented yet.");if(this.kernelSize=pI(t.kernelSize,e,"kernelSize"),this.strides=pI(null==t.strides?1:t.strides,e,"strides"),this.padding=null==t.padding?"valid":t.padding,Jk(this.padding),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,Yk(this.dataFormat),this.activation=$C(t.activation),this.useBias=null==t.useBias||t.useBias,this.biasInitializer=XS(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Vk(t.biasConstraint),this.biasRegularizer=sI(t.biasRegularizer),this.activityRegularizer=sI(t.activityRegularizer),this.dilationRate=pI(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new dk("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(this.dilationRate)));if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new dk("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new dk("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(this.dilationRate)))}static verifyArgs(e){if(gk("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Ak(e.kernelSize,"number",1,3))throw new dk("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:JC(this.activation),useBias:this.useBias,biasInitializer:KS(this.biasInitializer),biasRegularizer:oI(this.biasRegularizer),activityRegularizer:oI(this.activityRegularizer),biasConstraint:Wk(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class kI extends xI{constructor(e,t){super(e,t),this.kernel=null,kI.verifyArgs(t),this.filters=t.filters,Rk(this.filters,"filters"),this.kernelInitializer=XS(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Vk(t.kernelConstraint),this.kernelRegularizer=sI(t.kernelRegularizer)}build(e){e=n_(e);const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new dk("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));const n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return Qf((()=>{let t;e=t_(e);const n=null==this.bias?null:this.bias.read(),r=Mk(this.activation.getClassName());if(null!=r&&2===this.rank)t=vI(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)t=bI(e,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)t=vI(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new pk("convolutions greater than 3D are not implemented yet.");t=wI(e,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(t=this.activation.apply(t))}return t}))}computeOutputShape(e){e=n_(e);const t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<n.length;++o){const e=fI(n[o],this.kernelSize[o],this.padding,this.strides[o],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[o]);t.push(e)}let r=[e[0]];return"channelsLast"===this.dataFormat?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:KS(this.kernelInitializer),kernelRegularizer:oI(this.kernelRegularizer),kernelConstraint:Wk(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new dk("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}class SI extends kI{constructor(e){super(2,e),SI.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!Ak(e.kernelSize,"number",1,2))throw new dk("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}SI.className="Conv2D",Gf(SI);class _I extends kI{constructor(e){super(3,e),_I.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new dk("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}_I.className="Conv3D",Gf(_I);class CI extends SI{constructor(e){if(super(e),this.inputSpec=[new c_({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new dk("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(this.padding))}build(e){if(4!==(e=n_(e)).length)throw new dk("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new dk("The channel dimension of the inputs should be defined. Found `None`.");const n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new c_({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return Qf((()=>{let t=t_(e);if(4!==t.shape.length)throw new dk("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));const n=t.shape,r=n[0];let o,a;"channelsFirst"===this.dataFormat?(o=2,a=3):(o=1,a=2);const s=n[o],i=n[a],c=this.kernelSize[0],l=this.kernelSize[1],u=this.strides[0],h=this.strides[1],d=[r,mI(s,u,c,this.padding),mI(i,h,l,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(t=dy(t,[0,2,3,1]));let p=jm(t,this.kernel.read(),d,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(p=dy(p,[0,3,1,2])),null!=this.bias&&(p=_S(p,this.bias.read(),this.dataFormat)),null!=this.activation&&(p=this.activation.apply(p)),p}))}computeOutputShape(e){const t=(e=n_(e)).slice();let n,r,o;"channelsFirst"===this.dataFormat?(n=1,r=2,o=3):(n=3,r=1,o=2);const a=this.kernelSize[0],s=this.kernelSize[1],i=this.strides[0],c=this.strides[1];return t[n]=this.filters,t[r]=mI(t[r],i,a,this.padding),t[o]=mI(t[o],c,s,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}CI.className="Conv2DTranspose",Gf(CI);class II extends kI{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==t.filters)throw new dk("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new dk("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new dk("SeparableConv".concat(this.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(t.padding)));this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=XS(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=sI(t.depthwiseRegularizer),this.depthwiseConstraint=Vk(t.depthwiseConstraint),this.pointwiseInitializer=XS(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=sI(t.pointwiseRegularizer),this.pointwiseConstraint=Vk(t.pointwiseConstraint)}build(e){if((e=n_(e)).length<this.rank+2)throw new dk("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));const t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new dk("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));const n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),o=[];for(let s=0;s<this.rank;++s)o.push(1);o.push(n*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new c_({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return Qf((()=>{let t;if(e=t_(e),1===this.rank)throw new pk("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(e=dy(e,[0,2,3,1])),t=Xg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(t=_S(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),"channelsFirst"===this.dataFormat&&(t=dy(t,[0,3,1,2])),t}))}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=KS(this.depthwiseInitializer),e.pointwiseInitializer=KS(this.pointwiseInitializer),e.depthwiseRegularizer=oI(this.depthwiseRegularizer),e.pointwiseRegularizer=oI(this.pointwiseRegularizer),e.depthwiseConstraint=Wk(this.depthwiseConstraint),e.pointwiseConstraint=Wk(this.pointwiseConstraint),e}}II.className="SeparableConv";class TI extends II{constructor(e){super(2,e)}}TI.className="SeparableConv2D",Gf(TI);class NI extends kI{constructor(e){super(1,e),NI.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if("number"!==typeof e.kernelSize&&!Ak(e.kernelSize,"number",1,1))throw new dk("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}NI.className="Conv1D",Gf(NI);class EI extends p_{constructor(e){super(e),"number"===typeof e.cropping?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Qf((()=>{if(e=t_(e),"channelsLast"===this.dataFormat){const t=mS(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return mS(t,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const t=mS(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return mS(t,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}EI.className="Cropping2D",Gf(EI);class AI extends p_{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==e.size?this.DEFAULT_SIZE:e.size,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Yk(this.dataFormat),this.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){Ek(Gk,"InterpolationFormat",e)}(this.interpolation)}computeOutputShape(e){if("channelsFirst"===this.dataFormat){const t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}{const t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return Qf((()=>{let t=t_(e);const n=t.shape;if("channelsFirst"===this.dataFormat){t=dy(t,[0,2,3,1]);const e=this.size[0]*n[2],r=this.size[1]*n[3],o="nearest"===this.interpolation?t.resizeNearestNeighbor([e,r]):t.resizeBilinear([e,r]);return dy(o,[0,3,1,2])}{const e=this.size[0]*n[1],r=this.size[1]*n[2];return"nearest"===this.interpolation?t.resizeNearestNeighbor([e,r]):t.resizeBilinear([e,r])}}))}getConfig(){const e={size:this.size,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}AI.className="UpSampling2D",Gf(AI);class RI extends xI{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=XS(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Vk(e.depthwiseConstraint),this.depthwiseRegularizer=sI(e.depthwiseRegularizer)}build(e){if((e=n_(e)).length<4)throw new dk("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));const t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new dk("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));const n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Qf((()=>{let t=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return Qf((()=>{null==o&&(o="channelsLast"),Yk(o);let s=gI(e,o);if(4!==e.rank)throw new dk("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new dk("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return s=Um(s,t,n,"same"===r?"same":"valid","NHWC",a),"channelsFirst"===o&&(s=dy(s,[0,3,1,2])),s}))}(e=t_(e),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(t=_S(t,this.bias.read(),this.dataFormat)),null!=this.activation&&(t=this.activation.apply(t)),t}))}computeOutputShape(e){e=n_(e);const t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=fI(t,this.kernelSize[0],this.padding,this.strides[0]),a=fI(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,o,a]:[e[0],o,a,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=KS(this.depthwiseInitializer),e.depthwiseRegularizer=oI(this.depthwiseRegularizer),e.depthwiseConstraint=Wk(this.depthwiseRegularizer),e}}function OI(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new dk("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function o(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=o(t),constants:n=o(n)}}function MI(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Qf((()=>{const c=t.shape.length;if(c<3)throw new dk("Input should be at least 3D, but is ".concat(c,"D."));const l=[1,0].concat(uS(2,c));if(t=dy(t,l),null!=a)throw new pk("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=o&&(o=o.asType("bool").asType("float32"),o.rank===c-1&&(o=Zm(o,-1)),o=dy(o,l)),r&&(t=Hg(t,0),null!=o&&(o=Hg(o,0)));const u=[];let h,d=n;const p=t.shape[0],f=cy(t);let m,g;null!=o&&(m=cy(o));for(let t=0;t<p;++t){const n=f[t],r=Qf((()=>e(n,d)));if(null==o)h=r[0],d=r[1];else{const e=Qf((()=>{const e=m[t],n=Lg(e).sub(e),o=r[0].mul(e).add(d[0].mul(n)),a=d.map(((t,o)=>r[1][o].mul(e).add(t.mul(n))));return{output:o,newStates:a}}));h=e.output,d=e.newStates}i&&u.push(h)}if(i){g=oy(u,1)}return[h,g,d]}))}RI.className="DepthwiseConv2D",Gf(RI);class PI extends p_{constructor(e){let t;if(super(e),null==e.cell)throw new dk("cell property is missing for the constructor of RNN.");if(t=Array.isArray(e.cell)?new jI({cells:e.cell}):e.cell,null==t.stateSize)throw new dk("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=null!=e.returnSequences&&e.returnSequences,this.returnState=null!=e.returnState&&e.returnState,this.goBackwards=null!=e.goBackwards&&e.goBackwards,this._stateful=null!=e.stateful&&e.stateful,this.unroll=null!=e.unroll&&e.unroll,this.supportsMasking=!0,this.inputSpec=[new c_({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){return uS(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((e=>null))}return this.states_}setStates(e){this.states_=e}computeOutputShape(e){$S(e)&&(e=e[0]);let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const n=t[0];let r;if(r=this.returnSequences?[e[0],e[1],n]:[e[0],n],this.returnState){const n=[];for(const r of t)n.push([e[0],r]);return[r].concat(n)}return r}computeMask(e,t){return Qf((()=>{Array.isArray(t)&&(t=t[0]);const e=this.returnSequences?t:null;if(this.returnState){const t=this.states.map((e=>null));return[e].concat(t)}return e}))}get states(){if(null==this.states_){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let n=0;n<e;++n)t.push(null);return t}return this.states_}set states(e){this.states_=e}build(e){if(null!=this.numConstants)throw new pk("Constants support is not implemented in RNN yet.");$S(e)&&(e=e[0]);const t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new c_({shape:[t,null,...n]});const r=[e[0]].concat(e.slice(2));let o;if(this.cell.build(r),o=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!nl(this.stateSpec.map((e=>e.shape[e.shape.length-1])),o))throw new dk("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map((e=>new c_({shape:[null,e]})));this.stateful&&this.resetStates()}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Qf((()=>{if(!this.stateful)throw new uk("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new dk("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>Dg([n,e]))):this.states_=[Dg([n,this.cell.stateSize])];else if(null==e)Yf(this.states_),null!=this.keptStates&&(Yf(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((e=>Dg([n,e]))):this.states_[0]=Dg([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new dk("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===t?this.keptStates.push(this.states_.slice()):Yf(this.states_);for(let t=0;t<this.states_.length;++t){const r=e[t],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[t]:this.cell.stateSize,a=[n,o];if(!nl(r.shape,a))throw new dk("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(a,", received shape=").concat(r.shape));this.states_[t]=r}}this.states_=this.states_.map((e=>Jf(e.clone())))}))}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const o=OI(e,n,r,this.numConstants);e=o.inputs,n=o.initialState,r=o.constants;let a=[],s=[];if(null!=n){t.initialState=n,a=a.concat(n),this.stateSpec=[];for(const e of n)this.stateSpec.push(new c_({shape:e.shape}));s=s.concat(this.stateSpec)}null!=r&&(t.constants=r,a=a.concat(r),this.numConstants=r.length);if(a[0]instanceof l_){const n=[e].concat(a),r=this.inputSpec.concat(s),o=this.inputSpec;this.inputSpec=r;const i=super.apply(n,t);return this.inputSpec=o,i}return super.apply(e,t)}call(e,t){return Qf((()=>{const n=null==t?null:t.mask,r=null==t?null:t.training;let o=null==t?null:t.initialState;e=t_(e),null==o&&(o=this.stateful?this.states_:this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==a)throw new dk("RNN Layer has ".concat(a," state(s) but was passed ")+"".concat(o.length," initial state(s)."));this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const s={training:r},i=MI(((e,t)=>{const n=this.cell.call([e].concat(t),s);return[n[0],n.slice(1)]}),e,o,this.goBackwards,n,null,this.unroll,this.returnSequences),c=i[0],l=i[1],u=i[2];this.stateful&&this.resetStates(u,r);const h=this.returnSequences?l:c;return this.returnState?[h].concat(u):h}))}getInitialState(e){return Qf((()=>{let t=Dg(e.shape);return t=hg(t,[1,2]),t=dS(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((e=>e>1?bS(t,[1,e]):t)):this.cell.stateSize>1?[bS(t,[1,this.cell.stateSize])]:[t]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===PI.className&&(t.cell={className:this.cell.getClassName(),config:n}),Object.assign({},n,e,t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=T_(t.cell,n);return new e(Object.assign(t,{cell:r}))}}PI.className="RNN",Gf(PI);class DI extends p_{}class FI extends DI{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Rk(this.units,"units"),this.activation=$C(null==e.activation?this.DEFAULT_ACTIVATION:e.activation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=XS(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=XS(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=XS(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=sI(e.kernelRegularizer),this.recurrentRegularizer=sI(e.recurrentRegularizer),this.biasRegularizer=sI(e.biasRegularizer),this.kernelConstraint=Vk(e.kernelConstraint),this.recurrentConstraint=Vk(e.recurrentConstraint),this.biasConstraint=Vk(e.biasConstraint),this.dropout=cS([1,lS([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=cS([1,lS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=n_(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Qf((()=>{if(2!==e.length)throw new dk("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));let n=e[1];e=e[0];const r=null!=t.training&&t.training;let o;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=VI({ones:()=>Lg(e),rate:this.dropout,training:r})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=VI({ones:()=>Lg(n),rate:this.recurrentDropout,training:r}));const a=this.dropoutMask,s=this.recurrentDropoutMask;o=wS(null!=a?Cm(e,a):e,this.kernel.read()),null!=this.bias&&(o=_S(o,this.bias.read())),null!=s&&(n=Cm(n,s));let i=rm(o,wS(n,this.recurrentKernel.read()));return null!=this.activation&&(i=this.activation.apply(i)),[i,i]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:JC(this.activation),useBias:this.useBias,kernelInitializer:KS(this.kernelInitializer),recurrentInitializer:KS(this.recurrentInitializer),biasInitializer:KS(this.biasInitializer),kernelRegularizer:oI(this.kernelRegularizer),recurrentRegularizer:oI(this.recurrentRegularizer),biasRegularizer:oI(this.biasRegularizer),activityRegularizer:oI(this.activityRegularizer),kernelConstraint:Wk(this.kernelConstraint),recurrentConstraint:Wk(this.recurrentConstraint),biasConstraint:Wk(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}FI.className="SimpleRNNCell",Gf(FI);class LI extends PI{constructor(e){e.cell=new FI(e),super(e)}call(e,t){return Qf((()=>{null!=this.cell.dropoutMask&&(Yf(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Yf(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:o})}))}static fromConfig(e,t){return new e(t)}}LI.className="SimpleRNN",Gf(LI);class zI extends DI{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new dk("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Rk(this.units,"units"),this.activation=$C(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=$C(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=XS(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=XS(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=XS(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=sI(e.kernelRegularizer),this.recurrentRegularizer=sI(e.recurrentRegularizer),this.biasRegularizer=sI(e.biasRegularizer),this.kernelConstraint=Vk(e.kernelConstraint),this.recurrentConstraint=Vk(e.recurrentConstraint),this.biasConstraint=Vk(e.biasConstraint),this.dropout=cS([1,lS([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=cS([1,lS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){const t=(e=n_(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Qf((()=>{if(2!==e.length)throw new dk("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=null!=t.training&&t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=VI({ones:()=>Lg(e),rate:this.dropout,training:n,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=VI({ones:()=>Lg(r),rate:this.recurrentDropout,training:n,count:3}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let s,i,c;0<this.dropout&&this.dropout<1&&(e=Cm(e,o[0]));let l=wS(e,this.kernel.read());this.useBias&&(l=_S(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Cm(r,a[0]));const u=this.recurrentKernel.read(),[h,d]=ty(u,[2*this.units,this.units],u.rank-1),p=wS(r,h),[f,m,g]=ty(l,3,l.rank-1),[y,b]=ty(p,2,p.rank-1);s=this.recurrentActivation.apply(rm(f,y)),i=this.recurrentActivation.apply(rm(m,b));const v=wS(Cm(i,r),d);c=this.activation.apply(rm(g,v));const w=rm(Cm(s,r),Cm(rm(1,Og(s)),c));return[w,w]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:JC(this.activation),recurrentActivation:JC(this.recurrentActivation),useBias:this.useBias,kernelInitializer:KS(this.kernelInitializer),recurrentInitializer:KS(this.recurrentInitializer),biasInitializer:KS(this.biasInitializer),kernelRegularizer:oI(this.kernelRegularizer),recurrentRegularizer:oI(this.recurrentRegularizer),biasRegularizer:oI(this.biasRegularizer),activityRegularizer:oI(this.activityRegularizer),kernelConstraint:Wk(this.kernelConstraint),recurrentConstraint:Wk(this.recurrentConstraint),biasConstraint:Wk(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}zI.className="GRUCell",Gf(zI);class BI extends PI{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new zI(e),super(e)}call(e,t){return Qf((()=>{null!=this.cell.dropoutMask&&(Yf(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Yf(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:o})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}BI.className="GRU",Gf(BI);class qI extends DI{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Rk(this.units,"units"),this.activation=$C(void 0===e.activation?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=$C(void 0===e.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=null==e.useBias||e.useBias,this.kernelInitializer=XS(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=XS(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=XS(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=sI(e.kernelRegularizer),this.recurrentRegularizer=sI(e.recurrentRegularizer),this.biasRegularizer=sI(e.biasRegularizer),this.kernelConstraint=Vk(e.kernelConstraint),this.recurrentConstraint=Vk(e.recurrentConstraint),this.biasConstraint=Vk(e.biasConstraint),this.dropout=cS([1,lS([0,null==e.dropout?0:e.dropout])]),this.recurrentDropout=cS([1,lS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;const n=(e=n_(e))[e.length-1];let r;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const e=this.biasInitializer,n=this.units;r=new((t=class extends ES{apply(t,r){const o=e.apply([n]),a=(new RS).apply([n]),s=e.apply([2*n]);return yS(yS(o,a),s)}}).className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Qf((()=>{const n=null!=t.training&&t.training;if(3!==e.length)throw new dk("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=VI({ones:()=>Lg(e),rate:this.dropout,training:n,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=VI({ones:()=>Lg(r),rate:this.recurrentDropout,training:n,count:4}));const a=this.dropoutMask,s=this.recurrentDropoutMask;let i,c,l,u;0<this.dropout&&this.dropout<1&&(e=Cm(e,a[0]));let h=wS(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Cm(r,s[0])),h=rm(h,wS(r,this.recurrentKernel.read())),this.useBias&&(h=_S(h,this.bias.read()));const[d,p,f,m]=ty(h,4,h.rank-1);i=this.recurrentActivation.apply(d),c=this.recurrentActivation.apply(p),l=rm(Cm(c,o),Cm(i,this.activation.apply(f))),u=this.recurrentActivation.apply(m);const g=Cm(u,this.activation.apply(l));return[g,g,l]}))}getConfig(){const e=super.getConfig(),t={units:this.units,activation:JC(this.activation),recurrentActivation:JC(this.recurrentActivation),useBias:this.useBias,kernelInitializer:KS(this.kernelInitializer),recurrentInitializer:KS(this.recurrentInitializer),biasInitializer:KS(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:oI(this.kernelRegularizer),recurrentRegularizer:oI(this.recurrentRegularizer),biasRegularizer:oI(this.biasRegularizer),activityRegularizer:oI(this.activityRegularizer),kernelConstraint:Wk(this.kernelConstraint),recurrentConstraint:Wk(this.recurrentConstraint),biasConstraint:Wk(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}qI.className="LSTMCell",Gf(qI);class WI extends PI{constructor(e){0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qI(e),super(e)}call(e,t){return Qf((()=>{null!=this.cell.dropoutMask&&(Yf(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Yf(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==t?null:t.mask,r=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:o})}))}static fromConfig(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}WI.className="LSTM",Gf(WI);class jI extends DI{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Qf((()=>{let n=e.slice(1);const r=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?r.push(n.splice(0,e.stateSize.length)):r.push(n.splice(0,1));r.reverse();const o=[];let a;for(let s=0;s<this.cells.length;++s){const i=this.cells[s];n=r[s],a=0===s?[e[0]].concat(n):[a[0]].concat(n),a=i.call(a,t),o.push(a.slice(1))}n=[];for(const e of o.slice().reverse())n.push(...e);return[a[0]].concat(n)}))}build(e){let t;$S(e)&&(e=e[0]),this.cells.forEach(((n,r)=>{eS("RNNCell_".concat(r),(()=>{n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}getConfig(){const e=super.getConfig(),t={cells:this.cells.map((e=>({className:e.getClassName(),config:e.getConfig()})))};return Object.assign({},e,t)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[];for(const o of t.cells)r.push(T_(o,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return s_(e)}setWeights(e){const t=[];for(const n of this.cells){const r=n.weights.length,o=e.splice(r);for(let e=0;e<n.weights.length;++e)t.push([n.weights[e],o[e]])}i_(t)}}function VI(e){const{ones:t,rate:n,training:r=!1,count:o=1}=e,a=()=>CS(t(),n),s=()=>IS(a,t,r);if(!o||o<=1)return Jf(s().clone());return Array(o).fill(void 0).map(s).map((e=>Jf(e.clone())))}jI.className="StackedRNNCells",Gf(jI);var UI=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};class GI extends PI{constructor(e){if(e.unroll)throw new pk("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new pk("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new c_({ndim:5})]}call(e,t){return Qf((()=>{if(null!=this.cell.dropoutMask&&(Yf(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(Yf(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new dk("ConvRNN2D cell does not support constants");const n=null==t?null:t.mask,r=null==t?null:t.training,o=null==t?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:o})}))}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Qf((()=>{const{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),o=Dg([r[0],...r.slice(2)]);return Array.isArray(t)?Array(t.length).fill(o):[o]}))}resetStates(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Qf((()=>{if(!this.stateful)throw new uk("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),o=[r[0],...r.slice(2)];if(null==n[0])throw new dk("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Dg(o))):this.states_=[Dg(o)];else if(null==e)Yf(this.states_),null!=this.keptStates&&(Yf(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Dg(o))):this.states_[0]=Dg(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new dk("Layer ".concat(this.name," expects ").concat(this.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));t?this.keptStates.push(this.states_.slice()):Yf(this.states_);for(let t=0;t<this.states_.length;++t){const n=e[t],r=o;if(!nl(n.shape,r))throw new dk("State ".concat(t," is incompatible with layer ").concat(this.name,": ")+"expected shape=".concat(r,", received shape=").concat(n.shape));this.states_[t]=n}}this.states_=this.states_.map((e=>Jf(e.clone())))}))}computeSingleOutputShape(e){const{dataFormat:t,filters:n,kernelSize:r,padding:o,strides:a,dilationRate:s}=this.cell,i="channelsFirst"===t,c=e[i?3:2],l=e[i?4:3],u=fI(c,r[0],o,a[0],s[0]),h=fI(l,r[1],o,a[1],s[1]);return[...e.slice(0,2),...i?[n,u,h]:[u,h,n]]}}GI.className="ConvRNN2D";class HI extends qI{constructor(e){const{filters:t,kernelSize:n,strides:r,padding:o,dataFormat:a,dilationRate:s}=e;super(Object.assign({},e,{units:t})),this.filters=t,Rk(this.filters,"filters"),this.kernelSize=pI(n,2,"kernelSize"),this.kernelSize.forEach((e=>Rk(e,"kernelSize"))),this.strides=pI(r||1,2,"strides"),this.strides.forEach((e=>Rk(e,"strides"))),this.padding=o||"valid",Jk(this.padding),this.dataFormat=a||"channelsLast",Yk(this.dataFormat),this.dilationRate=pI(s||1,2,"dilationRate"),this.dilationRate.forEach((e=>Rk(e,"dilationRate")))}build(e){var t;e=n_(e);const n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new dk("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));const r=e[n],o=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let e;if(this.unitForgetBias){const n=this.biasInitializer,r=this.filters;e=new((t=class extends ES{apply(e,t){return gS([n.apply([r]),Fg([r]),n.apply([2*r])])}}).className="CustomInit",t)}else e=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,e,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Qf((()=>{if(3!==e.length)throw new dk("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));const n=t.training||!1,r=e[0],o=e[1],a=e[2];0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=VI({ones:()=>Lg(r),rate:this.dropout,training:n,count:4}));const s=this.dropoutMask,i=(e,t,n)=>t&&t[n]?Cm(t[n],e):e;let c=i(r,s,0),l=i(r,s,1),u=i(r,s,2),h=i(r,s,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=VI({ones:()=>Lg(o),rate:this.recurrentDropout,training:n,count:4}));const d=this.recurrentDropoutMask;let p=i(o,d,0),f=i(o,d,1),m=i(o,d,2),g=i(o,d,3);const[y,b,v,w]=ty(this.kernel.read(),4,3),[x,k,S,_]=this.useBias?ty(this.bias.read(),4):[null,null,null,null];c=this.inputConv(c,y,x,this.padding),l=this.inputConv(l,b,k,this.padding),u=this.inputConv(u,v,S,this.padding),h=this.inputConv(h,w,_,this.padding);const[C,I,T,N]=ty(this.recurrentKernel.read(),4,3);p=this.recurrentConv(p,C),f=this.recurrentConv(f,I),m=this.recurrentConv(m,T),g=this.recurrentConv(g,N);const E=this.recurrentActivation.apply(rm(c,p)),A=this.recurrentActivation.apply(rm(l,f)),R=rm(Cm(A,a),Cm(E,this.activation.apply(rm(u,m)))),O=Cm(this.recurrentActivation.apply(rm(h,g)),this.activation.apply(R));return[O,O,R]}))}getConfig(){const e=super.getConfig(),{units:t}=e,n=UI(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,r)}inputConv(e,t,n,r){const o=Bm(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?_S(o,n,this.dataFormat):o}recurrentConv(e,t){return Bm(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}HI.className="ConvLSTM2DCell",Gf(HI);class KI extends GI{constructor(e){const t=new HI(e);super(Object.assign({},e,{cell:t}))}static fromConfig(e,t){return new e(t)}}KI.className="ConvLSTM2D",Gf(KI);class XI extends p_{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(null==this.noiseShape)return this.noiseShape;const t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e);if(0<this.rate&&this.rate<1){const e=null!=t.training&&t.training,r=this.getNoiseShape(n);return IS((()=>CS(n,this.rate,r,this.seed)),(()=>n),e)}return e}))}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}XI.className="Dropout",Gf(XI);class QI extends XI{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}QI.className="SpatialDropout1D",Gf(QI);class YI extends p_{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){let t=null;null!=e.batchSize&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Rk(this.units,"units"),this.activation=$C(e.activation),null!=e.useBias&&(this.useBias=e.useBias),this.kernelInitializer=XS(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=XS(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Vk(e.kernelConstraint),this.biasConstraint=Vk(e.biasConstraint),this.kernelRegularizer=sI(e.kernelRegularizer),this.biasRegularizer=sI(e.biasRegularizer),this.activityRegularizer=sI(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){const t=(e=n_(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){const t=(e=n_(e)).slice();return t[t.length-1]=this.units,t}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e),r=Mk(this.activation.getClassName());let o;return null!=r?o=wS(n,this.kernel.read(),r,this.bias?this.bias.read():null):(o=wS(n,this.kernel.read()),null!=this.bias&&(o=_S(o,this.bias.read())),null!=this.activation&&(o=this.activation.apply(o))),o}))}getConfig(){const e={units:this.units,activation:JC(this.activation),useBias:this.useBias,kernelInitializer:KS(this.kernelInitializer),biasInitializer:KS(this.biasInitializer),kernelRegularizer:oI(this.kernelRegularizer),biasRegularizer:oI(this.biasRegularizer),activityRegularizer:oI(this.activityRegularizer),kernelConstraint:Wk(this.kernelConstraint),biasConstraint:Wk(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}YI.className="Dense",Gf(YI);class JI extends p_{constructor(e){super(e=e||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=n_(e);for(const t of e.slice(1))if(null==t)throw new dk('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.');return[e[0],sS(e,1)]}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);let n=t_(e);if("channelsFirst"===this.dataFormat&&n.rank>1){const e=[0];for(let t=2;t<n.rank;++t)e.push(t);e.push(1),n=n.transpose(e)}return function(e){if(e.rank<=1)throw new dk("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));const t=[e.shape[0],sS(e.shape,1)];return e.reshape(t)}(n)}))}getConfig(){const e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}JI.className="Flatten",Gf(JI);class ZI extends p_{constructor(e){super(e),this.supportsMasking=!0,this.activation=$C(e.activation)}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e);return this.activation.apply(n)}))}getConfig(){const e={activation:JC(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}ZI.className="Activation",Gf(ZI);class $I extends p_{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Qf((()=>function(e,t){return Qf((()=>{if(2!==e.shape.length)throw new dk("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return bS(dS(e,1),[1,t,1])}))}(e=t_(e),this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}$I.className="RepeatVector",Gf($I);class eT extends p_{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||null==e}fixUnknownDimension(e,t){const n="Total size of new array must be unchanged.",r=t.slice();let o=1,a=null;for(let i=0;i<r.length;++i){const e=r[i];if(this.isUnknown(e)){if(null!==a)throw new dk("Can only specifiy one unknown dimension.");a=i}else o*=e}const s=sS(e);if(null!==a){if(0===o||s%o!==0)throw new dk(n);r[a]=s/o}else if(s!==o)throw new dk(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e),r=n.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return n.reshape(o)}))}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}eT.className="Reshape",Gf(eT);class tT extends p_{constructor(e){if(super(e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));const t=uS(1,e.dims.length+1);if(!nl(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new c_({ndim:this.dims.length+1})]}computeOutputShape(e){const t=(e=n_(e)).slice();return this.dims.forEach(((n,r)=>{t[r+1]=e[n]})),t}call(e,t){return dy(t_(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}tT.className="Permute",Gf(tT);class nT extends p_{constructor(e){super(null==e?{}:e),this.supportsMasking=!0,this.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const n=t_(e);return am(Mg(n,this.maskValue),-1)}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e),r=am(Mg(n,this.maskValue),-1,!0);return n.mul(r.asType(n.dtype))}))}}nT.className="Masking",Gf(nT);class rT extends p_{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){let t=null;null!=e.batchSize&&(t=e.batchSize),null==e.inputLength?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(vk(e.inputLength))}this.inputDim=e.inputDim,Rk(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Rk(this.outputDim,"outputDim"),this.embeddingsInitializer=XS(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=sI(e.embeddingsRegularizer),this.activityRegularizer=sI(e.activityRegularizer),this.embeddingsConstraint=Vk(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Qf((()=>this.maskZero?(e=t_(e),Mg(e,hy(e))):null))}computeOutputShape(e){if(e=n_(e),null==this.inputLength)return[...e,this.outputDim];const t=vk(this.inputLength);if(t.length!==e.length-1)throw new dk('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));{let n=0;for(let r=0;r<t.length;++r){const o=t[r],a=e[r+1];if(null!=o&&null!=a&&o!==a)throw new dk('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==o&&(t[n]=a),n++}}return[e[0],...t,this.outputDim]}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);let n=t_(e);"int32"!==n.dtype&&(n=hS(n,"int32"));return xS(this.embeddings.read(),n.as1D()).reshape(n_(this.computeOutputShape(n.shape)))}))}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:KS(this.embeddingsInitializer),embeddingsRegularizer:oI(this.embeddingsRegularizer),activityRegularizer:oI(this.activityRegularizer),embeddingsConstraint:Wk(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}rT.className="Embedding",Gf(rT);class oT extends p_{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new pk}computeElementwiseOpOutputShape(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;const n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],a=t[r];if(null==o||null==a||o<0||a<0)n.push(null);else if(1===o)n.push(a);else if(1===a)n.push(o);else{if(o!==a)throw new dk("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(o)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[n_(e)]),e.length<2)throw new dk("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));let t=[];for(const o of e)null!=o&&null!==o[0]&&t.push(o[0]);if(t=Tk(t),t.length>1)throw new dk("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));let n=null==e[0]?null:e[0].slice(1);for(let o=1;o<e.length;++o){const t=null==e[o]?null:e[o].slice(1);n=this.computeElementwiseOpOutputShape(n,t)}const r=e.map((e=>e.length));-1===e.indexOf(null)&&1===Tk(r).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return Qf((()=>{if(this.reshapeRequired){const t=[],n=e.map((e=>e.rank));if(-1===n.indexOf(null)){const r=lS(n);for(let n of e){const e=n.rank;for(let t=0;t<r-e;++t)n=dS(n,1);t.push(n)}return this.mergeFunction(t)}{let n=!1;for(const a of e){const e=a.rank;if(null==e){const e=a.shape,r=e[0],o=e.slice(1).concat([r]);let s=a.reshape([r].concat(sS(e.slice(1))));s=dy(s,[1,0]),s=s.reshape(o),t.push(s),n=!0}else if(e>1){const r=uS(1,e).concat([0]);t.push(dy(a,r)),n=!0}else t.push(a)}let r=this.mergeFunction(t);const o=r.rank;if(n)if(null==o){const e=r.shape,t=e[e.length-1],n=[t].concat(e.slice(0,e.length-1));r=dy(r.reshape([-1,t]),[1,0]).reshape(n)}else if(o>1){const e=[o-1].concat(uS(0,o-1));r=dy(r,e)}return r}}return this.mergeFunction(e)}))}computeOutputShape(e){let t;t=null==e[0]?null:e[0].slice(1);for(let r=1;r<e.length;++r){const n=null==e[r]?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,n)}let n=[];for(const r of e)null!=r&&null!==r[0]&&n.push(r[0]);return n=Tk(n),t=1===n.length?n.concat(t):[null].concat(t),t}computeMask(e,t){return Qf((()=>{if(null==t)return null;if(!Array.isArray(t))throw new dk("`mask` should be an Array");if(!Array.isArray(e))throw new dk("`inputs` should be an Array");if(t.length!==e.length)throw new dk("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((e=>null==e)))return null;let n=(t=t.map((e=>null==e?e:Zm(e,0))))[0];for(let e=1;e<t.length-1;++e)n=pg(n,t[e]);return n}))}}class aT extends oT{constructor(e){super(e)}mergeFunction(e){return Qf((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=rm(t,e[n]);return t}))}}aT.className="Add",Gf(aT);class sT extends oT{constructor(e){super(e)}mergeFunction(e){return Qf((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Cm(t,e[n]);return t}))}}sT.className="Multiply",Gf(sT);class iT extends oT{constructor(e){super(e)}mergeFunction(e){return Qf((()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=rm(t,e[n]);return Cm(1/e.length,t)}))}}iT.className="Average",Gf(iT);class cT extends oT{constructor(e){super(e)}mergeFunction(e){return Qf((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=gg(t,e[n]);return t}))}}cT.className="Maximum",Gf(cT);class lT extends oT{constructor(e){super(e)}mergeFunction(e){return Qf((()=>{let t=e[0];for(let n=1;n<e.length;++n)t=vg(t,e[n]);return t}))}}lT.className="Minimum",Gf(lT);class uT extends oT{constructor(e){super(e),this.DEFAULT_AXIS=-1,null==e&&(e={}),this.axis=null==e.axis?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new dk("A `Concatenate` layer should be called on a list of at least 2 inputs");let t=!0;for(const r of e)if(null!=r){t=!1;break}if(t)return;const n=[];for(let r=0;r<e.length;++r){const t=e[r].slice();t.splice(this.axis,1);let o=!1;for(const e of n)if(nl(e,t)){o=!0;break}o||n.push(t)}if(n.length>1)throw new dk("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Qf((()=>gS(e,this.axis)))}computeOutputShape(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new dk("A `Concatenate` layer should be called on a list of inputs.");const t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const o of t.slice(1)){if(null==n[r]||null==o[r]){n[r]=null;break}n[r]+=o[r]}return n}computeMask(e,t){if(null==t)return null;if(!Array.isArray(t))throw new dk("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new dk("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new dk("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return Qf((()=>{let n=!0;if(t.forEach((e=>{null==e||(n=!1)})),n)return null;const r=[];for(let a=0;a<e.length;++a)null==t[a]?r.push(Lg(e[a]).asType("bool")):t[a].rank<e[a].rank?r.push(Zm(t[a],-1)):r.push(t[a]);const o=Sm(r,this.axis);return om(o,-1,!1)}))}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}function hT(e,t){for(;e<0;)e+=t;return e}uT.className="Concatenate",Gf(uT);class dT extends oT{constructor(e){super(e),this.axes=e.axes,this.normalize=null!=e.normalize&&e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){Jc(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0],n=e[1];if(t.length>3||n.length>3)throw new pk("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new dk("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}mergeFunction(e){if(2!==e.length)throw new dk("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));let t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map(((t,n)=>hT(t,e[n].shape.length))):[hT(this.axes,n.shape.length),hT(this.axes,r.shape.length)],this.normalize&&(n=N_(n,t[0]),r=N_(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new pk("batchDot is not implemented for tensors of 4D or higher rank yet");if(Jc(e.shape.length>=2,(()=>"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length))),Jc(e.shape.length>=2,(()=>"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length))),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new pk("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,o=t.shape.length;null==n&&(n=[r-1,o-2]);const a=n;return Qf((()=>{let n,s;if(r>o){n=r-o;const e=[];for(let t=0;t<n;++t)e.push(1);t=t.reshape(t.shape.concat(e))}else if(o>r){n=o-r;const t=[];for(let e=0;e<n;++e)t.push(1);e=e.reshape(e.shape.concat(t))}else n=0;if(2===e.shape.length&&2===t.shape.length)s=a[0]===a[1]?e.mul(t).sum(a[0]):e.transpose([1,0]).mul(t).sum(a[1]);else{const n=a[0]!==e.shape.length-1,r=a[1]===t.shape.length-1;s=e.matMul(t,n,r)}if(n>0){let e;e=r>o?r+o-3:r-1;const t=[];for(let r=e;r<e+n;++r)t.push(r);s=s.squeeze(t)}return 1===s.shape.length&&(s=s.expandDims(1)),s}))}(n,r,t)}interpretAxes(e,t){let n;return n=Array.isArray(this.axes)?this.axes:[hT(this.axes,e.length),hT(this.axes,t.length)],n}computeOutputShape(e){Jc(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new pk("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const o=t.concat(n);return 1===o.length&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}dT.className="Dot",Gf(dT);class pT extends p_{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e);return IS((()=>vS(n.shape,0,this.stddev).add(n)),(()=>n),t.training||!1)}))}}pT.className="GaussianNoise",Gf(pT);class fT extends p_{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Qf((()=>{this.invokeCallHook(e,t);const n=t_(e);if(this.rate>0&&this.rate<1){return IS((()=>{const e=Math.sqrt(this.rate/(1-this.rate));return n.mul(vS(n.shape,1,e))}),(()=>n),t.training||!1)}return n}))}}fT.className="GaussianDropout",Gf(fT);class mT extends p_{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||t_(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Qf((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e),r=()=>{const t=t_(e),r=-1.7580993408473766;let o=ag(Ug(n),this.rate);o=hS(o,"float32");const a=((1-this.rate)*(1+this.rate*r**2))**-.5,s=-a*r*this.rate;return t.mul(o).add(o.add(-1).mul(r)).mul(a).add(s)};return IS(r,(()=>t_(e)),t.training||!1)}return e}))}}function gT(e,t,n,r,o){let a,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)a=Rm(e,t,n,r,o,s);else if(3===e.rank)a=Om(e,t,n,r,o,s);else{if(4!==e.rank)throw new pk("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");a=Mm(e,t,n,r,o,s)}return a}function yT(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return nl(r.slice().sort(),uS(0,e.rank-1))?function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Qf((()=>{const a=Eg(e,r),s=a.mean,i=a.variance;return[gT(e,s,i,n,t,o),s,i]}))}(e,t,n,r,o):function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Qf((()=>{const a=Eg(e,r),s=a.mean,i=a.variance,c=[];for(const t of uS(0,e.rank))-1!==r.indexOf(t)?c.push(1):c.push(e.shape[t]);const l=s.reshape(c),u=i.reshape(c),h=null==t?null:t.reshape(c),d=null==n?null:n.reshape(c);return[gT(e,l,u,d,h,o),s,i]}))}(e,t,n,r,o)}mT.className="AlphaDropout",Gf(mT);class bT extends p_{constructor(e){null==e&&(e={}),super(e),this.supportsMasking=!0,this.axis=null==e.axis?-1:e.axis,this.momentum=null==e.momentum?.99:e.momentum,this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=XS(e.betaInitializer||"zeros"),this.gammaInitializer=XS(e.gammaInitializer||"ones"),this.movingMeanInitializer=XS(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=XS(e.movingVarianceInitializer||"ones"),this.betaConstraint=Vk(e.betaConstraint),this.gammaConstraint=Vk(e.gammaConstraint),this.betaRegularizer=sI(e.betaRegularizer),this.gammaRegularizer=sI(e.gammaRegularizer)}build(e){e=n_(e);const t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new dk("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new c_({ndim:e.length,axes:{[t]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Qf((()=>{const n=null!=t.training&&t.training,r=t_(e),o=r.shape,a=o.length,s=uS(0,a),i=this.axis>=0?this.axis:this.axis+a;s.splice(i,1);const c=mk(1,a);c[i]=o[i];const l=s.slice();l.sort();const u=!nl(l,uS(0,a).slice(0,a-1));if(!n)return(()=>{if(u){const e=this.movingMean.read().reshape(c),t=this.movingVariance.read().reshape(c),n=this.center?this.beta.read().reshape(c):null,o=this.scale?this.gamma.read().reshape(c):null;return gT(r,e,t,n,o,this.epsilon)}return gT(r,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[h,d,p]=yT(r,this.gamma.read(),this.beta.read(),s,this.epsilon),f=(e,t,n)=>{Qf((()=>{const r=1-n,o=e.read(),a=o.sub(t).mul(r);e.write(o.sub(a))}))};return(()=>{f(this.movingMean,d,this.momentum),f(this.movingVariance,p,this.momentum)})(),h}))}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:KS(this.betaInitializer),gammaInitializer:KS(this.gammaInitializer),movingMeanInitializer:KS(this.movingMeanInitializer),movingVarianceInitializer:KS(this.movingVarianceInitializer),betaRegularizer:oI(this.betaRegularizer),gammaRegularizer:oI(this.gammaRegularizer),betaConstraint:Wk(this.betaConstraint),gammaConstraint:Wk(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}bT.className="BatchNormalization",Gf(bT);class vT extends p_{constructor(e){if(null==e&&(e={}),super(e),this.axis=null==e.axis?-1:e.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received ".concat(this.axis))}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(this.axis)));for(const e of this.axis)if(!Number.isInteger(e))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(this.axis)))}this.epsilon=null==e.epsilon?.001:e.epsilon,this.center=null==e.center||e.center,this.scale=null==e.scale||e.scale,this.betaInitializer=XS(e.betaInitializer||"zeros"),this.gammaInitializer=XS(e.gammaInitializer||"ones"),this.betaRegularizer=sI(e.betaRegularizer),this.gammaRegularizer=sI(e.gammaRegularizer),this.supportsMasking=!0}build(e){const t=(e=n_(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error("Invalid axis: ".concat(o));if(this.axis.length!==Tk(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));const n=this.axis.map((t=>e[t])),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const n=t_(e),r=n.shape,o=r.length;return Qf((()=>{let{mean:e,variance:t}=Eg(n,this.axis,!0);const a=mk(1,o);for(const n of this.axis)a[n]=r[n];const s=e=>null!=e&&e.shape.length!==o&&this.axis!==[o-1]?e.reshape(a):e;let i=s(this.gamma.read()),c=s(this.beta.read());const l=[],u=[];for(let n=0;n<o;++n)-1!==this.axis.indexOf(n)?(l.push(r[n]),u.push(1)):(l.push(1),u.push(r[n]));return e=e.tile(l),t=t.tile(l),i=i.tile(u),c=c.tile(u),gT(n,e,t,c,i,this.epsilon)}))}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:KS(this.betaInitializer),gammaInitializer:KS(this.gammaInitializer),betaRegularizer:oI(this.betaRegularizer),gammaRegularizer:oI(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}vT.className="LayerNormalization",Gf(vT);class wT extends p_{constructor(e){if(null==e&&(e={}),super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new dk("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));let t,n;if("number"===typeof e.padding[0])t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new dk("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(t=e.padding[0],2!==e.padding[1].length)throw new dk("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new c_({ndim:4})]}computeOutputShape(e){let t,n;return e=n_(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}call(e,t){return Qf((()=>function(e,t,n){return Qf((()=>{if(4!==e.rank)throw new dk("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new dk("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new dk("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");let r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],zg(e,r)}))}(t_(e),this.padding,this.dataFormat)))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}function xT(e,t,n,r,o,a){return Qf((()=>{let s;Yk(o),Zk(a),Jk(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==o&&(o="channelsLast"),null==a&&(a="max"),e=gI(e,o);const i="same"===r?"same":"valid";return s="max"===a?fg(e,t,n,i):xm(e,t,n,i),"channelsFirst"===o&&(s=dy(s,[0,3,1,2])),s}))}function kT(e,t,n,r,o,a){return Qf((()=>{let s;Yk(o),Zk(a),Jk(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==o&&(o="channelsLast"),null==a&&(a="max"),e=yI(e,o);const i="same"===r?"same":"valid";return s="max"===a?mg(e,t,n,i):km(e,t,n,i),"channelsFirst"===o&&(s=dy(s,[0,4,1,2,3])),s}))}wT.className="ZeroPadding2D",Gf(wT);class ST extends p_{constructor(e){if(null==e.poolSize&&(e.poolSize=2),super(e),"number"===typeof e.poolSize)this.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new dk("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));this.poolSize=e.poolSize}if(Rk(this.poolSize,"poolSize"),null==e.strides)this.strides=this.poolSize;else if("number"===typeof e.strides)this.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new dk("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));this.strides=e.strides}Rk(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,Jk(this.padding),this.inputSpec=[new c_({ndim:3})]}computeOutputShape(e){const t=fI((e=n_(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Qf((()=>{this.invokeCallHook(e,t),e=dS(t_(e),2);const n=this.poolingFunction(t_(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ry(n,[2])}))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class _T extends ST{constructor(e){super(e)}poolingFunction(e,t,n,r,o){return Yk(o),Jk(r),xT(e,t,n,r,o,"max")}}_T.className="MaxPooling1D",Gf(_T);class CT extends ST{constructor(e){super(e)}poolingFunction(e,t,n,r,o){return Yk(o),Jk(r),xT(e,t,n,r,o,"avg")}}CT.className="AveragePooling1D",Gf(CT);class IT extends p_{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new dk("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides];Rk(this.poolSize,"poolSize"),Rk(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Yk(this.dataFormat),Jk(this.padding),this.inputSpec=[new c_({ndim:4})]}computeOutputShape(e){e=n_(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=fI(t,this.poolSize[0],this.padding,this.strides[0]),n=fI(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return Qf((()=>(this.invokeCallHook(e,t),this.poolingFunction(t_(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class TT extends IT{constructor(e){super(e)}poolingFunction(e,t,n,r,o){return Yk(o),Jk(r),xT(e,t,n,r,o,"max")}}TT.className="MaxPooling2D",Gf(TT);class NT extends IT{constructor(e){super(e)}poolingFunction(e,t,n,r,o){return Yk(o),Jk(r),xT(e,t,n,r,o,"avg")}}NT.className="AveragePooling2D",Gf(NT);class ET extends p_{constructor(e){if(null==e.poolSize&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new dk("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Rk(this.poolSize,"poolSize"),Rk(this.strides,"strides"),this.padding=null==e.padding?"valid":e.padding,this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Yk(this.dataFormat),Jk(this.padding),this.inputSpec=[new c_({ndim:5})]}computeOutputShape(e){e=n_(e);let t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=fI(t,this.poolSize[0],this.padding,this.strides[0]),n=fI(n,this.poolSize[1],this.padding,this.strides[1]),r=fI(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return Qf((()=>(this.invokeCallHook(e,t),this.poolingFunction(t_(e),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class AT extends ET{constructor(e){super(e)}poolingFunction(e,t,n,r,o){return Yk(o),Jk(r),kT(e,t,n,r,o,"max")}}AT.className="MaxPooling3D",Gf(AT);class RT extends ET{constructor(e){super(e)}poolingFunction(e,t,n,r,o){return Yk(o),Jk(r),kT(e,t,n,r,o,"avg")}}RT.className="AveragePooling3D",Gf(RT);class OT extends p_{constructor(e){super(e),this.inputSpec=[new c_({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new pk}}class MT extends OT{constructor(e){super(e||{})}call(e,t){return Qf((()=>{const t=t_(e);return yg(t,1)}))}}MT.className="GlobalAveragePooling1D",Gf(MT);class PT extends OT{constructor(e){super(e||{})}call(e,t){return Qf((()=>{const t=t_(e);return lg(t,1)}))}}PT.className="GlobalMaxPooling1D",Gf(PT);class DT extends p_{constructor(e){super(e),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Yk(this.dataFormat),this.inputSpec=[new c_({ndim:4})]}computeOutputShape(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new pk}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class FT extends DT{call(e,t){return Qf((()=>{const t=t_(e);return"channelsLast"===this.dataFormat?yg(t,[1,2]):yg(t,[2,3])}))}}FT.className="GlobalAveragePooling2D",Gf(FT);class LT extends DT{call(e,t){return Qf((()=>{const t=t_(e);return"channelsLast"===this.dataFormat?lg(t,[1,2]):lg(t,[2,3])}))}}LT.className="GlobalMaxPooling2D",Gf(LT);class zT extends p_{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(e){null!=this.layer&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=T_(t.layer,n);delete t.layer;const o={layer:r};return Object.assign(o,t),new e(o)}}class BT extends zT{constructor(e){super(e),this.supportsMasking=!0}build(e){if((e=n_(e)).length<3)throw new dk("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){const t=[(e=n_(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return Qf((()=>MI(((e,n)=>[t_(this.layer.call(e,t)),[]]),e=t_(e),[],!1,null,null,!1,!0)[1]))}}BT.className="TimeDistributed",Gf(BT);class qT extends zT{constructor(e){super(e);const t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=T_(n),t.goBackwards=!0!==t.goBackwards;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=T_(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){Ek(Xk,"BidirectionalMergeMode",e)}(this.mergeMode),e.weights)throw new pk("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t,n,r,o=this.forwardLayer.computeOutputShape(e);return Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),this.returnState?(r=o.slice(1),t=o[0]):t=o[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):bk(n)}apply(e,t){let n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});const o=OI(e,n,r,this.numConstants);if(e=o.inputs,n=o.initialState,r=o.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return super.apply(e,t);const a=[],s=[];if(null!=n){const e=n.length;if(e%2>0)throw new dk("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,a.push(...n);const r=n.map((e=>new c_({shape:e.shape})));this.forwardLayer.stateSpec=r.slice(0,e/2),this.backwardLayer.stateSpec=r.slice(e/2),s.push(...r)}if(null!=r)throw new pk("Support for constants in Bidirectional layers is not implemented yet.");const i=a[0]instanceof l_;for(const c of a)if(c instanceof l_!==i)throw new dk("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(i){const n=[e].concat(a),r=this.inputSpec.concat(s),o=this.inputSpec;this.inputSpec=r;const i=super.apply(n,t);return this.inputSpec=o,i}return super.apply(e,t)}call(e,t){return Qf((()=>{const n=t.initialState;let r,o,a,s;if(null==n)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const a=n.slice(0,n.length/2),s=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:a})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:s}))}return this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Hg(o,1)),"concat"===this.mergeMode?s=gS([r,o]):"sum"===this.mergeMode?s=rm(r,o):"ave"===this.mergeMode?s=Cm(.5,rm(r,o)):"mul"===this.mergeMode?s=Cm(r,o):null==this.mergeMode&&(s=[r,o]),this.returnState?null==this.mergeMode?s.concat(a):[s].concat(a):s}))}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){eS(this.forwardLayer.name,(()=>{this.forwardLayer.build(e)})),eS(this.backwardLayer.name,(()=>{this.backwardLayer.build(e)})),this.built=!0}computeMask(e,t){let n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){const e=this.forwardLayer.states.map((e=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const n=T_(t.layer);if(delete t.layer,null!=t.numConstants)throw new pk("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=n,new e(r)}}qT.className="Bidirectional",Gf(qT);var WT,jT;!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(WT||(WT={})),function(e){let t;!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(jT||(jT={}));var VT,UT=__webpack_require__(4334);function GT(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);const o=t(e);if(o.recurse&&null!==o.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse){if(QT(e)){const o=Array.isArray(e)?[]:{};r.add(e);for(const a in e){const s=GT(e[a],t,n,r);o[a]=s}return r.delete(e),o}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,o.value),o.value}function HT(e){return KT(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:XT)}function KT(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;const r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");const o=t(e);if(o.recurse&&null!==o.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(o.recurse){if(QT(r)){const o=Array.isArray(r)?[]:{};n.add(r);for(const a in r){const r=e.map((e=>e[a])),s=KT(r,t,n);o[a]=s}return n.delete(r),o}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return o.value}function XT(e){return null===e?null:QT(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function QT(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof ep))}function YT(e){return function(e,t){return GT(e,t)}(e,JT)}function JT(e){return e instanceof ep?{value:e.clone(),recurse:!1}:QT(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}class ZT{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,null==e)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(const t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}class $T extends ZT{constructor(){super($T.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){const e=2*this.capacity,t=new Array(e),n=this.length();for(let r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function eN(e){return new oN(e)}function tN(e,t){return new mN(e,t)}$T.INITIAL_CAPACITY=32;class nN{async toArray(){const e=[];let t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){const e=this.prefetch(100),t=[];let n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new hN(this,e)}filter(e){return new lN(this,e)}map(e){return new uN(this,e)}mapAsync(e){return new dN(this,e)}serialMapAsync(e){return new dN(this,e).serial()}flatmap(e){return new fN(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile((e=>!0===e))}rowMajorBatch(e){return new cN(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}columnMajorBatch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:XT;return this.rowMajorBatch(e,t).map((e=>HT(e,n)))}concatenate(e,t){return new mN(new rN([this,e]),t)}take(e){return e<0||null==e?this:new iN(this,e)}skip(e){return e<0||null==e?this:new sN(this,e)}prefetch(e){return new gN(this,e)}shuffle(e,t){return new yN(this,e,t)}serial(){return new aN(this)}}class rN extends nN{constructor(e){super(),this.items=e,this.trav=0}summary(){return"Array of ".concat(this.items.length," items")}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const e=this.items[this.trav];return this.trav++,{value:YT(e),done:!1}}}class oN extends nN{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(F2){throw F2.message="Error thrown while iterating through a dataset: ".concat(F2.message),F2}}}class aN extends nN{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Serial")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class sN extends nN{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Skip")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const e=await this.upstream.next();if(e.done)return e;Yf(e.value)}return this.upstream.next()}}class iN extends nN{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return"".concat(this.upstream.summary()," -> Take")}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class cN extends nN{constructor(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const e=[];for(;e.length<this.batchSize;){const t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}}class lN extends nN{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> Filter")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;){const e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;Yf(e.value)}}}class uN extends nN{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Map")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=dp(e.value),n=this.transform(e.value),r=dp(n);for(const o of t)hp(o,r)||o.dispose();return{value:n,done:!1}}}class hN extends nN{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return"".concat(this.upstream.summary()," -> handleErrors")}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(F2){if(!this.handler(F2))return{value:null,done:!0}}}}class dN extends nN{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> AsyncMap")}async next(){const e=await this.upstream.next();if(e.done)return{value:null,done:!0};const t=dp(e.value),n=await this.transform(e.value),r=dp(n);for(const o of t)hp(o,r)||o.dispose();return{value:n,done:!1}}}class pN extends nN{constructor(){super(),this.outputQueue=new $T,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class fN extends pN{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return"".concat(this.upstream.summary()," -> Flatmap")}async pump(){const e=await this.upstream.next();if(e.done)return!1;const t=dp(e.value),n=this.transform(e.value),r=dp(n);this.outputQueue.pushAll(n);for(const o of t)hp(o,r)||o.dispose();return!0}}class mN extends nN{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,null==this.iterator){const e=await this.moreIterators.next();if(e.done)return{value:null,done:!0};this.iterator=e.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}}!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(VT||(VT={}));class gN extends nN{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new ZT(t)}summary(){return"".concat(this.upstream.summary()," -> Prefetch")}refill(){for(;!this.buffer.isFull();){const e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}}class yN extends gN{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=UT.alea(n||Kd().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(!t.done)return this.refill(),t;this.upstreamExhausted=!0}return{value:null,done:!0}}}class bN{constructor(){this.size=null}batch(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this;let r;return Jc(e>0,(()=>"batchSize needs to be positive, but it is\n      ".concat(e))),r=this.size===1/0||null==this.size?this.size:t?Math.ceil(this.size/e):Math.floor(this.size/e),vN((async()=>(await n.iterator()).columnMajorBatch(e,t,wN)),r)}concatenate(e){const t=this;let n;return n=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,vN((async()=>(await t.iterator()).concatenate(await e.iterator())),n)}filter(e){const t=this;let n;return n=this.size===1/0?1/0:null,vN((async()=>(await t.iterator()).filter((t=>Qf((()=>e(t)))))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){const t=this;return vN((async()=>(await t.iterator()).map((t=>Qf((()=>e(t)))))),this.size)}mapAsync(e){const t=this;return vN((async()=>(await t.iterator()).mapAsync(e)),this.size)}prefetch(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const t=this;return vN((async()=>(await t.iterator()).prefetch(e)),this.size)}repeat(e){const t=this;let n;return n=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,vN((async()=>tN(eN((async()=>({value:await t.iterator(),done:!1}))).take(e))),n)}skip(e){const t=this;let n;return n=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,vN((async()=>(await t.iterator()).skip(e)),n)}shuffle(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));const r=this,o=UT.alea(t||Kd().toString());return vN((async()=>{let t=o.int32();return n&&(t+=o.int32()),(await r.iterator()).shuffle(e,t.toString())}),this.size)}take(e){const t=this;let n;return n=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,vN((async()=>(await t.iterator()).take(e)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function vN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new class extends bN{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function wN(e){if(null===e)return null;const t=e[0];if(null==(n=t)||function(e){return null===e||"object"!==typeof e&&"function"!==typeof e}(n)||Array.isArray(n)||"object"===typeof n&&n instanceof ep||pl(n)){return{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof ep?oy(e):Ap(e)}(e),recurse:!1}}var n;return{value:null,recurse:!0}}bN.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function xN(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Jc("complex64"!==e.dtype,(()=>"".concat(t," does not support complex64 tensors in the CPU backend.")))}))}const kN=ov;class SN extends Hc{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Gc(this,Kf())}write(e,t,n){this.firstUse&&(this.firstUse=!1,Ol().get("IS_NODE")&&qb("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const r={};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&ml(n[0])){const o=n.map((e=>Xd(e)));r=this.write(o,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}incRef(e){this.data.get(e).refCount++}decRef(e){if(this.data.has(e)){this.data.get(e).refCount--}}move(e,t,n,r){this.data.set(e,{values:t,dtype:r,refCount:1})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:n}=this.data.get(e);if("complex64"===t){return jb(this.readSync(n.real.dataId),this.readSync(n.imag.dataId))}return this.data.get(e).values}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map((e=>Qd(e)))}catch($Y){throw new Error("Failed to decode encoded string bytes into utf-8")}return pf(e.shape,e.dtype,n)}makeOutput(e,t,n){const r=this.write(e,t,n);return Kf().makeTensorFromDataId(r,t,n,this)}disposeData(e){if(this.data.has(e)){const{complexTensorInfos:t}=this.data.get(e);null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}}disposeIntermediateTensorInfo(e){const t=e.dataId;if(this.data.has(t)){const e=this.data.get(t);e.refCount--,e.refCount<1&&this.disposeData(t)}}async time(e){const t=Kd();e();return{kernelMs:Kd()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){xN([e],"where");const t=this.readSync(e.dataId);return kN(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}function _N(e,t,n){return r=>{let{inputs:o,attrs:a,backend:s}=r;const{x:i}=o;if(xN(i,e),"string"===i.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const c=s,l=c.data.get(i.dataId).values,u=tl(i.shape),h=n||i.dtype,d=hl(h,u);for(let e=0;e<u;++e)d[e]=t(l[e],a);return c.makeTensorInfo(i.shape,h,d)}}function CN(e,t,n){return r=>{let{inputs:o,attrs:a,backend:s}=r;const{x:i}=o;if(xN(i,e),"string"===i.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const c=s,l=c.data.get(i.dataId).values,u=n||i.dtype,h=t(l,u,a);return c.makeTensorInfo(i.shape,u,h)}}Zf("cpu",(()=>new SN),1);const IN=_N(Au,(e=>e>=0?e:Math.exp(e)-1)),TN={kernelName:Au,backendName:"cpu",kernelFunc:IN};function NN(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const EN={kernelName:Ku,backendName:"cpu",kernelFunc:NN};function AN(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{alpha:a}=r;xN([o],"leakyRelu");const s=tl(o.shape),i=n.data.get(o.dataId).values,c=ul("float32",s);for(let l=0;l<i.length;l++)c[l]=i[l]<0?a*i[l]:i[l];return n.makeTensorInfo(o.shape,"float32",c)}const RN={kernelName:$u,backendName:"cpu",kernelFunc:AN};function ON(e){return(t,n,r,o,a)=>{const s=Ym(t,n),i=s.length,c=wl(s),l=ul(a,tl(s)),u=t.length,h=n.length,d=wl(t),p=wl(n),f=Xm(t,s),m=Xm(n,s);if(f.length+m.length===0)for(let g=0;g<l.length;++g)l[g]=e(r[g%r.length],o[g%o.length]);else for(let g=0;g<l.length;++g){const t=Nl(g,i,c),n=t.slice(-u);f.forEach((e=>n[e]=0));const a=Tl(n,u,d),s=t.slice(-h);m.forEach((e=>s[e]=0));const y=Tl(s,h,p);l[g]=e(r[a],o[y])}return[l,s]}}const MN=ON(((e,t)=>e<0?t*e:e));function PN(e){const{inputs:t,backend:n}=e,{x:r,alpha:o}=t;xN([r,o],"prelu");const a=n.data.get(r.dataId).values,s=n.data.get(o.dataId).values,[i,c]=MN(r.shape,o.shape,a,s,r.dtype);return n.makeTensorInfo(c,r.dtype,i)}const DN={kernelName:Ph,backendName:"cpu",kernelFunc:PN},FN=_N(Bh,(e=>Math.max(0,e))),LN={kernelName:Bh,backendName:"cpu",kernelFunc:FN},zN=_N(Gh,(e=>Math.min(Math.max(0,e),6))),BN={kernelName:Gh,backendName:"cpu",kernelFunc:zN};function qN(e,t,n,r,o){if("linear"===n)return NN({inputs:{x:t},backend:e});if("relu"===n)return FN({inputs:{x:t},backend:e});if("elu"===n)return IN({inputs:{x:t},backend:e});if("relu6"===n)return zN({inputs:{x:t},backend:e});if("prelu"===n)return PN({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return AN({inputs:{x:t},backend:e,attrs:{alpha:o}});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function WN(e){const{inputs:t,backend:n}=e,{real:r,imag:o}=t,a=n.data.get(r.dataId).values,s=n.data.get(o.dataId).values,i=n.makeTensorInfo(r.shape,"complex64");return n.data.get(i.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",a),imag:n.makeTensorInfo(o.shape,"float32",s)},i}const jN={kernelName:iu,backendName:"cpu",kernelFunc:WN};function VN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){return WN({inputs:{real:VN(e,t,"float32"),imag:VN(e,t,"float32")},backend:e})}const r=_l(tl(t),n);return e.makeTensorInfo(t,n,r)}function UN(e){const{inputs:t,backend:n}=e,{input:r}=t,o=n.data.get(r.dataId).complexTensorInfos.real,a=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,a)}const GN={kernelName:Lh,backendName:"cpu",kernelFunc:UN};function HN(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{dtype:a}=r;if("complex64"===a){if("complex64"===o.dtype)return NN({inputs:{x:o},backend:n});const e=VN(n,o.shape,o.dtype),t=HN({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),r=WN({inputs:{real:t,imag:e},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),r}if("complex64"===o.dtype){const e=UN({inputs:{input:o},backend:n}),t=HN({inputs:{x:e},backend:n,attrs:{dtype:a}});return n.disposeIntermediateTensorInfo(e),t}if(!dl(o.dtype,a)){const e=NN({inputs:{x:o},backend:n});return{dataId:e.dataId,shape:e.shape,dtype:a}}if("int32"===a){const e=n.data.get(o.dataId).values,t=Int32Array.from(e);return n.makeTensorInfo(o.shape,"int32",t)}if("bool"===a){const e=n.data.get(o.dataId).values,t=Hd([0],o.dtype),[r,a]=ON(((e,t)=>e!==t?1:0))(o.shape,[],e,t,"bool");return n.makeTensorInfo(a,"bool",r)}throw new Error("Error in Cast: failed to cast ".concat(o.dtype," to ").concat(a))}const KN={kernelName:ou,backendName:"cpu",kernelFunc:HN};function XN(e,t,n,r){return null==n?n=>{let{inputs:o,backend:a}=n;const{a:s,b:i}=o,c=a;xN([s,i],e);const l=c.data.get(s.dataId).values,u=c.data.get(i.dataId).values,h=r||s.dtype,[d,p]=t(s.shape,i.shape,l,u,h);return c.makeTensorInfo(p,h,d)}:e=>{let{inputs:o,backend:a}=e;const{a:s,b:i}=o,c=a;if("complex64"===s.dtype||"complex64"===i.dtype){const e=HN({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),t=c.data.get(e.dataId),r=t.complexTensorInfos.real,o=t.complexTensorInfos.imag,a=c.data.get(r.dataId).values,l=c.data.get(o.dataId).values,u=HN({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),h=c.data.get(u.dataId),d=h.complexTensorInfos.real,p=h.complexTensorInfos.imag,f=c.data.get(d.dataId).values,m=c.data.get(p.dataId).values,[g,y,b]=n(s.shape,i.shape,a,l,f,m),v=c.makeTensorInfo(b,"float32",g),w=c.makeTensorInfo(b,"float32",y),x=WN({inputs:{real:v,imag:w},backend:c});return c.disposeIntermediateTensorInfo(e),c.disposeIntermediateTensorInfo(u),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(w),x}{const e=c.data.get(s.dataId).values,n=c.data.get(i.dataId).values,o=r||s.dtype,[a,l]=t(s.shape,i.shape,e,n,o);return c.makeTensorInfo(l,o,a)}}}function QN(e){return(t,n,r,o,a,s)=>{const i=Ym(t,n),c=tl(i),l=i.length,u=wl(i),h=ul("float32",c),d=ul("float32",c),p=Xm(t,i),f=Xm(n,i),m=jb(r,o),g=jb(a,s),y=t.length,b=wl(t),v=n.length,w=wl(n);if(p.length+f.length===0)for(let x=0;x<h.length;x++){const t=x%m.length,n=x%g.length,r=e(m[2*t],m[2*t+1],g[2*n],g[2*n+1]);h[x]=r.real,d[x]=r.imag}else for(let x=0;x<h.length;x++){const t=Nl(x,l,u),n=t.slice(-y);p.forEach((e=>n[e]=0));const r=Tl(n,y,b),o=t.slice(-v);f.forEach((e=>o[e]=0));const a=Tl(o,v,w),s=e(m[2*r],m[2*r+1],g[2*a],g[2*a+1]);h[x]=s.real,d[x]=s.imag}return[h,d,i]}}const YN=ON(((e,t)=>e+t)),JN=QN(((e,t,n,r)=>({real:e+n,imag:t+r}))),ZN=XN(ql,YN,JN),$N={kernelName:ql,backendName:"cpu",kernelFunc:ZN};function eE(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{shape:a}=r,s=tl(o.shape),i=il(a,s),c=tl(i);Jc(s===c,(()=>"The new shape (".concat(i,") has ").concat(c," elements and the old ")+"shape (".concat(o.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements.")),n.incRef(o.dataId);const l=n.data.get(o.dataId);if(null!=l.complexTensorInfos){const e=l.complexTensorInfos.real,t=l.complexTensorInfos.imag;e.shape=i,t.shape=i}return{dataId:o.dataId,shape:i,dtype:o.dtype}}const tE={kernelName:qh,backendName:"cpu",kernelFunc:eE};function nE(e){const{inputs:t,backend:n,attrs:r}=e,{a:o,b:a}=t,{transposeA:s,transposeB:i}=r;xN([o,a],"matMul");const c=o.shape.length,l=a.shape.length,u=s?o.shape[c-2]:o.shape[c-1],h=i?a.shape[l-1]:a.shape[l-2],d=s?o.shape[c-1]:o.shape[c-2],p=i?a.shape[l-2]:a.shape[l-1],f=o.shape.slice(0,-2),m=a.shape.slice(0,-2),g=tl(f),y=tl(m);Jc(c>=2&&l>=2&&(g===y||1===g||1===y),(()=>"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input "+"batch dimensions of (".concat(f,") and (").concat(m,").")));const b=(g>y?o.shape.slice(0,-2):a.shape.slice(0,-2)).concat([d,p]);Jc(u===h,(()=>"Error in matMul: inner shapes (".concat(u,") and (")+"".concat(h,") of Tensors with shapes ").concat(o.shape," and ")+"".concat(a.shape," and transposeA=").concat(s)+" and transposeB=".concat(i," must match.")));const v=i?[y,p,h]:[y,h,p],w=eE({inputs:{x:o},backend:n,attrs:{shape:s?[g,u,d]:[g,d,u]}}),x=eE({inputs:{x:a},backend:n,attrs:{shape:v}}),k=s?w.shape[1]:w.shape[2],S=s?w.shape[2]:w.shape[1],_=i?x.shape[1]:x.shape[2],C=Math.max(g,y),I=n.data.get(w.dataId).values,T=n.data.get(x.dataId).values,N=wl(w.shape),E=wl(x.shape),[A,R,O]=s?[N[0],1,N[1]]:[N[0],N[1],1],[M,P,D]=i?[1,E[1],E[0]]:[E[1],1,E[0]],F=S*_,L=pf([C,S,_],w.dtype),z=L.values,B=n.blockSize;for(let q=0;q<C;q++)for(let e=0;e<S;e+=B)for(let t=0;t<_;t+=B)for(let n=0;n<k;n+=B){const r=Math.min(e+B,S),o=Math.min(t+B,_),a=Math.min(n+B,k);for(let s=e;s<r;s++)for(let e=t;e<o;e++){let t=0;for(let r=n;r<a;r++){const n=Math.min(q,g-1)*A,o=Math.min(q,y-1)*D;t+=I[n+s*R+r*O]*T[r*M+e*P+o]}z[q*F+(s*_+e)]+=t}}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(b,L.dtype,L.values)}const rE={kernelName:tu,backendName:"cpu",kernelFunc:nE};const oE={kernelName:Id,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:o,b:a,bias:s,preluActivationWeights:i}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=r;let d,p,f;const m=[];d=nE({inputs:{a:o,b:a},attrs:{transposeA:c,transposeB:l},backend:n}),s&&(p=ZN({inputs:{a:d,b:s},backend:n}),m.push(d),d=p),u&&(f=qN(n,d,u,i,h),m.push(d),d=f);for(const g of m)n.disposeIntermediateTensorInfo(g);return d}};function aE(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const sE={kernelName:Ll,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend;xN(t,"abs");let r=new Float32Array(tl(t.shape));return r=aE(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,"float32")}},iE=_N(zl,(e=>Math.acos(e))),cE={kernelName:zl,backendName:"cpu",kernelFunc:iE},lE=_N(Bl,(e=>Math.acosh(e))),uE={kernelName:Bl,backendName:"cpu",kernelFunc:lE};const hE={kernelName:Wl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,r=t;xN(t,"addN");const o=r.map((e=>n.data.get(e.dataId).values)),a=pf(r[0].shape,r[0].dtype),s=a.values;for(let i=0;i<r.length;i++){const e=o[i];for(let t=0;t<s.length;t++)s[t]+=e[t]}return n.makeTensorInfo(a.shape,a.dtype,a.values)}};function dE(e,t,n,r,o){const a=t.length,s=tl(t),i=wl(t),c=wl(o),l=ul(n,tl(o));for(let u=0;u<s;++u){const t=Nl(u,a,i),n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t[r[e]];l[Tl(n,a,c)]=e[u]}return l}function pE(e){const{inputs:t,attrs:n,backend:r}=e,{x:o}=t,{perm:a}=n;xN(o,"transpose");const s=o.shape.length,i=new Array(s);for(let l=0;l<i.length;l++)i[l]=o.shape[a[l]];const c=dE(r.data.get(o.dataId).values,o.shape,o.dtype,a,i);return{dataId:r.write(c,i,o.dtype),shape:i,dtype:o.dtype}}const fE={kernelName:bd,backendName:"cpu",kernelFunc:pE};const mE={kernelName:jl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r;xN(o,"all");const i=cl(a,o.shape);let c=i;const l=Cg(c,o.shape.length);let u=o;null!=l&&(u=pE({inputs:{x:o},backend:n,attrs:{perm:l}}),c=Tg(c.length,o.shape.length)),_g("all",c,u.shape.length);const[h,d]=kg(u.shape,c),p=tl(d),f=_l(tl(h),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=m[e];for(let n=0;n<p;++n){const r=m[e+n];t=t&&r}f[y]=t}null!=l&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,f);if(s){const e=eE({inputs:{x:g},backend:n,attrs:{shape:Sg(h,i)}});return n.disposeIntermediateTensorInfo(g),e}return g}};const gE={kernelName:Vl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r;xN(o,"any");const i=cl(a,o.shape);let c=i;const l=Cg(c,o.shape.length);let u=o;null!=l&&(u=pE({inputs:{x:o},backend:n,attrs:{perm:l}}),c=Tg(c.length,o.shape.length)),_g("any",c,u.shape.length);const[h,d]=kg(u.shape,c),p=tl(d),f=_l(tl(h),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=m[e];for(let n=0;n<p;++n){const r=m[e+n];t=t||r}f[y]=t}null!=l&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,f);if(s){const e=eE({inputs:{x:g},backend:n,attrs:{shape:Sg(h,i)}});return n.disposeIntermediateTensorInfo(g),e}return g}};const yE={kernelName:Ul,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a}=r;xN(o,"argMax");let s=cl(a,o.shape);const i=Cg(s,o.shape.length);let c=o;const l=[];null!=i&&(c=pE({inputs:{x:o},backend:n,attrs:{perm:i}}),l.push(c),s=Tg(s.length,c.shape.length)),s=[s[0]],_g("argMax",s,c.shape.length);const[u,h]=kg(c.shape,s),d=_l(tl(u),"int32"),p=tl(h),f=n.data.get(c.dataId).values;for(let m=0;m<d.length;++m){const e=m*p;let t=f[e],n=0;for(let r=0;r<p;++r){const o=f[e+r];o>t&&(t=o,n=r)}d[m]=n}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(u,"int32",d)}};const bE={kernelName:Gl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a}=r;xN(o,"argMin");let s=cl(a,o.shape);const i=Cg(s,o.shape.length);let c=o;const l=[];null!=i&&(c=pE({inputs:{x:o},backend:n,attrs:{perm:i}}),l.push(c),s=Tg(s.length,c.shape.length)),s=[s[0]],_g("argMin",s,c.shape.length);const[u,h]=kg(c.shape,s),d=_l(tl(u),"int32"),p=tl(h),f=n.data.get(c.dataId).values;for(let m=0;m<d.length;++m){const e=m*p;let t=f[e],n=0;for(let r=0;r<p;++r){const o=f[e+r];o<t&&(t=o,n=r)}d[m]=n}return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(u,"int32",d)}},vE=_N(Hl,(e=>Math.asin(e))),wE={kernelName:Hl,backendName:"cpu",kernelFunc:vE},xE=_N(Kl,(e=>Math.asinh(e))),kE={kernelName:Kl,backendName:"cpu",kernelFunc:xE},SE=_N(Xl,(e=>Math.atan(e))),_E={kernelName:Xl,backendName:"cpu",kernelFunc:SE},CE=ON(((e,t)=>Math.atan2(e,t))),IE=XN(Yl,CE),TE={kernelName:Yl,backendName:"cpu",kernelFunc:IE},NE=_N(Ql,(e=>Math.atanh(e))),EE={kernelName:Ql,backendName:"cpu",kernelFunc:NE};function AE(e,t,n,r,o,a){const s=o.strideHeight,i=o.strideWidth,c=o.dilationHeight,l=o.dilationWidth,u=o.effectiveFilterHeight,h=o.effectiveFilterWidth,d=o.padInfo.top,p=o.padInfo.left,f="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=pf(o.outShape,n),g=m.values,y=o.outShape[1]*o.outShape[2]*o.outShape[3],b=o.outShape[2]*o.outShape[3],v=o.outShape[3];for(let w=0;w<o.batchSize;++w){const t=w*y,n=w*r[0];for(let m=0;m<o.inChannels;++m)for(let y=0;y<o.outHeight;++y){const w=y*s-d,x=Math.max(0,w),k=Math.min(o.inHeight,u+w),S=t+y*b;for(let t=0;t<o.outWidth;++t){const s=t*i-p,u=Math.max(0,s),d=Math.min(o.inWidth,h+s);let y=f,b=0,w=0;for(let t=x;t<k;t+=c){const o=n+t*r[1];for(let t=u;t<d;t+=l){const n=e[o+t*r[2]+m];"max"===a&&n>y?y=n:"avg"===a&&(b+=n,w++)}if(isNaN(y))break}g[S+t*v+m]="avg"===a?b/w:y}}}return m}function RE(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=pf(r.outShape,"int32"),i=r.strideHeight,c=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=pf(t,n,e);for(let g=0;g<r.batchSize;++g)for(let e=0;e<r.inChannels;++e)for(let t=0;t<r.outHeight;++t){const n=t*i-p;let y=n;for(;y<0;)y+=l;const b=Math.min(r.inHeight,h+n);for(let i=0;i<r.outWidth;++i){const h=i*c-f;let p=h;for(;p<0;)p+=u;const v=Math.min(r.inWidth,d+h);let w=Number.NEGATIVE_INFINITY,x=-1;for(let t=y;t<b;t+=l){const s=t-n;for(let n=p;n<v;n+=u){const i=n-h,c=m.get(g,t,n,e);c>w&&(w=c,x=o?a?((g*r.inHeight+t)*r.inWidth+n)*r.inChannels+e:(t*r.inWidth+n)*r.inChannels+e:s*d+i)}}s.set(x,g,t,i,e)}}return s}function OE(e,t,n,r,o,a){const s=o.strideDepth,i=o.strideHeight,c=o.strideWidth,l=o.dilationDepth,u=o.dilationHeight,h=o.dilationWidth,d=o.effectiveFilterDepth,p=o.effectiveFilterHeight,f=o.effectiveFilterWidth,m=o.padInfo.front,g=o.padInfo.top,y=o.padInfo.left,b="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=pf(o.outShape,n),w=v.values,x=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],k=o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[3]*o.outShape[4],_=o.outShape[4];for(let C=0;C<o.batchSize;++C){const t=C*x,n=C*r[0];for(let v=0;v<o.inChannels;++v)for(let x=0;x<o.outDepth;++x){const C=x*s-m;let I=C;for(;I<0;)I+=l;const T=Math.min(o.inDepth,d+C),N=t+x*k;for(let t=0;t<o.outHeight;++t){const s=t*i-g;let d=s;for(;d<0;)d+=u;const m=Math.min(o.inHeight,p+s),x=N+t*S;for(let t=0;t<o.outWidth;++t){const s=t*c-y;let i=s;for(;i<0;)i+=h;const p=Math.min(o.inWidth,f+s),g=x+t*_;let k=b,S=0,C=0;for(let t=I;t<T;t+=l){const o=n+t*r[1];for(let t=d;t<m;t+=u){const n=o+t*r[2];for(let t=i;t<p;t+=h){const o=e[n+t*r[3]+v];if("max"===a&&o>k?k=o:"avg"===a&&(S+=o,C++),isNaN(k))break}if(isNaN(k))break}if(isNaN(k))break}w[g+v]="avg"===a?S/C:k}}}}return v}const ME={kernelName:Jl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t;xN(o,"avgPool");const{filterSize:a,strides:s,pad:i,dimRoundingMode:c}=r;Jc(bm(s,1),(()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")));const l=cm(o.shape,a,s,1,i,c);let u;if(1===l.filterWidth&&1===l.filterHeight&&nl(l.inShape,l.outShape))u=NN({inputs:{x:o},backend:n});else{const e=n.data.get(o.dataId).values,t=wl(o.shape),r=AE(e,o.shape,o.dtype,t,l,"avg");u=n.makeTensorInfo(l.outShape,o.dtype,r.values)}return u}};const PE={kernelName:$l,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{filterSize:a,strides:s,pad:i,dimRoundingMode:c,dataFormat:l,dilations:u}=r;xN(o,"avgPool3d");let h=u;null==h&&(h=[1,1,1]);const d=lm(o.shape,a,s,h,i,c,l),p=OE(n.data.get(o.dataId).values,o.shape,o.dtype,wl(o.shape),d,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};const DE={kernelName:eu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a}=t,{filterSize:s,strides:i,pad:c,dilations:l,dimRoundingMode:u}=r;xN([o,a],"avgPool3DGrad");const h=lm(a.shape,s,i,l,c,u),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=h.dilationDepth,v=h.dilationHeight,w=h.dilationWidth,x=h.effectiveFilterDepth,k=h.effectiveFilterHeight,S=h.effectiveFilterWidth,_=x-1-h.padInfo.front,C=S-1-h.padInfo.left,I=k-1-h.padInfo.top,T=pf(a.shape,"float32"),N=1/(m*g*y),E=n.bufferSync(o);for(let A=0;A<h.batchSize;++A)for(let e=0;e<h.inChannels;++e)for(let t=0;t<h.inDepth;++t)for(let n=0;n<h.inHeight;++n)for(let r=0;r<h.inWidth;++r){const o=t-_,a=n-I,s=r-C;let i=0;for(let t=0;t<x;t+=b){const n=(o+t)/d;if(!(n<0||n>=h.outDepth||Math.floor(n)!==n))for(let t=0;t<k;t+=v){const r=(a+t)/p;if(!(r<0||r>=h.outHeight||Math.floor(r)!==r))for(let t=0;t<S;t+=w){const o=(s+t)/f;if(o<0||o>=h.outWidth||Math.floor(o)!==o)continue;i+=E.get(A,n,r,o,e)}}}T.set(i*N,A,t,n,r,e)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};const FE={kernelName:Zl,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a}=t,s=a;xN([o,a],"avgPoolGrad");const{filterSize:i,strides:c,pad:l}=r,u=cm(s.shape,i,c,1,l),h=u.strideHeight,d=u.strideWidth,p=u.filterHeight,f=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,b=u.effectiveFilterWidth,v=b-1-u.padInfo.left,w=y-1-u.padInfo.top,x=pf(s.shape,"float32"),k=1/(p*f),S=n.data.get(o.dataId).values,_=pf(o.shape,"float32",S);for(let C=0;C<u.batchSize;++C)for(let e=0;e<u.inChannels;++e)for(let t=0;t<u.inHeight;++t)for(let n=0;n<u.inWidth;++n){const r=t-w,o=n-v;let a=0;for(let t=0;t<y;t+=m){const n=(r+t)/h;if(!(n<0||n>=u.outHeight||Math.floor(n)!==n))for(let t=0;t<b;t+=g){const r=(o+t)/d;if(r<0||r>=u.outWidth||Math.floor(r)!==r)continue;a+=_.get(C,n,r,e)}}x.set(a*k,C,t,n,e)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};const LE={kernelName:ju,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,scale:a,offset:s,mean:i,variance:c}=t;Jc(i.shape.length===c.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Jc(null==s||i.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Jc(null==a||i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),xN([o,i,c,a,s],"batchNorm");let{varianceEpsilon:l}=r;null==l&&(l=.001);const u=n.data.get(o.dataId).values,h=n.data.get(i.dataId).values,d=n.data.get(c.dataId).values,p=a?n.data.get(a.dataId).values:new Float32Array([1]),f=s?n.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=f.length,y=p.length,b=d.length,v=h.length;let w=0,x=0,k=0,S=0;for(let _=0;_<u.length;++_)m[_]=f[w++]+(u[_]-h[x++])*p[k++]/Math.sqrt(d[S++]+l),w>=g&&(w=0),x>=v&&(x=0),k>=y&&(k=0),S>=b&&(S=0);return n.makeTensorInfo(o.shape,o.dtype,m)}};function zE(e,t,n,r,o){const a=Bf(r,t,n),s=tl(n),i=wl(r);if(a){const n=qf(t,i);return"string"===o?e.slice(n,n+s):e.subarray(n,n+s)}const c=pf(r,o,"string"===o?nv(e):e),l=pf(n,o);for(let u=0;u<l.size;++u){const e=l.indexToLoc(u),n=e.map(((e,n)=>e+t[n]));l.set(c.get(...n),...e)}return"string"===o?rv(l.values):l.values}function BE(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{begin:a,size:s}=r;xN(o,"slice");const[i,c]=Wf(o,a,s);Tf(o,i,c);const l=zE(n.data.get(o.dataId).values,i,c,o.shape,o.dtype);return n.makeTensorInfo(c,o.dtype,l)}const qE={kernelName:Zh,backendName:"cpu",kernelFunc:BE};const WE={kernelName:nu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{blockShape:a,crops:s}=r;xN([o],"batchToSpaceND");const i=a.reduce(((e,t)=>e*t)),c=Sb(o.shape,a,i),l=_b(c.length,a.length),u=Cb(o.shape,a,i),h=Ib(s,a.length),d=Tb(u,s,a.length),p=eE({inputs:{x:o},backend:n,attrs:{shape:c}}),f=pE({inputs:{x:p},backend:n,attrs:{perm:l}}),m=eE({inputs:{x:f},backend:n,attrs:{shape:u}}),g=BE({inputs:{x:m},backend:n,attrs:{begin:h,size:d}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}};function jE(e,t,n,r,o){const a=tl(r),s=_l(o,n);for(let i=0;i<e.length;i++){const n=e[i];if(n<0)throw new Error("Input x must be non-negative!");n>=o||(s[n]+=a>0?t[i]:1)}return s}function VE(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=e.shape[0],a=e.shape[1],s=pf([o,n],t.dtype);for(let i=0;i<o;i++)for(let o=0;o<a;o++){const a=e.get(i,o);if(a<0)throw new Error("Input x must be non-negative!");a>=n||(r?s.set(1,i,a):t.size>0?s.set(s.get(i,a)+t.get(i,o),i,a):s.set(s.get(i,a)+1,i,a))}return s}const UE={kernelName:ru,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,weights:a}=t,{size:s}=r,i=jE(n.data.get(o.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,i)}};function GE(e){return(t,n,r)=>{const o=ul(n,t.length);for(let a=0;a<t.length;++a)o[a]=e(t[a],r);return o}}const HE=GE((e=>Math.ceil(e))),KE=CN(au,HE),XE={kernelName:au,backendName:"cpu",kernelFunc:KE},QE=_N(su,((e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),YE={kernelName:su,backendName:"cpu",kernelFunc:QE},JE={kernelName:cu,backendName:"cpu",kernelFunc:e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(tl(t.shape)),o=n.data.get(t.dataId),a=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,i=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values;for(let l=0;l<i.length;l++){const e=i[l],t=c[l];r[l]=Math.hypot(e,t)}return n.makeOutput(r,t.shape,"float32")}};function ZE(e,t,n,r){const o=hl(n,tl(t));if(r&&"string"!==n){let t=0;e.forEach((e=>{const n=tl(e.shape);o.set(e.vals,t),t+=n}))}else{let r=0;e.forEach((e=>{const a="string"===n?nv(e.vals):e.vals;let s=0;for(let n=0;n<e.shape[0];++n){const i=n*t[1]+r;for(let t=0;t<e.shape[1];++t)o[i+t]=a[s++]}r+=e.shape[1]}))}return o}function $E(e){const{inputs:t,backend:n}=e,{input:r}=t,o=n.data.get(r.dataId).complexTensorInfos.imag,a=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,a)}const eA={kernelName:Qu,backendName:"cpu",kernelFunc:$E};function tA(e){const{inputs:t,backend:n,attrs:r}=e,{axis:o}=r,a=cl(o,t[0].shape)[0];let s=vb(t.map((e=>e.shape)),a);if(0===tl(s))return n.makeTensorInfo(s,t[0].dtype,[]);const i=t.filter((e=>tl(e.shape)>0));if(1===i.length)return NN({inputs:{x:i[0]},backend:n});if(bb(i.map((e=>e.shape)),a),"complex64"===i[0].dtype){const e=i.map((e=>UN({inputs:{input:e},backend:n}))),t=i.map((e=>$E({inputs:{input:e},backend:n}))),r=tA({inputs:e,backend:n,attrs:{axis:a}}),o=tA({inputs:t,backend:n,attrs:{axis:a}}),s=WN({inputs:{real:r,imag:o},backend:n});return e.forEach((e=>n.disposeIntermediateTensorInfo(e))),t.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),s}const c=i.map((e=>{const t=tl(e.shape.slice(a));return eE({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),l=c.map((e=>({vals:n.data.get(e.dataId).values,shape:e.shape})));s=vb(c.map((e=>e.shape)),1);const u=1===c[0].shape[0],h=ZE(l,s,t[0].dtype,u),d=vb(i.map((e=>e.shape)),a),p=n.makeTensorInfo(d,t[0].dtype,h);return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}const nA={kernelName:lu,backendName:"cpu",kernelFunc:tA};function rA(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dataFormat:c,dilations:l,dimRoundingMode:u}=r;xN([o,a],"conv2d");const h=vm(c),d=um(o.shape,a.shape,s,l,i,u,!1,h),p=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,b=d.padInfo.top,v="channelsLast"===d.dataFormat,w=new Yd(d.outShape,o.dtype),x=wl(o.shape),k=wl(a.shape),S=x[0],_=v?x[1]:x[2],C=v?x[2]:1,I=v?1:x[1],T=w.strides[0],N=v?w.strides[1]:w.strides[2],E=v?w.strides[2]:1,A=v?1:w.strides[1],R=n.data.get(o.dataId).values,O=n.data.get(a.dataId).values,M=w.values;for(let P=0;P<d.batchSize;++P){const e=P*S,t=P*T;for(let n=0;n<d.outHeight;++n){const r=t+n*N,o=n*d.strideHeight-b;for(let t=0;t<p;++t){const n=o+t*m;if(n<0||n>=d.inHeight)continue;const a=t*k[0],s=e+n*_;for(let e=0;e<d.outWidth;++e){const t=r+e*E,n=e*d.strideWidth-y;for(let e=0;e<f;++e){const r=n+e*g;if(r<0||r>=d.inWidth)continue;const o=s+r*C;let i=a+e*k[1];for(let e=0;e<d.inChannels;++e){const n=R[o+e*I];for(let e=0;e<d.outChannels;++e)M[t+e*A]+=n*O[i+e];i+=d.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,M)}const oA={kernelName:uu,backendName:"cpu",kernelFunc:rA};const aA={kernelName:hu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,dy:a}=t,{strides:s,pad:i,dataFormat:c,dimRoundingMode:l,filterShape:u}=r;xN([o,a],"conv2dBackpropFilter");const h=vm(c),d=um(o.shape,u,s,1,i,l,!1,h),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=d,y="channelsLast"===d.dataFormat,b=new Yd(d.filterShape,"float32"),v=d.padInfo.left,w=d.padInfo.top,x=n.data.get(o.dataId).values,k=n.data.get(a.dataId).values,S=new Yd(o.shape,o.dtype,x),_=new Yd(a.shape,a.dtype,k);for(let C=0;C<m;++C){const e=Math.max(0,Math.ceil((w-C)/p)),t=Math.min(d.outHeight,(d.inHeight+w-C)/p);for(let n=0;n<g;++n){const r=Math.max(0,Math.ceil((v-n)/f)),o=Math.min(d.outWidth,(d.inWidth+v-n)/f);for(let a=0;a<d.inChannels;++a)for(let s=0;s<d.outChannels;++s){let i=0;for(let c=0;c<d.batchSize;++c)for(let l=e;l<t;++l){const e=C+l*p-w;for(let t=r;t<o;++t){const r=n+t*f-v;i+=y?S.get(c,e,r,a)*_.get(c,l,t,s):S.get(c,a,e,r)*_.get(c,s,l,t)}}b.set(i,C,n,a,s)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const sA={kernelName:du,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,filter:a}=t,{inputShape:s,strides:i,pad:c,dataFormat:l,dimRoundingMode:u}=r;xN([o,a],"conv2dBackpropInput");const h=wl(a.shape),d=wl(o.shape);let p=vm(l);const f=um(s,a.shape,i,1,c,u,!1,p),m=new Yd(f.inShape,"float32"),g=m.values,y=n.data.get(o.dataId).values,b=n.data.get(a.dataId).values,[v,w,x]=h,{batchSize:k,filterHeight:S,filterWidth:_,inChannels:C,inHeight:I,inWidth:T,outChannels:N,outHeight:E,outWidth:A,strideHeight:R,strideWidth:O}=f;p=f.dataFormat;const M=S-1-f.padInfo.top,P=_-1-f.padInfo.left,D="channelsLast"===p,F=m.strides[0],L=D?m.strides[1]:m.strides[2],z=D?m.strides[2]:1,B=D?1:m.strides[1],q=d[0],W=D?d[1]:d[2],j=D?d[2]:1,V=D?1:d[1];for(let U=0;U<k;++U)for(let e=0;e<C;++e)for(let t=0;t<I;++t){const n=t-M,r=Math.max(0,Math.ceil(n/R)),o=Math.min(E,(S+n)/R);for(let a=0;a<T;++a){const s=a-P,i=Math.max(0,Math.ceil(s/O)),c=Math.min(A,(_+s)/O);let l=0;for(let t=r;t<o;++t){const r=t*R-n;for(let n=i;n<c;++n){const o=q*U+W*t+j*n,a=v*(S-1-r)+w*(_-1-(n*O-s))+x*e;for(let e=0;e<N;++e){l+=y[o+V*e]*b[a+e]}}}g[F*U+L*t+z*a+B*e]=l}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};const iA={kernelName:pu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dilations:c}=r;xN([o,a],"conv3d");const l=hm(o.shape,a.shape,s,c,i),{filterDepth:u,filterHeight:h,filterWidth:d,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=l,y=g.front,b=g.left,v=g.top,w=new Yd(l.outShape,o.dtype),x=n.data.get(o.dataId).values,k=n.data.get(a.dataId).values,S=w.values,_=wl(o.shape),C=wl(a.shape);for(let I=0;I<l.batchSize;++I){const e=I*_[0],t=I*w.strides[0];for(let n=0;n<l.outDepth;++n){const r=t+n*w.strides[1],o=n*l.strideDepth-y;for(let t=0;t<u;++t){const n=o+t*p;if(n<0||n>=l.inDepth)continue;const a=t*C[0],s=e+n*_[1];for(let e=0;e<l.outHeight;++e){const t=r+e*w.strides[2],n=e*l.strideHeight-v;for(let e=0;e<h;++e){const r=n+e*f;if(r<0||r>=l.inHeight)continue;const o=a+e*C[1],i=s+r*_[2];for(let e=0;e<l.outWidth;++e){const n=t+e*l.outChannels,r=e*l.strideWidth-b;for(let e=0;e<d;++e){const t=r+e*m;if(t<0||t>=l.inWidth)continue;const a=o+e*C[2],s=i+t*l.inChannels;let c=a;for(let e=0;e<l.inChannels;++e){const t=x[s+e];for(let e=0;e<l.outChannels;++e)S[n+e]+=t*k[c+e];c+=l.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};const cA={kernelName:fu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,dy:a}=t,{strides:s,pad:i,filterShape:c}=r;xN([o,a],"conv3dBackpropFilterV2");const l=wl(o.shape),u=wl(a.shape),h=hm(o.shape,c,s,1,i),d=h.strideDepth,p=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new Yd(h.filterShape,"float32"),v=b.values,[w,x,k,S]=b.strides,_=n.data.get(a.dataId).values,[C,I,T,N]=u,E=n.data.get(o.dataId).values,[A,R,O,M]=l,P=h.padInfo.front,D=h.padInfo.left,F=h.padInfo.top;for(let L=0;L<m;++L){const e=Math.max(0,Math.ceil((P-L)/d)),t=Math.min(h.outDepth,(h.inDepth+P-L)/d),n=L*w;for(let r=0;r<g;++r){const o=Math.max(0,Math.ceil((F-r)/p)),a=Math.min(h.outHeight,(h.inHeight+F-r)/p),s=r*x+n;for(let n=0;n<y;++n){const i=Math.max(0,Math.ceil((D-n)/f)),c=Math.min(h.outWidth,(h.inWidth+D-n)/f),l=n*k+s;for(let s=0;s<h.inChannels;++s){const u=s*S+l;for(let l=0;l<h.outChannels;++l){let m=0;for(let u=0;u<h.batchSize;++u){const h=u*A,g=u*C;for(let u=e;u<t;++u){const e=(L+u*d-P)*R+h,t=u*I+g;for(let u=o;u<a;++u){const o=(r+u*p-F)*O+e,a=u*T+t;for(let e=i;e<c;++e){const t=e*N+a;m+=E[(n+e*f-D)*M+o+s]*_[t+l]}}}}v[u+l]=m}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};const lA={kernelName:mu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,filter:a}=t,{pad:s,strides:i,inputShape:c}=r;xN([o],"conv3dBackpropInputV2");const l=wl(o.shape),u=wl(a.shape),h=hm(c,a.shape,i,1,s),d=new Yd(h.inShape,"float32"),p=d.values,[f,m,g,y]=d.strides,b=n.data.get(o.dataId).values,[v,w,x,k]=l,S=n.data.get(a.dataId).values,[_,C,I,T]=u,{batchSize:N,filterDepth:E,filterHeight:A,filterWidth:R,inChannels:O,inDepth:M,inHeight:P,inWidth:D,outChannels:F,outDepth:L,outHeight:z,outWidth:B,strideDepth:q,strideHeight:W,strideWidth:j}=h,V=E-1-h.padInfo.front,U=A-1-h.padInfo.top,G=R-1-h.padInfo.left;for(let H=0;H<N;++H)for(let e=0;e<O;++e)for(let t=0;t<M;++t){const n=t-V,r=Math.max(0,Math.ceil(n/q)),o=Math.min(L,(E+n)/q);for(let a=0;a<P;++a){const s=a-U,i=Math.max(0,Math.ceil(s/W)),c=Math.min(z,(A+s)/W);for(let l=0;l<D;++l){const u=l-G,h=Math.max(0,Math.ceil(u/j)),d=Math.min(B,(R+u)/j);let N=0;for(let t=r;t<o;++t){const r=t*q-n;for(let n=i;n<c;++n){const o=n*W-s;for(let a=h;a<d;++a){const s=v*H+w*t+x*n+k*a,i=_*(E-1-r)+C*(A-1-o)+I*(R-1-(a*j-u))+T*e;for(let e=0;e<F;++e){N+=b[s+e]*S[i+e]}}}}p[f*H+m*t+g*a+y*l+e]=N}}}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},uA=_N(gu,(e=>Math.cos(e))),hA={kernelName:gu,backendName:"cpu",kernelFunc:uA},dA=_N(yu,(e=>Math.cosh(e))),pA={kernelName:yu,backendName:"cpu",kernelFunc:dA};const fA={kernelName:vu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{image:o,boxes:a,boxInd:s}=t,{cropSize:i,method:c,extrapolationValue:l}=r,[u,h,d,p]=o.shape,f=a.shape[0],[m,g]=i,y=pf([f,m,g,p],"float32"),b=n.data.get(a.dataId).values,v=n.data.get(s.dataId).values,w=n.data.get(o.dataId).values,x=wl(o.shape),k=wl(y.shape);for(let S=0;S<f;S++){const e=4*S,t=b[e],n=b[e+1],r=b[e+2],o=b[e+3],a=v[S];if(a>=u)continue;const s=m>1?(r-t)*(h-1)/(m-1):0,i=g>1?(o-n)*(d-1)/(g-1):0;for(let u=0;u<m;u++){const e=m>1?t*(h-1)+u*s:.5*(t+r)*(h-1);if(e<0||e>h-1)for(let t=0;t<g;t++)for(let e=0;e<p;e++){const n=e+t*k[2]+u*k[1]+S*k[0];y.values[n]=l}else if("bilinear"===c){const t=Math.floor(e),r=Math.ceil(e),s=e-t;for(let e=0;e<g;e++){const c=g>1?n*(d-1)+e*i:.5*(n+o)*(d-1);if(c<0||c>d-1){for(let t=0;t<p;t++){const n=t+e*k[2]+u*k[1]+S*k[0];y.values[n]=l}continue}const h=Math.floor(c),f=Math.ceil(c),m=c-h;for(let n=0;n<p;n++){let o=n+h*x[2]+t*x[1]+a*x[0];const i=w[o];o=n+f*x[2]+t*x[1]+a*x[0];const c=w[o];o=n+h*x[2]+r*x[1]+a*x[0];const l=w[o];o=n+f*x[2]+r*x[1]+a*x[0];const d=i+(c-i)*m,p=l+(w[o]-l)*m;o=n+e*k[2]+u*k[1]+S*k[0],y.values[o]=d+(p-d)*s}}}else for(let t=0;t<g;++t){const r=g>1?n*(d-1)+t*i:.5*(n+o)*(d-1);if(r<0||r>d-1){for(let e=0;e<p;e++){const n=e+t*k[2]+u*k[1]+S*k[0];y.values[n]=l}continue}const s=Math.round(r),c=Math.round(e);for(let e=0;e<p;e++){const n=e+s*x[2]+c*x[1]+a*x[0],r=e+t*k[2]+u*k[1]+S*k[0];y.values[r]=w[n]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};const mA={kernelName:bu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,exclusive:s,reverse:i}=r;xN(o,"cumsum");const c=Cg([a],o.shape.length);let l=o;null!=c&&(l=pE({inputs:{x:o},backend:n,attrs:{perm:c}}));const u=Tg(1,o.shape.length)[0];if(u!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(l.shape.length-1," but got axis=").concat(u));const h=cp(l.dtype,"int32"),d=_l(tl(l.shape),h),p=n.data.get(l.dataId).values,f=l.shape[l.shape.length-1],m=i?(e,t)=>e+f-t-1:(e,t)=>e+t;for(let y=0;y<p.length;y+=f)for(let e=0;e<f;e++){const t=m(y,e);if(0===e)d[t]=s?0:p[t];else{const n=m(y,e-1);d[t]=s?p[n]+d[n]:p[t]+d[n]}}const g=n.makeTensorInfo(l.shape,h,d);if(null!=c){const e=pE({inputs:{x:g},backend:n,attrs:{perm:Ig(c)}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(l),e}return g}};const gA={kernelName:wu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,weights:a}=t,{size:s,binaryOutput:i}=r;if(1===o.shape.length){const e=jE(n.data.get(o.dataId).values,n.data.get(a.dataId).values,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,e)}if(2===o.shape.length){const e=VE(n.bufferSync(o),n.bufferSync(a),s,i);return n.makeTensorInfo(e.shape,a.dtype,e.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(o.shape.length,"."))}};const yA={kernelName:xu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{blockSize:a,dataFormat:s}=r;Jc("NHWC"===s,(()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(s))),Jc(a>1,(()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(a)));const i=o.shape[0],c=o.shape[1],l=o.shape[2],u=o.shape[3],h=c*a,d=l*a,p=u/(a*a),f=n.data.get(o.dataId).values,m=new Float32Array(i*h*d*p);let g=0;for(let y=0;y<i;++y)for(let e=0;e<h;++e){const t=Math.floor(e/a),n=e%a;for(let e=0;e<d;++e){const r=Math.floor(e/a),o=(n*a+e%a)*p;for(let e=0;e<p;++e){const n=e+o+u*(r+l*(t+c*y));m[g++]=f[n]}}}return n.makeTensorInfo([i,h,d,p],o.dtype,m)}};function bA(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dilations:c,dimRoundingMode:l}=r;xN([o,a],"depthwiseConv2DNative");const u=wl(o.shape),h=wl(a.shape);let d=c;null==d&&(d=[1,1]),Jc(bm(s,d),(()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(d,"'")));const p=um(o.shape,a.shape,s,d,i,l,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:b}=p,v=b.left,w=b.top,x=p.outChannels/p.inChannels,k=new Yd(p.outShape,o.dtype),S=n.data.get(o.dataId).values,_=n.data.get(a.dataId).values,C=k.values;for(let I=0;I<p.batchSize;++I){const e=I*u[0],t=I*k.strides[0];for(let n=0;n<p.outHeight;++n){const r=t+n*k.strides[1],o=n*p.strideHeight-v;for(let t=0;t<f;++t){const n=o+t*g;if(n<0||n>=p.inHeight)continue;const a=t*h[0],s=e+n*u[1];for(let e=0;e<p.outWidth;++e){const t=r+e*k.strides[2],n=e*p.strideWidth-w;for(let e=0;e<m;++e){const r=n+e*y;if(r<0||r>=p.inWidth)continue;const o=a+e*h[1],i=s+r*p.inChannels;let c=t,l=o;for(let e=0;e<p.inChannels;++e){const t=S[i+e];for(let e=0;e<x;++e)C[c+e]+=t*_[l+e];c+=x,l+=x}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const vA={kernelName:ku,backendName:"cpu",kernelFunc:bA};const wA={kernelName:Su,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,dy:a}=t,{strides:s,dilations:i,pad:c,dimRoundingMode:l,filterShape:u}=r;xN([o,a],"depthwiseConv2dNativeBackpropFilter");const h=um(o.shape,u,s,i,c,l,!0),{strideHeight:d,strideWidth:p,filterHeight:f,filterWidth:m}=h,g=new Yd(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=n.data.get(o.dataId).values,x=new Yd(o.shape,o.dtype,w),k=n.data.get(a.dataId).values,S=new Yd(a.shape,a.dtype,k);for(let _=0;_<f;++_){const e=Math.max(0,Math.ceil((b-_)/d)),t=Math.min(h.outHeight,(h.inHeight+b-_)/d);for(let n=0;n<m;++n){const r=Math.max(0,Math.ceil((y-n)/p)),o=Math.min(h.outWidth,(h.inWidth+y-n)/p);for(let a=0;a<h.outChannels;++a){const s=Math.trunc(a/v),i=a%v;let c=0;for(let l=0;l<h.batchSize;++l)for(let i=e;i<t;++i){const e=_+i*d-b;for(let t=r;t<o;++t){const r=n+t*p-y;c+=x.get(l,e,r,s)*S.get(l,i,t,a)}}g.set(c,_,n,s,i)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};const xA={kernelName:_u,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,filter:a}=t,{strides:s,dilations:i,pad:c,dimRoundingMode:l,inputShape:u}=r;xN([o,a],"depthwiseConv2DNativeBackpropInput");const h=wl(o.shape),d=wl(a.shape),p=um(u,a.shape,s,i,c,l,!0),f=new Yd(p.inShape,"float32"),m=f.values,[g,y,b]=f.strides,v=n.data.get(o.dataId).values,[w,x,k]=h,S=n.data.get(a.dataId).values,[_,C,I]=d,{batchSize:T,filterHeight:N,filterWidth:E,inChannels:A,inHeight:R,inWidth:O,outChannels:M,outHeight:P,outWidth:D,strideHeight:F,strideWidth:L}=p,z=N-1-p.padInfo.top,B=E-1-p.padInfo.left,q=M/A;for(let W=0;W<T;++W)for(let e=0;e<A;++e)for(let t=0;t<R;++t){const n=t-z,r=Math.max(0,Math.ceil(n/F)),o=Math.min(P,(N+n)/F);for(let a=0;a<O;++a){const s=a-B,i=Math.max(0,Math.ceil(s/L)),c=Math.min(D,(E+s)/L);let l=0;for(let t=r;t<o;++t){const r=t*F-n;for(let n=i;n<c;++n){const o=w*W+x*t+k*n,a=_*(N-1-r)+C*(E-1-(n*L-s))+I*e;for(let t=0;t<q;++t){l+=v[o+(e*q+t)]*S[a+t]}}}m[g*W+y*t+b*a+e]=l}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};const kA={kernelName:Cu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,o=tl(r.shape),a=n.data.get(r.dataId).values,s=pf([o,o],r.dtype),i=s.values;for(let l=0;l<a.length;l++)i[l*o+l]=a[l];const c=[...r.shape,...r.shape];return n.makeTensorInfo(c,s.dtype,s.values)}},SA={kernelName:Iu,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:o,filter:a}=t,{strides:s,pad:i,dilations:c}=r,l=n,u=l.data.get(o.dataId).values,h=o.shape.length,d=l.data.get(a.dataId).values,p=a.shape.length,{batchSize:f,inHeight:m,inWidth:g,inChannels:y,outHeight:b,outWidth:v,padInfo:w,strideHeight:x,strideWidth:k,filterHeight:S,filterWidth:_,dilationHeight:C,dilationWidth:I,outShape:T}=im(o.shape,a.shape,s,i,"NHWC",c),N=tl(T),E=T.length,A=hl(o.dtype,N);for(let R=0;R<f;++R)for(let e=0;e<b;++e){const t=e*x-w.top;for(let n=0;n<v;++n){const r=n*k-w.left;for(let s=0;s<y;++s){let i=Number.MIN_SAFE_INTEGER;for(let e=0;e<S;++e){const n=t+e*C;if(n>=0&&n<m)for(let t=0;t<_;++t){const c=r+t*I;if(c>=0&&c<g){const r=Tl([R,n,c,s],h,wl(o.shape)),l=Tl([e,t,s],p,wl(a.shape)),f=u[r]+d[l];f>i&&(i=f)}}}A[Tl([R,e,n,s],E,wl(T))]=i}}}return{dataId:l.write(Hd(A,o.dtype),T,o.dtype),shape:T,dtype:o.dtype}}},_A={kernelName:Nu,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:o,filter:a,dy:s}=t,{strides:i,pad:c,dilations:l}=r,u=n,h=kl(o.shape,u.data.get(o.dataId).values),d=kl(a.shape,u.data.get(a.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:x,filterHeight:k,filterWidth:S,dilationHeight:_,dilationWidth:C,outShape:I}=im(o.shape,a.shape,i,c,"NHWC",l);Jc(s.rank===I.length,(()=>"Error in ".concat(Nu,", dy ")+"must have the same rank as output ".concat(I.length,", but got ")+"".concat(s.rank)));const T=kl(I,u.data.get(s.dataId).values),N=Cl(a.shape,a.dtype);for(let E=0;E<p;++E)for(let e=0;e<y;++e){const t=e*w-v.top;for(let n=0;n<b;++n){const r=n*x-v.left;for(let o=0;o<g;++o){let a=Number.MIN_SAFE_INTEGER,s=0,i=0;for(let e=0;e<k;++e){const n=t+e*_;if(n>=0&&n<f)for(let t=0;t<S;++t){const c=r+t*C;if(c>=0&&c<m){const r=h[E][n][c][o]+d[e][t][o];r>a&&(a=r,s=e,i=t)}}}N[s][i][o]+=T[E][e][n][o]}}}return{dataId:u.write(Hd(N,o.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},CA={kernelName:Tu,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:o,filter:a,dy:s}=t,{strides:i,pad:c,dilations:l}=r,u=n,h=kl(o.shape,u.data.get(o.dataId).values),d=kl(a.shape,u.data.get(a.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:x,filterHeight:k,filterWidth:S,dilationHeight:_,dilationWidth:C,outShape:I}=im(o.shape,a.shape,i,c,"NHWC",l);Jc(s.rank===I.length,(()=>"Error in ".concat(Tu,", dy ")+"must have the same rank as output ".concat(I.length,", but got ")+"".concat(s.rank)));const T=kl(I,u.data.get(s.dataId).values),N=Cl(o.shape,o.dtype);for(let E=0;E<p;++E)for(let e=0;e<y;++e){const t=e*w-v.top;for(let n=0;n<b;++n){const r=n*x-v.left;for(let o=0;o<g;++o){let a=Number.MIN_SAFE_INTEGER,s=t<0?0:t,i=r<0?0:r;for(let e=0;e<k;++e){const n=t+e*_;if(n>=0&&n<f)for(let t=0;t<S;++t){const c=r+t*C;if(c>=0&&c<m){const r=h[E][n][c][o]+d[e][t][o];r>a&&(a=r,s=n,i=c)}}}N[E][s][i][o]+=T[E][e][n][o]}}}return{dataId:u.write(Hd(N,o.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};const IA={kernelName:Ru,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{dy:r,y:o}=t;xN([r,o],"eluGrad");const a=new Float32Array(tl(o.shape)),s=n.data.get(o.dataId).values,i=n.data.get(r.dataId).values;for(let c=0;c<s.length;++c){const e=s[c];a[c]=e>=1?i[c]:i[c]*(e+1)}return n.makeTensorInfo(o.shape,"float32",a)}},TA=ON(((e,t)=>e===t?1:0)),NA=XN(Mu,TA,null,"bool"),EA={kernelName:Mu,backendName:"cpu",kernelFunc:NA},AA=Pb,RA=Db,OA=Fb,MA=Lb,PA=zb,DA=Bb,FA=_N(Ou,(e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+AA*n);return t*(1-((((DA*r+PA)*r+MA)*r+OA)*r+RA)*r*Math.exp(-n*n))})),LA={kernelName:Ou,backendName:"cpu",kernelFunc:FA},zA=GE((e=>Math.exp(e))),BA=CN(Pu,zA),qA={kernelName:Pu,backendName:"cpu",kernelFunc:BA};function WA(e){const{inputs:t,backend:n,attrs:r}=e,{input:o}=t,{dim:a}=r,s=o.shape.length,i=o.shape.slice();let c=a;return a<0&&(Jc(-(s+1)<=a,(()=>"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]"))),c=s+a+1),i.splice(c,0,1),eE({inputs:{x:o},backend:n,attrs:{shape:i}})}const jA={kernelName:Du,backendName:"cpu",kernelFunc:WA},VA=GE((e=>Math.expm1(e))),UA=CN(Fu,VA),GA={kernelName:Fu,backendName:"cpu",kernelFunc:UA},HA=ON(((e,t)=>e*t)),KA=QN(((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n}))),XA=XN(Sh,HA,KA),QA={kernelName:Sh,backendName:"cpu",kernelFunc:XA},YA=ON(((e,t)=>e/t)),JA=XN(Eu,YA),ZA={kernelName:Eu,backendName:"cpu",kernelFunc:JA},$A=ON(((e,t)=>e-t)),eR=QN(((e,t,n,r)=>({real:e-n,imag:t-r}))),tR=XN(hd,$A,eR),nR={kernelName:hd,backendName:"cpu",kernelFunc:tR};function rR(e,t,n){const r=e.shape,o=r[0],a=r[1],s=n.data.get(e.dataId),i=s.complexTensorInfos.real,c=s.complexTensorInfos.imag,l=[o,a],u=tl(l),h=ul("float32",u),d=ul("float32",u);for(let g=0;g<o;g++){const e=BE({inputs:{x:i},backend:n,attrs:{begin:[g,0],size:[1,a]}}),r=BE({inputs:{x:c},backend:n,attrs:{begin:[g,0],size:[1,a]}}),o=WN({inputs:{real:e,imag:r},backend:n}),{real:s,imag:l}=oR(o,t,n),u=jb(s,l);for(let t=0;t<a;t++){const e=Hb(u,t);h[g*a+t]=e.real,d[g*a+t]=e.imag}n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o)}const p=n.makeTensorInfo(l,"float32",h),f=n.makeTensorInfo(l,"float32",d),m=WN({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}function oR(e,t,n){const r=tl(e.shape),o=n.data.get(e.dataId),a=n.data.get(o.complexTensorInfos.real.dataId).values,s=n.data.get(o.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){const o=aR(a,s,r,t,n),i=[e.shape[0],e.shape[1]];if(t){const e=n.makeTensorInfo(i,"float32",o.real),t=n.makeTensorInfo(i,"float32",o.imag),a=n.makeTensorInfo([],"float32",Gd(r,"float32")),s=NN({inputs:{x:a},backend:n}),c=ZA.kernelFunc({inputs:{a:e,b:a},backend:n}),l=ZA.kernelFunc({inputs:{a:t,b:s},backend:n}),u=n.data.get(c.dataId).values,h=n.data.get(l.dataId).values;return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),{real:u,imag:h}}return o}{const e=function(e,t,n){const r=new Float32Array(2*t);for(let o=0;o<t;o++){let a=0,s=0;for(let r=0;r<t;r++){const i=Qb(o*r,t,n),c=Hb(e,r);a+=c.real*i.real-c.imag*i.imag,s+=c.real*i.imag+c.imag*i.real}n&&(a/=t,s/=t),Kb(r,a,s,o)}return r}(jb(a,s),r,t);return Vb(e)}}function aR(e,t,n,r,o){if(1===n)return{real:e,imag:t};const a=jb(e,t),s=n/2,i=Ub(a),c=i.real,l=i.imag,u=[c.length],h=o.makeTensorInfo(u,"float32",c),d=o.makeTensorInfo(u,"float32",l),p=WN({inputs:{real:h,imag:d},backend:o}),f=Gb(a),m=f.real,g=f.imag,y=[m.length],b=o.makeTensorInfo(y,"float32",m),v=o.makeTensorInfo(y,"float32",g),w=WN({inputs:{real:b,imag:v},backend:o}),x=aR(c,l,s,r,o),k=x.real,S=x.imag,_=[k.length],C=o.makeTensorInfo(_,"float32",k),I=o.makeTensorInfo(_,"float32",S),T=WN({inputs:{real:C,imag:I},backend:o}),N=aR(m,g,s,r,o),E=N.real,A=N.imag,R=[E.length],O=o.makeTensorInfo(R,"float32",E),M=o.makeTensorInfo(R,"float32",A),P=WN({inputs:{real:O,imag:M},backend:o}),D=Xb(n,r),F=[D.real.length],L=o.makeTensorInfo(F,"float32",D.real),z=o.makeTensorInfo(F,"float32",D.imag),B=WN({inputs:{real:L,imag:z},backend:o}),q=XA({inputs:{a:B,b:P},backend:o}),W=ZN({inputs:{a:T,b:q},backend:o}),j=tR({inputs:{a:T,b:q},backend:o}),V=UN({inputs:{input:W},backend:o}),U=UN({inputs:{input:j},backend:o}),G=$E({inputs:{input:W},backend:o}),H=$E({inputs:{input:j},backend:o}),K=tA({inputs:[V,U],backend:o,attrs:{axis:0}}),X=tA({inputs:[G,H],backend:o,attrs:{axis:0}}),Q=o.data.get(K.dataId).values,Y=o.data.get(X.dataId).values;return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(I),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(M),o.disposeIntermediateTensorInfo(P),o.disposeIntermediateTensorInfo(L),o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(q),o.disposeIntermediateTensorInfo(W),o.disposeIntermediateTensorInfo(j),o.disposeIntermediateTensorInfo(V),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(H),o.disposeIntermediateTensorInfo(K),o.disposeIntermediateTensorInfo(X),{real:Q,imag:Y}}const sR={kernelName:Lu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,o=tl(r.shape),a=r.shape[r.shape.length-1],s=eE({inputs:{x:r},backend:n,attrs:{shape:[o/a,a]}}),i=rR(s,!1,n),c=eE({inputs:{x:i},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),c}};function iR(e){const{backend:t,attrs:n}=e,{shape:r,value:o,dtype:a}=n,s=a||yl(o),i=hl(s,tl(r));return function(e,t){e.fill(t)}(i,o),t.makeTensorInfo(r,s,i)}const cR={kernelName:zu,backendName:"cpu",kernelFunc:iR};const lR={kernelName:Bu,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:o}=t,a=r,s=ul(o.dtype,tl(o.shape)),[i,c,l,u]=o.shape,h=a.data.get(o.dataId).values;for(let d=0;d<i;d++){const e=d*l*c*u;for(let t=0;t<c;t++){const n=t*(l*u);for(let r=0;r<l;r++){const o=r*u;for(let a=0;a<u;a++){const c=[i,t,r,a][2],d=Math.round(l-c),p=e+n+o+a;let f=h[p];if(d>=0&&d<l){f=h[e+n+d*u+a]}s[p]=f}}}}return{dataId:a.write(s,o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},uR=GE((e=>Math.floor(e))),hR=CN(qu,uR),dR={kernelName:qu,backendName:"cpu",kernelFunc:hR},pR=ON(((e,t)=>Math.floor(e/t))),fR=XN(Wu,pR,null,"int32"),mR={kernelName:Wu,backendName:"cpu",kernelFunc:fR};const gR={kernelName:Td,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a,bias:s,preluActivationWeights:i}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=rA({inputs:{x:o,filter:a},backend:n,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}});if(s){const e=m;m=ZN({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){const e=m;m=qN(n,m,p,i,f),n.disposeIntermediateTensorInfo(e)}return m}};const yR={kernelName:Nd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a,bias:s,preluActivationWeights:i}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r;let m=bA({inputs:{x:o,filter:a},backend:n,attrs:{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d}});if(s){const e=m;m=ZN({inputs:{a:m,b:s},backend:n}),n.disposeIntermediateTensorInfo(e)}if(p){const e=m;m=qN(n,m,p,i,f),n.disposeIntermediateTensorInfo(e)}return m}};const bR={kernelName:Uu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:o}=t,a=tl(r.shape),s=o.shape,i=s[s.length-1],[c,l,u,h]=Nb(r,o);if(0===l)return n.makeTensorInfo(c,r.dtype,[]);const d=pf([l,u],r.dtype),p=n.data.get(o.dataId).values,f=n.data.get(r.dataId).values;for(let m=0;m<l;m++){const e=[];let t=0;for(let n=0;n<i;n++){const r=p[m*i+n];t+=r*h[n],e.push(r)}if(t<0||t>=a/u)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(r.shape));for(let n=0;n<u;n++)d.values[m*u+n]=f[t*u+n]}return n.makeTensorInfo(c,d.dtype,d.values)}};function vR(e,t,n){const r=pf(n,e.dtype);for(let o=0;o<r.size;++o){const n=r.indexToLoc(o).slice(),a=n[0],s=n[2],i=t.locToIndex([a,s]);n[2]=t.values[i];const c=e.locToIndex(n);r.values[o]=e.values[c]}return r}const wR={kernelName:Vu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,indices:a}=t,{axis:s,batchDims:i}=r;xN([o,a],"gatherV2");let c=i;null==i&&(c=0);const l=tl(a.shape),u=$b(o,a,cl(s,o.shape)[0],c),h=eE({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),d=eE({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,l/u.batchSize]}}),p=[u.batchSize,u.outerSize,l/u.batchSize,u.sliceSize],f=n.bufferSync(d),m=vR(n.bufferSync(h),f,p);return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.makeTensorInfo(u.outputShape,m.dtype,m.values)}},xR=ON(((e,t)=>e>t?1:0)),kR=XN(Gu,xR,null,"bool"),SR={kernelName:Gu,backendName:"cpu",kernelFunc:kR},_R=ON(((e,t)=>e>=t?1:0)),CR=XN(Hu,_R,null,"bool"),IR={kernelName:Hu,backendName:"cpu",kernelFunc:CR};const TR={kernelName:Xu,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t,o=tl(r.shape),a=r.shape[r.shape.length-1],s=eE({inputs:{x:r},backend:n,attrs:{shape:[o/a,a]}}),i=rR(s,!0,n),c=eE({inputs:{x:i},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),c}},NR=_N(Yu,(e=>Number.isFinite(e)?1:0),"bool"),ER={kernelName:Yu,backendName:"cpu",kernelFunc:NR},AR=_N(Ju,(e=>Math.abs(e)===1/0?1:0),"bool"),RR={kernelName:Ju,backendName:"cpu",kernelFunc:AR},OR=_N(Zu,(e=>Number.isNaN(e)?1:0),"bool"),MR={kernelName:Zu,backendName:"cpu",kernelFunc:OR},PR=ON(((e,t)=>e<t?1:0)),DR=XN(eh,PR,null,"bool"),FR={kernelName:eh,backendName:"cpu",kernelFunc:DR},LR=ON(((e,t)=>e<=t?1:0)),zR=XN(th,LR,null,"bool"),BR={kernelName:th,backendName:"cpu",kernelFunc:zR};function qR(e,t,n){const r=(t-e)/(n-1),o=_l(n,"float32");o[0]=e;for(let a=1;a<o.length;a++)o[a]=o[a-1]+r;return o}const WR={kernelName:nh,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:o,num:a}=n,s=qR(r,o,a);return t.makeTensorInfo([s.length],"float32",s)}},jR=GE((e=>Math.log(e))),VR=CN(rh,jR),UR={kernelName:rh,backendName:"cpu",kernelFunc:VR},GR=_N(oh,(e=>Math.log1p(e))),HR={kernelName:oh,backendName:"cpu",kernelFunc:GR},KR=ON(((e,t)=>e&&t)),XR=XN(ah,KR,null,"bool"),QR={kernelName:ah,backendName:"cpu",kernelFunc:XR},YR=_N(sh,(e=>e?0:1),"bool"),JR={kernelName:sh,backendName:"cpu",kernelFunc:YR},ZR=ON(((e,t)=>e||t)),$R=XN(ih,ZR,null,"bool"),eO={kernelName:ih,backendName:"cpu",kernelFunc:$R};const tO={kernelName:ch,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{depthRadius:a,bias:s,alpha:i,beta:c}=r;xN(o,"LRN");const l=o.shape[3],u=l-1,h=n.data.get(o.dataId).values,d=tl(o.shape),p=new Float32Array(d);function f(e){const t=e%l;let n=e-t+Math.max(0,t-a);const r=e-t+Math.min(t+a,u);let o=0;for(;n<=r;n++){const e=h[n];o+=e*e}return o}for(let m=0;m<d;m++){const e=f(m),t=h[m]*Math.pow(s+i*e,-c);p[m]=t}return n.makeTensorInfo(o.shape,o.dtype,p)}};const nO={kernelName:lh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,y:a,dy:s}=t,{depthRadius:i,bias:c,alpha:l,beta:u}=r;xN(s,"LRNGrad");const h=tl(s.shape),d=s.shape[3],p=n.data.get(s.dataId).values,f=n.data.get(o.dataId).values,m=n.data.get(a.dataId).values,g=new Float32Array(h),y=h;for(let b=0;b<y;b++){const e=b%d,t=b-e+Math.max(0,e-i),n=b-e+Math.min(d,e+i+1);let r=0;for(let o=t;o<n;o++)r+=Math.pow(f[o],2);r=l*r+c;for(let o=t;o<n;o++){let e=-2*l*u*f[o]*m[b]/r;b===o&&(e+=Math.pow(r,-u)),e*=p[b],g[o]+=e}}return n.makeTensorInfo(s.shape,o.dtype,g)}};function rO(e,t,n,r){const o=ul(r,tl(n));for(let a=0;a<o.length;++a){const n=a*t;let r=e[n];for(let o=0;o<t;++o){const t=e[n+o];t>r&&(r=t)}o[a]=r}return o}function oO(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{reductionIndices:a,keepDims:s}=r,i=n;let c=o.shape;const l=c.length,u=cl(a,c);let h=u;const d=Cg(h,l);let p=i.data.get(o.dataId).values;if(null!=d){const e=new Array(l);for(let t=0;t<e.length;t++)e[t]=c[d[t]];p=dE(p,c,o.dtype,d,e),h=Tg(h.length,l),c=e}xN(o,"max"),_g("max",h,l);const[f,m]=kg(c,h),g=rO(p,tl(m),f,o.dtype),y=i.write(g,f,o.dtype);let b=f;if(s){b=Sg(f,u)}return{dataId:y,shape:b,dtype:o.dtype}}const aO={kernelName:uh,backendName:"cpu",kernelFunc:oO},sO=ON(((e,t)=>Math.max(e,t))),iO=XN(hh,sO),cO={kernelName:hh,backendName:"cpu",kernelFunc:iO};const lO={kernelName:dh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t;xN(o,"maxPool");const{filterSize:a,strides:s,pad:i,dimRoundingMode:c}=r;Jc(bm(s,1),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")));const l=cm(o.shape,a,s,1,i,c);let u;if(1===l.filterWidth&&1===l.filterHeight&&nl(l.inShape,l.outShape))u=NN({inputs:{x:o},backend:n});else{const e=n.data.get(o.dataId).values,t=wl(o.shape),r=AE(e,o.shape,o.dtype,t,l,"max");u=n.makeTensorInfo(l.outShape,o.dtype,r.values)}return u}};const uO={kernelName:fh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{filterSize:a,strides:s,pad:i,dimRoundingMode:c,dataFormat:l,dilations:u}=r;xN(o,"maxPool3d");let h=u;null==h&&(h=[1,1,1]);const d=lm(o.shape,a,s,h,i,c,l),p=OE(n.data.get(o.dataId).values,o.shape,o.dtype,wl(o.shape),d,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};const hO={kernelName:mh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a}=t,{filterSize:s,strides:i,pad:c,dilations:l,dimRoundingMode:u}=r;xN([o,a],"maxPool3DGrad");const h=lm(a.shape,s,i,l,c,u),d=function(e,t){const n=pf(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,i=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,p=t.padInfo.top,f=t.padInfo.left;for(let m=0;m<t.batchSize;++m)for(let g=0;g<t.inChannels;++g)for(let y=0;y<t.outDepth;++y){const b=y*r-d;let v=b;for(;v<0;)v+=s;const w=Math.min(t.inDepth,l+b);for(let r=0;r<t.outHeight;++r){const l=r*o-p;let d=l;for(;d<0;)d+=i;const x=Math.min(t.inHeight,u+l);for(let o=0;o<t.outWidth;++o){const p=o*a-f;let k=p;for(;k<0;)k+=c;const S=Math.min(t.inWidth,h+p);let _=Number.NEGATIVE_INFINITY,C=-1;for(let t=v;t<w;t+=s){const n=t-b;for(let r=d;r<x;r+=i){const o=r-l;for(let a=k;a<S;a+=c){const s=a-p,i=e.get(m,t,r,a,g);i>=_&&(_=i,C=n*u*h+o*u+s)}}}n.set(C,m,y,r,o,g)}}}return n}(n.bufferSync(a),h),p=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.dilationDepth,y=h.dilationHeight,b=h.dilationWidth,v=h.effectiveFilterDepth,w=h.effectiveFilterHeight,x=h.effectiveFilterWidth,k=v-1-h.padInfo.front,S=x-1-h.padInfo.left,_=w-1-h.padInfo.top,C=pf(a.shape,"float32"),I=n.bufferSync(o);for(let T=0;T<h.batchSize;++T)for(let e=0;e<h.inChannels;++e)for(let t=0;t<h.inDepth;++t)for(let n=0;n<h.inHeight;++n)for(let r=0;r<h.inWidth;++r){const o=t-k,a=n-_,s=r-S;let i=0;for(let t=0;t<v;t+=g){const n=(o+t)/p;if(!(n<0||n>=h.outDepth||Math.floor(n)!==n))for(let r=0;r<w;r+=y){const o=(a+r)/f;if(!(o<0||o>=h.outHeight||Math.floor(o)!==o))for(let a=0;a<x;a+=b){const c=(s+a)/m;if(c<0||c>=h.outWidth||Math.floor(c)!==c)continue;const l=v*w*x-1-d.get(T,n,o,c,e)===t*w*x+r*x+a?1:0;if(0===l)continue;i+=I.get(T,n,o,c,e)*l}}}C.set(i,T,t,n,r,e)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};const dO={kernelName:ph,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a,output:s}=t,i=a;xN([a,s],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=r,d=cm(i.shape,c,l,1,u,h),p=n.data.get(i.dataId).values,f=pf(d.outShape,i.dtype,RE(p,i.shape,i.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterHeight,w=d.effectiveFilterWidth,x=w-1-d.padInfo.left,k=v-1-d.padInfo.top,S=pf(i.shape,"float32"),_=n.data.get(o.dataId).values,C=pf(o.shape,"float32",_);for(let I=0;I<d.batchSize;++I)for(let e=0;e<d.inChannels;++e)for(let t=0;t<d.inHeight;++t)for(let n=0;n<d.inWidth;++n){const r=t-k,o=n-x;let a=0;for(let t=0;t<v;t+=y){const n=(r+t)/m;if(!(n<0||n>=d.outHeight||Math.floor(n)!==n))for(let r=0;r<w;r+=b){const s=(o+r)/g;if(s<0||s>=d.outWidth||Math.floor(s)!==s)continue;const i=v*w-1-f.get(I,n,s,e)===t*w+r?1:0;if(0===i)continue;a+=C.get(I,n,s,e)*i}}S.set(a,I,t,n,e)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};const pO={kernelName:gh,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:o}=t,{filterSize:a,strides:s,pad:i,includeBatchInIndex:c}=n,l=r;xN(o,"MaxPoolWithArgmax");const u=l.data.get(o.dataId).values,h=cm(o.shape,a,s,[1,1],i),[d,p]=function(e,t,n,r,o){const a=AE(e,0,n,wl(t),o,"max"),s=RE(e,t,n,o,!0,r);return[a.values,s.values]}(u,o.shape,o.dtype,c,h),f=l.write(d,h.outShape,o.dtype),m=l.write(p,h.outShape,o.dtype);return[{dataId:f,shape:h.outShape,dtype:o.dtype},{dataId:m,shape:h.outShape,dtype:"int32"}]}};function fO(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r;let i;xN(o,"sum"),i="bool"===o.dtype?HN({inputs:{x:o},backend:n,attrs:{dtype:"int32"}}):NN({inputs:{x:o},backend:n});const c=i.shape.length,l=cl(a,i.shape),u=Cg(l,c);let h=l,d=i;null!=u&&(d=pE({inputs:{x:i},backend:n,attrs:{perm:u}}),h=Tg(h.length,c)),_g("sum",h,d.shape.length);const[p,f]=kg(d.shape,h);let m=VN(n,p,cp(d.dtype,"int32"));const g=tl(f),y=n.data.get(m.dataId).values,b=n.data.get(d.dataId).values;for(let v=0;v<y.length;++v){const e=v*g;let t=0;for(let n=0;n<g;++n)t+=b[e+n];y[v]=t}if(s){const e=m;m=eE({inputs:{x:m},backend:n,attrs:{shape:Sg(m.shape,l)}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(i),null!=u&&n.disposeIntermediateTensorInfo(d),m}const mO={kernelName:ad,backendName:"cpu",kernelFunc:fO};const gO={kernelName:yh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r,i=cl(a,o.shape),c=tl(kg(o.shape,i)[1]),l=[],u=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(u);const h=HN({inputs:{x:o},backend:n,attrs:{dtype:"float32"}});l.push(h);const d=JA({inputs:{a:h,b:u},backend:n});l.push(d);const p=fO({inputs:{x:d},backend:n,attrs:{axis:a,keepDims:s}});return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),p}};const yO={kernelName:bh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r;xN(o,"min");const i=cl(a,o.shape);let c=i;const l=Cg(c,o.shape.length);let u=o;null!=l&&(u=pE({inputs:{x:o},backend:n,attrs:{perm:l}}),c=Tg(c.length,o.shape.length)),_g("min",c,u.shape.length);const[h,d]=kg(u.shape,c),p=tl(d),f=_l(tl(h),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){const e=y*p;let t=m[e];for(let n=0;n<p;++n){const r=m[e+n];r<t&&(t=r)}f[y]=t}null!=l&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(h,u.dtype,f);if(s){const e=eE({inputs:{x:g},backend:n,attrs:{shape:Sg(h,i)}});return n.disposeIntermediateTensorInfo(g),e}return g}},bO=ON(((e,t)=>Math.min(e,t))),vO=XN(vh,bO),wO={kernelName:vh,backendName:"cpu",kernelFunc:vO};const xO={kernelName:wh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{paddings:a,mode:s}=r;xN(o,"mirrorPad");const i=a.map(((e,t)=>e[0]+o.shape[t]+e[1])),c=a.map((e=>e[0])),l=a.map(((e,t)=>e[0]+o.shape[t])),u="reflect"===s?0:1,h=n.data.get(o.dataId).values,d=o.shape.length,p=wl(o.shape),f=tl(i),m=i.length,g=wl(i),y=ul(o.dtype,f);for(let b=0;b<f;b++){let e=Nl(b,m,g);for(let n=0;n<m;n++)e[n]<c[n]?e[n]=2*c[n]-e[n]-u:e[n]>=l[n]&&(e[n]=2*(l[n]-1)-e[n]+u);e=e.map(((e,t)=>e-c[t]));const t=Tl(e,d,p);y[b]=h[t]}return{dataId:n.write(y,i,o.dtype),shape:i,dtype:o.dtype}}},kO=ON(((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),SO=XN(xh,kO),_O={kernelName:xh,backendName:"cpu",kernelFunc:SO};var CO=__webpack_require__(5575);function IO(e){const{inputs:t,backend:n,attrs:r}=e,{logits:o}=t,{dim:a}=r,s=o.shape.length;let i=a;if(-1===i&&(i=s-1),i!==s-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(s," and dim was ").concat(i));const c=cl([i],o.shape),l=oO({inputs:{x:o},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),u=Sg(l.shape,c),h=eE({inputs:{x:l},backend:n,attrs:{shape:u}}),d=tR({inputs:{a:o,b:h},backend:n}),p=BA({inputs:{x:d},backend:n}),f=fO({inputs:{x:p},backend:n,attrs:{axis:c,keepDims:!1}}),m=eE({inputs:{x:f},backend:n,attrs:{shape:u}}),g=JA({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const TO={kernelName:cd,backendName:"cpu",kernelFunc:IO};const NO={kernelName:kh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:o}=t,{numSamples:a,seed:s,normalized:i}=r;xN(o,"multinomial");const c=i?o:IO({inputs:{logits:o},backend:n,attrs:{dim:-1}}),l=c.shape[0],u=c.shape[1],h=n.data.get(c.dataId).values,d=[l,a],p=_l(tl(d),"int32");for(let f=0;f<l;++f){const e=f*u,t=new Float32Array(u-1);t[0]=h[e];for(let o=1;o<t.length;++o)t[o]=t[o-1]+h[e+o];const n=CO.alea(s.toString()),r=f*a;for(let o=0;o<a;++o){const e=n();p[r+o]=t.length;for(let n=0;n<t.length;n++)if(e<t[n]){p[r+o]=n;break}}}return i||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(d,"int32",p)}};function EO(e,t,n){const r=Gd(-1,n);return HA([],t,r,e,n)}const AO={kernelName:_h,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;xN(r,"neg");const o=n.data.get(r.dataId).values,[a,s]=EO(o,r.shape,r.dtype);return n.makeTensorInfo(s,r.dtype,a)}},RO=Ly;const OO={kernelName:Ih,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:o,scores:a}=t,{maxOutputSize:s,iouThreshold:i,scoreThreshold:c}=r;xN(o,"NonMaxSuppression");const l=n.data.get(o.dataId).values,u=n.data.get(a.dataId).values,{selectedIndices:h}=RO(l,u,s,i,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},MO=zy;const PO={kernelName:Th,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:o,scores:a}=t,{maxOutputSize:s,iouThreshold:i,scoreThreshold:c,padToMaxOutputSize:l}=r;xN(o,"NonMaxSuppressionPadded");const u=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,{selectedIndices:d,validOutputs:p}=MO(u,h,s,i,c,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},DO=By;const FO={kernelName:Nh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:o,scores:a}=t,{maxOutputSize:s,iouThreshold:i,scoreThreshold:c,softNmsSigma:l}=r;xN(o,"NonMaxSuppressionWithScore");const u=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,d=s,p=i,f=c,m=l,{selectedIndices:g,selectedScores:y}=DO(u,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}},LO=ON(((e,t)=>e!==t?1:0)),zO=XN(Ch,LO,null,"bool"),BO={kernelName:Ch,backendName:"cpu",kernelFunc:zO};const qO={kernelName:Ah,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:o}=t,{depth:a,onValue:s,offValue:i}=r;xN(o,"oneHot");const c=tl(o.shape),l=new Float32Array(c*a);l.fill(i);const u=n.data.get(o.dataId).values;for(let h=0;h<c;++h)u[h]>=0&&u[h]<a&&(l[h*a+u[h]]=s);return n.makeTensorInfo([...o.shape,a],"int32",l)}};function WO(e){const{inputs:t,backend:n}=e,{x:r}=t;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){const e=UN({inputs:{input:r},backend:n}),t=WO({inputs:{x:e},backend:n}),o=$E({inputs:{input:r},backend:n}),a=WO({inputs:{x:o},backend:n}),s=WN({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),s}return iR({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const jO={kernelName:kd,backendName:"cpu",kernelFunc:WO};const VO={kernelName:Eh,backendName:"cpu",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:o}=n;if("string"===o.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===o.dtype){const t=UN({inputs:{input:o},backend:r}),n=e({inputs:{x:t},backend:r}),a=$E({inputs:{input:o},backend:r}),s=WO({inputs:{x:a},backend:r}),i=WN({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),i}return iR({backend:r,attrs:{shape:o.shape,value:1,dtype:o.dtype}})}};function UO(e){const{inputs:t,backend:n,attrs:r}=e,{axis:o}=r;if(1===t.length)return WA({inputs:{input:t[0]},backend:n,attrs:{dim:o}});const a=t[0].shape,s=t[0].dtype;t.forEach((e=>{Zc(a,e.shape,"All tensors passed to stack must have matching shapes"),Jc(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const i=[],c=tA({inputs:t.map((e=>{const t=WA({inputs:{input:e},backend:n,attrs:{dim:o}});return i.push(t),t})),backend:n,attrs:{axis:o}});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}const GO={kernelName:Rh,backendName:"cpu",kernelFunc:UO};const HO={kernelName:Oh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{paddings:a,constantValue:s}=r;xN(o,"pad");const i=a.map(((e,t)=>e[0]+o.shape[t]+e[1])),c=a.map((e=>e[0])),l=n.data.get(o.dataId).values,u=tl(o.shape),h=o.shape.length,d=wl(o.shape),p=tl(i),f=i.length,m=wl(i),g=ul(o.dtype,p);0!==s&&g.fill(s);for(let y=0;y<u;y++){const e=Nl(y,h,d).map(((e,t)=>e+c[t]));g[Tl(e,f,m)]=l[y]}return{dataId:n.write(g,i,o.dtype),shape:i,dtype:o.dtype}}},KO=ON(((e,t)=>Math.pow(e,t))),XO=XN(Mh,KO),QO={kernelName:Mh,backendName:"cpu",kernelFunc:XO};function YO(e,t,n,r){const[o,a]=kg(e,r),s=cp(t,"int32"),i=_l(tl(o),s),c=tl(a);for(let l=0;l<i.length;++l){const e=l*c;let t=1;for(let r=0;r<c;++r)t*=n[e+r];i[l]=t}return{outVals:i,outShape:o,outDtype:s}}const JO={kernelName:Dh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r;xN(o,"prod");const i=o.shape.length,c=cl(a,o.shape),l=Cg(c,i);let u=c,h=o;const d=[];null!=l&&(h=pE({inputs:{x:o},backend:n,attrs:{perm:l}}),d.push(h),u=Tg(u.length,i));const p=n.data.get(h.dataId).values,{outVals:f,outShape:m,outDtype:g}=YO(h.shape,h.dtype,p,u);let y=m;return s&&(y=Sg(m,c)),d.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(y,g,f)}};function ZO(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return _l(0,r);const o=_l(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(let a=1;a<o.length;a++)o[a]=o[a-1]+n;return o}const $O={kernelName:Fh,backendName:"cpu",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:o,dtype:a,step:s}=n,i=ZO(r,o,s,a);return t.makeTensorInfo([i.length],a,i)}},eM=_N(zh,(e=>1/e)),tM={kernelName:zh,backendName:"cpu",kernelFunc:eM};const nM={kernelName:Vh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o}=t,{alignCorners:a,halfPixelCenters:s,size:i}=r;xN(o,"resizeBilinear");const c=wl(o.shape),[l,u]=i,[h,d,p,f]=o.shape,m=n.data.get(o.dataId).values,g=new Float32Array(tl([h,l,u,f])),y=[a&&l>1?d-1:d,a&&u>1?p-1:p],b=[a&&l>1?l-1:l,a&&u>1?u-1:u];let v=0;const w=y[0]/b[0],x=y[1]/b[1];for(let k=0;k<h;k++)for(let e=0;e<l;e++){let t;t=s?w*(e+.5)-.5:w*e;const n=Math.max(0,Math.floor(t)),r=t-n,o=Math.min(d-1,Math.ceil(t)),a=k*c[0]+n*c[1],i=k*c[0]+o*c[1];for(let e=0;e<u;e++){let t;t=s?x*(e+.5)-.5:x*e;const n=Math.max(0,Math.floor(t)),o=t-n,l=Math.min(p-1,Math.ceil(t)),u=a+n*c[2],h=i+n*c[2],d=a+l*c[2],y=i+l*c[2];for(let e=0;e<f;e++){const t=m[u+e],n=m[h+e],a=t+(m[d+e]-t)*o,s=a+(n+(m[y+e]-n)*o-a)*r;g[v++]=s}}}return n.makeTensorInfo([h,l,u,f],"float32",g)}};const rM={kernelName:Uh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o,dy:a}=t,{alignCorners:s}=r;xN([a,o],"resizeBilinearGrad");const i=wl(o.shape),[c,l,u,h]=o.shape,[,d,p]=a.shape,f=new Float32Array(c*l*u*h),m=[s&&d>1?l-1:l,s&&p>1?u-1:u],g=[s&&d>1?d-1:d,s&&p>1?p-1:p],y=m[0]/g[0],b=m[1]/g[1],v=n.data.get(a.dataId).values;let w=0;for(let x=0;x<c;x++){const e=x*i[0];for(let t=0;t<d;t++){const n=t*y,r=Math.floor(n),o=Math.min(Math.ceil(n),l-1),a=e+r*i[1],s=e+o*i[1],c=n-r,d=1-c;for(let e=0;e<p;e++){const t=e*b,n=Math.floor(t),r=Math.min(Math.ceil(t),u-1),o=t-n,l=1-o,p=a+n*i[2],m=a+r*i[2],g=s+n*i[2],y=s+r*i[2],x=d*l,k=d*o,S=c*l,_=c*o;for(let e=0;e<h;e++){const t=v[w++];f[p+e]+=t*x,f[m+e]+=t*k,f[g+e]+=t*S,f[y+e]+=t*_}}}}return n.makeTensorInfo([c,u,l,h],"float32",f)}};const oM={kernelName:Wh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o}=t,{alignCorners:a,halfPixelCenters:s,size:i}=r;xN(o,"resizeNearestNeighbor");const c=wl(o.shape),[l,u]=i,[h,d,p,f]=o.shape,m=n.data.get(o.dataId).values,g=new Float32Array(h*l*u*f),y=[a&&l>1?d-1:d,a&&u>1?p-1:p],b=[a&&l>1?l-1:l,a&&u>1?u-1:u],v=y[0]/b[0],w=y[1]/b[1];let x=0;for(let k=0;k<h;k++){const e=k*c[0];for(let t=0;t<l;t++){const n=s?v*(t+.5):v*t;let r=Math.min(d-1,a?Math.round(n):Math.floor(n));s&&(r=Math.max(0,r));const o=e+r*c[1];for(let e=0;e<u;e++){const t=s?w*(e+.5):w*e;let n=Math.min(p-1,a?Math.round(t):Math.floor(t));s&&(n=Math.max(0,n));const r=o+n*c[2];for(let e=0;e<f;e++){const t=m[r+e];g[x++]=t}}}}return n.makeTensorInfo([h,l,u,f],o.dtype,g)}};const aM={kernelName:jh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o,dy:a}=t,{alignCorners:s}=r;xN([a,o],"resizeNearestNeighborGrad");const i=wl(o.shape),c=wl(a.shape),[l,u,h,d]=o.shape,[,p,f]=a.shape,m=new Float32Array(l*u*h*d),g=n.data.get(a.dataId).values,y=[s&&p>1?u-1:u,s&&f>1?h-1:h],b=[s&&p>1?p-1:p,s&&f>1?f-1:f],v=y[0]/b[0],w=y[1]/b[1],x=1/v,k=1/w,S=2*Math.ceil(x)+2,_=2*Math.ceil(k)+2;for(let C=0;C<l;C++){const e=C*i[0];for(let t=0;t<u;t++){const n=e+t*i[1],r=Math.floor(t*x),o=Math.floor(r-S/2);for(let a=0;a<h;a++){const r=n+a*i[2],l=Math.floor(a*k),y=Math.floor(l-_/2);for(let n=0;n<d;n++){let i=0;for(let r=0;r<S;r++){const l=r+o;if(l<0||l>=p)continue;const d=e+l*c[1],m=l*v;if(t===Math.min(u-1,s?Math.round(m):Math.floor(m)))for(let e=0;e<_;e++){const t=e+y;if(t<0||t>=f)continue;const r=d+t*c[2],o=t*w;a===Math.min(h-1,s?Math.round(o):Math.floor(o))&&(i+=g[r+n])}}m[r+n]=i}}}}return n.makeTensorInfo(o.shape,o.dtype,m)}};const sM={kernelName:Hh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{dims:a}=r;xN(o,"reverse");const s=o.shape.length,i=cl(a,o.shape);if(0===s)return NN({inputs:{x:o},backend:n});const c=new Yd(o.shape,o.dtype),l=n.bufferSync(o);for(let u=0;u<c.size;u++){const e=c.indexToLoc(u),t=e.slice();i.forEach((e=>t[e]=o.shape[e]-1-t[e])),c.set(l.get(...t),...e)}return n.makeTensorInfo(c.shape,c.dtype,c.values)}},iM={kernelName:Cd,backendName:"cpu",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:o}=t,{radians:a,fillValue:s,center:i}=n,c=r,l=ul(o.dtype,tl(o.shape)),[u,h,d,p]=o.shape,[f,m]=kb(i,h,d),g=Math.sin(a),y=Math.cos(a),b=c.data.get(o.dataId).values;for(let v=0;v<u;v++){const e=v*d*h*p;for(let t=0;t<h;t++){const n=t*(d*p);for(let r=0;r<d;r++){const o=r*p;for(let a=0;a<p;a++){const i=[u,t,r,a],c=i[2],v=i[1];let w=(c-f)*y-(v-m)*g,x=(c-f)*g+(v-m)*y;w=Math.round(w+f),x=Math.round(x+m);let k=s;if("number"!==typeof s&&(k=3===a?255:s[a]),w>=0&&w<d&&x>=0&&x<h){k=b[e+x*(d*p)+w*p+a]}l[e+n+o+a]=k}}}}return{dataId:c.write(l,o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},cM=_N(Kh,(e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),lM={kernelName:Kh,backendName:"cpu",kernelFunc:cM},uM=GE((e=>1/Math.sqrt(e))),hM=CN(Xh,uM),dM={kernelName:Xh,backendName:"cpu",kernelFunc:hM};function pM(e,t,n,r,o,a,s,i,c,l){const u=[r/o,o],h=e.values,d=t.values;if(0===r)return pf(n,t.dtype);const p=pf(u,t.dtype);p.values.fill(c);for(let f=0;f<a;f++){const e=[];let a=0;for(let t=0;t<s;t++){const n=h[f*s+t];e.push(n),a+=n*i[t]}if(a<0||a>=r/o)throw new Error("Invalid indices: ".concat(e," does not index into ").concat(n));for(let n=0;n<o;n++)l?p.values[a*o+n]+=d[f*o+n]:p.values[a*o+n]=0===t.rank?d[0]:d[f*o+n]}return p}const fM={kernelName:Qh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:o,updates:a}=t,{shape:s}=r,{sliceRank:i,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=Rb(0,o,s),d=pM(n.bufferSync(o),n.bufferSync(a),s,h,l,c,i,u,0,!0);return n.makeTensorInfo(s,d.dtype,d.values)}};const mM={kernelName:Yh,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:o,e:a}=t;xN([r,o,a],"select");const s=r.shape.length,i=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,l=n.data.get(a.dataId).values,u=cp(o.dtype,a.dtype),h=_l(tl(o.shape),u);let d=0;const p=0===s||s>1||1===o.shape.length?1:tl(o.shape.slice(1));for(let f=0;f<i.length;f++)for(let e=0;e<p;e++)1===i[f]?h[d++]=c[f]:h[d++]=l[f];return n.makeTensorInfo(o.shape,u,h)}},gM=Ob,yM=Mb,bM=_N(Jh,(e=>e>=0?yM*e:gM*(Math.exp(e)-1))),vM={kernelName:Jh,backendName:"cpu",kernelFunc:bM},wM=_N(nd,(e=>1/(1+Math.exp(-e)))),xM={kernelName:nd,backendName:"cpu",kernelFunc:wM},kM=_N(td,(e=>e<0?-1:e>0?1:0)),SM={kernelName:td,backendName:"cpu",kernelFunc:kM},_M=_N($h,(e=>Math.sin(e))),CM={kernelName:$h,backendName:"cpu",kernelFunc:_M},IM=_N(ed,(e=>Math.sinh(e))),TM={kernelName:ed,backendName:"cpu",kernelFunc:IM},NM=Math.log(1.1920928955078125e-7)+2,EM=_N(rd,(e=>{const t=e>-NM,n=e<NM,r=Math.exp(e);let o;return o=n?r:t?e:Math.log(1+r),o})),AM={kernelName:rd,backendName:"cpu",kernelFunc:EM};const RM={kernelName:sd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{blockShape:a,paddings:s}=r;xN([o],"spaceToBatchND");const i=tl(a),c=[[0,0]];c.push(...s);for(let g=1+a.length;g<o.shape.length;++g)c.push([0,0]);const l=HO.kernelFunc({inputs:{x:o},backend:n,attrs:{paddings:c,constantValue:0}}),u=Sb(l.shape,a,i,!1),h=_b(u.length,a.length,!1),d=Cb(l.shape,a,i,!1),p=eE({inputs:{x:l},backend:n,attrs:{shape:u}}),f=pE({inputs:{x:p},backend:n,attrs:{perm:h}}),m=eE({inputs:{x:f},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}};const OM={kernelName:dd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:o,sparseValues:a,defaultValue:s}=t,{outputShape:i}=r,{sliceRank:c,numUpdates:l,sliceSize:u,strides:h,outputSize:d}=Rb(0,o,i),p=pM(n.bufferSync(o),n.bufferSync(a),i,d,u,l,c,h,n.data.get(s.dataId).values[0],!1);return n.makeTensorInfo(i,p.dtype,p.values)}};const MM={kernelName:id,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{numOrSizeSplits:a,axis:s}=r,i=cl(s,o.shape)[0],c=Yb(o,a,i),l=new Array(o.shape.length).fill(0),u=o.shape.slice();return c.map((e=>{const t=[...u];t[i]=e;const r=BE({inputs:{x:o},backend:n,attrs:{begin:l,size:t}});return l[i]+=e,r}))}},PM=_N(od,(e=>Math.sqrt(e))),DM={kernelName:od,backendName:"cpu",kernelFunc:PM},FM={kernelName:ud,backendName:"cpu",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{x:r}=t,o=n;xN(r,"square");const a=o.data.get(r.dataId).values,s=new Float32Array(a.length);for(let i=0;i<a.length;++i){const e=a[i];s[i]=e*e}return{dataId:o.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},LM=ON(((e,t)=>{const n=e-t;return n*n})),zM=XN(ld,LM),BM={kernelName:ld,backendName:"cpu",kernelFunc:zM},qM=_N(Sd,((e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),WM={kernelName:Sd,backendName:"cpu",kernelFunc:qM};function jM(e,t,n,r){const o=pf(e,t.dtype);for(let a=0;a<o.size;a++){const e=o.indexToLoc(a),s=new Array(e.length);for(let t=0;t<s.length;t++)s[t]=e[t]*n[t]+r[t];o.set(t.get(...s),...e)}return o}const VM={kernelName:pd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{begin:a,end:s,strides:i,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r;xN(o,"stridedSlice");const{nonStrided:p,$begin:f,$strides:m,size:g,newShape:y,outShape:b}=jf(o.shape,a,s,i,c,l,u,h,d),v=eE({inputs:{x:o},backend:n,attrs:{shape:y}});let w;if(p){const e=BE({inputs:{x:v},backend:n,attrs:{begin:f,size:g}});w=eE({inputs:{x:e},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(e)}else if(b.some((e=>0===e)))w=n.makeTensorInfo(b,o.dtype,[]);else{const e=jM(b,n.bufferSync(v),m,f);w=n.makeTensorInfo(e.shape,e.dtype,e.values)}const x=eE({inputs:{x:w},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),x}},UM=_N(fd,(e=>Math.tan(e))),GM={kernelName:fd,backendName:"cpu",kernelFunc:UM},HM=_N(md,(e=>Math.tanh(e)));function KM(e,t){const n=new Array(e.rank);for(let o=0;o<n.length;o++)n[o]=e.shape[o]*t[o];const r=pf(n,e.dtype);for(let o=0;o<r.values.length;++o){const t=r.indexToLoc(o),n=new Array(e.rank);for(let r=0;r<n.length;r++)n[r]=t[r]%e.shape[r];const a=e.locToIndex(n);r.values[o]=e.values[a]}return r}const XM={kernelName:gd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{reps:a}=r;xN(o,"tile");const s=KM(n.bufferSync(o),a);return n.makeTensorInfo(s.shape,s.dtype,s.values)}};function QM(e,t,n,r,o){const a=t[t.length-1],[s,i]=[e.length/a,a],c=ul(n,s*r),l=ul("int32",s*r);for(let h=0;h<s;h++){const t=h*i,n=e.subarray(t,t+i),o=[];for(let e=0;e<n.length;e++)o.push({value:n[e],index:e});o.sort(((e,t)=>t.value-e.value));const a=h*r,s=c.subarray(a,a+r),u=l.subarray(a,a+r);for(let e=0;e<r;e++)s[e]=o[e].value,u[e]=o[e].index}const u=t.slice();return u[u.length-1]=r,[pf(u,n,c),pf(u,"int32",l)]}const YM={kernelName:yd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{k:a,sorted:s}=r;xN(o,"topk");const i=n.data.get(o.dataId).values,[c,l]=QM(i,o.shape,o.dtype,a);return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};function JM(e,t,n,r){const o=cl(t,n)[0],a=[1,n[0],1];for(let f=0;f<o;f++)a[0]*=n[f];a[1]=n[o];for(let f=o+1;f<n.length;f++)a[2]*=n[f];const s={},i=new Int32Array(n[o]),c=new Yd(a,r,e),l=[],u=1===a[0]&&1===a[2];for(let f=0;f<n[o];f++){let t;if(u)t=e[f].toString();else{const e=[];for(let t=0;t<a[0];t++)for(let n=0;n<a[2];n++)e.push(c.get(t,f,n));t=e.join(",")}if(void 0!==s[t])i[f]=s[t];else{const e=Object.keys(s).length;s[t]=e,i[f]=e,l.push(f)}}const h=a.slice();h[1]=Object.keys(s).length;const d=new Yd(h,r);l.forEach(((e,t)=>{for(let n=0;n<a[0];n++)for(let r=0;r<a[2];r++)d.set(c.get(n,e,r),n,t,r)}));const p=n.slice();return p[o]=h[1],{outputValues:d.values,outputShape:p,indices:i}}const ZM={kernelName:vd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:o}=n,{x:a}=t;xN(a,"unique");const s=r.data.get(a.dataId).values,{outputValues:i,outputShape:c,indices:l}=JM(s,o,a.shape,a.dtype);return[r.makeTensorInfo(c,a.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}};const $M={kernelName:wd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:o}=t;let{axis:a}=r;a<0&&(a+=o.shape.length);const s=o.shape.length,i=o.shape[a],c=new Array(s-1);let l=0;for(let p=0;p<s;p++)p!==a&&(c[l++]=o.shape[p]);const u=new Array(s).fill(0),h=o.shape.slice();h[a]=1;const d=new Array(i);for(let p=0;p<d.length;p++){u[a]=p;const e=BE({inputs:{x:o},backend:n,attrs:{begin:u,size:h}});d[p]=eE({inputs:{x:e},backend:n,attrs:{shape:c}}),n.disposeIntermediateTensorInfo(e)}return d}};const eP={kernelName:xd,backendName:"cpu",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,segmentIds:a}=t,{numSegments:s}=r;xN(o,"unsortedSegmentSum");const i=[],c=[],l=o.shape.length-a.shape.length;let u=a;for(let d=0;d<l;++d){const e=WA({inputs:{input:u},backend:n,attrs:{dim:d+1}});u=e,c.push(e)}for(let d=0;d<s;++d){const e=Gd(d,"int32"),t=n.makeTensorInfo([],"int32",e),r=NA({inputs:{a:t,b:u},backend:n}),a=HN({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),s=XA({inputs:{a:a,b:o},backend:n}),l=fO({inputs:{x:s},backend:n,attrs:{axis:0,keepDims:!1}});i.push(l),c.push(t),c.push(r),c.push(a),c.push(s),c.push(l)}const h=UO({inputs:i,backend:n,attrs:{axis:0}});return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),h}},tP=[oE,sE,cE,uE,$N,hE,mE,gE,yE,bE,wE,kE,_E,TE,EE,ME,PE,DE,FE,rE,LE,WE,UE,KN,XE,YE,jN,JE,nA,aA,sA,oA,cA,lA,iA,hA,pA,fA,mA,gA,yA,vA,wA,xA,kA,SA,CA,_A,ZA,TN,IA,EA,LA,qA,jA,GA,sR,cR,lR,dR,mR,gR,yR,bR,wR,SR,IR,EN,TR,eA,ER,RR,MR,RN,FR,BR,WR,UR,HR,QR,JR,eO,tO,nO,cO,lO,uO,hO,dO,pO,aO,gO,yO,wO,xO,_O,NO,QA,AO,OO,PO,FO,BO,qO,VO,GO,HO,QO,DN,JO,$O,GN,tM,LN,BN,tE,nM,rM,oM,aM,sM,iM,lM,dM,fM,mM,vM,xM,SM,CM,TM,qE,TO,AM,RM,OM,MM,DM,FM,BM,WM,VM,nR,mO,GM,{kernelName:md,backendName:"cpu",kernelFunc:HM},XM,YM,fE,ZM,$M,eP,jO];for(const z2 of tP)Pd(z2);const nP={},rP={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function oP(e){if(!(e in nP)){const t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);if(t.addEventListener("webglcontextlost",(t=>{t.preventDefault(),delete nP[e]}),!1),1===e)return t.getContext("webgl",rP)||t.getContext("experimental-webgl",rP);return t.getContext("webgl2",rP)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;nP[e]=t}const t=nP[e];return t.isContextLost()?(delete nP[e],oP(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),nP[e])}var aP,sP,iP;function cP(e,t){return[t,e]}function lP(e){const t=tl(e);return ol(Math.ceil(t/4))}function uP(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function hP(e,t){const n=e;let r,o,a,s,i,c,l,u,h,d;return 2===Ol().getNumber("WEBGL_VERSION")?(r=n.R32F,o=n.R16F,a=n.RGBA16F,s=n.RGBA32F,i=n.RED,l=4,u=1,h=n.HALF_FLOAT,d=n.FLOAT):(r=e.RGBA,o=e.RGBA,a=e.RGBA,s=n.RGBA,i=e.RGBA,l=4,u=4,h=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT),c=e.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:s,textureFormatFloat:i,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:d}}function dP(e,t){const n=t();return Ol().getBool("DEBUG")&&function(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(aP||(aP={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(sP||(sP={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(iP||(iP={}));function pP(e){return!!(Ol().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function fP(e,t){return SP(e,(()=>e.getExtension(t)),'Extension "'+t+'" not supported on this browser.')}function mP(e,t){const n=SP(e,(()=>e.createShader(e.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(dP(e,(()=>e.shaderSource(n,t))),dP(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){const n=gP.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);const r=+n[1],o=e.split("\n"),a=o.length.toString().length+2,s=o.map(((e,t)=>al((t+1).toString(),a)+e));let i=0;for(let h=0;h<s.length;h++)i=Math.max(s[h].length,i);const c=s.slice(0,r-1),l=s.slice(r-1,r),u=s.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(al(l[0],i)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const gP=/ERROR: [0-9]+:([0-9]+):/g;function yP(e,t){if(dP(e,(()=>e.validateProgram(t))),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function bP(e,t,n,r,o,a,s){const i=e.getAttribLocation(t,n);return-1!==i&&(dP(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,r))),dP(e,(()=>e.vertexAttribPointer(i,o,e.FLOAT,!1,a,s))),dP(e,(()=>e.enableVertexAttribArray(i))),!0)}function vP(e,t,n,r){dP(e,(()=>function(e,t,n){_P(e,n),dP(e,(()=>e.activeTexture(e.TEXTURE0+n))),dP(e,(()=>e.bindTexture(e.TEXTURE_2D,t)))}(e,t,r))),dP(e,(()=>e.uniform1i(n,r)))}function wP(e,t,n){dP(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,n))),dP(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)))}function xP(e,t){dP(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,t))),dP(e,(()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)))}function kP(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function SP(e,t,n){const r=dP(e,(()=>t()));if(null==r)throw new Error(n);return r}function _P(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const e="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(e,"."))}}function CP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return tl(e.slice(0,e.length-t))}function IP(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function TP(e){let t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[CP(e),...IP(e)]),t}function NP(e){return e%2===0}function EP(e,t){if(nl(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){const n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(NP(n)&&NP(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&NP(e[0])&&NP(t[0])}let AP,RP;function OP(e,t){return null!=e.getExtension(t)}function MP(e){try{if(null!=oP(e))return!0}catch(F2){return console.log("Error when getting WebGL context: ",F2),!1}return!1}function PP(e){if(0===e)return!1;const t=oP(e);if(1!==e){if(OP(t,"EXT_color_buffer_float"))return DP(t);const e="EXT_color_buffer_half_float";if(OP(t,e)){const n=t.getExtension(e);return function(e,t){const n=hP(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const o=1,a=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,o,a,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(s),i}(t,n)}return!1}if(!OP(t,"OES_texture_float"))return!1;if(!OP(t,"WEBGL_color_buffer_float"))return!1;return DP(t)}function DP(e){const t=hP(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function FP(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>{null!=e&&Jc("complex64"!==e.dtype,(()=>"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."))}))}const LP=Ol();function zP(){let e,t,n,r,o,a,s,i,c,l;return 2===Ol().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",a="outputColor",s="out vec4 outputColor;",i="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",s="",i="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:s,defineSpecialNaN:i,defineSpecialInf:c,defineRound:l}}function BP(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index";const r=wl(t);return r.map(((t,o)=>{const a="int ".concat(e[o]," = ").concat(n," / ").concat(t),s=o===r.length-1?"int ".concat(e[o+1]," = ").concat(n," - ").concat(e[o]," * ").concat(t):"index -= ".concat(e[o]," * ").concat(t);return"".concat(a,"; ").concat(s,";")})).join("")}function qP(e){const t=wl(e).map((e=>e.toString()));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}LP.registerFlag("HAS_WEBGL",(()=>LP.getNumber("WEBGL_VERSION")>0)),LP.registerFlag("WEBGL_VERSION",(()=>MP(2)?2:MP(1)?1:0)),LP.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),LP.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===LP.get("WEBGL_VERSION"))),LP.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),LP.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),LP.registerFlag("WEBGL_PACK",(()=>LP.getBool("HAS_WEBGL"))),LP.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_PACK_CLIP",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>!1)),LP.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_PACK_REDUCE",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_LAZILY_UNPACK",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_CONV_IM2COL",(()=>LP.getBool("WEBGL_PACK"))),LP.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>function(e){if(null==AP){const t=oP(e);AP=t.getParameter(t.MAX_TEXTURE_SIZE)}return AP}(LP.getNumber("WEBGL_VERSION")))),LP.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>function(e){if(null==RP){const t=oP(e);RP=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,RP)}(LP.getNumber("WEBGL_VERSION")))),LP.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const e=LP.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;let t;const n=oP(e);return t=OP(n,"EXT_disjoint_timer_query_webgl2")&&2===e?2:OP(n,"EXT_disjoint_timer_query")?1:0,t}(e)})),LP.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>LP.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!vp())),LP.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>function(e){if(0===e)return!1;const t=oP(e);if(1===e){if(!OP(t,"OES_texture_float"))return!1}else if(!OP(t,"EXT_color_buffer_float"))return!1;return DP(t)}(LP.getNumber("WEBGL_VERSION")))),LP.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!LP.getBool("WEBGL_FORCE_F16_TEXTURES")&&LP.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),LP.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>PP(LP.getNumber("WEBGL_VERSION")))),LP.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>{return 2===(e=LP.getNumber("WEBGL_VERSION"))&&null!=oP(e).fenceSync;var e})),LP.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>LP.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0)),LP.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(e=>{if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}));const WP="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";class jP{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=aP.DENSE;const t=lP(e),n=zP();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(BP(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(t[0],", ").concat(t[1],"));\n        int index = 4 * (resTexRC.x * ").concat(t[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")}}class VP{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=aP.DENSE;const t=lP(e),n=zP();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(BP(["r","c","d"],e),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(t[0],", ").concat(t[1],"));\n        int index = 4 * (resTexRC.x * ").concat(t[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")}}class UP{constructor(e){this.variableNames=["A"],this.outTexUsage=sP.DOWNLOAD;const t=zP();this.outputShape=e,this.userCode="\n      ".concat(WP,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class GP{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=sP.DOWNLOAD;const t=zP();this.outputShape=e,this.userCode="\n      ".concat(WP,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(t.output," = encode_float(x);\n      }\n    ")}}class HP{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.variableNames=["A"];const r=zP(),[o,a]=t;this.outputShape=e;let s="result";n&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(qP(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(a,";\n        int c = imod(flatIndex, ").concat(a,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(a,".0, ").concat(o,".0);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(s,", 0., 0., 0.);\n      }\n    ")}}class KP{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const r=zP(),[o,a]=t;this.outputShape=e;let s="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let t=0;t<=1;t++){const n=2*c+t;s+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(t," < ").concat(e[2],") {\n            localCoords[2] += ").concat(t,";\n            if(localCoords[1] + ").concat(c," < ").concat(e[1],") {\n              localCoords[1] += ").concat(c,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(a,";\n              c = imod(flatIndex, ").concat(a,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(a,".0, ").concat(o,".0);\n              values = ").concat(r.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(n,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(n,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(n,"] = values[2];\n              } else {\n                result[").concat(n,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(qP(e),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(s,"\n\n        ").concat(r.output," = ").concat(i,";\n      }\n    ")}}function XP(e){const t=zP();return function(e,t){const n=SP(e,(()=>e.createShader(e.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(dP(e,(()=>e.shaderSource(n,t))),dP(e,(()=>e.compileShader(n))),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function QP(e){return function(e,t){const n=SP(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return dP(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),dP(e,(()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function YP(e){return function(e,t){const n=SP(e,(()=>e.createBuffer()),"Unable to create WebGLBuffer");return dP(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n))),dP(e,(()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW))),n}(e,new Uint16Array([0,1,2,2,1,3]))}function JP(e,t,n,r,o,a){!function(e,t){const n=Ol().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const n="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(e>n||t>n){const r="[".concat(e,"x").concat(t,"]"),o="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}(t,n);const s=function(e){return SP(e,(()=>e.createTexture()),"Unable to create WebGLTexture.")}(e),i=e.TEXTURE_2D;return dP(e,(()=>e.bindTexture(i,s))),dP(e,(()=>e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE))),dP(e,(()=>e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))),dP(e,(()=>e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST))),dP(e,(()=>e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST))),dP(e,(()=>e.texImage2D(i,0,r,t,n,0,o,a,null))),dP(e,(()=>e.bindTexture(e.TEXTURE_2D,null))),s}function ZP(e){return e.internalFormatFloat}function $P(e){return e.internalFormatHalfFloat}function eD(e){return e.downloadTextureFormat}function tD(e){return e.internalFormatPackedFloat}function nD(e){return e.internalFormatPackedHalfFloat}function rD(e,t,n,r,o,a,s,i){const c=e,l=new Float32Array(function(e,t){const[n,r]=uP(e,t);return n*r*4}(a,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}class oD{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const t=Ol().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,function(e,t){nP[e]=t}(t,e)):this.gl=oP(t);let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(1===Ol().getNumber("WEBGL_VERSION")){const e="OES_texture_float",t="OES_texture_half_float";if(this.textureFloatExtension=fP(this.gl,e),OP(this.gl,t))this.textureHalfFloatExtension=fP(this.gl,t);else if(Ol().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),OP(this.gl,r))this.colorBufferHalfFloatExtension=fP(this.gl,r);else if(Ol().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",OP(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!OP(this.gl,r))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(r)}this.vertexBuffer=QP(this.gl),this.indexBuffer=YP(this.gl),this.framebuffer=function(e){return SP(e,(()=>e.createFramebuffer()),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=hP(this.gl,this.textureHalfFloatExtension)}get debug(){return Ol().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;dP(e,(()=>e.finish())),dP(e,(()=>e.bindFramebuffer(e.FRAMEBUFFER,null))),dP(e,(()=>e.deleteFramebuffer(this.framebuffer))),dP(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,null))),dP(e,(()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null))),dP(e,(()=>e.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[o,a]=cP(t,n);return JP(e,o,a,ZP(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[o,a]=cP(t,n);return JP(e,o,a,$P(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[o,a]=cP(t,n);return JP(e,o,a,eD(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),function(e,t,n){dP(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),n.data instanceof Uint8Array?dP(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data))):dP(e,(()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n))),dP(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,o,a){let s,i,c;dP(e,(()=>e.bindTexture(e.TEXTURE_2D,t))),o instanceof Uint8Array?(s=new Uint8Array(n*r*4),i=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(n*r*4),i=e.FLOAT,c=a.internalFormatPackedFloat),s.set(o),dP(e,(()=>e.texImage2D(e.TEXTURE_2D,0,c,n,r,0,e.RGBA,i,s))),dP(e,(()=>e.bindTexture(e.TEXTURE_2D,null)))}(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[o,a]=uP(t,n);return JP(e,o,a,nD(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),function(e,t,n,r){const[o,a]=uP(t,n);return JP(e,o,a,tD(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(xP(this.gl,this.framebuffer),this.outputTexture=null),dP(this.gl,(()=>this.gl.deleteTexture(e)))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n,r){const[o,a]=cP(t,n),s=new Uint8Array(t*n*4);return dP(e,(()=>e.readPixels(0,0,o,a,r.downloadTextureFormat,e.UNSIGNED_BYTE,s))),new Float32Array(s.buffer)}(this.gl,t,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(e,t,n,r,o,a){return rD(this.gl,e,0,0,0,o,a,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return function(e,t,n){const r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);const r=function(e,t,n){const r=e.createBuffer();dP(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,r)));const o=16*t*n;return dP(e,(()=>e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ))),dP(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0))),dP(e,(()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null))),r}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Ol().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const e=r.clientWaitSync(o,0,0);return e===r.ALREADY_SIGNALED||e===r.CONDITION_SATISFIED},t=o}else Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,(()=>function(e,t,n){const r=new Float32Array(t*n*4);return dP(e,(()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r))),r}(this.gl,t,n)))}createProgram(e){this.throwIfDisposed();const t=this.gl,n=mP(t,e),r=XP(t),o=function(e){return SP(e,(()=>e.createProgram()),"Unable to create WebGLProgram.")}(t);return dP(t,(()=>t.attachShader(o,r))),dP(t,(()=>t.attachShader(o,n))),function(e,t){if(dP(e,(()=>e.linkProgram(t))),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,o),this.debug&&yP(t,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=function(e,t,n){return dP(e,(()=>e.bindBuffer(e.ARRAY_BUFFER,n))),bP(e,t,"clipSpacePos",n,3,20,0)&&bP(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),o}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&dP(this.gl,(()=>this.gl.deleteProgram(e)))}setProgram(e){this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&yP(this.gl,this.program),dP(this.gl,(()=>this.gl.useProgram(e)))}getUniformLocation(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return SP(e,(()=>e.getUniformLocation(t,n)),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),dP(this.gl,(()=>this.gl.getAttribLocation(e,t)))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),vP(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();const[r,o]=uP(t,n);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&yP(this.gl,this.program),kP(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),dP(e,(()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),dP(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=fP(this.gl,2===Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(2===Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const e=this.gl,t=this.getQueryTimerExtensionWebGL2();return void e.endQuery(t.TIME_ELAPSED_EXT)}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await sl((()=>this.disposed||this.isQueryAvailable(e,Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(e,Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(0===t)return null;if(2===t){const t=this.gl;return t.getQueryParameter(e,t.QUERY_RESULT)/1e6}{const t=this.getQueryTimerExtensionWebGL1();return t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(0===t)return!0;if(2===t){const t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const t=this.getQueryTimerExtensionWebGL1(),n=t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(t.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(e){return new Promise((t=>{this.addItemToPoll((()=>e.isFencePassed()),(()=>t()))}))}pollItems(){const e=function(e){let t=0;for(;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((e=>e.isDoneFn)));for(let t=0;t<=e;++t){const{resolveFn:e}=this.itemsToPoll[t];e()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||sl((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(e){this.throwIfDisposed(),wP(this.gl,e,this.framebuffer),this.debug&&kP(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(wP(this.gl,this.outputTexture,this.framebuffer),this.debug&&kP(this.gl)):xP(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();const r=this.gl;wP(r,e,this.framebuffer),this.debug&&kP(r),this.outputTexture=e,dP(r,(()=>r.viewport(0,0,t,n))),dP(r,(()=>r.scissor(0,0,t,n)))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),dP(this.gl,(()=>this.gl.scissor(e,t,n,r)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}const{getBroadcastDims:aD}=n;function sD(e,t,n,r){const o=[];e.forEach((e=>{const t=tl(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(o.push("uniform sampler2D ".concat(e.name,";")),o.push("uniform int offset".concat(e.name,";")))}));const a=o.join("\n"),s=e.map((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";r+=n?cD(e):iD(e);const o=e.shapeInfo.logicalShape,a=t.logicalShape;o.length<=a.length&&(r+=n?function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,i=aD(e.shapeInfo.logicalShape,t.logicalShape),c=mD(s),l=s-a;let u;const h=["x","y","z","w","u","v"];u=0===a?"":s<2&&i.length>=1?"coords = 0;":i.map((e=>"coords.".concat(h[e+l]," = 0;"))).join("\n");let d="";d=s<2&&a>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>"coords.".concat(h[t+l]))).join(", ");let p="return outputValue;";const f=1===tl(e.shapeInfo.logicalShape),m=tl(t.logicalShape),g=1===m;if(1!==a||f||g){if(f&&!g)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(i.length){const e=a-2,t=a-1;i.indexOf(e)>-1&&i.indexOf(t)>-1?p="return vec4(outputValue.x);":i.indexOf(e)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(t)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(u,"\n      vec4 outputValue = get").concat(r,"(").concat(d,");\n      ").concat(p,"\n    }\n  ")}(e,t):function(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=t.texShape,s=e.shapeInfo.texShape,i=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===c&&null==e.shapeInfo.flatOffset&&nl(s,a))return"\n      float ".concat(o,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");const l=mD(c),u=aD(e.shapeInfo.logicalShape,t.logicalShape),h=c-i;let d;const p=["x","y","z","w","u","v"];d=0===i?"":c<2&&u.length>=1?"coords = 0;":u.map((e=>"coords.".concat(p[e+h]," = 0;"))).join("\n");let f="";f=c<2&&i>0?"coords":e.shapeInfo.logicalShape.map(((e,t)=>"coords.".concat(p[t+h]))).join(", ");return"\n    float ".concat(o,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(d,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t));return r}(e,t,r))).join("\n"),i=t.texShape,c=zP(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c);let u,h,d=function(e){const t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(lD,"\n    ").concat(uD,"\n    ").concat(hD,"\n  ");return t}(c);t.isPacked?(u=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===n[0])return"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    ");if(1===n[1])return"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    ");return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(nl(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");const r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),o=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(o,";\n      index -= b * ").concat(o,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){const n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2);let a=o,s="",i="b, r, c";for(let c=2;c<e.length-1;c++)a*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(a,";\n      index -= b").concat(c," * ").concat(a,";\n    ")+s,i="b".concat(c,", ")+i;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(o,";\n      index -= b * ").concat(o,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(i,");\n    }\n  ")}(e,t)}}(t.logicalShape,i),h=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(u=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){if(1===t[0])return"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){if(nl(e,t))return"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){const n=BP(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){const n=BP(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){const n=BP(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){const n=BP(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,i),h=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),r&&(d+=dD);return[d,l,h,a,u,s,n].join("\n")}function iD(e){const t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");const[r,o]=e.shapeInfo.texShape;if(1===r&&1===o)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");const[a,s]=e.shapeInfo.texShape,i=pD(t);return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(s,", ").concat(i,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 1:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(fD(e),"\n      }\n    ");const r=e.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");const s=pD(t);if(1===a)return"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(o,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");if(1===o)return"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(a,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");return"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(a,", index + ").concat(s,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&nl(t,o)){const e=o[0],t=o[1];return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(t,".0, ").concat(e,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}const{newShape:a,keptDims:s}=ll(t),i=a;if(i.length<t.length){const t=gD(e,i),n=["row","col"];return"\n      ".concat(iD(t),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(yD(n,s),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(t[1],", 1)));\n        ").concat(fD(e),"\n      }\n    ");const c=o[0],l=o[1],u=pD(n);if(1===l)return"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(u,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(c,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");if(1===c)return"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(u,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(l,".0, 0.5);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(t[1]," + col + ").concat(u,";\n    vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", index);\n    return sampleTexture(").concat(n,", uv);\n  }\n")}(e);case 3:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],a=t[2],{newShape:s,keptDims:i}=ll(t),c=s;if(c.length<t.length){const t=gD(e,c),n=["row","col","depth"];return"\n        ".concat(iD(t),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(yD(n,i),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(o,", ").concat(a,", 1)));\n        ").concat(fD(e),"\n      }\n    ");const l=e.shapeInfo.texShape,u=l[0],h=l[1],d=e.shapeInfo.flatOffset;if(h===o&&null==d)return"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(a,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(h,".0, ").concat(u,".0);\n          return sampleTexture(").concat(n,", uv);\n        }\n      ");if(h===a&&null==d)return"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(t[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(h,".0, ").concat(u,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");const p=pD(n);return"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(o," + col * ").concat(a," + depth + ").concat(p,";\n        vec2 uv = uvFromFlat(").concat(u,", ").concat(h,", index);\n        return sampleTexture(").concat(n,", uv);\n      }\n  ")}(e);case 4:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],a=t[2]*o,s=t[1]*a,{newShape:i,keptDims:c}=ll(t);if(i.length<t.length){const t=gD(e,i),n=["row","col","depth","depth2"];return"\n      ".concat(iD(t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(yD(n,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(a,", ").concat(o,", 1)));\n        ").concat(fD(e),"\n      }\n    ");const l=e.shapeInfo.flatOffset,u=e.shapeInfo.texShape,h=u[0],d=u[1];if(d===s&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(a,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(d,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(d===o&&null==l)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(t[1]*t[2],", ").concat(t[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(d,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const p=pD(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(a," +\n          depth * ").concat(o," + depth2;\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(d,", index + ").concat(p,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 5:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],a=t[3]*o,s=t[2]*a,i=t[1]*s,{newShape:c,keptDims:l}=ll(t);if(c.length<t.length){const t=gD(e,c),n=["row","col","depth","depth2","depth3"];return"\n      ".concat(iD(t),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(yD(n,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(i,", ").concat(s,", ").concat(a,", ").concat(o,")) +\n          depth3;\n        ").concat(fD(e),"\n      }\n    ");const u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===i&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(s,", ").concat(a,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(p===o&&null==u)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(p,".0, ").concat(d,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const f=pD(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(i," + col * ").concat(s," + depth * ").concat(a," +\n          depth2 * ").concat(o," + depth3 + ").concat(f,";\n      vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:o,keptDims:a}=ll(t);if(o.length<t.length){const t=gD(e,o),n=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(iD(t),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(yD(n,a),");\n      }\n    ")}const s=t[5],i=t[4]*s,c=t[3]*i,l=t[2]*c,u=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(u,", ").concat(l,", ").concat(c,", ").concat(i,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(fD(e),"\n      }\n    ");const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],f=d[1];if(f===u&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(l,", ").concat(c,", ").concat(i,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(f===s&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");const m=pD(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(l," + depth * ").concat(c," +\n          depth2 * ").concat(i," + depth3 * ").concat(s," + depth4 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(f,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function cD(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=zP();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=zP();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(a.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=o[0],s=o[1],i=zP();if(null!=o&&nl(t,o))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(a,".0);\n\n        return ").concat(i.texture2D,"(").concat(n,", uv);\n      }\n    ");const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=Math.ceil(t[1]/2);return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);case 3:return function(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0]){const n=[1,2],o=gD(e,t.slice(1)),a=["b","row","col"];return"\n        ".concat(cD(o),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(yD(a,n),");\n        }\n      ")}const s=a[0],i=a[1],c=Math.ceil(t[2]/2),l=c*Math.ceil(t[1]/2),u=zP();return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(s,", ").concat(i,", ").concat(l,", ").concat(c,", b, row, col);\n      return ").concat(u.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);default:return function(e){const t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,s=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],i=s[0],c=s[1],l=Math.ceil(t[n-1]/2);let u=l*Math.ceil(t[n-2]/2),h="int b, int row, int col",d="b * ".concat(u," + (row / 2) * ").concat(l," + (col / 2)");for(let f=2;f<n-1;f++)h="int b".concat(f,", ")+h,u*=t[n-f-1],d="b".concat(f," * ").concat(u," + ")+d;const p=zP();return"\n    vec4 ".concat(o,"(").concat(h,") {\n      int index = ").concat(d,";\n      int texR = index / ").concat(c,";\n      int texC = index - texR * ").concat(c,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(c,", ").concat(i,");\n      return ").concat(p.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e)}}const lD="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",uD="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",hD="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",dD="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function pD(e){return"offset".concat(e)}function fD(e){const t=e.name,n=tl(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function mD(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function gD(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function yD(e,t){return t.map((t=>e[t])).join(", ")}function bD(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach(((e,n)=>{const r=e.logicalShape,o=t[n],a=o.shape;if(!nl(r,a))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(a," must match"));if(e.isUniform&&o.isUniform)return;const s=e.texShape,i=o.isUniform?null:o.texData.texShape;if(!nl(s,i))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(i," must match"))}))}const{mx:vD,XI:wD,Nk:xD,YG:kD,hH:SD,sG:_D,uM:CD,vS:ID,GG:TD,rq:ND,WR:ED,GE:AD,px:RD,jC:OD,He:MD,hE:PD,BF:DD,Dk:FD,_B:LD,qy:zD,Zy:BD,dH:qD,HS:WD,eW:jD,dl:VD,Dw:UD,xT:GD,_X:HD,wz:KD}=r;function XD(e,t){return["x","y","z","w","u","v"].slice(0,t).map((t=>"".concat(e,".").concat(t)))}function QD(e,t){return 1===t?[e]:XD(e,t)}class YD{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;const t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=QD("rc",t),r=mD(t),o=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);let r="";for(let o=e-2;o<e;o++)r+="".concat(n[o]," >= ").concat(t[o]),o<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";const o=r.slice(-2);return"\n    int r = ".concat(o[0],";\n    int c = ").concat(o[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(t,e[e.length-1],e[e.length-2],n),s=function(e,t){const n=e.length,r=function(e,t){const n=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let a="".concat(0===r?"r":"rp1",", ").concat(0===o?"c":"cp1");for(let n=2;n<e;n++)a="".concat(t[t.length-1-n],",")+a;n.push(a)}return n}(n,t);if(1===n)return"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0");return"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(e,n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(o,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(a,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}}}class JD{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;let n="";for(let r=0;r<4;r++){let e="thisRC = rc;";r%2===1&&(e+="thisRC.z += 1;"),r>1&&(e+="thisRC.y += 1;"),n+="\n        ".concat(e,"\n        ").concat(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(r,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(r>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e){const t=BP(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t,"\n      return ivec3(r, c, d);\n    }\n  ")}(t),"\n      ").concat(qP(e),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(e[1],";\n        int cols = ").concat(e[2],";\n\n        ").concat(n,"\n\n        setOutput(result);\n      }\n    ")}}class ZD{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,t,n){const r=eF(t,n),o=tF(e,r,n);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const a=$D(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const e=this.freeTextures[o].shift();return this.usedTextures[o].push(e),e}let s;return r===iP.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===iP.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===iP.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===iP.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===iP.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(s),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),s}releaseTexture(e,t,n,r){if(null==this.freeTextures)return;const o=eF(n,r),a=tF(t,o,r);a in this.freeTextures||(this.freeTextures[a]=[]);const s=$D(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),i=Ol().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==i&&this._numBytesAllocated>i?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=s):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;const c=this.usedTextures[a],l=c.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(l,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const e in this.freeTextures)this.freeTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e)}));for(const e in this.usedTextures)this.usedTextures[e].forEach((e=>{this.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function $D(e,t,n,r,o){const a=function(e,t){switch(e){case iP.PACKED_2X2_FLOAT32:return tD(t);case iP.PACKED_2X2_FLOAT16:return nD(t);case iP.UNPACKED_FLOAT32:return ZP(t);case iP.UNPACKED_FLOAT16:return $P(t);case iP.PACKED_4X1_UNSIGNED_BYTE:return eD(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);let s;if(o){const[t,n]=uP(e[0],e[1]);s=t*n}else{const[t,n]=cP(e[0],e[1]);s=t*n}const i=function(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;throw new Error("Unknown internal format ".concat(t))}(n,a);return s*i}function eF(e,t){if(e===sP.UPLOAD)return iP.PACKED_2X2_FLOAT32;if(e===sP.RENDER||null==e)return function(e){return Ol().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?iP.PACKED_2X2_FLOAT32:iP.UNPACKED_FLOAT32:e?iP.PACKED_2X2_FLOAT16:iP.UNPACKED_FLOAT16}(t);if(e===sP.DOWNLOAD||e===sP.PIXELS)return iP.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function tF(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}class nF{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}const rF="if (isnan(x)) return x;",oF="return abs(x);";const aF=rF+"\n  return (x < 0.0) ? 0.0 : x;\n",sF=rF+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",iF="return x;";class cF{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")}}class lF{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;const t=e.length,n=QD("rc",t),r=mD(t),o=function(e,t){if(1===e)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),s=t<=1?"rc":"vec2(".concat(a.join(","),")");this.userCode="\n      void main() {\n        ".concat(r," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(o,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")}}const uF=ov,hF={};class dF extends Hc{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!Ol().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){const e=oP(Ol().getNumber("WEBGL_VERSION"));this.binaryCache=((t=Ol().getNumber("WEBGL_VERSION"))in hF||(hF[t]={}),hF[t]),this.gpgpu=new oD(e),this.canvas=e.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var t;this.textureManager=new ZD(this.gpgpu),this.numMBBeforeWarning=null==Ol().global.screen?1024:Ol().global.screen.height*Ol().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Gc(this,Kf())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(e,t,n){if((Ol().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ol().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:sP.UPLOAD,refCount:1,complexParentRefCount:0}),r}incRef(e){this.texData.get(e).refCount++}decRef(e){if(this.texData.has(e)){this.texData.get(e).refCount--}}decComplexRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.complexParentRefCount>0&&t.refCount--}}move(e,t,n,r){if(Ol().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:sP.UPLOAD,refCount:1,complexParentRefCount:0})}disposeIntermediateTensorInfo(e){const t=e.dataId;if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--,e.refCount<1&&this.disposeData(t)}}readSync(e){const t=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:o,slice:a,shape:s,isPacked:i}=t;if(null!=a){let t;t=i?new cF(s,iF):new nF(s,iF);const n=this.runWebGLProgram(t,[{dataId:e,shape:s,dtype:r}],r),o=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),o}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;const c=null!=this.activeTimers;let l,u;if(c&&(l=Kd()),"complex64"===r){u=jb(this.readSync(o.real.dataId),this.readSync(o.imag.dataId))}else u=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Kd()-l),this.convertAndCacheOnCPU(e,u)}async read(e){if(this.pendingRead.has(e)){const t=this.pendingRead.get(e);return new Promise((e=>t.push(e)))}const t=this.texData.get(e),{values:n,shape:r,slice:o,dtype:a,complexTensorInfos:s,isPacked:i}=t;if(null!=o){let t;t=i?new cF(r,iF):new nF(r,iF);const n=this.runWebGLProgram(t,[{dataId:e,shape:r,dtype:a}],a),o=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),o}if(null!=n)return this.convertAndCacheOnCPU(e);if(!Ol().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Ol().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c,l,u=null;if("complex64"!==a&&Ol().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const t=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(t.texture,...lP(r))}if(this.pendingRead.set(e,[]),"complex64"!==a&&await this.gpgpu.createAndWaitForFence(),"complex64"===a){const e=await Promise.all([this.read(s.real.dataId),this.read(s.imag.dataId)]);l=jb(e[0],e[1])}else if(null==u)l=this.getValuesFromTexture(e);else{const e=tl(r);l=this.gpgpu.downloadFloat32MatrixFromBuffer(u,e)}null!=c&&this.disposeIntermediateTensorInfo(c);const h=this.convertAndCacheOnCPU(e,l),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach((e=>e(h))),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),h}bufferSync(e){const t=this.readSync(e.dataId);let n=t;if("string"===e.dtype)try{n=t.map((e=>Qd(e)))}catch($Y){throw new Error("Failed to decode encoded string bytes into utf-8")}return pf(e.shape,e.dtype,n)}checkNumericalProblems(e){if(null!=e)for(let t=0;t<e.length;t++){const n=e[t];if(!pP(n)){if(Ol().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}getValuesFromTexture(e){const{shape:t,dtype:n,isPacked:r}=this.texData.get(e),o=tl(t);if(Ol().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(e),r=this.texData.get(n.dataId),a=this.gpgpu.downloadMatrixFromPackedTexture(r.texture,...lP(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(n),a}const a=Ol().getBool("WEBGL_PACK")&&!0===r,s=a?TP(t):t,i=a?new GP(s):new UP(s),c=this.runWebGLProgram(i,[{shape:s,dtype:n,dataId:e}],"float32"),l=this.texData.get(c.dataId),u=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(l.texture,l.texShape[0],l.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),u}async time(e){const t=this.activeTimers,n=[];let r=!1;null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const o=el(this.activeTimers.map((e=>e.query))).filter((e=>null!=e)),a=el(this.activeTimers.map((e=>e.name))).filter((e=>null!=e));this.activeTimers=t,r&&(this.programTimersStack=null);const s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const e=await Promise.all(o);s.kernelMs=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}(e),s.getExtraProfileInfo=()=>e.map(((e,t)=>({name:a[t],ms:e}))).map((e=>"".concat(e.name,": ").concat(e.ms))).join(", ")}else s.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,s}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Kd(),endMs:null}}endTimer(e){return Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Kd(),e)}async getQueryTime(e){if(Ol().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e){if(this.pendingDisposal.has(e))return;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(!this.texData.has(e))return;if(this.texData.get(e).complexParentRefCount>0)return void this.texData.get(e).refCount--;this.releaseGPUData(e);const{complexTensorInfos:t}=this.texData.get(e);null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}releaseGPUData(e){const{texture:t,dtype:n,texShape:r,usage:o,isPacked:a,slice:s}=this.texData.get(e),i=s&&s.origDataId||e,c=this.dataRefCount.get(i);c>1?this.dataRefCount.set(i,c-1):(this.dataRefCount.delete(i),null!=t&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(t,r,o,a)));const l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}getCPUBackend(){return Ol().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Kf().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128;const n=this.getCPUBackend();return Ol().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=n||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&e.every((e=>null==this.texData.get(e.dataId).texture&&tl(e.shape)<t))}getGPGPUContext(){return this.gpgpu}where(e){qb("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return uF(e.shape,t)}packedUnaryOp(e,t,n){const r=new cF(e.shape,t);return this.compileAndRun(r,[e],n)}abs(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){const t=qD(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Ol().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,oF,e.dtype);const t=new nF(e.shape,oF);return this.compileAndRun(t,[e])}makeTensorInfo(e,t,n){let r;if("string"===t&&null!=n&&n.length>0&&ml(n[0])){const o=n.map((e=>Xd(e)));r=this.write(o,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,n){const{dataId:r}=this.makeTensorInfo(e,t,n);return Kf().makeTensorFromDataId(r,e,t,this)}unpackTensor(e){const t=new lF(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new YD(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const n=[CP(e.shape),...IP(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[CP(t),...IP(t)],a=new JD(o,n),s=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}decode(e){const t=this.texData.get(e),{isPacked:n,shape:r,dtype:o}=t,a=TP(r);let s;s=n?new VP(a):new jP(a);return{dtype:o,shape:r,dataId:this.runWebGLProgram(s,[{shape:a,dtype:o,dataId:e}],o,null,!0).dataId}}runWebGLProgram(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(a.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===aP.DENSE){const t=lP(e.outputShape);s.texShape=t.map((e=>2*e))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===tl(a.shape))return s.values=ul(a.dtype,0),a;const i=[],c=t.map((t=>{if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&tl(t.shape)<=Ol().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!==!!e.packedInputs)t=n.isPacked?this.unpackTensor(t):this.packTensor(t),i.push(t),n=this.texData.get(t.dataId);else if(n.isPacked&&!EP(n.shape,t.shape)){const e=t,r=t.shape;t.shape=n.shape,t=this.packedReshape(t,r),i.push(t),n=this.texData.get(t.dataId),e.shape=r}return this.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(a.dataId);const l={shape:a.shape,texData:s,isUniform:!1},u=function(e,t,n){let r="";t.concat(n).forEach((e=>{const t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+="".concat(e.shape,"_").concat(n,"_").concat(t)}));const o=e.userCode;let a=e.constructor.name;return a+="_"+r+"_"+o,a}(e,c,l),h=this.getAndSaveBinary(u,(()=>function(e,t,n,r){const o=t.userCode,a=n.map(((e,n)=>{const r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=a.map((e=>e.shapeInfo)),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=sD(a,i,o,t.packedInputs),l=e.createProgram(c);let u=null;const h=e.getUniformLocation(l,"NAN",!1);1===Ol().getNumber("WEBGL_VERSION")&&(u=e.getUniformLocation(l,"INFINITY",!1));const d={};for(let p=0;p<t.variableNames.length;p++){const n=t.variableNames[p],r=!1;d[n]=e.getUniformLocation(l,n,r),d["offset".concat(n)]=e.getUniformLocation(l,"offset".concat(n),r)}return{program:t,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:s,outShapeInfo:i,infLoc:u,nanLoc:h}}(this.gpgpu,e,c,l))),d=null!=this.activeTimers;let p;if(d&&(p=this.startTimer()),function(e,t,n,r,o){bD(t.inShapeInfos,n),bD([t.outShapeInfo],[r]);const a=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,s[0],s[1]):e.setOutputMatrixTexture(a,s[0],s[1]),e.setProgram(t.webGLProgram),1===Ol().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(((n,r)=>{const o=t.program.variableNames[r],a=t.uniformLocations[o],s=t.uniformLocations["offset".concat(o)];if(null!=a)if(n.isUniform)if(tl(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{let t=n.uniformValues;t instanceof Float32Array||(t=new Float32Array(t)),e.gl.uniform1fv(a,t)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,h,c,l,r),i.forEach((e=>this.disposeIntermediateTensorInfo(e))),d&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!Ol().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){const e=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),e}return a}compileAndRun(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;const a=this.runWebGLProgram(e,t,n,r,o);return Kf().makeTensorFromDataId(a.dataId,a.shape,a.dtype)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!Ol().getBool("IS_TEST")){Object.keys(this.binaryCache).forEach((e=>{this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram),delete this.binaryCache[e]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Qf((()=>{if(!Ol().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Ol().getBool("DEBUG");Ol().set("DEBUG",!1);const t=this.abs(em(1e-8)).dataSync()[0];if(Ol().set("DEBUG",e),t>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(e){const t=this.texData.get(e),{shape:n,dtype:r,values:o,texture:a,usage:s,isPacked:i}=t;if(null!=a)return;const c=null!=this.activeTimers;let l;c&&(l=Kd());let u=t.texShape;if(null==u&&(u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ol().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map(((t,n)=>n>=e.length-2?Yc(e[n]):e[n])),1===e.length&&(e=[2,e[0]])),2!==e.length){const t=ll(e);e=t.newShape}let r=tl(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){const t=CP(e);let n=2,o=2;return e.length&&([n,o]=IP(e)),r=t*(n/2)*(o/2),ol(r).map((e=>2*e))}return ol(r)}(n,i),t.texShape=u),null!=o){const e=TP(n);let a,s=u[1],h=u[0];const d=o instanceof Uint8Array;i?([s,h]=uP(u[0],u[1]),a=new KP(e,[h,s],d)):a=new HP(e,[h,s],d);const p=this.makeTensorInfo([h,s],r);this.texData.get(p.dataId).usage=d?sP.PIXELS:sP.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),s,h,o);const f=!0,m=this.runWebGLProgram(a,[p],r,null,f),g=this.texData.get(m.dataId);t.texture=g.texture,t.texShape=g.texShape,t.isPacked=g.isPacked,t.usage=g.usage,this.disposeIntermediateTensorInfo(p),this.texData.delete(m.dataId),t.values=null,c&&(this.uploadWaitMs+=Kd()-l)}else{const e=this.acquireTexture(u,s,r,i);t.texture=e}}convertAndCacheOnCPU(e,t){const n=this.texData.get(e),{dtype:r}=n;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){const n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length);for(let t=0;t<n.length;++t)n[t]=Math.round(e[t]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}acquireTexture(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const e=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(e," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*fl(t)}}wp()&&Zf("webgl",(()=>new dF),2);const pF="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class fF{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=Ym(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")}}const mF="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n";class gF{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ym(t,n);const o=this.outputShape.length;let a="";if(r)if(0===o||1===tl(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const e=mD(o);if(a="\n          ".concat(e," coords = getOutputCoords();\n        "),1===o)a+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{const e=QD("coords",o);a+="\n            bool nextRowOutOfBounds =\n              (".concat(e[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(e[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(e,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(a,"\n\n        setOutput(result);\n      }\n    ")}}function yF(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const bF={kernelName:Ku,backendName:"webgl",kernelFunc:yF};function vF(e){const{inputs:t,backend:n}=e,{real:r,imag:o}=t,a=n.makeTensorInfo(r.shape,"complex64"),s=n.texData.get(a.dataId),i=yF({inputs:{x:r},backend:n});n.texData.get(i.dataId).complexParentRefCount++;const c=yF({inputs:{x:o},backend:n});return n.texData.get(c.dataId).complexParentRefCount++,s.complexTensorInfos={real:i,imag:c},a}const wF={kernelName:iu,backendName:"webgl",kernelFunc:vF},xF="return (a < 0.) ? b * a : a;",kF="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const SF={kernelName:$u,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{alpha:a}=r,s=n.makeTensorInfo([],"float32",Gd(a,"float32")),i=Ol().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gF(kF,o.shape,s.shape):new fF(xF,o.shape,s.shape),c=n.runWebGLProgram(i,[o,s],o.dtype);return n.disposeIntermediateTensorInfo(s),c}},_F="return (a < 0.) ? b * a : a;",CF="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";const IF={kernelName:Ph,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r,alpha:o}=t,a=Ol().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gF(CF,r.shape,o.shape):new fF(_F,r.shape,o.shape);return n.runWebGLProgram(a,[r,o],r.dtype)}},TF="if (isnan(x)) return x;";function NF(e){let{opSnippet:t,packedOpSnippet:n,cpuKernelImpl:r,dtype:o}=e;return e=>{let{inputs:a,backend:s}=e;const{x:i}=a,c=s,l=o||i.dtype;if(c.shouldExecuteOnCPU([i])&&null!=r){const e=c.texData.get(i.dataId),t=r(e.values,l);return c.makeTensorInfo(i.shape,l,t)}let u;return u=Ol().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new cF(i.shape,n):new nF(i.shape,t),c.runWebGLProgram(u,[i],l)}}function EF(e){let{opSnippet:t,packedOpSnippet:n,checkOutOfBounds:r=!1,supportsComplex:o=!1,cpuKernelImpl:a,dtype:s}=e;return e=>{let{inputs:i,backend:c}=e;const{a:l,b:u}=i,h=c;if(o&&"complex64"===l.dtype){const e=h.texData.get(l.dataId),n=h.texData.get(u.dataId),[r,o]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,r]=e,o={dataId:n.dataId,dtype:n.dtype,shape:l.shape},a={dataId:r.dataId,dtype:r.dtype,shape:u.shape},s=new fF(t,l.shape,u.shape);return h.runWebGLProgram(s,[o,a],cp(n.dtype,r.dtype))})),a=vF({inputs:{real:r,imag:o},backend:h});return h.disposeIntermediateTensorInfo(r),h.disposeIntermediateTensorInfo(o),a}const d=s||cp(l.dtype,u.dtype);if(h.shouldExecuteOnCPU([l,u])&&null!=a){const e=h.texData.get(l.dataId),t=h.texData.get(u.dataId),[n,r]=a(l.shape,u.shape,e.values,t.values,d),o=h.makeTensorInfo(r,d);return h.texData.get(o.dataId).values=n,o}let p;return p=Ol().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new gF(n,l.shape,u.shape,r):new fF(t,l.shape,u.shape),h.runWebGLProgram(p,[l,u],d)}}function AF(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":aF;if("elu"===e)return t?"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n":"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n":sF;if("prelu"===e)return t?CF:_F;if("leakyrelu"===e)return t?kF:xF;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}class RF{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;const l=r?e[1]:e[2],u=Math.ceil(l/2),h=r?"i * 2, rc.y":"rc.y, i * 2",d=o?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";s&&(m=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");const y=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<t[0]?b="int(min(float(rc.x), ".concat(e[0]-1,".))"):t[0]<e[0]&&(v="int(min(float(rc.x), ".concat(t[0]-1,".))")),this.userCode="\n      ".concat(m,"\n\n      const float sharedDimension = ").concat(u,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(u,"; i++) {\n          int batchA = ").concat(b,";\n          int batchB = ").concat(v,";\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(p[0]," * ").concat(f[0],");\n          result += (").concat(p[1]," * ").concat(f[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")}}const OF="return areal * breal - aimag * bimag;",MF="return areal * bimag + aimag * breal;";class PF{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ym(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(e,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")}}const DF="return a * b;";function FF(e){const{inputs:t,backend:n}=e,{a:r,b:o}=t,a=cp(r.dtype,o.dtype);if("complex64"===r.dtype){const e=n.texData.get(r.dataId),t=n.texData.get(o.dataId),a=new PF(OF,r.shape,o.shape),s=new PF(MF,r.shape,o.shape),i=[{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:r.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:o.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:o.shape}],c=n.runWebGLProgram(a,i,"float32"),l=n.runWebGLProgram(s,i,"float32"),u=vF({inputs:{real:c,imag:l},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),u}if(n.shouldExecuteOnCPU([r,o])){const e=n.texData.get(r.dataId),t=n.texData.get(o.dataId),[s,i]=DD(r.shape,o.shape,e.values,t.values,a),c=n.makeTensorInfo(i,a);return n.texData.get(c.dataId).values=s,c}let s;return s=Ol().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gF(DF,r.shape,o.shape):new fF(DF,r.shape,o.shape),n.runWebGLProgram(s,[r,o],a)}const LF={kernelName:Sh,backendName:"webgl",kernelFunc:FF};function zF(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{shape:a}=r,s=n,i=tl(o.shape),c=il(a,i),l=tl(c);Jc(i===l,(()=>"The new shape (".concat(c,") has ").concat(l," elements and the old ")+"shape (".concat(o.shape,") has ").concat(i," elements. The new shape and old ")+"shape must have the same number of elements."));const u=s.texData.get(o.dataId);return!u.isPacked||EP(o.shape,c)||null!==u.texture&&EP(u.shape,c)?(s.incRef(o.dataId),{dataId:o.dataId,shape:c,dtype:o.dtype}):function(e,t,n){const r=[CP(e.shape),...IP(e.shape)],o={dtype:e.dtype,shape:r,dataId:e.dataId},a=[CP(t),...IP(t)],s=new JD(a,r),i=n.runWebGLProgram(s,[o],e.dtype,null,!0);return{dataId:i.dataId,shape:t,dtype:i.dtype}}(o,c,s)}const BF={kernelName:qh,backendName:"webgl",kernelFunc:zF};class qF{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:o,outSize:a}=e;this.outputShape=[r,a];const s=4*Math.floor(n/4),i=n%4;let c="sumValue += dot(values, ones);";if(null!=t){const e=1/t;c="sumValue += dot(values * ".concat(rl(e)?e.toPrecision(2):e,", ones);")}let l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(l,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===i,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===i,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===i,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")}}class WF{constructor(e,t){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:o,outSize:a}=e;this.outputShape=[r,a];let s="0.0",i="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",i="min"):"max"===t&&(s="-1.0 / 1e-20",i="max");let c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");const l=4*Math.floor(n/4),u=n%4;let h="\n      if (".concat("sum"===t,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===t,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(i,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===t?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let p="";o%n>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(n,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===u,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}}function jF(e,t,n,r){const o=function(e){const t=[];for(;0===t.length||1!==t[t.length-1].outSize;){const n=t.length?t[t.length-1].outSize:e[1],r=xb(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape);let a=e;for(let s=0;s<o.length;s++){const{inSize:i,windowSize:c,outSize:l}=o[s];let u,h;u="mean"===n?0===s?new qF({windowSize:c,inSize:i,batchSize:e.shape[0],outSize:l},i):new qF({windowSize:c,inSize:i,batchSize:e.shape[0],outSize:l}):new WF({windowSize:c,inSize:i,batchSize:e.shape[0],outSize:l},n),h=a,a=r.runWebGLProgram(u,[a],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return a}class VF{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;const r=mD(this.rank),o=function(e){const t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      ".concat(r," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}}class UF{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let l=0;l<n.length;l++)n[l]=e[t[l]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));const r=mD(this.rank),o=XD("rc",this.rank),a=new Array(this.rank);for(let l=0;l<t.length;l++)a[t[l]]=o[l];const s="vec2(".concat(a.slice(-2).join(),")"),i="++".concat(o[this.rank-1]," < ").concat(n[this.rank-1]),c="getChannel(getA(".concat(a.join(),"), ").concat(s,")");this.userCode="\n    void main() {\n      ".concat(r," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(c,";\n      if(").concat(i,") {\n        result[1] = ").concat(c,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(n[this.rank-2],") {\n        result[2] = ").concat(c,";\n        if(").concat(i,") {\n          result[3] = ").concat(c,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}}function GF(e,t,n){const r=Ol().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new UF(e.shape,t):new VF(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function HF(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r;return function(e,t,n,r){const o=t,a=e.shape.length,s=cl(o,e.shape);let i=s;const c=Cg(i,a),l=null!=c;let u=e;l&&(u=GF(e,c,r),i=Tg(i.length,a)),_g("sum",i,a);const[h,d]=kg(u.shape,i);let p=h;n&&(p=Sg(h,s));const f=tl(d),m=zF({inputs:{x:u},attrs:{shape:[tl(e.shape)/f,f]},backend:r}),g=jF(m,lp(e.dtype),"sum",r),y=zF({inputs:{x:g},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),l&&r.disposeIntermediateTensorInfo(u),y}(o,a,s,n)}const KF={kernelName:ad,backendName:"webgl",kernelFunc:HF};function XF(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{perm:a}=r,s=n,i=o.shape.length,c=new Array(i);for(let u=0;u<c.length;u++)c[u]=o.shape[a[u]];let l;if(s.shouldExecuteOnCPU([o])){const e=s.texData.get(o.dataId).values,t=HD(e,o.shape,o.dtype,a,c);l=s.makeTensorInfo(c,o.dtype);s.texData.get(l.dataId).values=t}else l=GF(o,a,s);return l}const QF={kernelName:bd,backendName:"webgl",kernelFunc:XF};function YF(e){let{a:t,b:n,transposeA:r,transposeB:o,backend:a,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:c=0,activation:l=null}=e;const u=t.shape.length,h=n.shape.length,d=r?t.shape[u-2]:t.shape[u-1],p=o?n.shape[h-1]:n.shape[h-2],f=r?t.shape[u-1]:t.shape[u-2],m=o?n.shape[h-2]:n.shape[h-1],g=t.shape.slice(0,-2),y=n.shape.slice(0,-2),b=tl(g),v=tl(y);Jc(u>=2&&h>=2&&(b===v||1===b||1===v),(()=>"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input "+"batch dimensions of (".concat(g,") and (").concat(y,").")));const w=(b>v?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([f,m]);Jc(d===p,(()=>"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(p,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(o," must match.")));const x=r?[b,d,f]:[b,f,d],k=o?[v,m,p]:[v,p,m],S=zF({inputs:{x:t},backend:a,attrs:{shape:x}}),_=zF({inputs:{x:n},backend:a,attrs:{shape:k}}),C=[S,_],I=Math.max(b,v),T=r?S.shape[1]:S.shape[2],N=null!=s,E=null!=i,A="leakyrelu"===l,R=null!=l?AF(l,!0):null;let O;if((1===f||1===m)&&T>1e3&&!1===(N||E||A||null!=R)){let e=S,t=_;r&&(e=XF({inputs:{x:S},backend:a,attrs:{perm:[0,2,1]}}),C.push(e)),o&&(t=XF({inputs:{x:_},backend:a,attrs:{perm:[0,2,1]}}),C.push(t));const n=1===m;let s=e;1!==m&&(s=zF({inputs:{x:e},backend:a,attrs:{shape:[I,T,1]}}),C.push(s));const i=1===m?2:1;let c=t;n&&(c=zF({inputs:{x:t},backend:a,attrs:{shape:[I,1,T]}}),C.push(c));const l=FF({inputs:{a:s,b:c},backend:a});O=HF({inputs:{x:l},backend:a,attrs:{axis:i,keepDims:!0}}),C.push(l)}else{const e=cp(t.dtype,n.dtype),l=new RF(x,k,[I,f,m],r,o,N,R,E,A),u=[S,_];if(null!=s&&u.push(s),E&&u.push(i),A){const e=a.makeTensorInfo([],"float32",Gd(c,"float32"));u.push(e),C.push(e)}O=a.runWebGLProgram(l,u,e)}const M=zF({inputs:{x:O},backend:a,attrs:{shape:w}});C.push(O);for(const P of C)a.disposeIntermediateTensorInfo(P);return M}const JF={kernelName:Id,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:o,b:a,bias:s,preluActivationWeights:i}=t,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:h}=r;return YF({a:o,b:a,transposeA:c,transposeB:l,backend:n,bias:s,preluActivationWeights:i,leakyreluAlpha:h,activation:u})}},ZF="return abs(x);";const $F={kernelName:Ll,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&"complex64"!==r.dtype){const e=n.texData.get(r.dataId),t=qD(e.values);return n.makeTensorInfo(r.shape,r.dtype,t)}let o;return o=Ol().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new cF(r.shape,ZF):new nF(r.shape,ZF),n.runWebGLProgram(o,[r],r.dtype)}},eL=NF({opSnippet:rF+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),tL={kernelName:zl,backendName:"webgl",kernelFunc:eL},nL=NF({opSnippet:rF+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),rL={kernelName:Bl,backendName:"webgl",kernelFunc:nL},oL="return a + b;",aL=EF({opSnippet:oL,packedOpSnippet:oL,supportsComplex:!0,cpuKernelImpl:vD}),sL={kernelName:ql,backendName:"webgl",kernelFunc:aL};class iL{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(((e,t)=>"T".concat(t)));const n=[];this.variableNames.forEach((e=>{n.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));const r=this.variableNames.map((e=>"v".concat(e))).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        float result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}class cL{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(((e,t)=>"T".concat(t)));const n=[];this.variableNames.forEach((e=>{n.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));const r=this.variableNames.map((e=>"v".concat(e))).join(" + ");this.userCode="\n      void main() {\n        ".concat(n.join("\n        "),"\n\n        vec4 result = ").concat(r,";\n        setOutput(result);\n      }\n    ")}}const lL={kernelName:Wl,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,o=n;if(1===o.length)return yF({inputs:{x:o[0]},backend:r});if(o.length>Ol().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(o.length/2),n=e({inputs:o.slice(0,t),backend:r}),a=e({inputs:o.slice(t),backend:r});return e({inputs:[n,a],backend:r})}const a=o.map((e=>e.dtype)).reduce(((e,t)=>cp(e,t))),s=o.map((e=>e.shape)),i=Ol().getBool("WEBGL_PACK")?new cL(o[0].shape,s):new iL(o[0].shape,s);return r.runWebGLProgram(i,o,a)}};const uL={kernelName:jl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r,i=o.shape.length,c=cl(a,o.shape);let l=c;const u=Cg(l,i);let h=o;null!=u&&(h=XF({inputs:{x:o},backend:n,attrs:{perm:u}}),l=Tg(l.length,i)),_g("all",l,i);const[d,p]=kg(h.shape,l),f=zF({inputs:{x:h},backend:n,attrs:{shape:[-1,tl(p)]}}),m=jF(f,f.dtype,"all",n);let g;if(s){g=zF({inputs:{x:m},backend:n,attrs:{shape:Sg(d,c)}})}else g=zF({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(h),g}};const hL={kernelName:Vl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r,i=o.shape.length,c=cl(a,o.shape);let l=c;const u=Cg(l,i);let h=o;null!=u&&(h=XF({inputs:{x:o},backend:n,attrs:{perm:u}}),l=Tg(l.length,i)),_g("any",l,i);const[d,p]=kg(h.shape,l),f=zF({inputs:{x:h},backend:n,attrs:{shape:[-1,tl(p)]}}),m=jF(f,f.dtype,"any",n);let g;if(s){g=zF({inputs:{x:m},backend:n,attrs:{shape:Sg(d,c)}})}else g=zF({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(h),g}};class dL{constructor(e,t,n){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:a}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];const s="max"===t?">":"<",i=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(r,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          int inIdx = ").concat(i,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")}}class pL{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Jc(e.length>2,(()=>"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")));const o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");const s=this.outputShape,i=s.length,c=mD(i),l=QD("coords",i);let u,h;if(1===a){h=i+1;const e=mD(h);u="\n        ".concat(e," sourceLocR = ").concat(e,"(").concat(l.join(),", 0);\n        ++").concat(l[i-1],";\n        ").concat(e," sourceLocG = ").concat(e,"(").concat(l.join(),", 0);\n        ++").concat(l[i-2],";\n        ").concat(e," sourceLocA = ").concat(e,"(").concat(l.join(),", 0);\n        --").concat(l[i-1],";\n        ").concat(e," sourceLocB = ").concat(e,"(").concat(l.join(),", 0);\n        --").concat(l[i-2],";")}else h=i,u="\n        ".concat(c," sourceLocR = coords;\n        ++").concat(l[i-1],";\n        ").concat(c," sourceLocG = coords;\n        ++").concat(l[i-2],";\n        ").concat(c," sourceLocA = coords;\n        --").concat(l[i-1],";\n        ").concat(c," sourceLocB = coords;\n        --").concat(l[i-2],";");const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],f=d.map((e=>"int "+e)),m=QD("sourceLocR",h-1).concat("inIdx.r"),g=QD("sourceLocG",h-1).concat("inIdx.g"),y=QD("sourceLocB",h-1).concat("inIdx.b"),b=QD("sourceLocA",h-1).concat("inIdx.a"),v="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(m.join(),"),\n                             getBestIndicesAChannel(").concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),x="vec4(\n            getAChannel(".concat(m.join(),"),\n            hasNextCol ? getAChannel(").concat(g.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),k=r?"":"\n      float getBestIndicesAChannel(".concat(f.join(),") {\n        return getChannel(getBestIndicesA(").concat(d.join(),"),\n                                          vec2(").concat(d.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(f.join(),") {\n        return getChannel(getA(").concat(d.join(),"),\n                               vec2(").concat(d.slice(-2).join(),"));\n      }\n      ").concat(k,"\n      void main() {\n        ").concat(c," coords = getOutputCoords();\n        bool hasNextCol = ").concat(l[i-1]," < ").concat(s[i-1]-1,";\n        bool hasNextRow = ").concat(l[i-2]," < ").concat(s[i-2]-1,";\n        ").concat(u,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(p,", sourceLocG").concat(p,",\n          sourceLocB").concat(p,", sourceLocA").concat(p,") * ").concat(t,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(t,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(v,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}}function fL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=t.shape[0],a=t.shape[1];null!=r&&(o=r.shape[0],a=r.shape[1]);const s=xb(a),i={windowSize:s,inSize:a,batchSize:o,outSize:Math.ceil(a/s)},c=new dL(i,n,null==r),l=[t];null!=r&&l.push(r);const u=e.runWebGLProgram(c,l,"int32");if(1===u.shape[1])return u;const h=fL(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function mL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=null!=r?r.shape:t.shape,a=xb(o[o.length-1]),s=new pL(o,a,n,null==r),i=null==r?[t]:[t,r],c=e.runWebGLProgram(s,i,"int32");if(c.shape.length===t.shape.length){const r=mL(e,t,n,c);return e.disposeIntermediateTensorInfo(c),r}return c}function gL(e,t,n,r){const o=[n];if(_g("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,t.shape.length),!Ol().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const n=[],[a,s]=kg(t.shape,o),i=tl(s),c=zF({inputs:{x:t},backend:e,attrs:{shape:[-1,i]}});n.push(c);const l=fL(e,c,r);n.push(l);const u=zF({inputs:{x:l},backend:e,attrs:{shape:a}});return n.forEach((t=>e.disposeIntermediateTensorInfo(t))),u}return mL(e,t,r)}const yL={kernelName:Ul,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a}=r;let s=cl(a,o.shape);const i=Cg(s,o.shape.length);let c=o;const l=[];null!=i&&(c=XF({inputs:{x:o},backend:n,attrs:{perm:i}}),l.push(c),s=Tg(s.length,c.shape.length)),_g("argMax",[s[0]],c.shape.length);const u=gL(n,c,s[0],"max");return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}};const bL={kernelName:Gl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a}=r;let s=cl(a,o.shape);const i=Cg(s,o.shape.length);let c=o;const l=[];null!=i&&(c=XF({inputs:{x:o},backend:n,attrs:{perm:i}}),l.push(c),s=Tg(s.length,c.shape.length)),_g("argMin",[s[0]],c.shape.length);const u=gL(n,c,s[0],"min");return l.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}},vL=NF({opSnippet:rF+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),wL={kernelName:Hl,backendName:"webgl",kernelFunc:vL},xL=NF({opSnippet:rF+"return log(x + sqrt(x * x + 1.0));"}),kL={kernelName:Kl,backendName:"webgl",kernelFunc:xL},SL=NF({opSnippet:rF+"\n  return atan(x);\n"}),_L={kernelName:Xl,backendName:"webgl",kernelFunc:SL},CL=EF({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),IL={kernelName:Yl,backendName:"webgl",kernelFunc:CL},TL=NF({opSnippet:rF+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),NL={kernelName:Ql,backendName:"webgl",kernelFunc:TL};class EL{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,s=e.strideHeight,i=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const f="avg"===t,m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d");let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(i,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(u,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(t," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(r?o?m:g:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let b="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(b="avgValue / count");const v=4*Math.floor(a/4),w=a%4,x="\n      if (".concat(f,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(x,"\n          }\n\n          int xC = xCCorner + ").concat(v,";\n          if (").concat(1===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(2===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(x,"\n          } else if (").concat(3===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(x,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}}class AL{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,s=e.strideDepth,i=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const b="avg"===t;let v="0.0";if(b||(v="-1.0 / 1e-20"),n){const t=">=";return void(this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(i,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(u,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(f,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(t," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(r?o?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(p," * ").concat(f," +\n                      wR * ").concat(f," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      "))}let w="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(w="avgValue / count");const x=4*Math.floor(a/4),k=a%4,S="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(i,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(e.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(u,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(S,"\n            }\n\n            int xC = xCCorner + ").concat(x,";\n            if (").concat(1===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(2===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(3===k,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(S,"\n            }\n          }\n          setOutput(").concat(w,");\n        }\n      }\n    ")}}const RL={kernelName:Jl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t;FP(o,"avgPool");const{filterSize:a,strides:s,pad:i,dimRoundingMode:c}=r;Jc(bm(s,1),(()=>"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")));const l=cm(o.shape,a,s,1,i,c);if(1===l.filterWidth&&1===l.filterHeight&&nl(l.inShape,l.outShape))return yF({inputs:{x:o},backend:n});const u=new EL(l,"avg",!1);return n.runWebGLProgram(u,[o],"float32")}};const OL={kernelName:$l,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{filterSize:a,strides:s,pad:i,dimRoundingMode:c,dataFormat:l}=r,u=lm(o.shape,a,s,[1,1,1],i,c,l),h=new AL(u,"avg",!1);return n.runWebGLProgram(h,[o],"float32")}};class ML{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,i=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=i-1-e.padInfo.top,u=c-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(u,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n            wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class PL{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=u-1-e.padInfo.front,f=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(f,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n            wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(o,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const DL={kernelName:eu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a}=t,s=a,{filterSize:i,strides:c,pad:l,dimRoundingMode:u}=r,h=lm(s.shape,i,c,[1,1,1],l,u),d=new PL(h);return n.runWebGLProgram(d,[o],s.dtype)}};const FL={kernelName:Zl,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a}=t,s=a;FP([o,a],"avgPoolGrad");const{filterSize:i,strides:c,pad:l}=r,u=cm(s.shape,i,c,1,l),h=new ML(u);return n.runWebGLProgram(h,[o],s.dtype)}};const LL={kernelName:tu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{a:o,b:a}=t,{transposeA:s,transposeB:i}=r;return YF({a:o,b:a,transposeA:s,transposeB:i,backend:n})}};class zL{constructor(e,t,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Ym(e,t),Ym(e,n);let s="0.0";null!=r&&(Ym(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let i="1.0";null!=o&&(Ym(e,o),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(i,";\n        float inv = scale * inversesqrt(variance + float(").concat(a,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")}}class BL{constructor(e,t,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ym(e,t),Ym(e,n);let s="vec4(0.0)";null!=r&&(Ym(e,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");let i="vec4(1.0)";null!=o&&(Ym(e,o),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(i,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(a,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")}}const qL={kernelName:ju,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:o,mean:a,variance:s,offset:i,scale:c}=t;Jc(a.shape.length===s.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),Jc(null==i||a.shape.length===i.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),Jc(null==c||a.shape.length===c.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:l}=r;null==l&&(l=.001);const u=[o,a,s];let h=null;null!=i&&(h=i.shape,u.push(i));let d=null;null!=c&&(d=c.shape,u.push(c));const p=Ol().getBool("WEBGL_PACK_NORMALIZATION")?new BL(o.shape,a.shape,s.shape,h,d,l):new zL(o.shape,a.shape,s.shape,h,d,l);return n.runWebGLProgram(p,u,u[0].dtype)}};class WL{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=mD(this.rank),n="uniform int start[".concat(this.rank,"];"),r=function(e){if(1===e)return"sourceLoc";if(e<=6)return jL.slice(0,e).map((e=>"sourceLoc."+e)).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);let o;const a=e.map(((e,t)=>"sourceLoc.".concat(jL[t]," = start[").concat(t,"] + coords.").concat(jL[t],";")));o="\n        ".concat(t," sourceLoc;\n        ").concat(t," coords = getOutputCoords();\n        ").concat(a.join("\n"),"\n      "),this.userCode="\n      ".concat(n,"\n      void main() {\n        ").concat(o,"\n        setOutput(getSource(").concat(r,"));\n      }\n    ")}getCustomSetupFunc(e){if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return(t,n)=>{null==this.startLoc&&(this.startLoc=t.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||t.gl.uniform1iv(this.startLoc,e)}}}const jL=["x","y","z","w","u","v"];class VL{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;const t=mD(this.rank),n=QD("coords",this.rank),r=QD("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2(".concat(r.slice(-2).join(),")"),a="getChannel(getSource(".concat(r.join(),"), ").concat(o,")"),s="\n      result.x = ".concat(a,";\n      if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n        ++").concat(r[this.rank-1],";\n        result.y = ").concat(a,";\n        --").concat(r[this.rank-1],";\n      }\n    "),i=1===this.rank?"":"\n      --".concat(n[this.rank-1],";\n      if (++").concat(n[this.rank-2]," < ").concat(e[this.rank-2],") {\n        ++").concat(r[this.rank-2],";\n        result.z = ").concat(a,";\n        if (++").concat(n[this.rank-1]," < ").concat(e[this.rank-1],") {\n          ++").concat(r[this.rank-1],";\n          result.w = ").concat(a,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(t,"(").concat(e.map(((e,t)=>"start[".concat(t,"]"))).join(),");"):e.map(((e,t)=>"".concat(r[t]," = ").concat(n[t]," + start[").concat(t,"];"))).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(t," coords = getOutputCoords();\n        ").concat(t," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(i,"\n        setOutput(result);\n      }\n    ")}getCustomSetupFunc(e){if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return(t,n)=>{null==this.startLoc&&(this.startLoc=t.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||t.gl.uniform1iv(this.startLoc,e)}}}function UL(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{begin:a,size:s}=r,[i,c]=Wf(o,a,s);if(Tf(o,i,c),0===tl(c))return n.makeTensorInfo(c,o.dtype,[]);if(n.shouldExecuteOnCPU([o])||"string"===o.dtype){const e=n.texData.get(o.dataId),t=WD(e.values,i,c,o.shape,o.dtype);return n.makeTensorInfo(c,o.dtype,t)}const{isPacked:l}=n.texData.get(o.dataId),u=Bf(o.shape,i,c);if(l||!u){const e=Ol().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new VL(c):new WL(c),t=e.getCustomSetupFunc(i);return n.runWebGLProgram(e,[o],o.dtype,t)}return n.uploadToGPU(o.dataId),function(e,t,n,r){const o=r.texData.get(e.dataId),a=r.makeTensorInfo(n,e.dtype),s=r.texData.get(a.dataId);Object.assign(s,o),s.complexParentRefCount=0,s.refCount=1,s.shape=n,s.dtype=e.dtype;let i=qf(t,wl(e.shape));o.slice&&(i+=o.slice.flatOffset),s.slice={flatOffset:i,origDataId:o.slice&&o.slice.origDataId||e.dataId};const c=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,c+1),a}(o,i,c,n)}const GL={kernelName:Zh,backendName:"webgl",kernelFunc:UL},HL={kernelName:nu,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{blockShape:a,crops:s}=r;Jc(o.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const i=a.reduce(((e,t)=>e*t)),c=Sb(o.shape,a,i),l=_b(c.length,a.length),u=Cb(o.shape,a,i),h=Ib(s,a.length),d=Tb(u,s,a.length),p=[],f=zF({inputs:{x:o},backend:n,attrs:{shape:c}}),m=XF({inputs:{x:f},backend:n,attrs:{perm:l}}),g=zF({inputs:{x:m},backend:n,attrs:{shape:u}}),y=UL({inputs:{x:g},backend:n,attrs:{begin:h,size:d}});return p.push(f),p.push(m),p.push(g),p.forEach((e=>n.disposeIntermediateTensorInfo(e))),y}};const KL={kernelName:ru,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,weights:a}=t,{size:s}=r,i=n.readSync(o.dataId),c=n.readSync(a.dataId),l=wD(i,c,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,l)}},XL=EF({opSnippet:"return float(a != b);",dtype:"bool"}),QL={kernelName:Ch,backendName:"webgl",kernelFunc:XL};function YL(e){const{inputs:t,backend:n}=e,{input:r}=t;return yF({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}const JL={kernelName:Lh,backendName:"webgl",kernelFunc:YL};const ZL={kernelName:ou,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r,attrs:o}=t,{x:a}=n,{dtype:s}=o;if("complex64"===s){if("complex64"===a.dtype)return yF({inputs:{x:a},backend:r});const t=Dg(a.shape),n=e({inputs:{x:a},backend:r,attrs:{dtype:"float32"}}),o=vF({inputs:{real:n,imag:t},backend:r});return t.dispose(),r.disposeIntermediateTensorInfo(n),o}if("complex64"===a.dtype){const t=YL({inputs:{input:a},backend:r}),n=e({inputs:{x:t},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(t),n}if(!dl(a.dtype,s)){const e=yF({inputs:{x:a},backend:r});return{dataId:e.dataId,shape:e.shape,dtype:s}}if("int32"===s)return function(e,t){const n=new nF(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(a,r);if("bool"===s){const e=r.makeTensorInfo([],"bool",ul("bool",1)),t=XL({inputs:{a:a,b:e},backend:r});return r.disposeIntermediateTensorInfo(e),t}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(s))}},$L="return ceil(x);",ez=NF({opSnippet:$L,packedOpSnippet:$L,cpuKernelImpl:kD}),tz={kernelName:au,backendName:"webgl",kernelFunc:ez};class nz{constructor(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}getCustomSetupFunc(e,t){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,e),n.gl.uniform1f(this.maxLoc,t)}}}class rz{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}getCustomSetupFunc(e,t){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,e),n.gl.uniform1f(this.maxLoc,t)}}}const oz={kernelName:su,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{clipValueMin:a,clipValueMax:s}=r;let i;i=Ol().getBool("WEBGL_PACK_CLIP")?new rz(o.shape):new nz(o.shape);const c=i.getCustomSetupFunc(a,s);return n.runWebGLProgram(i,[o],o.dtype,c)}};class az{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}function sz(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}const iz={kernelName:cu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,o=n.texData.get(r.dataId),a=new az(r.shape),s=[sz(r,o.complexTensorInfos.real),sz(r,o.complexTensorInfos.imag)];return n.runWebGLProgram(a,s,s[0].dtype)}};class cz{constructor(e){this.outputShape=[],this.outputShape=vb(e,1),this.variableNames=e.map(((e,t)=>"T".concat(t)));const t=new Array(e.length-1);t[0]=e[0][1];for(let a=1;a<t.length;a++)t[a]=t[a-1]+e[a][1];const n=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")];for(let a=1;a<t.length;a++){const e=t[a-1];n.push("else if (yC < ".concat(t[a],") ")+"setOutput(getT".concat(a,"(yR, yC-").concat(e,"));"))}const r=t.length,o=t[t.length-1];n.push("else setOutput(getT".concat(r,"(yR, yC-").concat(o,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(n.join("\n        "),"\n      }\n    ")}}class lz{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vb(e,t);const n=this.outputShape,r=n.length,o=mD(r),a=QD("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(((e,t)=>"T".concat(t)));const i=new Array(e.length-1);i[0]=e[0][t];for(let f=1;f<i.length;f++)i[f]=i[f-1]+e[f][t];const c=s[t],l=s.slice(-2),u=s.join();let h="if (".concat(c," < ").concat(i[0],") {\n        return getChannel(\n            getT0(").concat(u,"), vec2(").concat(l.join(),"));\n        }");for(let f=1;f<i.length;f++){const e=i[f-1];h+="\n        if (".concat(c," < ").concat(i[f],"  && ").concat(c," >= ").concat(i[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(uz(s,c,e),"),\n            vec2(").concat(uz(l,c,e),"));\n        }")}const d=i.length,p=i[i.length-1];h+="\n        return getChannel(\n          getT".concat(d,"(").concat(uz(s,c,p),"),\n          vec2(").concat(uz(l,c,p),"));"),this.userCode="\n      float getValue(".concat(s.map((e=>"int "+e)),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(a,"), 0., 0., 0.);\n\n        ").concat(a[r-1]," = ").concat(a[r-1]," + 1;\n        if (").concat(a[r-1]," < ").concat(n[r-1],") {\n          result.g = getValue(").concat(a,");\n        }\n\n        ").concat(a[r-2]," = ").concat(a[r-2]," + 1;\n        if (").concat(a[r-2]," < ").concat(n[r-2],") {\n          result.a = getValue(").concat(a,");\n        }\n\n        ").concat(a[r-1]," = ").concat(a[r-1]," - 1;\n        if (").concat(a[r-2]," < ").concat(n[r-2]," &&\n            ").concat(a[r-1]," < ").concat(n[r-1],") {\n          result.b = getValue(").concat(a,");\n        }\n        setOutput(result);\n      }\n    ")}}function uz(e,t,n){const r=e.indexOf(t),o=e.map(((e,t)=>t===r?"".concat(e," - ").concat(n):e));return o.join()}function hz(e){const{inputs:t,backend:n}=e,{input:r}=t;return yF({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}const dz={kernelName:Qu,backendName:"webgl",kernelFunc:hz};function pz(e,t,n){const r=e[0].dtype;if("complex64"===r){const r=e.map((e=>YL({inputs:{input:e},backend:n}))),o=e.map((e=>hz({inputs:{input:e},backend:n}))),a=pz(r,t,n),s=pz(o,t,n),i=vF({inputs:{real:a,imag:s},backend:n});return r.forEach((e=>n.disposeIntermediateTensorInfo(e))),o.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),i}if("string"===r){const{tensors2D:o,outShape:a}=fz(e,t,n),s=o.map((e=>({vals:n.readSync(e.dataId),shape:e.shape}))),i=1===o[0].shape[0],c=SD(s,a,r,i),l=vb(e.map((e=>e.shape)),t),u=n.makeTensorInfo(l,r,c);return o.forEach((e=>n.disposeIntermediateTensorInfo(e))),u}if(e.length>Ol().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const r=Math.floor(e.length/2),o=pz(e.slice(0,r),t,n),a=pz(e.slice(r),t,n),s=pz([o,a],t,n);return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),s}if(Ol().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){const o=new lz(e.map((e=>e.shape)),t);return n.runWebGLProgram(o,e,r)}const{tensors2D:o,outShape:a}=fz(e,t,n),s=new cz(o.map((e=>e.shape))),i=n.runWebGLProgram(s,o,r);o.forEach((e=>n.disposeIntermediateTensorInfo(e)));const c=zF({inputs:{x:i},attrs:{shape:a},backend:n});return n.disposeIntermediateTensorInfo(i),c}function fz(e,t,n){const r=vb(e.map((e=>e.shape)),t),o=e.map((e=>zF({inputs:{x:e},attrs:{shape:[-1,tl(e.shape.slice(t))]},backend:n})));return{tensors2D:o,outShape:r}}function mz(e){const{inputs:t,backend:n,attrs:r}=e,{axis:o}=r,a=cl(o,t[0].shape)[0],s=vb(t.map((e=>e.shape)),a);if(0===tl(s))return n.makeTensorInfo(s,t[0].dtype,[]);const i=t.filter((e=>tl(e.shape)>0));if(1===i.length)return yF({inputs:{x:i[0]},backend:n});return bb(i.map((e=>e.shape)),a),pz(i,a,n)}const gz={kernelName:lu,backendName:"webgl",kernelFunc:mz};class yz{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.padInfo.top,s=e.padInfo.left,i=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,m="channelsLast"===e.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1;let v="",w="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):o?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),w="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(i,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(a,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(e.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(u,";\n\n            if (xC < 0 || xC >= ").concat(e.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===f,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(p,") *\n                    getW(wR, wC, ").concat(p,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(p,", xR, xC) *\n                    getW(wR, wC, ").concat(p,", d2);\n              }\n\n            } else if (").concat(2===f,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===f,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2),\n                getW(wR, wC, ").concat(p," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1),\n                  getX(batch, xR, xC, ").concat(p," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC),\n                  getX(batch, ").concat(p," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(x,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")}}class bz{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(o,", ").concat(a,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(t,", ").concat(n,", ").concat(r,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(u,"; wF++) {\n          int xF = xFCorner + wF * ").concat(i,";\n\n          if (xF < 0 || xF >= ").concat(e.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===f,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===f,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===f,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class vz{constructor(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;const{filterWidth:r,inChannels:o,strideWidth:a,strideHeight:s,padInfo:i,outWidth:c,dilationWidth:l,dilationHeight:u,dataFormat:h}=n,{left:d,top:p}=i,f=o*r,m=zP(),g="channelsLast"===h,y=g?0:1,b=g?1:2;let v="";for(let w=0;w<=1;w++)for(let n=0;n<=1;n++)v+="\n          blockIndex = rc.y + ".concat(n,";\n          pos = rc.x + ").concat(w,";\n\n          if(blockIndex < ").concat(e[1]," && pos < ").concat(e[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(p,";\n            d0 = offsetY + ").concat(u," * (pos / ").concat(f,");\n\n            if(d0 < ").concat(t[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(a,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(f,".) / ").concat(o,".));\n\n              if(d1 < ").concat(t[b]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(o,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*w+n,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*w+n,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(v,"\n\n        ").concat(m.output," = result;\n      }\n    ")}}function wz(e){let{x:t,filter:n,convInfo:r,backend:o,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:c=null}=e;const l=t.shape,u=o.texData.get(t.dataId),h=r.inChannels,d=l[0]*l[1]*l[2],p=r.outChannels,f="channelsLast"===r.dataFormat,m=!1,g=!1;let y;const b=[],v=(1===d||1===p)&&h>1e3,w=l[2]%2!==0&&!!u.isPacked;if(!v&&Ol().getBool("WEBGL_LAZILY_UNPACK")&&Ol().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&w){const e=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),h={dataId:t.dataId,shape:[1,e,r.inChannels],dtype:t.dtype},d=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,Jc(EP(u.shape,h.shape),(()=>"packed reshape ".concat(u.shape," to ").concat(h.shape," isn't free")));const p=zF({inputs:{x:n},backend:o,attrs:{shape:[1,r.inChannels,r.outChannels]}});b.push(p);const v=YF({a:h,b:p,backend:o,transposeA:m,transposeB:g,bias:a,activation:c,preluActivationWeights:s,leakyreluAlpha:i}),w=o.texData.get(v.dataId);Jc(w.isPacked,(()=>"batchMatMul result is expected to be packed")),u.shape=d,w.shape=r.outShape,y=yF({inputs:{x:v},backend:o}),y.shape=r.outShape,b.push(v)}else{const e=zF({inputs:{x:t},backend:o,attrs:{shape:[1,f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],r.inChannels]}}),u=zF({inputs:{x:n},backend:o,attrs:{shape:[1,r.inChannels,r.outChannels]}}),h=YF({a:e,b:u,transposeA:m,transposeB:g,backend:o,bias:a,activation:c,preluActivationWeights:s,leakyreluAlpha:i});y=zF({inputs:{x:h},backend:o,attrs:{shape:r.outShape}}),b.push(e),b.push(u),b.push(h)}for(const x of b)o.disposeIntermediateTensorInfo(x);return y}function xz(e){let{x:t,filter:n,convInfo:r,backend:o,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:c=null}=e;const{filterWidth:l,filterHeight:u,inChannels:h,outWidth:d,outHeight:p,dataFormat:f}=r,m="channelsLast"===f,g=l*u*h,y=p*d,b=[g,y],v=[],w=zF({inputs:{x:t},backend:o,attrs:{shape:t.shape.slice(1)}}),x=zF({inputs:{x:n},backend:o,attrs:{shape:[1,g,tl(n.shape)/g]}});v.push(w),v.push(x);const k=new vz(b,w.shape,r),S=o.runWebGLProgram(k,[w],"float32"),_=zF({inputs:{x:S},backend:o,attrs:{shape:[1,b[0],b[1]]}});v.push(S),v.push(_);const C=null!=a,I=null!=s,T="leakyrelu"===c,N=c?AF(c,!0):null,E=new RF(_.shape,x.shape,[1,y,r.outChannels],!0,!1,C,N,I,T),A=[_,x];if(a&&A.push(a),I&&A.push(s),T){const e=o.makeTensorInfo([],"float32",Gd(i,"float32"));A.push(e),v.push(e)}const R=o.runWebGLProgram(E,A,"float32"),O=zF({inputs:{x:R},backend:o,attrs:{shape:m?[1,p,d,r.outChannels]:[1,r.outChannels,p,d]}});v.push(R);for(const M of v)o.disposeIntermediateTensorInfo(M);return O}const kz={kernelName:uu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dataFormat:c,dilations:l,dimRoundingMode:u}=r,h=vm(c),d=um(o.shape,a.shape,s,l,i,u,!1,h);let p;if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(Ol().getBool("WEBGL_CONV_IM2COL")&&1===o.shape[0])p=xz({x:o,filter:a,convInfo:d,backend:n});else{const e=new yz(d);p=n.runWebGLProgram(e,[o,a],"float32")}else p=wz({x:o,filter:a,convInfo:d,backend:n});const f=zF({inputs:{x:p},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(p),f}};class Sz{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(o,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              if (").concat(a,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class _z{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a="channelsLast"===e.dataFormat,s=t-1-e.padInfo.top,i=n-1-e.padInfo.left,c=a?1:2,l=a?2:3,u=a?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(u,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Cz{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,s=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(e.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(e.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t," - ").concat(o,";\n\n            if (xF < 0 || xF >= ").concat(e.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n              if (xR < 0 || xR >= ").concat(e.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(r," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Iz{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,s=e.strideWidth,i=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(i,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(t,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(o,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(e.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(t," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(n,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(n," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(r,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(r," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(e.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Tz={kernelName:hu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,dy:a}=t,{strides:s,pad:i,dataFormat:c,dimRoundingMode:l,filterShape:u}=r,h=vm(c),d=um(o.shape,u,s,1,i,l,!1,h),p=new Sz(d);return n.runWebGLProgram(p,[o,a],"float32")}};const Nz={kernelName:du,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,filter:a}=t,{inputShape:s,strides:i,pad:c,dataFormat:l,dimRoundingMode:u}=r,h=vm(l),d=um(s,a.shape,i,1,c,u,!1,h),p=new _z(d);return n.runWebGLProgram(p,[o,a],"float32")}};const Ez={kernelName:pu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dilations:c}=r,l=hm(o.shape,a.shape,s,c,i),u=new bz(l);return n.runWebGLProgram(u,[o,a],"float32")}};const Az={kernelName:fu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,dy:a}=t,{strides:s,pad:i,filterShape:c}=r,l=hm(o.shape,c,s,1,i),u=new Cz(l);return n.runWebGLProgram(u,[o,a],"float32")}};const Rz={kernelName:mu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,filter:a}=t,{pad:s,strides:i,inputShape:c}=r,l=hm(c,a.shape,i,1,s),u=new Iz(l);return n.runWebGLProgram(u,[o,a],"float32")}},Oz=NF({opSnippet:TF+"\n  return cos(x);\n"}),Mz={kernelName:gu,backendName:"webgl",kernelFunc:Oz},Pz=NF({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),Dz={kernelName:yu,backendName:"webgl",kernelFunc:Pz};class Fz{constructor(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,s,i,c]=e,[l]=t,[u,h]=n;this.outputShape=[l,u,h,c];const d="bilinear"===r?1:0,[p,f]=["".concat(s-1,".0"),"".concat(i-1,".0")],[m,g,y]=u>1?["".concat((s-1)/(u-1)),"(y2-y1) * height_ratio","y1*".concat(p," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(p)],[b,v,w]=h>1?["".concat((i-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(f," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(f)];this.userCode="\n      const float height_ratio = float(".concat(m,");\n      const float width_ratio = float(").concat(b,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(a,") {\n          return;\n        }\n\n        float height_scale = ").concat(g,";\n        float width_scale = ").concat(v,";\n\n        float in_y = ").concat(y,";\n        if( in_y < 0.0 || in_y > ").concat(p," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n        float in_x = ").concat(w,";\n        if( in_x < 0.0 || in_x > ").concat(f," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(d," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")}}const Lz={kernelName:vu,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{image:o,boxes:a,boxInd:s}=t,{cropSize:i,method:c,extrapolationValue:l}=r,u=new Fz(o.shape,a.shape,i,c,l);return n.runWebGLProgram(u,[o,a,s],"float32")}};class zz{constructor(e,t,n){this.variableNames=["x"],this.outputShape=e;const r=e.length,o=t?"0.0":"getX(".concat(Bz(r,"coords"),")"),a=e[e.length-1];let s="",i="";t?(s=n?"end != ".concat(a-1):"end != 0",i=n?"end + 1":"end - 1"):(s=n?"end + pow2 < ".concat(a):"end >= pow2",i=n?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(mD(r)," coords = getOutputCoords();\n        int end = ").concat(qz(r,"coords"),";\n        float val = ").concat(o,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(i,";\n          ").concat(qz(r,"coords")," = idx;\n          val += getX(").concat(Bz(r,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}getCustomSetupFunc(e){return(t,n)=>{null==this.index&&(this.index=t.getUniformLocation(n,"index")),t.gl.uniform1f(this.index,e)}}}function Bz(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function qz(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}const Wz={kernelName:bu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,exclusive:s,reverse:i}=r,c=o.shape.length,l=Cg([a],c);let u=o;null!=l&&(u=XF({inputs:{x:o},backend:n,attrs:{perm:l}}));const h=Tg(1,c)[0];if(h!==c-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(o.shape.length-1," ")+"but got axis=".concat(a));const d=u.shape[h];let p=yF({inputs:{x:u},backend:n});for(let f=0;f<=Math.ceil(Math.log2(d))-1;f++){const e=new zz(u.shape,!1,i),t=e.getCustomSetupFunc(f),r=p;p=n.runWebGLProgram(e,[p],p.dtype,t),n.disposeIntermediateTensorInfo(r)}if(s){const e=new zz(u.shape,s,i),t=p;p=n.runWebGLProgram(e,[p],p.dtype),n.disposeIntermediateTensorInfo(t)}if(null!=l){const e=XF({inputs:{x:p},backend:n,attrs:{perm:Ig(l)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),e}return p}};const jz={kernelName:wu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,weights:a}=t,{size:s,binaryOutput:i}=r;if(1===o.shape.length){const e=n.readSync(o.dataId),t=n.readSync(a.dataId),r=wD(e,t,a.dtype,a.shape,s);return n.makeTensorInfo([s],a.dtype,r)}if(2===o.shape.length){const e=n.bufferSync(o),t=n.bufferSync(a),r=xD(e,t,s,i);return n.makeTensorInfo(r.shape,a.dtype,r.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(o.shape.length,"."))}};class Vz{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(t,";\n      int offset_h = imod(h, ").concat(t,");\n      int in_w = w / ").concat(t,";\n      int offset_w = imod(w, ").concat(t,");\n      int offset_d = (offset_h * ").concat(t," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}const Uz={kernelName:xu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{blockSize:a,dataFormat:s}=r;Jc(a>1,(()=>"blockSize should be > 1 for depthToSpace, but was: ".concat(a)));const i=o.shape[0],c="NHWC"===s?o.shape[1]:o.shape[2],l="NHWC"===s?o.shape[2]:o.shape[3],u="NHWC"===s?o.shape[3]:o.shape[1],h=c*a,d=l*a,p=u/(a*a),f=new Vz("NHWC"===s?[i,h,d,p]:[i,p,h,d],a,s);return n.runWebGLProgram(f,[o],o.dtype)}};class Gz{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.inHeight,s=e.inWidth,i=e.padInfo.top,c=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,h=e.dilationHeight,d=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=e.outChannels/e.inChannels;let g="",y="";n&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):o?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"\n          float activation(float x) {\n            ".concat(n,"\n          }\n        "),y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(c,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(h,";\n\n          if (xR < 0 || xR >= ").concat(a,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(b,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")}}class Hz{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;const a=e.inHeight,s=e.inWidth,i=e.padInfo.top,c=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,h=e.dilationHeight,d=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=f;let g="int xR; int xC; int xCOffset;";for(let w=0;w<p;w++)for(let e=0;e<f;e++)g+="\n          vec4 xTexelR".concat(w,"C").concat(2*e," = vec4(0.);\n          vec4 wR").concat(w,"C").concat(e," = vec4(0.);\n          vec4 xR").concat(w,"C").concat(e," = vec4(0.);");for(let w=0;w<p;w++)for(let e=0;e<m;e++){const t=2*e;if(g+="\n          xR = xRCorner + ".concat(w*h,";\n          xC = xCCorner + ").concat(t*d,";\n        "),1===u){if(t<f&&(g+=c%2===1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(a," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(w,"C").concat(t," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(w,"C").concat(t,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(w,"C").concat(t," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(a," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(w,"C").concat(t," = vec4(previous.zw, xTexelR").concat(w,"C").concat(t,".xy);\n                } else {\n                  xR").concat(w,"C").concat(t," = vec4(0, 0, xTexelR").concat(w,"C").concat(t,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(a," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(w,"C").concat(t," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(w,"C").concat(t," = vec4(0.);\n                }\n\n                xR").concat(w,"C").concat(t," = xTexelR").concat(w,"C").concat(t,";\n              "),t+1<f)){const e=c%2===0?Yc(d):d;d%2===0&&c%2===1||d%2!==0&&c%2!==1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(e,";\n\n                  if(xR >= 0 && xR < ").concat(a," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(w,"C").concat(t+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(a," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(w,"C").concat(t," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(w,"C").concat(t," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(w,"C").concat(t+1," = vec4(\n                    xTexelR").concat(w,"C").concat(t,".zw, xTexelR").concat(w,"C").concat(t+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(e,";\n\n                  if(xR >= 0 && xR < ").concat(a," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(w,"C").concat(t+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(w,"C").concat(t+1," = xTexelR").concat(w,"C").concat(t+2,";\n                ")}}else t<f&&(g+="\n              if(xR >= 0 && xR < ".concat(a,") {\n            "),c%2===1?(g+="\n                xCOffset = xC + 1 - ".concat(u,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(w,"C").concat(t," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(w,"C").concat(t," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(w,"C").concat(t+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(w,"C").concat(t+2," = vec4(0.);\n                }\n\n                xR").concat(w,"C").concat(t," = vec4(\n                  xTexelR").concat(w,"C").concat(t,".zw, xTexelR").concat(w,"C").concat(t+2,".zw);\n              "),t+1<f&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(u,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(w,"C").concat(t+1," = vec4(xTexelR").concat(w,"C").concat(t+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(w,"C").concat(t," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(w,"C").concat(t," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(u,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(w,"C").concat(t+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(w,"C").concat(t+2," = vec4(0.);\n                }\n\n                xR").concat(w,"C").concat(t," = vec4(\n                  xTexelR").concat(w,"C").concat(t,".xy, xTexelR").concat(w,"C").concat(t+2,".xy);\n              "),t+1<f&&(g+="\n                  xR".concat(w,"C").concat(t+1," = vec4(\n                    xTexelR").concat(w,"C").concat(t,".zw, xTexelR").concat(w,"C").concat(t+2,".zw);\n                "))),g+="}");t<f&&(g+="\n            vec4 wTexelR".concat(w,"C").concat(t," = getW(").concat(w,", ").concat(t,", d1, q);\n            wR").concat(w,"C").concat(t," = vec4(wTexelR").concat(w,"C").concat(t,".xz, wTexelR").concat(w,"C").concat(t,".xz);\n          "),t+1<f&&(g+="\n              vec4 wTexelR".concat(w,"C").concat(t+1," = getW(").concat(w,", ").concat(t+1,", d1, q);\n              wR").concat(w,"C").concat(t+1," =\n                vec4(wTexelR").concat(w,"C").concat(t+1,".xz, wTexelR").concat(w,"C").concat(t+1,".xz);")))}for(let w=0;w<p;w++)for(let e=0;e<f;e++)g+="dotProd += xR".concat(w,"C").concat(e," * wR").concat(w,"C").concat(e,";");let y="",b="";n&&(y=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(n,"\n        }"):o?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(n,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(n,"\n        }"),b="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(y,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(v,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")}}const Kz={kernelName:ku,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dilations:c,dimRoundingMode:l}=r;let u=c;null==u&&(u=[1,1]),Jc(bm(s,u),(()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(s," and dilations '").concat(u,"'")));const h=um(o.shape,a.shape,s,u,i,l,!0);let d;return d=Ol().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new Hz(h):new Gz(h),n.runWebGLProgram(d,[o,a],"float32")}};class Xz{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(a," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(e.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(e.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t," - ").concat(r,";\n\n            if (xR < 0 || xR >= ").concat(e.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(e.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(n," - ").concat(o,";\n\n              if (xC < 0 || xC >= ").concat(e.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class Qz{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(t,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(t," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(n,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(n," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(i,"; dm++) {\n              int d2 = d1 * ").concat(i," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Yz={kernelName:Su,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,dy:a}=t,{strides:s,dilations:i,pad:c,dimRoundingMode:l,filterShape:u}=r,h=um(o.shape,u,s,i,c,l,!0),d=new Xz(h);return n.runWebGLProgram(d,[o,a],"float32")}};const Jz={kernelName:_u,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,filter:a}=t,{strides:s,dilations:i,pad:c,dimRoundingMode:l,inputShape:u}=r,h=um(u,a.shape,s,i,c,l,!0),d=new Qz(h);return n.runWebGLProgram(d,[o,a],"float32")}};class Zz{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}const $z={kernelName:Cu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t,o=[...r.shape,...r.shape],a=tl(r.shape),s=zF({inputs:{x:r},backend:n,attrs:{shape:[a]}}),i=new Zz(a),c=n.runWebGLProgram(i,[s],s.dtype),l=zF({inputs:{x:c},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),l}};class eB{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:n,padInfo:r,strideHeight:o,strideWidth:a,filterHeight:s,filterWidth:i,dilationHeight:c,dilationWidth:l}=e,{top:u,left:h}=r;this.userCode="\n      const ivec2 strides = ivec2(".concat(o,", ").concat(a,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(t,") {\n            for (int w = 0; w < ").concat(i,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(n,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}}const tB={kernelName:Iu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a}=t,{strides:s,pad:i,dilations:c}=r,l=im(o.shape,a.shape,s,i,"NHWC",c);let u;const h=new eB(l);u=n.runWebGLProgram(h,[o,a],"float32");const d=zF({inputs:{x:u},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(u),d}},nB=NF({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),rB={kernelName:Au,backendName:"webgl",kernelFunc:nB},oB={kernelName:Ru,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n}=e,{dy:r,y:o}=t,a=Ol().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new gF("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,o.shape):new fF("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,o.shape);return n.runWebGLProgram(a,[r,o],r.dtype)}},aB=EF({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"}),sB={kernelName:Mu,backendName:"webgl",kernelFunc:aB},iB=NF({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Pb,";\n  float a1 = ").concat(Db,";\n  float a2 = ").concat(Fb,";\n  float a3 = ").concat(Lb,";\n  float a4 = ").concat(zb,";\n  float a5 = ").concat(Bb,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),cB={kernelName:Ou,backendName:"webgl",kernelFunc:iB},lB="return exp(x);",uB=NF({opSnippet:lB,packedOpSnippet:lB,cpuKernelImpl:_D}),hB={kernelName:Pu,backendName:"webgl",kernelFunc:uB};function dB(e){const{inputs:t,attrs:n,backend:r}=e,{dim:o}=n,{input:a}=t,s=a.shape.length,i=a.shape.slice();let c=o;return o<0&&(Jc(-(s+1)<=o,(()=>"Axis must be in the interval [".concat(-(s+1),", ").concat(s,"]"))),c=s+o+1),i.splice(c,0,1),zF({inputs:{x:a},backend:r,attrs:{shape:i}})}const pB={kernelName:Du,backendName:"webgl",kernelFunc:dB},fB="return exp(x) - 1.0;",mB=NF({opSnippet:fB,packedOpSnippet:fB,cpuKernelImpl:CD}),gB={kernelName:Fu,backendName:"webgl",kernelFunc:mB};class yB{constructor(e,t,n){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),a=n?"".concat(r,".0"):"1.0";let s;if("real"===e)s="return real * expR - imag * expI;";else{if("imag"!==e)throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));s="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(s,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(r,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(r,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(a,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}}function bB(e,t,n){const r=n.texData.get(e.dataId),o=tl(e.shape),a=e.shape[e.shape.length-1],s=zF({inputs:{x:e},backend:n,attrs:{shape:[o/a,a]}}),i=s.shape,c=new yB("real",i,t),l=new yB("imag",i,t),u=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:i},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:i}],h=n.runWebGLProgram(c,u,"float32"),d=n.runWebGLProgram(l,u,"float32"),p=vF({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const f=zF({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(p),f}const vB={kernelName:Lu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return bB(r,!1,n)}};class wB{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}getCustomSetupFunc(e){return(t,n)=>{null==this.valueLoc&&(this.valueLoc=t.getUniformLocationNoThrow(n,"value")),t.gl.uniform1f(this.valueLoc,e)}}}function xB(e){const{backend:t,attrs:n}=e,{shape:r,value:o}=n;let{dtype:a}=n;if(a=a||yl(o),"string"===a){const e=hl(a,tl(r));return e.fill(o),t.makeTensorInfo(r,a,e)}{const e=new wB(r,o),n=e.getCustomSetupFunc(o);return t.runWebGLProgram(e,[],a,n)}}const kB={kernelName:zu,backendName:"webgl",kernelFunc:xB};class SB{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(t," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(t,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const _B={kernelName:Bu,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n}=e;const{image:r}=t,o=n,a=new SB(r.shape);return o.runWebGLProgram(a,[r],r.dtype)}},CB="return floor(x);",IB=NF({opSnippet:CB,packedOpSnippet:CB,cpuKernelImpl:ID}),TB={kernelName:qu,backendName:"webgl",kernelFunc:IB},NB=EF({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),EB={kernelName:Wu,backendName:"webgl",kernelFunc:NB};class AB{constructor(e){this.variableNames=["A"];const t=zP(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(r,".0, ").concat(n,".0);\n\n        vec4 values = ").concat(t.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")}}class RB{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=zP(),[n,r]=e;this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(r,".0, ").concat(n,".0);\n            vec4 values = ").concat(t.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(t.output," = result;\n      }\n    ")}}const OB={kernelName:_d,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:o}=t;const{numChannels:a}=r,s="undefined"!==typeof HTMLVideoElement&&o instanceof HTMLVideoElement,i="undefined"!==typeof HTMLImageElement&&o instanceof HTMLImageElement,c="undefined"!==typeof ImageBitmap&&o instanceof ImageBitmap,[l,u]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],h=[u,l],d=[u,l,a];(i||s||c)&&(null==MB&&(MB=document.createElement("canvas").getContext("2d")),MB.canvas.width=l,MB.canvas.height=u,MB.drawImage(o,0,0,l,u),o=MB.canvas);const p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=sP.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),o);const f=Ol().getBool("WEBGL_PACK")?new RB(d):new AB(d),m=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),m}};let MB;const PB={kernelName:Td,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a,bias:s,preluActivationWeights:i}=t,{strides:c,pad:l,dataFormat:u,dilations:h,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=vm(u),g=um(o.shape,a.shape,c,h,l,d,!1,m);let y;const b=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(Ol().getBool("WEBGL_CONV_IM2COL")&&1===o.shape[0])y=xz({x:o,filter:a,convInfo:g,backend:n,bias:s,activation:p,preluActivationWeights:i,leakyreluAlpha:f});else{const e=null!=s,t=null!=i,r="leakyrelu"===p,c=p?AF(p,!1):null,l=new yz(g,e,c,t,r),u=[o,a];if(s&&u.push(s),i&&u.push(i),r){const e=n.makeTensorInfo([],"float32",Gd(f,"float32"));u.push(e),b.push(e)}y=n.runWebGLProgram(l,u,"float32")}else y=wz({x:o,filter:a,convInfo:g,backend:n,bias:s,activation:p,preluActivationWeights:i,leakyreluAlpha:f});const v=zF({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach((e=>n.disposeIntermediateTensorInfo(e))),v}};const DB={kernelName:Nd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,filter:a,bias:s,preluActivationWeights:i}=t,{strides:c,pad:l,dilations:u,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,f=[];let m=u;null==m&&(m=[1,1]),Jc(bm(c,m),(()=>"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(c," and dilations '").concat(m,"'")));const g=um(o.shape,a.shape,c,m,l,h,!0),y=Ol().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=d?AF(d,y):null,v=[o,a],w=null!=s,x=null!=i,k="leakyrelu"===d;if(w&&v.push(s),x&&v.push(i),k){const e=n.makeTensorInfo([],"float32",Gd(p,"float32"));v.push(e),f.push(e)}let S;S=y?new Hz(g,w,b,x,k):new Gz(g,w,b,x,k);const _=n.runWebGLProgram(S,v,"float32");return f.forEach((e=>n.disposeIntermediateTensorInfo(e))),_}};class FB{constructor(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;const r=mD(t.length),o=mD(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        ".concat(r," strides = ").concat(r,"(").concat(this.strides,");\n         void main() {\n          ").concat(o," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(a,";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")}}const LB={kernelName:Uu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{params:r,indices:o}=t,a=o.shape,s=a[a.length-1],[i,c,l,u]=Nb(r,o),h=zF({inputs:{x:o},backend:n,attrs:{shape:[c,s]}}),d=zF({inputs:{x:r},backend:n,attrs:{shape:[tl(r.shape)/l,l]}}),p=new FB(s,u,[c,l]),f=n.runWebGLProgram(p,[d,h],d.dtype),m=zF({inputs:{x:f},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),m}};class zB{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const n=mD(this.rank),r=function(e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<e.length;r++)2===r?n.push("int(getIndices(resRC.x, resRC.z))"):n.push("".concat(t[r]));return n.join()}(e);this.userCode="\n      void main() {\n        ".concat(n," resRC = getOutputCoords();\n        setOutput(getA(").concat(r,"));\n      }\n    ")}}const BB={kernelName:Vu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,indices:a}=t,{axis:s,batchDims:i}=r,c=$b(o,a,cl(s,o.shape)[0],i),l=tl(a.shape),u=[],h=zF({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),d=zF({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});u.push(h),u.push(d);const p=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([o,a])||"string"===o.dtype){const e=n.bufferSync(d),t=n.bufferSync(h),r=TD(t,e,p);return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),n.makeTensorInfo(c.outputShape,r.dtype,r.values)}const f=new zB(h.shape,p),m=n.runWebGLProgram(f,[h,d],h.dtype);u.push(m);const g=zF({inputs:{x:m},backend:n,attrs:{shape:c.outputShape}});return u.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}},qB=EF({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:ND,dtype:"bool"}),WB={kernelName:Gu,backendName:"webgl",kernelFunc:qB},jB=EF({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"}),VB={kernelName:Hu,backendName:"webgl",kernelFunc:jB};const UB={kernelName:Xu,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{input:r}=t;return bB(r,!0,n)}},GB=NF({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),HB={kernelName:Yu,backendName:"webgl",kernelFunc:GB},KB=NF({opSnippet:"return float(isinf(x));",dtype:"bool"}),XB={kernelName:Ju,backendName:"webgl",kernelFunc:KB},QB=NF({opSnippet:"return float(isnan(x));",dtype:"bool"}),YB={kernelName:Zu,backendName:"webgl",kernelFunc:QB},JB=EF({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:ED,dtype:"bool"}),ZB={kernelName:eh,backendName:"webgl",kernelFunc:JB},$B=EF({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"}),eq={kernelName:th,backendName:"webgl",kernelFunc:$B};const tq={kernelName:nh,backendName:"webgl",kernelFunc:function(e){const{backend:t,attrs:n}=e,{start:r,stop:o,num:a}=n,s=AD(r,o,a);return t.makeTensorInfo([s.length],"float32",s)}},nq=NF({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:RD}),rq={kernelName:rh,backendName:"webgl",kernelFunc:nq},oq=NF({opSnippet:"return log(1.0 + x);"}),aq={kernelName:oh,backendName:"webgl",kernelFunc:oq},sq=EF({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),iq={kernelName:ah,backendName:"webgl",kernelFunc:sq},cq=NF({opSnippet:"return float(!(x >= 1.0));"}),lq={kernelName:sh,backendName:"webgl",kernelFunc:cq},uq=EF({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),hq={kernelName:ih,backendName:"webgl",kernelFunc:uq};class dq{constructor(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];const a=t,s=e[3]-1;let i;this.outputShape=e;const c="float(".concat(n,") + float(").concat(r,") * sum");i=.5===o?"inversesqrt(".concat(c,")"):1===o?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(o,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(a,"; j <= ").concat(a,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(i,";\n        setOutput(val);\n      }\n    ")}}class pq{constructor(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,s=e[3]-1;let i;this.outputShape=e;const c="float(".concat(n,") + float(").concat(r,") * sum");i=.5===o?"inversesqrt(".concat(c,")"):1===o?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(o,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(a,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(a,"; j <= ").concat(a,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(i,";\n        setOutput(result);\n      }\n    ")}}const fq={kernelName:ch,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{depthRadius:a,bias:s,alpha:i,beta:c}=r,l=Ol().getBool("WEBGL_PACK_NORMALIZATION")?new pq(o.shape,a,s,i,c):new dq(o.shape,a,s,i,c);return n.runWebGLProgram(l,[o],o.dtype)}};class mq{constructor(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(t,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(t," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(r,") * norm + float(").concat(n,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(r,")\n                * float(").concat(o,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(o,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")}}const gq={kernelName:lh,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:o,y:a,dy:s}=t,{depthRadius:i,bias:c,alpha:l,beta:u}=r,h=new mq(o.shape,i,c,l,u);return n.runWebGLProgram(h,[o,a,s],o.dtype)}};function yq(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{reductionIndices:a,keepDims:s}=r,i=o.shape.length,c=cl(a,o.shape);let l=c;const u=Cg(l,i),h=null!=u,d=n.shouldExecuteOnCPU([o]);let p=o;if(h){if(d){const e=n.texData.get(p.dataId).values,t=new Array(i);for(let n=0;n<t.length;n++)t[n]=o.shape[u[n]];const r=HD(e,o.shape,o.dtype,u,t);p=n.makeTensorInfo(t,o.dtype);n.texData.get(p.dataId).values=r}else p=GF(o,u,n);l=Tg(l.length,i)}_g("max",l,i);const[f,m]=kg(p.shape,l);let g,y=f;if(s&&(y=Sg(f,c)),d){const e=n.texData.get(p.dataId).values,t=OD(e,tl(m),y,o.dtype);g=n.makeTensorInfo(y,o.dtype);n.texData.get(g.dataId).values=t}else g=function(e,t,n,r){const o=tl(t),a=zF({inputs:{x:e},attrs:{shape:[tl(e.shape)/o,o]},backend:r}),s=jF(a,e.dtype,"max",r),i=zF({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),i}(p,m,y,n);return h&&n.disposeIntermediateTensorInfo(p),g}const bq={kernelName:uh,backendName:"webgl",kernelFunc:yq},vq=EF({opSnippet:pF+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+mF+"\n  return result;\n",cpuKernelImpl:MD}),wq={kernelName:hh,backendName:"webgl",kernelFunc:vq};const xq={kernelName:dh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t;FP(o,"maxPool");const{filterSize:a,strides:s,pad:i,dimRoundingMode:c}=r;Jc(bm(s,1),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(1,"'")));const l=cm(o.shape,a,s,1,i,c);if(1===l.filterWidth&&1===l.filterHeight&&nl(l.inShape,l.outShape))return yF({inputs:{x:o},backend:n});const u=new EL(l,"max",!1);return n.runWebGLProgram(u,[o],o.dtype)}};const kq={kernelName:fh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{filterSize:a,strides:s,pad:i,dataFormat:c,dimRoundingMode:l}=r,u=lm(o.shape,a,s,[1,1,1],i,l,c),h=new AL(u,"max",!1);return n.runWebGLProgram(h,[o],o.dtype)}};class Sq{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,s=o-1-e.padInfo.top,i=a-1-e.padInfo.left,c=o*a-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(o,";\n          wR += ").concat(r,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(a,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(n,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(a," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}class _q{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,s=e.dilationWidth,i=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=i-1-e.padInfo.front,h=c-1-e.padInfo.top,d=l-1-e.padInfo.left,p=i*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(i,";\n           wD += ").concat(o,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(e.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(a,") {\n            float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(e.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(e.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(p," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}}const Cq={kernelName:mh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a}=t,s=a,{filterSize:i,strides:c,pad:l,dimRoundingMode:u}=r,h=lm(s.shape,i,c,[1,1,1],l,u),d=new AL(h,"max",!0),p=n.runWebGLProgram(d,[s],s.dtype),f=new _q(h),m=n.runWebGLProgram(f,[o,p],s.dtype);return n.disposeIntermediateTensorInfo(p),m}};const Iq={kernelName:ph,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{dy:o,input:a,output:s}=t,i=a;FP([a,s],"maxPoolGrad");const{filterSize:c,strides:l,pad:u,dimRoundingMode:h}=r,d=cm(i.shape,c,l,1,u,h),p=new EL(d,"max",!0),f=n.runWebGLProgram(p,[i],i.dtype),m=new Sq(d),g=n.runWebGLProgram(m,[o,f],i.dtype);return n.disposeIntermediateTensorInfo(f),g}};const Tq={kernelName:gh,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:o}=t,{filterSize:a,strides:s,pad:i,includeBatchInIndex:c}=n,l=r;Jc(4===o.shape.length,(()=>"Error in maxPool: input must be rank 4 but got rank ".concat(o.shape.length,".")));const u=[1,1];Jc(bm(s,u),(()=>"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(u,"'")));const h=cm(o.shape,a,s,u,i),[d,p]=function(e,t,n,r){let o=new EL(n,"max",!1);const a=r.runWebGLProgram(o,[e],"float32");return o=new EL(n,"max",!0,!0,t),[a,r.runWebGLProgram(o,[e],"float32")]}(o,c,h,l);return[d,p]}};const Nq={kernelName:yh,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{x:o}=t,{keepDims:a,axis:s}=n,i=r,c=o.shape.length,l=cl(s,o.shape);let u=l;const h=Cg(u,c),d=null!=h,p=i.shouldExecuteOnCPU([o]),f=[];let m=o;if(d){if(p){const e=i.texData.get(m.dataId).values,t=new Array(c);for(let r=0;r<t.length;r++)t[r]=o.shape[h[r]];const n=HD(e,o.shape,o.dtype,h,t);m=i.makeTensorInfo(t,o.dtype);i.texData.get(m.dataId).values=n}else m=GF(o,h,i);f.push(m),u=Tg(u.length,c)}_g("sum",u,c);const[g,y]=kg(m.shape,u);let b=g;a&&(b=Sg(g,l));const v=function(e,t,n,r){const o=tl(t),a=zF({inputs:{x:e},attrs:{shape:[tl(e.shape)/o,o]},backend:r}),s=jF(a,"float32","mean",r),i=zF({inputs:{x:s},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),i}(m,y,b,i);for(const w of f)i.disposeIntermediateTensorInfo(w);return v}};const Eq={kernelName:bh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r,i=o.shape.length,c=cl(a,o.shape);let l=c;const u=Cg(l,i);let h=o;null!=u&&(h=XF({inputs:{x:o},backend:n,attrs:{perm:u}}),l=Tg(l.length,o.shape.length)),_g("min",l,i);const[d,p]=kg(h.shape,l),f=zF({inputs:{x:h},backend:n,attrs:{shape:[-1,tl(p)]}}),m=jF(f,f.dtype,"min",n);let g;if(s){g=zF({inputs:{x:m},backend:n,attrs:{shape:Sg(d,c)}})}else g=zF({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),null!=u&&n.disposeIntermediateTensorInfo(h),g}},Aq=EF({opSnippet:pF+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+mF+"\n  return result;\n",cpuKernelImpl:PD}),Rq={kernelName:vh,backendName:"webgl",kernelFunc:Aq};class Oq{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,o=mD(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c="reflect"===n?0:1;this.userCode=1!==r?"\n      ".concat(o," start = ").concat(o,"(").concat(a,");\n      ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(r,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(o," coords = outC - start;\n        setOutput(getX(").concat(i,"));\n      }\n    "):"\n        int start = ".concat(a,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")}}class Mq{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,o=mD(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),i=QD("rc",r),c=QD("source",r),l="".concat(i[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===n?0:1;let d="";if(1===r){const e="\n        ".concat(o," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(o," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        ").concat(i[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        }\n      ")}else{const e="\n        ".concat(o," source = rc;\n        ").concat(o," lt = ").concat(o,"(lessThan(source, start));\n        ").concat(o," gte = ").concat(o,"(greaterThanEqual(source, end));\n        ").concat(o," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(o," rc = outputLoc;\n        ").concat(e,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        ").concat(i[r-1]," += 1;\n        if(").concat(l,") {\n          ").concat(e,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        }\n        rc = outputLoc;\n        ").concat(i[r-2]," += 1;\n        if(").concat(i[r-2]," < ").concat(this.outputShape[r-2],") {\n          ").concat(e,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n          ").concat(i[r-1]," += 1;\n          if(").concat(l,") {\n            ").concat(e,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(o," start = ").concat(o,"(").concat(a,");\n      const ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")}}const Pq={kernelName:wh,backendName:"webgl",kernelFunc:e=>{let{inputs:t,backend:n,attrs:r}=e;const{x:o}=t,{paddings:a,mode:s}=r,i=Ol().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Mq(o.shape,a,s):new Oq(o.shape,a,s);return n.runWebGLProgram(i,[o],o.dtype)}},Dq=EF({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+mF+"\n  return result;\n"}),Fq={kernelName:xh,backendName:"webgl",kernelFunc:Dq};class Lq{constructor(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(t-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(t-1,"));\n      }\n    ")}getCustomSetupFunc(e){return(t,n)=>{null==this.seedLoc&&(this.seedLoc=t.getUniformLocation(n,"seed")),t.gl.uniform1f(this.seedLoc,e)}}}const zq=EF({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Bq={kernelName:Eu,backendName:"webgl",kernelFunc:zq},qq="return a - b;",Wq=EF({opSnippet:qq,packedOpSnippet:qq,supportsComplex:!0,cpuKernelImpl:VD}),jq={kernelName:hd,backendName:"webgl",kernelFunc:Wq};function Vq(e){const{inputs:t,backend:n,attrs:r}=e,{logits:o}=t,{dim:a}=r,s=cl([a],o.shape),i=yq({inputs:{x:o},backend:n,attrs:{reductionIndices:s,keepDims:!1}}),c=Sg(i.shape,s),l=zF({inputs:{x:i},backend:n,attrs:{shape:c}}),u=Wq({inputs:{a:o,b:l},backend:n}),h=uB({inputs:{x:u},backend:n}),d=HF({inputs:{x:h},backend:n,attrs:{axis:s,keepDims:!1}}),p=zF({inputs:{x:d},backend:n,attrs:{shape:c}}),f=zq({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const Uq={kernelName:cd,backendName:"webgl",kernelFunc:Vq};const Gq={kernelName:kh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{logits:o}=t,{numSamples:a,seed:s,normalized:i}=r,c=i?o:Vq({inputs:{logits:o},backend:n,attrs:{dim:o.shape.length-1}}),l=c.shape[0],u=c.shape[1],h=new Lq(l,u,a),d=h.getCustomSetupFunc(s),p=n.runWebGLProgram(h,[c],"int32",d);return i||n.disposeIntermediateTensorInfo(c),p}},Hq="return -x;";const Kq={kernelName:_h,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const e=n.texData.get(r.dataId),[t,o]=FD(e.values,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,t)}let o;return o=Ol().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new cF(r.shape,Hq):new nF(r.shape,Hq),n.runWebGLProgram(o,[r],r.dtype)}},Xq=Ly;const Qq={kernelName:Ih,backendName:"webgl",kernelFunc:function(e){qb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:o,scores:a}=t,{maxOutputSize:s,iouThreshold:i,scoreThreshold:c}=r,l=n.readSync(o.dataId),u=n.readSync(a.dataId),{selectedIndices:h}=Xq(l,u,s,i,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},Yq=zy;const Jq={kernelName:Th,backendName:"webgl",kernelFunc:function(e){qb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:o,scores:a}=t,{maxOutputSize:s,iouThreshold:i,scoreThreshold:c,padToMaxOutputSize:l}=r,u=n.readSync(o.dataId),h=n.readSync(a.dataId),{selectedIndices:d,validOutputs:p}=Yq(u,h,s,i,c,l);return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},Zq=By;const $q={kernelName:Nh,backendName:"webgl",kernelFunc:function(e){qb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:o,scores:a}=t,{maxOutputSize:s,iouThreshold:i,scoreThreshold:c,softNmsSigma:l}=r,u=n.readSync(o.dataId),h=n.readSync(a.dataId),d=s,p=i,f=c,m=l,{selectedIndices:g,selectedScores:y}=Zq(u,h,d,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}};class eW{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(r,"), float(").concat(n,"),\n                      float(index == coords.y)));\n      }\n    ")}}const tW={kernelName:Ah,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:o}=t,{depth:a,onValue:s,offValue:i}=r,c=tl(o.shape),l=new eW(c,a,s,i),u=zF({inputs:{x:o},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(l,[u],o.dtype);n.disposeIntermediateTensorInfo(u);const d=zF({inputs:{x:h},backend:n,attrs:{shape:[...o.shape,a]}});return n.disposeIntermediateTensorInfo(h),d}};function nW(e){const{inputs:t,backend:n}=e,{x:r}=t;if("complex64"===r.dtype){const e=YL({inputs:{input:r},backend:n}),t=nW({inputs:{x:e},backend:n}),o=hz({inputs:{input:r},backend:n}),a=nW({inputs:{x:o},backend:n}),s=vF({inputs:{real:t,imag:a},backend:n});return n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),s}return xB({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}const rW={kernelName:kd,backendName:"webgl",kernelFunc:nW};const oW={kernelName:Eh,backendName:"webgl",kernelFunc:function e(t){const{inputs:n,backend:r}=t,{x:o}=n;if("string"===o.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===o.dtype){const t=YL({inputs:{input:o},backend:r}),n=e({inputs:{x:t},backend:r}),a=hz({inputs:{input:o},backend:r}),s=nW({inputs:{x:a},backend:r}),i=vF({inputs:{real:n,imag:s},backend:r});return r.disposeIntermediateTensorInfo(t),r.disposeIntermediateTensorInfo(n),r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(s),i}return xB({attrs:{shape:o.shape,dtype:o.dtype,value:1},backend:r})}};const aW={kernelName:Rh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{axis:o}=r;if(1===t.length)return dB({inputs:{input:t[0]},backend:n,attrs:{dim:o}});const a=t[0].shape,s=t[0].dtype;t.forEach((e=>{Zc(a,e.shape,"All tensors passed to stack must have matching shapes"),Jc(s===e.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const i=[],c=mz({inputs:t.map((e=>{const t=dB({inputs:{input:e},backend:n,attrs:{dim:o}});return i.push(t),t})),backend:n,attrs:{axis:o}});return i.forEach((e=>n.disposeIntermediateTensorInfo(e))),c}};class sW{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,o=mD(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      ".concat(o," start = ").concat(o,"(").concat(a,");\n      ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(n,"));\n        } else {\n          ").concat(o," coords = outC - start;\n          setOutput(getX(").concat(i,"));\n        }\n      }\n    "):"\n        int start = ".concat(a,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(n,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")}}class iW{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(((t,n)=>t[0]+e[n]+t[1]));const r=e.length,o=mD(r),a=t.map((e=>e[0])).join(","),s=t.map(((t,n)=>t[0]+e[n])).join(","),i=QD("rc",r),c=QD("source",r),l="".concat(i[r-1]," < ").concat(this.outputShape[r-1]),u=1===r?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(o," rc = outputLoc;"),"".concat(i[r-1]," += 1;\n       if(").concat(l,") {\n      "),1===r?"":"}\n       rc = outputLoc;\n       ".concat(i[r-2]," += 1;\n       if(").concat(i[r-2]," < ").concat(this.outputShape[r-2],") {"),1===r?"":"  ".concat(i[r-1]," += 1;\n         if(").concat(l,") {")],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let f=0,m=1===r?2:4;f<m;f++)p+="\n        ".concat(h[f],"\n        if (").concat(d,") {\n          result[").concat(f,"] = float(").concat(n,");\n        } else {\n          ").concat(o," source = rc - start;\n          result[").concat(f,"] = getChannel(getX(").concat(c.join(),"), ").concat(u,");\n        }\n      ");p+=1===r?"} ":"}}",this.userCode="\n      const ".concat(o," start = ").concat(o,"(").concat(a,");\n      const ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")}}const cW=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{paddings:a,constantValue:s}=r,i=Ol().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iW(o.shape,a,s):new sW(o.shape,a,s);return n.runWebGLProgram(i,[o],o.dtype)},lW={kernelName:Oh,backendName:"webgl",kernelFunc:cW},uW=EF({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+mF+"\n  return result;\n"}),hW={kernelName:Mh,backendName:"webgl",kernelFunc:uW};const dW={kernelName:Dh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{axis:a,keepDims:s}=r,i=o.shape.length,c=[],l=cl(a,o.shape);let u=l;const h=Cg(u,i);let d,p=o;if(null!=h&&(p=XF({inputs:{x:o},backend:n,attrs:{perm:h}}),u=Tg(u.length,i),c.push(p)),_g("prod",u,i),n.shouldExecuteOnCPU([p])){const e=n.texData.get(p.dataId).values,{outVals:t,outShape:r,outDtype:o}=LD(p.shape,p.dtype,e,u);d=n.makeTensorInfo(r,o,t)}else{const[e,t]=kg(p.shape,u),r=tl(t),a=zF({inputs:{x:p},backend:n,attrs:{shape:[-1,r]}}),s=jF(a,lp(o.dtype),"prod",n);d=zF({inputs:{x:s},backend:n,attrs:{shape:e}}),c.push(a),c.push(s)}if(s){c.push(d);const e=Sg(d.shape,l);d=zF({inputs:{x:d},backend:n,attrs:{shape:e}})}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),d}},pW=e=>{const{backend:t,attrs:n}=e,{start:r,stop:o,step:a,dtype:s}=n,i=zD(r,o,a,s);return t.makeTensorInfo([i.length],s,i)},fW={kernelName:Fh,backendName:"webgl",kernelFunc:pW},mW=NF({opSnippet:"return 1.0 / x;"}),gW={kernelName:zh,backendName:"webgl",kernelFunc:mW},yW=NF({opSnippet:rF+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),bW={kernelName:Bh,backendName:"webgl",kernelFunc:yW},vW=NF({opSnippet:rF+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),wW={kernelName:Gh,backendName:"webgl",kernelFunc:vW};class xW{constructor(e,t,n,r,o){this.variableNames=["A"],this.outputShape=[];const[a,s,i,c]=e;this.outputShape=[a,t,n,c];const l=[r&&t>1?s-1:s,r&&n>1?i-1:i],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=o?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(i,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")}}class kW{constructor(e,t,n,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,s,i,c]=e;this.outputShape=[a,t,n,c];const l=[r&&t>1?s-1:s,r&&n>1?i-1:i],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];let h;h=o?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],",\n          ").concat(l[1]/u[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(i,".0,\n                                     ").concat(i,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(n-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}}const SW={kernelName:Vh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o}=t,{alignCorners:a,halfPixelCenters:s,size:i}=r,[c,l]=i,u=Ol().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new kW(o.shape,c,l,a,s):new xW(o.shape,c,l,a,s);return n.runWebGLProgram(u,[o],"float32")}};class _W{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,a,s]=e,i=[n&&a>1?r-1:r,n&&s>1?o-1:o],c=[n&&a>1?a-1:a,n&&s>1?s-1:s],l=i[0]/c[0],u=i[1]/c[1],h=1/l,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(p,");\n        const int winWidth = int(").concat(f,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(a,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(r-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const CW={kernelName:Uh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o,dy:a}=t,{alignCorners:s}=r,i=new _W(a.shape,o.shape,s);return n.runWebGLProgram(i,[a],a.dtype)}};class IW{constructor(e,t,n,r,o){this.variableNames=["A"],this.outputShape=[];const[a,s,i,c]=e;this.outputShape=[a,t,n,c];const l=[r&&t>1?s-1:s,r&&n>1?i-1:i],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0";let d;d=o?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/u[0],",\n          ").concat(l[1]/u[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(i,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}}const TW={kernelName:Wh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o}=t,{alignCorners:a,halfPixelCenters:s,size:i}=r,[c,l]=i,u=new IW(o.shape,c,l,a,s);return n.runWebGLProgram(u,[o],o.dtype)}};class NW{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,a,s]=e,i=[n&&a>1?r-1:r,n&&s>1?o-1:o],c=[n&&a>1?a-1:a,n&&s>1?s-1:s],l=i[0]/c[0],u=i[1]/c[1],h=1/l,d=1/u,p=2*Math.ceil(h)+2,f=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(l,");\n        const float widthScale = float(").concat(u,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(d,");\n\n        const int winHeight = int(").concat(p,");\n        const int winWidth = int(").concat(f,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(a,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(s,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(i[0],") *\n                (float(dyR) / float(").concat(c[0],"));\n\n            float sourceFracCol =\n                float(").concat(i[1],") *\n                  (float(dyC) / float(").concat(c[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(r,") - 1),\n                ").concat(n," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(n," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}}const EW={kernelName:jh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{images:o,dy:a}=t,{alignCorners:s}=r,i=new NW(a.shape,o.shape,s);return n.runWebGLProgram(i,[a],a.dtype)}};class AW{constructor(e,t){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(e[0]," - coord - 1));\n        }\n      "));const r=e.map(((n,r)=>(n=>-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - coords[").concat(n,"] - 1"):"coords[".concat(n,"]"))(r))).join(","),o=mD(n);this.userCode="\n      void main() {\n        ".concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(r,"));\n      }\n    ")}}class RW{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;const r=QD("rc",n),o="".concat(r[n-1]," + 1 < ").concat(this.outputShape[n-1]),a="".concat(r[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=mD(n);function i(n){const r=e.map(((r,o)=>function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?"".concat(e[n]," - ").concat(r[n]," - 1"):"".concat(r[n])}(o,n))),o=r.join(","),a=r.slice(-2).join(",");return"getChannel(getX(".concat(o,"), vec2(").concat(a,"))")}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(e[0]," - rc - 1),\n            ").concat(e[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(e[0]," - (rc  + 1) - 1),\n                ").concat(e[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return i(e)}(r.slice()),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",i(e)}(r.slice()),";\n          }\n          if(").concat(a,") {\n            result.b = ").concat(function(e){return e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",i(e)}(r.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}}const OW={kernelName:Hh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{dims:a}=r,s=o.shape.length,i=cl(a,o.shape);if(0===s)return yF({inputs:{x:o},backend:n});const c=Ol().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RW(o.shape,i):new AW(o.shape,i);return n.runWebGLProgram(c,[o],o.dtype)}};class MW{constructor(e,t,n,r){this.variableNames=["Image"],this.outputShape=[];const o=e[1],a=e[2],s=Math.sin(t).toFixed(3),i=Math.cos(t).toFixed(3);this.outputShape=e;const[c,l]=kb(r,o,a),u=c.toFixed(3),h=l.toFixed(3);let d="";d="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ".concat(u,") * ").concat(i," - (float(y) - ").concat(h,") * ").concat(s,";\n          float coordYFloat = (float(x) - ").concat(u,") * ").concat(s," + (float(y) - ").concat(h,") * ").concat(i,";\n          int coordX = int(round(coordXFloat + ").concat(u,"));\n          int coordY = int(round(coordYFloat + ").concat(h,"));\n          ").concat(d,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(o,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")}}const PW={kernelName:Cd,backendName:"webgl",kernelFunc:e=>{let{inputs:t,attrs:n,backend:r}=e;const{image:o}=t,{radians:a,fillValue:s,center:i}=n,c=r,l=new MW(o.shape,a,s,i);return c.runWebGLProgram(l,[o],o.dtype)}},DW=NF({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),FW={kernelName:Kh,backendName:"webgl",kernelFunc:DW},LW=NF({opSnippet:"return inversesqrt(x);",cpuKernelImpl:BD}),zW={kernelName:Xh,backendName:"webgl",kernelFunc:LW};class BW{constructor(e,t,n,r,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const s=mD(o.length),i=mD(a.length);let c="";1===n?c="i":2===n&&(c="i, j");const l="getIndices(".concat(c,")");let u="";1===r?u="i":2===r&&(u="i, coords[1]");const h="getUpdates(".concat(u,")"),d=t>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(o,");\n\n        void main() {\n          ").concat(i," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(e,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(t,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(d,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(h,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}}const qW={kernelName:Qh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{indices:o,updates:a}=t,{shape:s}=r,{sliceRank:i,numUpdates:c,sliceSize:l,strides:u,outputSize:h}=Rb(0,o,s),d=[h/l,l];if(0===h)return n.makeTensorInfo(s,o.dtype);const p=zF({inputs:{x:o},backend:n,attrs:{shape:[c,i]}}),f=zF({inputs:{x:a},backend:n,attrs:{shape:[c,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new BW(c,i,p.shape.length,f.shape.length,u,d),y=n.runWebGLProgram(g,[f,p,m],f.dtype),b=zF({inputs:{x:y},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}};class WW{constructor(e,t,n){let r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(1===n)o="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[];for(let r=0;r<t.length;r++)s.push("".concat(n[r])),r<e&&a.push("".concat(n[r]));r=a.join(),o=s.join()}const a=mD(n);this.userCode="\n      void main() {\n        ".concat(a," resRC = getOutputCoords();\n        float cVal = getC(").concat(r,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(o,"));\n        } else {\n          setOutput(getB(").concat(o,"));\n        }\n      }\n    ")}}const jW={kernelName:Yh,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n}=e,{condition:r,t:o,e:a}=t,s=new WW(r.shape.length,o.shape,o.shape.length);return n.runWebGLProgram(s,[r,o,a],cp(o.dtype,a.dtype))}},VW=NF({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(Ob,";\n  float scale = ").concat(Mb,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),UW={kernelName:Jh,backendName:"webgl",kernelFunc:VW},GW=NF({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"}),HW={kernelName:nd,backendName:"webgl",kernelFunc:GW},KW=NF({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),XW={kernelName:td,backendName:"webgl",kernelFunc:KW},QW=NF({opSnippet:TF+"\n  return sin(x);\n"}),YW={kernelName:$h,backendName:"webgl",kernelFunc:QW},JW=NF({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),ZW={kernelName:ed,backendName:"webgl",kernelFunc:JW},$W=NF({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),ej={kernelName:rd,backendName:"webgl",kernelFunc:$W},tj={kernelName:sd,backendName:"webgl",kernelFunc:e=>{const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{blockShape:a,paddings:s}=r;Jc(o.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const i=a.reduce(((e,t)=>e*t)),c=[[0,0]];c.push(...s);for(let y=1+a.length;y<o.shape.length;++y)c.push([0,0]);const l=[],u=cW({inputs:{x:o},backend:n,attrs:{paddings:c,constantValue:0}}),h=Sb(u.shape,a,i,!1),d=_b(h.length,a.length,!1),p=Cb(u.shape,a,i,!1),f=zF({inputs:{x:u},backend:n,attrs:{shape:h}}),m=XF({inputs:{x:f},backend:n,attrs:{perm:d}}),g=zF({inputs:{x:m},backend:n,attrs:{shape:p}});return l.push(u),l.push(f),l.push(m),l.forEach((e=>n.disposeIntermediateTensorInfo(e))),g}};const nj={kernelName:dd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:o,sparseValues:a,defaultValue:s}=t,{outputShape:i}=r,{sliceRank:c,numUpdates:l,strides:u,outputSize:h}=Rb(0,o,i),d=new BW(l,c,o.shape.length,a.shape.length,u,[h,1],!1),p=n.runWebGLProgram(d,[a,o,s],a.dtype),f=zF({inputs:{x:p},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(p),f}};const rj={kernelName:id,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{numOrSizeSplits:a,axis:s}=r,i=cl(s,o.shape)[0],c=Yb(o,a,i),l=o.shape.length,u=new Array(l).fill(0),h=o.shape.slice();return c.map((e=>{const t=[...h];t[i]=e;const r=UL({inputs:{x:o},backend:n,attrs:{begin:u,size:t}});return u[i]+=e,r}))}},oj=NF({opSnippet:"return sqrt(x);"}),aj={kernelName:od,backendName:"webgl",kernelFunc:oj},sj={kernelName:ud,backendName:"webgl",kernelFunc:NF({opSnippet:"return x * x;"})},ij="return (a - b) * (a - b);",cj=EF({opSnippet:ij,packedOpSnippet:ij}),lj={kernelName:ld,backendName:"webgl",kernelFunc:cj};const uj={kernelName:Sd,backendName:"webgl",kernelFunc:function(e){let{inputs:t,attrs:n,backend:r}=e;const{x:o}=t,a=rF+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),s=new nF(o.shape,a);return r.runWebGLProgram(s,[o],o.dtype)}};class hj{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,o=mD(n.length),a=mD(n.length);let s="";if(1===r)s="coords * strides + begin";else{let e=0;s=n.map(((t,r)=>(e++,1===n.length?"coords * strides[".concat(r,"] + begin[").concat(r,"]"):"coords[".concat(e-1,"] * strides[").concat(r,"] + begin[").concat(r,"]")))).join(",")}this.userCode="\n      ".concat(o," begin = ").concat(o,"(").concat(e,");\n      ").concat(o," strides = ").concat(o,"(").concat(t,");\n\n      void main() {\n        ").concat(a," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}}const dj={kernelName:pd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{begin:a,end:s,strides:i,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:d}=r,{nonStrided:p,$begin:f,$strides:m,size:g,newShape:y,outShape:b}=jf(o.shape,a,s,i,c,l,u,h,d),v=zF({inputs:{x:o},backend:n,attrs:{shape:y}});let w;if(p){const e=UL({inputs:{x:v},backend:n,attrs:{begin:f,size:g}});w=zF({inputs:{x:e},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(e)}else if(b.some((e=>0===e)))w=n.makeTensorInfo(b,o.dtype,[]);else{if(n.shouldExecuteOnCPU([v])){const e=n.texData.get(v.dataId).values,t=pf(v.shape,v.dtype,e),r=jD(b,t,m,f);w=n.makeTensorInfo(b,v.dtype,r.values)}else{const e=new hj(f,m,b);w=n.runWebGLProgram(e,[v],v.dtype)}}const x=zF({inputs:{x:w},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),x}},pj=NF({opSnippet:"return tan(x);"}),fj={kernelName:fd,backendName:"webgl",kernelFunc:pj},mj=NF({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),gj={kernelName:md,backendName:"webgl",kernelFunc:mj};class yj{constructor(e,t){this.variableNames=["A"];const n=new Array(e.length);for(let a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;const r=mD(this.rank),o=function(e){const t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<e.length;o++)r.push("imod(".concat(n[o],", ").concat(e[o],")"));return r.join()}(e);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}}function bj(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{reps:a}=r;if("string"===o.dtype){const e=n.readSync(o.dataId).map((e=>Qd(e))),t=pf(o.shape,o.dtype,e),r=UD(t,a);return n.makeTensorInfo(r.shape,r.dtype,r.values)}const s=new yj(o.shape,a);return n.runWebGLProgram(s,[o],o.dtype)}const vj={kernelName:gd,backendName:"webgl",kernelFunc:bj};const wj={kernelName:yd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o}=t,{k:a,sorted:s}=r,i=n.readSync(o.dataId),[c,l]=GD(i,o.shape,o.dtype,a,s);return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};const xj={kernelName:vd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,attrs:n,backend:r}=e,{axis:o}=n,{x:a}=t;FP(a,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const s=r.readSync(a.dataId),{outputValues:i,outputShape:c,indices:l}=KD(s,o,a.shape,a.dtype);return[r.makeTensorInfo(c,a.dtype,i),r.makeTensorInfo([l.length],"int32",l)]}};const kj={kernelName:wd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{value:o}=t;let{axis:a}=r;a<0&&(a+=o.shape.length);const s=o,i=s.shape.length,c=o.shape[a],l=new Array(i-1);let u=0;for(let m=0;m<i;m++)m!==a&&(l[u++]=s.shape[m]);const h=[],d=new Array(i).fill(0),p=s.shape.slice();p[a]=1;const f=new Array(c);for(let m=0;m<f.length;m++){d[a]=m;const e=UL({inputs:{x:s},backend:n,attrs:{begin:d,size:p}}),t=zF({inputs:{x:e},backend:n,attrs:{shape:l}});f[m]=t,h.push(e)}return h.forEach((e=>n.disposeIntermediateTensorInfo(e))),f}};class Sj{constructor(e,t){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,s=a*Math.ceil(o/n);this.outputShape=[r,s];const i=4*Math.floor(n/4),c=n%4,l="\n        sumValue += dot(values, segFilter);\n    ";let u="";o%n>0&&(u="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return initializationValue;\n        }\n      "));let h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(u,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(a,")) * float(").concat(n,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(a,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(i,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(i,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}}const _j={kernelName:xd,backendName:"webgl",kernelFunc:function(e){const{inputs:t,backend:n,attrs:r}=e,{x:o,segmentIds:a}=t,{numSegments:s}=r,i=o.shape.length,c=[];let l=0;const u=Cg([l],i);let h=o;null!=u&&(h=XF({inputs:{x:o},backend:n,attrs:{perm:u}}),c.push(h),l=Tg(1,i)[0]);const d=Zb(h.shape,l,s),p=tl([h.shape[l]]),f=zF({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});c.push(f);const m=lp(o.dtype),g=(e,t,r,o,a)=>{const s=e.shape[0],i=e.shape[1],l=Jb(i,a),u=new Sj({windowSize:l,inSize:i,batchSize:s,numSegments:a},t),h=n.compileAndRun(u,[e,r],o);if(c.push(h),h.shape[1]===a)return h;const d=pW({backend:n,attrs:{start:0,stop:a,step:1,dtype:"float32"}}),p=bj({inputs:{x:d},backend:n,attrs:{reps:[i/l]}});c.push(d),c.push(p);return g(h,t,p,o,a)},y=zF({inputs:{x:g(f,"unsortedSegmentSum",a,m,s)},backend:n,attrs:{shape:d}});let b=y;if(null!=u){c.push(y);const e=Ig(u);b=XF({inputs:{x:b},backend:n,attrs:{perm:e}})}return c.forEach((e=>n.disposeIntermediateTensorInfo(e))),b}},Cj=[fq,gq,JF,$F,tL,rL,sL,lL,uL,hL,yL,bL,wL,kL,IL,_L,NL,OL,RL,DL,FL,LL,qL,HL,KL,ZL,tz,oz,iz,wF,gz,Tz,Nz,kz,Az,Rz,Ez,Mz,Dz,Lz,Wz,jz,Uz,Yz,Jz,Kz,$z,tB,rB,oB,sB,cB,hB,pB,gB,vB,kB,_B,TB,EB,OB,PB,DB,LB,BB,WB,VB,bF,UB,dz,HB,XB,YB,SF,ZB,eq,tq,aq,rq,iq,lq,hq,bq,kq,xq,Cq,Iq,Tq,wq,Nq,Eq,Rq,Pq,Fq,Gq,LF,Kq,Qq,Jq,$q,QL,tW,oW,aW,lW,hW,IF,dW,fW,JL,Bq,gW,wW,bW,BF,SW,CW,TW,EW,OW,PW,FW,zW,qW,jW,UW,HW,XW,YW,ZW,GL,Uq,ej,tj,nj,rj,aj,sj,lj,uj,dj,jq,KF,fj,gj,vj,wj,QF,xj,kj,_j,rW];for(const z2 of Cj)Pd(z2);class Ij{constructor(e){this.depth=e}}class Tj extends Ij{constructor(e){super(e.numBits)}getTensors(e){const t=pf([e,this.depth]);for(let n=0;n<e;++n)for(let e=0;e<this.depth;++e)t.set(Math.floor((n+1)/Math.pow(2,e))%2?1:-1,n,e);return t.toTensor().as2D(e,this.depth)}}var Nj="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),Ej=function(e){return"string"!==typeof e?Nj.slice():Nj.filter((function(t){var n=t[1]||" ";return-1!==e.indexOf(n)}))},Aj=(Ej(" #"),Ej(" b"),/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/);function Rj(e){"string"!==typeof e&&(e="");var t=Aj.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}var Oj=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),Mj=[0,2,4,5,7,9,11],Pj=function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(e){var t=Rj(e);if(""===t[0]||""!==t[3])return Oj;var n=t[0],r=t[1],o=t[2],a={letter:n,acc:r,octStr:o,pc:n+r,name:n+r+o,step:(n.charCodeAt(0)+3)%7,alt:"b"===r[0]?-r.length:r.length,oct:o.length?+o:null,chroma:0,midi:null,freq:null};return a.chroma=(Mj[a.step]+a.alt+120)%12,a.midi=null!==a.oct?Mj[a.step]+a.alt+12*(a.oct+1):null,a.freq=Dj(a.midi),Object.freeze(a)})),Dj=function(e,t){return void 0===t&&(t=440),"number"===typeof e?Math.pow(2,(e-69)/12)*t:null},Fj=(Math.log(2),Math.log(440),function(e){return Pj(e).chroma}),Lj=function(e,t){return Array(t+1).join(e)},zj=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},Pj(t),e):e,r=n.step,o=n.alt,a=n.oct;if("number"!==typeof r)return null;var s=function(e){return"CDEFGAB"[e]}(r);if(!s)return null;var i=s+function(e){return function(e,t){return"number"!==typeof e?"":t(e)}(e,(function(e){return e<0?Lj("b",-e):Lj("#",e)}))}(o);return a||0===a?i+a:i};var Bj=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),qj=[0,2,4,5,7,9,11],Wj="PMMPPMM",jj=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null})),Vj=function(e){return(Math.abs(e)-1)%7},Uj=function(e){var t=function(e){var t=Bj.exec(""+e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(null===t)return jj;var n={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return n.num=+t[0],n.q=t[1],n.step=Vj(n.num),n.type=Wj[n.step],"M"===n.type&&"P"===n.q?jj:(n.name=""+n.num+n.q,n.dir=n.num<0?-1:1,n.simple=8===n.num||-8===n.num?n.num:n.dir*(n.step+1),n.alt=function(e,t){return"M"===t&&"M"===e||"P"===t&&"P"===e?0:"m"===t&&"M"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?"P"===e?-t.length:-t.length-1:null}(n.type,n.q),n.oct=Math.floor((Math.abs(n.num)-1)/7),n.semitones=n.dir*(qj[n.step]+n.alt+12*n.oct),n.chroma=(n.dir*(qj[n.step]+n.alt)%12+12)%12,Object.freeze(n))},Gj={};function Hj(e){return"string"!==typeof e?jj:Gj[e]||(Gj[e]=Uj(e))}"P m M m M P d P m M m M".split(" ");var Kj=[0,2,4,-1,1,3,5],Xj=Kj.map((function(e){return Math.floor(7*e/12)})),Qj=[3,0,4,1,5,2,6];var Yj=function(e,t,n){var r=Qj[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],o=Math.floor((e+1)/7);return void 0===t?{step:r,alt:o,dir:n}:{step:r,alt:o,oct:t+4*o+Xj[r],dir:n}},Jj=function(e){return function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,o=e.dir;void 0===o&&(o=1);var a=Kj[t]+7*n;return null===r?[o*a]:[o*a,o*(r-Xj[t]-4*n)]}(n)}))},Zj=Jj(Pj),$j=Jj(Hj);function eV(e,t){if(1===arguments.length)return function(t){return eV(e,t)};var n=Zj(e),r=$j(t);if(null===n||null===r)return null;var o=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return zj(Yj(o[0],o[1]))}const tV=JSON.parse('{"chromatic":["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],"lydian":["1P 2M 3M 4A 5P 6M 7M"],"major":["1P 2M 3M 4P 5P 6M 7M",["ionian"]],"mixolydian":["1P 2M 3M 4P 5P 6M 7m",["dominant"]],"dorian":["1P 2M 3m 4P 5P 6M 7m"],"aeolian":["1P 2M 3m 4P 5P 6m 7m",["minor"]],"phrygian":["1P 2m 3m 4P 5P 6m 7m"],"locrian":["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"altered":["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"diminished":["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"iwato":["1P 2m 4P 5d 7m"],"hirajoshi":["1P 2M 3m 5P 6m"],"kumoijoshi":["1P 2m 4P 5P 6m"],"pelog":["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus":["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"ritusen":["1P 2M 4P 5P 6M"],"scriabin":["1P 2m 3M 5P 6M"],"piongio":["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented":["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"egyptian":["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"oriental":["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"flamenco":["1P 2m 3m 3M 4A 5P 7m"],"balinese":["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"persian":["1P 2m 3M 4P 5d 6m 7M"],"bebop":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"enigmatic":["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"ichikosucho":["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}'),nV=JSON.parse('{"4":["1P 4P 7m 10m",["quartal"]],"5":["1P 5P"],"7":["1P 3M 5P 7m",["Dominant","Dom"]],"9":["1P 3M 5P 7m 9M",["79"]],"11":["1P 5P 7m 9M 11P"],"13":["1P 3M 5P 7m 9M 13M",["13_"]],"64":["5P 8P 10M"],"M":["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13":["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6":["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69":["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M7add13":["1P 3M 5P 6M 7M 9M"],"M7b5":["1P 3M 5d 7M"],"M7b6":["1P 3M 6m 7M"],"M7b9":["1P 3M 5P 7M 9m"],"M7sus4":["1P 4P 5P 7M"],"M9":["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"M9b5":["1P 3M 5d 7M 9M"],"M9sus4":["1P 4P 5P 7M 9M"],"Madd9":["1P 3M 5P 9M",["2","add9","add2"]],"Maj7":["1P 3M 5P 7M",["maj7","M7"]],"Mb5":["1P 3M 5d"],"Mb6":["1P 3M 13m"],"Msus2":["1P 2M 5P",["add9no3","sus2"]],"Msus4":["1P 4P 5P",["sus","sus4"]],"Maddb9":["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m":["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],"m11":["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m11b5":["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],"m13":["1P 3m 5P 7m 9M 11P 13M",["_13"]],"m6":["1P 3m 4P 5P 13M",["_6"]],"m69":["1P 3m 5P 6M 9M",["_69"]],"m7":["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],"m7add11":["1P 3m 5P 7m 11P",["m7add4"]],"m7b5":["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],"m9":["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],"m9b5":["1P 3m 7m 12d 2M",["h9","-9b5"]],"mMaj7":["1P 3m 5P 7M",["mM7","_M7"]],"mMaj7b6":["1P 3m 5P 6m 7M",["mM7b6"]],"mM9":["1P 3m 5P 7M 9M",["mMaj9","-M9"]],"mM9b6":["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],"mb6M7":["1P 3m 6m 7M"],"mb6b9":["1P 3m 6m 9m"],"o":["1P 3m 5d",["mb5","dim"]],"o7":["1P 3m 5d 13M",["diminished","m6b5","dim7"]],"o7M7":["1P 3m 5d 6M 7M"],"oM7":["1P 3m 5d 7M"],"sus24":["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],"madd4":["1P 3m 4P 5P"],"madd9":["1P 3m 5P 9M"]}');var rV=function(e){return Fj(e)||function(e){return Hj(e).chroma}(e)||0};function oV(e){if(sV(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(rV).forEach((function(e){t[e]=1})),t.join("")}var aV=/^[01]{12}$/;function sV(e){return aV.test(e)}"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");var iV=function(e){var t=Object.keys(e).sort(),n=[],r=[],o=function(e,t,o){n[e]=t,r[o]=r[o]||[],r[o].push(e)};t.forEach((function(t){var n=e[t][0].split(" "),r=e[t][1],a=oV(n);o(t,n,a),r&&r.forEach((function(e){return o(e,n,a)}))}));var a=Object.keys(n).sort(),s=function(e){return n[e]};return s.names=function(e){return"string"===typeof e?(r[e]||[]).slice():(!0===e?a:t).slice()},s},cV=iV(tV),lV=iV(nV),uV=(function(e,t){var n=function(n){return e(n)||t(n)};n.names=function(n){return e.names(n).concat(t.names(n))}}(cV,lV),Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}));cV.names;lV.names;var hV=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),dV=function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(e){var t=lV(e);if(!t)return hV;var n={intervals:t,name:e};return n.chroma=oV(t),n.setnum=parseInt(n.chroma,2),n.names=lV.names(n.chroma),n})),pV=function(e){return dV(gV(e)[1]).intervals};var fV=function(e){return void 0!==lV(gV(e)[1])},mV=/^(6|64|7|9|11|13)$/;function gV(e){var t=Rj(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:mV.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}const yV=120,bV=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],vV=127,wV="N.C.",xV=12,kV=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];var SV;!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(SV||(SV={}));class _V extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class CV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class IV{static pitches(e){if(!gV(e)[0]||!fV(e))throw new _V("Unrecognized chord symbol: ".concat(e));return function(e,t){if(t)return dV(t).intervals.map(eV(e));var n=gV(e),r=n[0],o=n[1];return dV(o).intervals.map(eV(r))}(e).map(Fj)}static root(e){const t=gV(e)[0];if(!t)throw new _V("Chord symbol has unknown root: ".concat(e));return Fj(t)}static quality(e){if(!fV(e))throw new _V("Unrecognized chord symbol: ".concat(e));const t=pV(e),n=kV.map((e=>e.every((e=>t.includes(e))))),r=n.indexOf(!0),o=n.lastIndexOf(!0);return r>=0&&r===o?r:SV.Other}}class TV{encodeProgression(e,t){const n=e.map((e=>this.encode(e))),r=Array.from(Array(t).keys()).map((e=>Math.floor(e*n.length/t)));return oy(r.map((e=>n[e])))}}class NV extends TV{constructor(){super(...arguments),this.depth=25}index(e){if(e===wV)return 0;const t=IV.root(e),n=1+IV.quality(e)*xV+t;if(n>=this.depth)throw new CV("Chord is neither major nor minor: ".concat(e));return n}encode(e){return Qf((()=>Pg(ay([this.index(e)],"int32"),this.depth).as1D()))}}class EV extends TV{constructor(){super(...arguments),this.depth=49}index(e){if(e===wV)return 0;const t=IV.root(e),n=1+IV.quality(e)*xV+t;if(n>=this.depth)throw new CV("Chord is not a standard triad: ".concat(e));return n}encode(e){return Qf((()=>Pg(ay([this.index(e)],"int32"),this.depth).as1D()))}}class AV extends TV{constructor(){super(...arguments),this.depth=37}encode(e){return Qf((()=>{if(e===wV)return Pg(ay([0],"int32"),this.depth).as1D();const t=IV.root(e),n=Pg(ay([t],"int32"),xV).as1D(),r=pf([xV]);IV.pitches(e).forEach((e=>r.set(1,e)));const o=r.toTensor().as1D(),a=n;return Dm([ay([0]),n,o,a])}))}}var RV=__webpack_require__(3457).tensorflow.magenta.NoteSequence;const OV=function(){if("undefined"!==typeof globalThis)return globalThis;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof __webpack_require__.g)return __webpack_require__.g;throw new Error("cannot find the global object")}();OV.fetch.bind(OV),OV.performance,OV.navigator,OV.webkitOfflineAudioContext,OV.WorkerGlobalScope;const MV="undefined"!==typeof __webpack_require__.g&&"undefined"!==typeof __webpack_require__.g.process,PV=MV?__webpack_require__(7541):window.fetch.bind(window),DV=MV?__webpack_require__(8791):window.performance;MV?__webpack_require__(8062):window.navigator;var FV;!function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(FV||(FV={}));function LV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Magenta.js",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(0===n)throw Error("Logging level cannot be NONE.");if(10>=n){(5===n?console.warn:console.log)("%c ".concat(t," "),"background:magenta; color:white",e)}}function zV(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Magenta.js",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;const o=(DV.now()-t)/1e3;LV("".concat(e," in ").concat(o.toPrecision(3),"s"),n,r)}class BV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class qV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class WV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class jV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class VV extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function UV(e){return RV.decode(RV.encode(e).finish())}function GV(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;const r=e*t;return Math.floor(r+(1-n))}function HV(e){return e.controlChanges.concat(e.textAnnotations)}function KV(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort(((e,t)=>e.time-t.time)),0!==e.tempos[0].time&&e.tempos[0].qpm!==yV)throw new jV("NoteSequence has an implicit tempo change from initial "+"".concat(yV," qpm to ")+"".concat(e.tempos[0].qpm," qpm at ").concat(e.tempos[0].time," seconds."));for(let t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new jV("NoteSequence has at least one tempo change from "+"".concat(e.tempos[0].qpm," qpm to ").concat(e.tempos[t].qpm)+"qpm at ".concat(e.tempos[t].time," seconds."))}}function XV(e,t){const n=UV(e);if(n.quantizationInfo=RV.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort(((e,t)=>e.time-t.time)),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new BV("NoteSequence has an implicit change from initial 4/4 time "+"signature to ".concat(n.timeSignatures[0].numerator,"/")+"".concat(n.timeSignatures[0].denominator," at ")+"".concat(n.timeSignatures[0].time," seconds."));for(let e=1;e<n.timeSignatures.length;e++){const t=n.timeSignatures[e];if(t.numerator!==n.timeSignatures[0].numerator||t.denominator!==n.timeSignatures[0].denominator)throw new BV("NoteSequence has at least one time signature change from "+"".concat(n.timeSignatures[0].numerator,"/")+"".concat(n.timeSignatures[0].denominator," to ")+"".concat(t.numerator,"/").concat(t.denominator," ")+"at ".concat(t.time," seconds"))}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{const e=RV.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(e)}const r=n.timeSignatures[0];if(!(o=r.denominator)||0!==(o&o-1))throw new qV("Denominator is not a power of 2. Time signature: "+"".concat(r.numerator,"/").concat(r.denominator));var o;if(0===r.numerator)throw new qV("Numerator is 0. Time signature: "+"".concat(r.numerator,"/").concat(r.denominator));if(n.tempos.length>0)KV(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{const e=RV.Tempo.create({qpm:yV,time:0});n.tempos.push(e)}const a=function(e,t){return e*t/60}(t,n.tempos[0].qpm);return n.totalQuantizedSteps=GV(e.totalTime,a),function(e,t){for(const n of e.notes){if(n.quantizedStartStep=GV(n.startTime,t),n.quantizedEndStep=GV(n.endTime,t),n.quantizedEndStep===n.quantizedStartStep&&(n.quantizedEndStep+=1),n.quantizedStartStep<0||n.quantizedEndStep<0)throw new WV("Got negative note time: start_step = "+"".concat(n.quantizedStartStep,", end_step = ")+"".concat(n.quantizedEndStep));n.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=n.quantizedEndStep)}HV(e).forEach((e=>{if(e.quantizedStep=GV(e.time,t),e.quantizedStep<0)throw new WV("Got negative event time: step = ".concat(e.quantizedStep))}))}(n,a),n}function QV(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function YV(e){if(!QV(e))throw new VV("NoteSequence ".concat(e.id," is not quantized (missing quantizationInfo)"))}function JV(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function ZV(e){if(!JV(e))throw new VV("NoteSequence ".concat(e.id," is not quantized or is quantized based on absolute timing"))}function $V(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yV;return RV.create({quantizationInfo:{stepsPerQuarter:e},tempos:[{qpm:t}]})}class eU{constructor(e,t,n){this.events=e,this.minPitch=t,this.maxPitch=n}static fromNoteSequence(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4?arguments[4]:void 0;YV(e);const a=e.notes.sort(((e,t)=>e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep)),s=new Int32Array(o||e.totalQuantizedSteps);let i=-1;return a.forEach((e=>{if(e.quantizedStartStep===i){if(r)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<t||e.pitch>n)throw Error("`NoteSequence` has a pitch outside of the valid range: "+"".concat(e.pitch));s[e.quantizedStartStep]=e.pitch-t+2,s[e.quantizedEndStep]=1,i=e.quantizedStartStep})),new eU(s,t,n)}toNoteSequence(e,t){const n=$V(e,t);let r=null;for(let o=0;o<this.events.length;++o){const e=this.events[o];switch(e){case 0:break;case 1:r&&(r.quantizedEndStep=o,n.notes.push(r),r=null);break;default:r&&(r.quantizedEndStep=o,n.notes.push(r)),r=RV.Note.create({pitch:e-2+this.minPitch,quantizedStartStep:o})}}return r&&(r.quantizedEndStep=this.events.length,n.notes.push(r)),n.totalQuantizedSteps=this.events.length,n}}class tU{constructor(){this.depth=1}extract(e){const t=e.events.length,n=pf([t,1]);for(let r=0;r<t;++r)n.set(e.events[r]>=2?1:0,r,0);return n.toTensor().as2D(t,1)}}class nU{constructor(){this.depth=3}extract(e){const t=e.events.length,n=pf([t,3]);let r=null,o=null;for(let a=0;a<t;++a)if(e.events[a]>=2){if(null!==r){let t;0===n.get(r,0)&&0===n.get(r,1)&&0===n.get(r,2)&&(r=-1),t=e.events[a]<o?0:e.events[a]>o?2:1;for(let e=a;e>r;--e)n.set(1,e,t)}r=a,o=e.events[a]}if(r!==t-1)if(null===r||0===n.get(r,0)&&0===n.get(r,1)&&0===n.get(r,2))for(let a=0;a<t;++a)n.set(1,a,1);else for(let a=t-1;a>r;--a)for(let e=0;e<3;e++)n.set(n.get(r,e),a,e);return n.toTensor().as2D(t,3)}}class rU{constructor(e,t,n,r,o){this.events=e,this.maxShiftSteps=t,this.numVelocityBins=n,this.program=r,this.isDrum=o}static fromNoteSequence(e,t,n,r){YV(e);const o=e.notes.filter(((e,t)=>void 0===r||e.instrument===r)),a=o.sort(((e,t)=>e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime)),s=a.map(((e,t)=>({step:e.quantizedStartStep,index:t,isOffset:0}))),i=a.map(((e,t)=>({step:e.quantizedEndStep,index:t,isOffset:1}))),c=s.concat(i).sort(((e,t)=>e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step)),l=n?Math.ceil(127/n):void 0,u=[];let h=0,d=n;for(const y of c){if(y.step>h){for(;y.step>h+t;)u.push({type:"time-shift",steps:t}),h+=t;u.push({type:"time-shift",steps:y.step-h}),h=y.step}if(y.isOffset)u.push({type:"note-off",pitch:a[y.index].pitch});else{if(l){const e=Math.floor((a[y.index].velocity-0-1)/l)+1;e!==d&&(u.push({type:"velocity-change",velocityBin:e}),d=e)}u.push({type:"note-on",pitch:a[y.index].pitch})}}const p=!!o.some((e=>e.isDrum))&&(!o.some((e=>!e.isDrum))||void 0),f=Array.from(new Set(o.map((e=>e.program)))),m=p||1!==f.length?void 0:f[0],g=new rU(u,t,n,m,p);return g.setNumSteps(e.totalQuantizedSteps),g}getNumSteps(){return this.events.filter((e=>"time-shift"===e.type)).map((e=>e.steps)).reduce(((e,t)=>e+t),0)}setNumSteps(e){let t=this.getNumSteps();if(t<e){if(this.events.length){const n=this.events[this.events.length-1];if("time-shift"===n.type){const r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){const n=this.events[this.events.length-1];"time-shift"===n.type?t-n.steps<e?(n.steps-=t-e,t=e):(this.events.pop(),t-=n.steps):this.events.pop()}}toNoteSequence(e){const t=this.numVelocityBins?Math.ceil(127/this.numVelocityBins):void 0,n=RV.create();let r,o=0;const a=new Map;for(let s=0;s<=127;++s)a.set(s,[]);for(const s of this.events)switch(s.type){case"note-on":a.get(s.pitch).push([o,r]);break;case"note-off":const i=a.get(s.pitch);if(i.length){const[t,r]=i.shift();o>t?n.notes.push(RV.Note.create({pitch:s.pitch,velocity:r,instrument:e,quantizedStartStep:t,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):LV("Ignoring zero-length note: "+"(pitch = ".concat(s.pitch,", step = ").concat(o,")"),"Performance")}else LV("Ignoring note-off with no previous note-on:"+"(pitch = ".concat(s.pitch,", step = ").concat(o,")"),"Performance");break;case"time-shift":o+=s.steps;break;case"velocity-change":if(!t)throw new Error("Unexpected velocity change event: ".concat(s));r=0+(s.velocityBin-1)*t+1;break;default:throw new Error("Unrecognized performance event: ".concat(s))}return a.forEach(((t,r)=>{for(const[a,s]of t)o>a?n.notes.push(RV.Note.create({pitch:r,velocity:s,instrument:e,quantizedStartStep:a,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):LV("Ignoring zero-length note: "+"(pitch = ".concat(r,", step = ").concat(o,")"),"Performance")})),n.totalQuantizedSteps=o,n}}class oU{constructor(e){this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=e.numSteps,this.numSegments=e.numSegments}tensorSteps(e){return em(e.shape[0],"int32")}}class aU extends oU{constructor(e){super(e),this.pitchClasses=e.pitchClasses||bV,this.pitchToClass=new Map;for(let t=0;t<this.pitchClasses.length;++t)this.pitchClasses[t].forEach((e=>{this.pitchToClass.set(e,t)}));this.depth=this.pitchClasses.length+1}toTensor(e){YV(e);const t=this.numSteps||e.totalQuantizedSteps,n=pf([t,this.pitchClasses.length+1],"int32");for(let r=0;r<t;++r)n.set(1,r,-1);return e.notes.forEach((e=>{n.set(1,e.quantizedStartStep,this.pitchToClass.get(e.pitch)),n.set(0,e.quantizedStartStep,-1)})),n.toTensor()}async toNoteSequence(e,t,n){const r=$V(t,n),o=e.argMax(1),a=await o.data();o.dispose();for(let s=0;s<a.length;++s)for(let e=0;e<this.pitchClasses.length;e++)a[s]>>e&1&&r.notes.push(RV.Note.create({pitch:this.pitchClasses[e][0],quantizedStartStep:s,quantizedEndStep:s+1,isDrum:!0}));return r.totalQuantizedSteps=a.length,r}}class sU extends aU{async toNoteSequence(e,t,n){const r=$V(t,n),o=await e.data();for(let a=0;a<e.shape[0];++a){const e=o.slice(a*this.pitchClasses.length,(a+1)*this.pitchClasses.length);for(let t=0;t<e.length;++t)e[t]&&r.notes.push(RV.Note.create({pitch:this.pitchClasses[t][0],quantizedStartStep:a,quantizedEndStep:a+1,isDrum:!0}))}return r.totalQuantizedSteps=e.shape[0],r}}class iU extends aU{constructor(e){super(e),this.depth=Math.pow(2,this.pitchClasses.length)}toTensor(e){ZV(e);const t=this.numSteps||e.totalQuantizedSteps,n=Array(t).fill(0);for(const{pitch:r,quantizedStartStep:o}of e.notes)n[o]+=Math.pow(2,this.pitchToClass.get(r));return Qf((()=>Pg(ay(n,"int32"),this.depth)))}}class cU extends oU{constructor(e){super(e),this.NOTE_OFF=1,this.FIRST_PITCH=2,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=e.ignorePolyphony,this.depth=e.maxPitch-e.minPitch+1+this.FIRST_PITCH}toTensor(e){const t=eU.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return Qf((()=>Pg(Ap(t.events,[t.events.length],"int32"),this.depth)))}async toNoteSequence(e,t,n){const r=e.argMax(1),o=await r.data();r.dispose();return new eU(o,this.minPitch,this.maxPitch).toNoteSequence(t,n)}}class lU extends oU{constructor(e,t){super(e),this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=e.ignorePolyphony,this.melodyControl=t,this.depth=t.depth}toTensor(e){const t=eU.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(t)}}class uU extends lU{constructor(e){super(e,new tU)}async toNoteSequence(e,t,n){const r=$V(t,n),o=await e.data();for(let a=0;a<o.length;++a)o[a]&&r.notes.push(RV.Note.create({pitch:bV[1][0],quantizedStartStep:a,quantizedEndStep:a+1,isDrum:!0}));return r.totalQuantizedSteps=o.length,r}}class hU extends lU{constructor(e){super(e,new nU)}async toNoteSequence(e,t,n){const r=$V(t,n),o=e.argMax(1),a=await o.data();o.dispose();let s=Math.round((this.maxPitch+this.minPitch)/2);for(let i=0;i<a.length;++i){switch(a[i]){case 0:s-=1,s<this.minPitch&&(s=this.minPitch,LV("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"));break;case 2:s+=1,s>this.maxPitch&&(s=this.maxPitch,LV("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"))}r.notes.push(RV.Note.create({pitch:s,quantizedStartStep:i,quantizedEndStep:i+1}))}return r.totalQuantizedSteps=a.length,r}}class dU extends oU{constructor(e){super(e),this.NUM_SPLITS=3,this.MEL_PROG_RANGE=[0,31],this.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,this.melConverter=new cU(e.melArgs),this.bassConverter=new cU(e.bassArgs),this.drumsConverter=new iU(e.drumsArgs),this.depth=this.melConverter.depth+this.bassConverter.depth+this.drumsConverter.depth}toTensor(e){YV(e);const t=UV(e),n=UV(e),r=UV(e);return t.notes=e.notes.filter((e=>!e.isDrum&&e.program>=this.MEL_PROG_RANGE[0]&&e.program<=this.MEL_PROG_RANGE[1])),n.notes=e.notes.filter((e=>!e.isDrum&&e.program>=this.BASS_PROG_RANGE[0]&&e.program<=this.BASS_PROG_RANGE[1])),r.notes=e.notes.filter((e=>e.isDrum)),Qf((()=>Sm([this.melConverter.toTensor(t),this.bassConverter.toTensor(n),this.drumsConverter.toTensor(r)],-1)))}async toNoteSequence(e,t,n){const r=ty(e,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),o=await this.melConverter.toNoteSequence(r[0],t,n);o.notes.forEach((e=>{e.instrument=0,e.program=0}));const a=await this.bassConverter.toNoteSequence(r[1],t,n);o.notes.push(...a.notes.map((e=>(e.instrument=1,e.program=this.BASS_PROG_RANGE[0],e))));const s=await this.drumsConverter.toNoteSequence(r[2],t,n);return o.notes.push(...s.notes.map((e=>(e.instrument=2,e)))),r.forEach((e=>e.dispose())),o}}class pU extends oU{constructor(e){super(e),this.NUM_SPLITS=3,this.trioConverter=new dU(e),this.depth=3}toTensor(e){return Qf((()=>{const t=this.trioConverter.toTensor(e),n=ty(t,[this.trioConverter.melConverter.depth,this.trioConverter.bassConverter.depth,this.trioConverter.drumsConverter.depth],1),r=sm(n[0],1),o=sm(n[1],1),a=sm(n[2],1),s=og(r,1),i=og(o,1),c=og(a,0);return oy([s,i,c],1)}))}async toNoteSequence(e,t,n){const r=ty(e,3,1),o=await Promise.all(r.map((e=>e.data()))),a=$V(t,n);for(let s=0;s<this.numSteps;++s)o[0][s]&&a.notes.push(RV.Note.create({pitch:72,quantizedStartStep:s,quantizedEndStep:s+1,instrument:0,program:0})),o[1][s]&&a.notes.push(RV.Note.create({pitch:36,quantizedStartStep:s,quantizedEndStep:s+1,instrument:1,program:32})),o[2][s]&&a.notes.push(RV.Note.create({pitch:bV[1][0],quantizedStartStep:s,quantizedEndStep:s+1,instrument:2,isDrum:!0}));return a.totalQuantizedSteps=this.numSteps,a}}class fU extends oU{constructor(e){super(e),this.SEGMENTED_BY_TRACK=!0,this.stepsPerQuarter=e.stepsPerQuarter,this.totalSteps=e.totalSteps,this.numVelocityBins=e.numVelocityBins,this.minPitch=e.minPitch?e.minPitch:0,this.maxPitch=e.maxPitch?e.maxPitch:127,this.numPitches=this.maxPitch-this.minPitch+1,this.performanceEventDepth=2*this.numPitches+this.totalSteps+this.numVelocityBins,this.numPrograms=129,this.endToken=this.performanceEventDepth+this.numPrograms,this.depth=this.endToken+1,this.endTensor=Qf((()=>Pg(ay([this.endToken],"int32"),this.depth).as1D()))}trackToTensor(e){const t=this.numSteps/this.numSegments;let n;if(e){for(;e.events.length>t-2;)e.events.pop();n=pf([e.events.length+2],"int32"),n.set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach(((e,t)=>{switch(e.type){case"note-on":n.set(e.pitch-this.minPitch,t+1);break;case"note-off":n.set(this.numPitches+e.pitch-this.minPitch,t+1);break;case"time-shift":n.set(2*this.numPitches+e.steps-1,t+1);break;case"velocity-change":n.set(2*this.numPitches+this.totalSteps+e.velocityBin-1,t+1);break;default:throw new Error("Unrecognized performance event: ".concat(e))}})),n.set(this.endToken,e.events.length+1)}else n=pf([1],"int32",new Int32Array([this.endToken]));return Qf((()=>{const e=Pg(n.toTensor(),this.depth);return e.pad([[0,t-e.shape[0]],[0,0]])}))}toTensor(e){if(ZV(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error("Steps per quarter note mismatch: ".concat(e.quantizationInfo.stepsPerQuarter," != ").concat(this.stepsPerQuarter));const t=UV(e);t.notes=e.notes.filter((e=>e.pitch>=this.minPitch&&e.pitch<=this.maxPitch));const n=new Set(t.notes.map((e=>e.instrument))),r=Array.from(n).map((e=>rU.fromNoteSequence(t,this.totalSteps,this.numVelocityBins,e))).sort(((e,t)=>t.isDrum?-1:e.isDrum?1:e.program-t.program));for(;r.length>this.numSegments;)r.pop();for(r.forEach((e=>e.setNumSteps(this.totalSteps)));r.length<this.numSegments;)r.push(void 0);return Qf((()=>Sm(r.map((e=>this.trackToTensor(e))),0)))}tokensToTrack(e){const t=e.indexOf(this.endToken),n=t>=0?t:e.length,r=e.slice(0,n),o=r.filter((e=>e<this.performanceEventDepth)),a=r.filter((e=>e>=this.performanceEventDepth)),[s,i]=a.length?a[0]-this.performanceEventDepth<this.numPrograms-1?[a[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],c=Array.from(o).map((e=>{if(e<this.numPitches)return{type:"note-on",pitch:this.minPitch+e};if(e<2*this.numPitches)return{type:"note-off",pitch:this.minPitch+e-this.numPitches};if(e<2*this.numPitches+this.totalSteps)return{type:"time-shift",steps:e-2*this.numPitches+1};if(e<2*this.numPitches+this.totalSteps+this.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*this.numPitches-this.totalSteps+1};throw new Error("Invalid performance event token: ".concat(e))}));return new rU(c,this.totalSteps,this.numVelocityBins,s,i)}async toNoteSequence(e){const t=$V(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.stepsPerQuarter,arguments.length>2?arguments[2]:void 0);t.totalQuantizedSteps=this.totalSteps;const n=Qf((()=>ty(e.argMax(1),this.numSegments)));return(await Promise.all(n.map((async e=>{const t=await e.data(),n=this.tokensToTrack(t);return e.dispose(),n})))).forEach(((e,n)=>{e.setNumSteps(this.totalSteps),t.notes.push(...e.toNoteSequence(n).notes)})),t}}class mU extends oU{constructor(e){super(e),this.TAPIFY_CHANNEL=3,this.stepsPerQuarter=e.stepsPerQuarter||4,this.pitchClasses=e.pitchClasses||bV,this.pitchToClass=new Map;for(let t=0;t<this.pitchClasses.length;++t)this.pitchClasses[t].forEach((e=>{this.pitchToClass.set(e,t)}));this.humanize=e.humanize||!1,this.tapify=e.tapify||!1,this.splitInstruments=e.splitInstruments||!1,this.depth=3}toTensor(e){const t=JV(e)?e:XV(e,this.stepsPerQuarter),n=this.numSteps,r=t.tempos&&t.tempos.length?t.tempos[0].qpm:yV,o=60/r/this.stepsPerQuarter,a=[];for(let h=0;h<n;++h)a.push(new Map);t.notes.forEach((e=>{if(!this.tapify&&!this.pitchToClass.has(e.pitch))return;const t=e.quantizedStartStep;if(t>=a.length)throw Error("Model does not support sequences with more than ".concat(n," steps (").concat(n*o," seconds at qpm ").concat(r,")."));const s=this.tapify?this.TAPIFY_CHANNEL:this.pitchToClass.get(e.pitch);(!a[t].has(s)||a[t].get(s).velocity<e.velocity)&&a[t].set(s,e)}));const s=this.pitchClasses.length,i=pf([n,s]),c=pf([n,s]),l=pf([n,s]);function u(e){if(void 0===e.startTime)return 0;const t=e.startTime;return 2*(e.quantizedStartStep*o-t)/o}for(let h=0;h<n;++h)for(let e=0;e<s;++e){const t=a[h].get(e);i.set(t?1:0,h,e),this.humanize||this.tapify||c.set(t?t.velocity/vV:0,h,e),this.humanize||l.set(t?u(t):0,h,e)}return Qf((()=>{const e=i.toTensor(),t=c.toTensor(),r=l.toTensor(),o=this.splitInstruments?n*s:n;return Sm([e.as2D(o,-1),t.as2D(o,-1),r.as2D(o,-1)],1)}))}async toNoteSequence(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yV;if(t&&t!==this.stepsPerQuarter)throw Error("`stepsPerQuarter` is set by the model.");t=this.stepsPerQuarter;const r=this.splitInstruments?e.shape[0]/this.pitchClasses.length:e.shape[0],o=60/n/this.stepsPerQuarter,a=RV.create({totalTime:r*o,tempos:[{qpm:n}]}),s=await e.data();function i(e,t,n){return Math.min(Math.max(e,t),n)}const c=this.pitchClasses.length;for(let l=0;l<r;++l){const e=s.slice(l*c*this.depth,(l+1)*c*this.depth);for(let t=0;t<c;++t){const n=e[this.splitInstruments?t*this.depth:t],r=e[this.splitInstruments?t*this.depth+1:c+t],s=e[this.splitInstruments?t*this.depth+2:2*c+t];if(n>.5){const e=i(Math.round(r*vV),0,vV),n=i(s/2,-.5,.5);a.notes.push(RV.Note.create({pitch:this.pitchClasses[t][0],startTime:(l-n)*o,endTime:(l-n+1)*o,velocity:e,isDrum:!0}))}}}return a}}const gU="attention_cell_wrapper/";class yU{constructor(e,t,n){this.cells=e,this.attnLength=t,this.attnSize=n}static isWrapped(e){return"rnn/".concat(gU,"kernel")in e}initialize(e){const t="rnn/".concat(gU);this.attnInputMatrix=e["".concat(t,"kernel")],this.attnInputBias=e["".concat(t,"bias")],this.attnW=e["".concat(t,"attention/attn_w")],this.attnV=e["".concat(t,"attention/attn_v")],this.attnMatrix=e["".concat(t,"attention/kernel")],this.attnBias=e["".concat(t,"attention/bias")],this.attnOutputMatrix=e["".concat(t,"attention_output_projection/kernel")],this.attnOutputBias=e["".concat(t,"attention_output_projection/bias")]}initState(){return{attention:Dg([this.attnSize]),attentionState:Dg([1,this.attnSize*this.attnLength])}}call(e,t,n,r){const o=Sm([e,r.attention.as2D(1,-1)],1),a=rm(_m(o,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));[t,n]=Ag(this.cells,a,t,n);const s=wm(r.attentionState,[-1,this.attnLength,1,this.attnSize]),i=Bm(s,this.attnW,[1,1],"same"),c=[];for(let v=0;v<t.length;v++)c.push(t[v]),c.push(n[v]);const l=Sm(c,1),u=_m(l,this.attnMatrix).reshape([-1,1,1,this.attnSize]),h=hg(Cm(this.attnV,Nm(rm(i,u))),[2,3]),d=$g(h),p=hg(Cm(wm(d,[-1,this.attnLength,1,1]),s),[1,2]).reshape([-1,this.attnSize]),f=r.attentionState.reshape([-1,this.attnLength,this.attnSize]),m=Tm(f,[0,1,0],[f.shape[0],f.shape[1]-1,f.shape[2]]),g=rm(_m(Sm([n[2],p],1),this.attnOutputMatrix),this.attnOutputBias),y=p.flatten(),b=Sm([m,g.as3D(g.shape[0],1,g.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:g,c:t,h:n,attentionState:{attention:y,attentionState:b}}}}class bU{constructor(e,t){this.checkpointURL=e,this.spec=t,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}isInitialized(){return this.initialized}instantiateFromSpec(){this.dataConverter=function(e){switch(e.type){case"MelodyConverter":return new cU(e.args);case"MelodyRhythmConverter":return new uU(e.args);case"MelodyShapeConverter":return new hU(e.args);case"DrumsConverter":return new aU(e.args);case"DrumRollConverter":return new sU(e.args);case"TrioConverter":return new dU(e.args);case"TrioRhythmConverter":return new pU(e.args);case"DrumsOneHotConverter":return new iU(e.args);case"MultitrackConverter":return new fU(e.args);case"GrooveConverter":return new mU(e.args);default:throw new Error("Unknown DataConverter type: ".concat(e))}}(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?function(e){switch(e){case"MajorMinorChordEncoder":return new NV;case"TriadChordEncoder":return new EV;case"PitchChordEncoder":return new AV;default:throw new Error("Unknown chord encoder type: ".concat(e))}}(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map((e=>function(e){if("BinaryCounter"===e.type)return new Tj(e.args);throw new Error("Unknown auxiliary input: ".concat(e))}(e))):void 0}async initialize(){this.dispose();const e=DV.now();this.spec||await PV("".concat(this.checkpointURL,"/config.json")).then((e=>e.json())).then((e=>{if("MusicRNN"!==e.type)throw new Error("Attempted to instantiate MusicRNN model with incorrect type:\n                  ".concat(e.type));this.spec=e})),this.instantiateFromSpec();const t=await PV("".concat(this.checkpointURL,"/weights_manifest.json")).then((e=>e.json())).then((e=>xf(e,this.checkpointURL))),n=yU.isWrapped(t),r=n?"rnn/".concat(gU):"rnn/";this.forgetBias=em(1),this.lstmCells.length=0,this.biasShapes.length=0;let o=0;for(;;){const e=r+"multi_rnn_cell/cell_%d/basic_lstm_cell/".replace("%d",o.toString());if(!("".concat(e,"kernel")in t))break;this.lstmCells.push(((n,r,o)=>Em(this.forgetBias,t["".concat(e,"kernel")],t["".concat(e,"bias")],n,r,o))),this.biasShapes.push(t["".concat(e,"bias")].shape[0]),++o}this.lstmFcW=t["fully_connected/weights"],this.lstmFcB=t["fully_connected/biases"],n&&(this.attentionWrapper=new yU(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(t)),this.rawVars=t,this.initialized=!0,zV("Initialized model",e,"MusicRNN")}dispose(){Object.keys(this.rawVars).forEach((e=>this.rawVars[e].dispose())),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1}async continueSequence(e,t,n,r){return(await this.continueSequenceImpl(e,t,n,r,!1)).sequence}async continueSequenceAndReturnProbabilities(e,t,n,r){return this.continueSequenceImpl(e,t,n,r,!0)}async continueSequenceImpl(e,t,n,r,o){if(ZV(e),this.chordEncoder&&!r)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&r)throw new Error("Unexpected chord progression provided.");this.initialized||await this.initialize();const a=DV.now(),s=Qf((()=>{const a=this.dataConverter.toTensor(e),s=a.shape[0],i=a.shape[1],c=this.chordEncoder?this.chordEncoder.encodeProgression(r,s+t):void 0,l=this.auxInputs?Sm(this.auxInputs.map((e=>e.getTensors(s+t))),1):void 0,u=this.sampleRnn(a,t,n,c,l,o),h=u.samples;return{samples:oy(h).as2D(h.length,i),probs:u.probs}})),i=await s,c=this.dataConverter.toNoteSequence(i.samples,e.quantizationInfo.stepsPerQuarter),l=[];if(o)for(let u=0;u<i.probs.length;u++)l.push(await i.probs[u].data()),i.probs[u].dispose();return s.samples.dispose(),c.then((()=>zV("Continuation completed",a,"MusicRNN",20))),{sequence:c,probs:l}}sampleRnn(e,t,n,r,o,a){const s=e.shape[0],i=e.shape[1];let c=[],l=[];for(let y=0;y<this.biasShapes.length;y++)c.push(Dg([1,this.biasShapes[y]/4])),l.push(Dg([1,this.biasShapes[y]/4]));let u,h=this.attentionWrapper?this.attentionWrapper.initState():null;e=e.toFloat();const d=[],p=[],f=ty(e.toFloat(),s),m=r?ty(r,r.shape[0]):void 0,g=o?ty(o,o.shape[0]):void 0;for(let y=0;y<s+t;y++){let e;if(y<s)e=f[y];else{let t,r=u.matMul(this.lstmFcW).add(this.lstmFcB).as1D();n?(r=r.div(em(n)),t=Rg(r,1).as1D()):t=r.argMax().as1D(),a&&p.push($g(r)),e=Pg(t,i).toFloat(),d.push(e.as1D())}if(y===s+t-1)break;const r=[];if(m&&r.push(m[y+1]),r.push(e),g&&r.push(g[y]),e=Sm(r,1),this.attentionWrapper){const t=this.attentionWrapper.call(e,c,l,h);c=t.c,l=t.h,h=t.attentionState,u=t.output}else[c,l]=Ag(this.lstmCells,e,c,l),u=l[l.length-1]}return{samples:d,probs:p}}}let vU;const wU={kick:36,snare:38,hihat:42,hhop:46,tomlow:45,tommid:47,tomhi:50,crash:49,ride:51,ridebell:53},xU=Object.fromEntries(Object.entries(wU).map((e=>{let[t,n]=e;return[n,t]})));async function kU(){vU||(vU=new bU("https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/drum_kit_rnn"),await vU.initialize(),console.log("DrumsRNN model (via MusicRNN direct import) initialized."))}function SU(e,t,n,r,o){const a=[];let s=0;console.log("[sequencerBarToNoteSequence] Converting bar with ".concat(e.length," blocks. AI SPQ: ").concat(o)),e.forEach(((e,r)=>{const i=r*o;s+=o,n.forEach((n=>{const r=e.trackSteps[n]||0;if(0!==r)for(let s=0;s<r;s++){const c=e.originalIndex,l="".concat(c,"-").concat(n,"-").concat(s);if(t[l]&&t[l].instrumentId){const e=t[l].instrumentId,n=wU[e];if(void 0===n)continue;let c;c=r===o?s:Math.floor(s/r*o);const u=i+c;a.push({pitch:n,quantizedStartStep:u,quantizedEndStep:u+1})}}}))}));const i=[],c=new Set;return a.forEach((e=>{const t="".concat(e.pitch,"-").concat(e.quantizedStartStep);c.has(t)||(i.push(e),c.add(t))})),console.log("[sequencerBarToNoteSequence] Seed notes for AI:",JSON.stringify(i,null,2)),XV({ticksPerQuarter:220,totalTime:s/o*(60/r),quantizationInfo:{stepsPerQuarter:o},tempos:[{time:0,qpm:r}],notes:i,totalQuantizedSteps:s},o)}function _U(e,t,n,r,o){const a=h({},r),s={kick:"RF",snare:"L",hihat:"R",hhop:"R",tomlow:"L",tommid:"R",tomhi:"R",crash:"R",ride:"R",ridebell:"R"};return console.log("[noteSequenceToSequencerBar] Converting AI sequence. AI SPQ: ".concat(o,". Blocks in bar: ").concat(t.length)),t.forEach((e=>{const t=e.originalIndex;n.forEach((n=>{const r=e.trackSteps[n]||0;for(let e=0;e<r;e++){const r="".concat(t,"-").concat(n,"-").concat(e);a[r]={instrumentId:null}}}))})),e&&e.notes&&0!==e.notes.length?(console.log("[noteSequenceToSequencerBar] Processing AI notes:",JSON.stringify(e.notes.map((e=>({p:e.pitch,s:e.quantizedStartStep,v:e.velocity}))),null,2)),e.notes.forEach((e=>{let r=xU[e.pitch];if(!r)return void console.warn("[noteSequenceToSequencerBar] Unknown AI pitch ".concat(e.pitch,", skipping."));const i=s[r];if(!i||!n.includes(i))return void console.warn("[noteSequenceToSequencerBar] Model instrument '".concat(r,"' maps to unknown/invalid limb track '").concat(i,"'. Skipping."));let c;c="tomlow"===r?"tomlow":"tommid"===r?"tommid":"tomhi"===r?"tomhi":r.includes("hihat")?"hihat":r;const l=Math.floor(e.quantizedStartStep/o),u=e.quantizedStartStep%o;if(l<t.length){const n=t[l],s=n.originalIndex,d=n.trackSteps[i]||0;if(0===d)return;const p=u,f=Math.min(p,d-1),m="".concat(s,"-").concat(i,"-").concat(f);if(a.hasOwnProperty(m)){var h;const t=(null===(h=Ct[c])||void 0===h?void 0:h.volume)||0,n=e.velocity?60*e.velocity-60:0,l=t+n;a[m]={instrumentId:c,volume:l},console.log("[noteSequenceToSequencerBar] Placed ".concat(c," (from AI ").concat(r,") on limb ").concat(i,", block ").concat(s,", user step ").concat(f," (AI step in block: ").concat(u,"/").concat(o,"). Volume: ").concat(l,"dB (base: ").concat(t,"dB + velocity: ").concat(n,"dB)"))}else console.warn("[noteSequenceToSequencerBar] Cell ".concat(m," for sample ").concat(c," was not pre-cleared or doesn't exist based on trackSteps. AI pitch ").concat(e.pitch,". This might indicate an issue with cell state initialization or trackSteps consistency."))}else console.warn("[noteSequenceToSequencerBar] AI note at step ".concat(e.quantizedStartStep," (visual block ").concat(l,") is outside current bar's block count (").concat(t.length,"). Skipping."))})),a):(console.warn("[noteSequenceToSequencerBar] No notes in generatedSequence to process."),a)}"undefined"!==typeof window&&kU().catch(console.error);const CU=e=>{let{onGenerateDrums:t,isGeneratingDrums:n,isMagentaModelReady:r,temperature:o,onTemperatureChange:a,isSequencerInitialized:s,stepsPerQuarterOptions:i,currentStepsPerQuarter:c,onStepsPerQuarterChange:l,onGenerateVariation:u,numNewBars:h,onNumNewBarsChange:d,isGeneratingVariation:p}=e;const f=!r||!s,m=n||p;return(0,St.jsxs)("div",{className:"ai-panel",children:[(0,St.jsx)("h3",{children:"AI \u0413\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440 \u041f\u0430\u0442\u0442\u0435\u0440\u043d\u043e\u0432"}),(0,St.jsxs)("div",{className:"ai-controls",children:[(0,St.jsx)("button",{className:"generate-button ".concat(n?"generating":""),onClick:t,disabled:f||m,title:f?s?"\u041c\u043e\u0434\u0435\u043b\u044c AI \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f...":"\u0421\u0435\u043a\u0432\u0435\u043d\u0441\u043e\u0440 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442\u0441\u044f...":m?"\u0418\u0434\u0435\u0442 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f...":"\u0421\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0442\u0442\u0435\u0440\u043d \u0434\u043b\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u0442\u0430\u043a\u0442\u0430",children:n?"\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f...":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c/\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u044c Drums"}),(0,St.jsx)("button",{className:"generate-button variation-button ".concat(p?"generating":""),onClick:u,disabled:f||m,title:f?s?"\u041c\u043e\u0434\u0435\u043b\u044c AI \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f...":"\u0421\u0435\u043a\u0432\u0435\u043d\u0441\u043e\u0440 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0435\u0442\u0441\u044f...":m?"\u0418\u0434\u0435\u0442 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f...":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0430\u0440\u0438\u0430\u0446\u0438\u044e \u0432 \u043d\u043e\u0432\u043e\u043c \u0442\u0430\u043a\u0442\u0435(\u0430\u0445)",children:p?"\u0412\u0430\u0440\u0438\u0430\u0446\u0438\u044f...":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0412\u0430\u0440\u0438\u0430\u0446\u0438\u044e (\u041d\u043e\u0432\u044b\u0439 \u0422\u0430\u043a\u0442)"}),(0,St.jsxs)("div",{className:"control-group",children:[(0,St.jsx)("label",{htmlFor:"num-new-bars-input",children:"\u041a\u043e\u043b-\u0432\u043e \u043d\u043e\u0432\u044b\u0445 \u0442\u0430\u043a\u0442\u043e\u0432:"}),(0,St.jsx)("input",{type:"number",id:"num-new-bars-input",value:h,onChange:e=>{let t=parseInt(e.target.value,10);(isNaN(t)||t<1)&&(t=1),t>8&&(t=8),d(t)},min:"1",max:"8",disabled:f||m})]}),(0,St.jsxs)("div",{className:"control-group",children:[(0,St.jsxs)("label",{htmlFor:"temperature-slider",children:["\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430: ",o.toFixed(1)]}),(0,St.jsx)("input",{type:"range",id:"temperature-slider",min:"0.1",max:"2.5",step:"0.1",value:o,onChange:e=>{a(parseFloat(e.target.value))},disabled:f||m})]}),(0,St.jsxs)("div",{className:"control-group",children:[(0,St.jsx)("label",{htmlFor:"steps-select",children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438:"}),(0,St.jsx)("select",{id:"steps-select",value:c,onChange:e=>{l(parseInt(e.target.value,10))},disabled:f||m,children:i&&i.map((e=>(0,St.jsx)("option",{value:e.value,children:e.label},e.value)))})]})]})]})},IU=[{value:3,label:"\u0422\u0440\u0438\u043e\u043b\u0438 8-\u0435 (3)"},{value:4,label:"16-\u0435 (4)"},{value:5,label:"\u041a\u0432\u0438\u043d\u0442\u043e\u043b\u0438 16-\u0435 (5)"},{value:6,label:"\u0422\u0440\u0438\u043e\u043b\u0438 16-\u0435 (6)"},{value:8,label:"32-\u0435 (8)"}],TU=e=>{let{selectedInstrument:t,onClearSequencer:n,onCellsStateChange:r,currentBarBlocks:a,allBlocks:s,barBlockMapping:i,currentBar:c,onBarChange:l,totalBars:u,playbackPosition:h,cellsState:d,onLoopButtonClick:p,loopedBlockIndices:f,mutedTracks:m,trackNames:g,isGridModeActive:y,onTrackStepsChange:b}=e;const[v,w]=(0,o.useState)(null),{handleCellClick:x,clearAllCells:k}=At(d,r),S=a||[];(0,o.useEffect)((()=>{}),[]),(0,o.useEffect)((()=>{n&&n(k)}),[n,k]),(0,o.useEffect)((()=>{if(!h||!i||!a)return void w(null);if(!(i[c]||[]).includes(h.blockIndex))return void w(null);const e=a.findIndex((e=>e.originalIndex===h.blockIndex));w(-1!==e?{blockIndex:e,stepIndex:h.stepIndex}:null)}),[h,i,c,a]);const _=e=>S[e]&&void 0!==S[e].originalIndex?S[e].originalIndex:e;return(0,St.jsx)("div",{className:"sequencer-wrapper",children:(0,St.jsx)(_t,{sequencerStructure:S,trackNames:g,getCellState:e=>{const[t,n,r]=e.split("-"),o=parseInt(t,10),a=_(o),s="".concat(a,"-").concat(n,"-").concat(r);return d[s]||{instrumentId:null}},handleCellClick:e=>{const[n,r,o]=e.split("-"),a=parseInt(n,10),s=_(a),i="".concat(s,"-").concat(r,"-").concat(o);x(i,t)},currentPlaybackPosition:v,onLoopButtonClick:p,loopedBlockIndices:f,mutedTracks:m,isGridModeActive:y,onTrackStepsChange:b})})},NU=(0,o.forwardRef)(((e,t)=>{let{initialSessionData:n}=e;const[r,a]=(0,o.useState)(null),[s,i]=(0,o.useState)(0),[c,l]=(0,o.useState)(1),[u,d]=(0,o.useState)({}),[p,f]=(0,o.useState)(null),[m,g]=(0,o.useState)({}),[y,b]=(0,o.useState)("horizontal"),v=(0,o.useRef)(null),w=(0,o.useRef)(null),x=(0,o.useRef)(null),[k,S]=(0,o.useState)(!1),[_,C]=(0,o.useState)(Et.bpm||120),[I,T]=(0,o.useState)(!1),[N,E]=(0,o.useState)(!0),[A,R]=(0,o.useState)(!1),[O,M]=(0,o.useState)([]),[P,D]=(0,o.useState)([]),[F,L]=(0,o.useState)(new Set),[z,B]=(0,o.useState)(!1),[q,W]=(0,o.useState)(!1),[j,V]=(0,o.useState)([]),[U,G]=(0,o.useState)([]),[H,K]=(0,o.useState)(!1),[X,Q]=(0,o.useState)(!1),[Y,J]=(0,o.useState)(1),[Z,$]=(0,o.useState)(4),[ee,te]=(0,o.useState)(!1),[ne,re]=(0,o.useState)(1);(0,o.useImperativeHandle)(t,(()=>({exportData:(e,t)=>{const n={version:"1.0",sessionName:e,folderName:t||null,bpm:_,trackNames:O,currentSequencerStructure:j,currentBars:U,cellsState:m,loopedBlockIndices:P,mutedTracks:Array.from(F),isMetronomeEnabled:z};fetch("https://rhythmcapsule.ru/api/sequencer/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.ok?e.json():e.json().then((t=>{throw new Error(t.message||"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ".concat(e.status))})).catch((()=>{throw new Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ".concat(e.status," ").concat(e.statusText))})))).then((n=>{console.log("\u0414\u0430\u043d\u043d\u044b\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435:",n),alert("\u0421\u0435\u0441\u0441\u0438\u044f '".concat(e,"' ").concat(t?"\u0432 \u043f\u0430\u043f\u043a\u0435 '"+t+"'":""," \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430! ID: ").concat(n.sessionId||"N/A"))})).catch((t=>{console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440:",t),alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0441\u0435\u0441\u0441\u0438\u0438 '".concat(e,"' \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440: ").concat(t.message))}))}}))),(0,o.useEffect)((()=>{I&&(Wc.setBPM(_),console.log("[BPM Effect] BPM set in audioEngine: ".concat(_)))}),[_,I]),(0,o.useEffect)((()=>{(async()=>{if(console.log("[Init Effect] Initializing audioEngine..."),await Wc.initialize(),T(!0),console.log("[Init Effect] AudioEngine initialized."),kU().then((()=>{K(!0),console.log("[Init Effect] Magenta DrumsRNN model ready.")})).catch((e=>{console.error("[Init Effect] Failed to initialize Magenta DrumsRNN model:",e)})),n)console.log("[Init Effect] Initializing with provided session data:",n),C(n.bpm||120),M(n.trackNames||[]),V(n.currentSequencerStructure||[]),G(n.currentBars||[]),g(n.cellsState||{}),D(n.loopedBlockIndices||[]),L(new Set(n.mutedTracks||[])),B(n.isMetronomeEnabled||!1);else{console.log("[Init Effect] Initializing with default initialSequencerData.");const e=Et.sequencerStructure||[],t=Et.bars||[],n=Et.trackNames||[];V(e),G(t),M(n);const r=oe(e,t);d(r);const o=Object.keys(r).length;l(o>0?o:1);const a={};Array.isArray(e)&&e.forEach(((e,t)=>{e&&e.trackSteps&&Array.isArray(n)&&n.forEach((n=>{const r=e.trackSteps[n];if(r&&"number"===typeof r)for(let e=0;e<r;e++){const r="".concat(t,"-").concat(n,"-").concat(e);a[r]={instrumentId:null}}}))}));const s=Et.initialInstruments||{};"object"===typeof s&&Object.entries(s).forEach((e=>{let[t,n]=e;n&&"object"===typeof n&&Object.entries(n).forEach((e=>{let[n,r]=e;const o="".concat(t,"-").concat(n);a[o]&&(a[o].instrumentId=r)}))})),g(a),C(Et.bpm||120),D([]),L(new Set),B(!1)}console.log("Sequencer Module Initialized.")})()}),[n]),(0,o.useEffect)((()=>{if(j.length>0||U.length>0){console.log("[Effect] currentSequencerStructure or currentBars changed, recalculating barBlockMapping.");const e=oe(j,U);d(e);const t=Object.keys(e).length;l(t>0?t:1),I&&O.length>0&&Object.keys(m).length>0&&(console.log("[Effect barBlockMapping] Structure changed, preparing sequencer for audioEngine."),Wc.prepareSequencer(j,O,m,e))}}),[j,U,I,O,m]),(0,o.useEffect)((()=>{I&&j.length>0&&O.length>0&&Object.keys(m).length>0&&Object.keys(u).length>0&&(console.log("[Effect prepareSequencer] Dependencies met. Calling prepare."),Wc.prepareSequencer(j,O,m,u))}),[I,j,O,m,u]);const oe=(e,t)=>{const n={};let r=0;const o=t||[],a=e.length;o.forEach(((e,t)=>{n[t]=[];const o=e.timeSignature||4;for(let s=0;s<o;s++)r<a&&(n[t].push(r),r++)}));let s=o.length;for(;r<a;){n[s]=[];const e=a-r,t=Math.min(e,6);for(let o=0;o<t;o++)r<a&&(n[s].push(r),r++);s++}return n};(0,o.useEffect)((()=>{c>0&&j.length>0&&Object.keys(u).length>0&&console.log("[Log State] ".concat(c," \u0442\u0430\u043a\u0442\u043e\u0432, ").concat(j.length," \u0431\u043b\u043e\u043a\u043e\u0432."))}),[c,j,u]);const ae=()=>{const e=U||[];return e[s]?e[s]:{id:s+1,name:"\u0422\u0430\u043a\u0442 ".concat(s+1),timeSignature:(u[s]||[]).length||4}},se=()=>{if(!j||0===j.length||0===Object.keys(u).length)return[];return(u[s]||[]).map((e=>j[e]?h(h({},j[e]),{},{originalIndex:e}):null)).filter(Boolean)};(0,o.useEffect)((()=>(Wc.setPositionCallback((e=>{if(f(e),e&&u&&c>0)for(let t=0;t<c;t++){if((u[t]||[]).includes(e.blockIndex)){t!==s&&i(t);break}}})),()=>{Wc.setPositionCallback(null)})),[u,s,c]);const ie=async()=>{if(I&&!A)if(R(!0),k)try{await Wc.stop(),S(!1)}catch(e){console.error("Error during stop:",e)}finally{R(!1)}else{if(N){const t=()=>{R(!1)};return Wc.setPrerollCancelCallback(t),void Wc.startPreroll(ae().timeSignature,(async()=>{try{await Wc.play(),S(!0)}catch(e){console.error("Error during playback after preroll:",e),S(!1)}finally{R(!1),Wc.setPrerollCancelCallback(null)}}))}try{await Wc.play(),S(!0)}catch(e){console.error("Error during playback without preroll:",e),S(!1)}finally{R(!1)}}},ce=e=>{b(e)},le=e=>{let t=[...P];const n=t.indexOf(e);if(n>-1?t.splice(n,1):(t.push(e),t.sort(((e,t)=>e-t))),D(t),t.length>0?Wc.setLoopedBlocks(t):Wc.clearLoopedBlocks(),I&&j.length>0&&O.length>0&&Object.keys(m).length>0){const e=k;let t=0;e&&(t=Wc.getCurrentTransportTime()),Wc.prepareSequencer(j,O,m,u),e&&Wc.play(t).catch((e=>S(!1)))}},ue=(0,o.useCallback)((e=>{L((t=>{const n=new Set(t);return n.has(e)?(n.delete(e),console.log("Track ".concat(e," unmuted."))):(n.add(e),console.log("Track ".concat(e," muted."))),n}))}),[]);(0,o.useEffect)((()=>{if(I&&(Wc.setMutedTracks(F),j.length>0&&O.length>0&&Object.keys(m).length>0)){const e=k;let t=0;e&&(t=Wc.getCurrentTransportTime(),Wc.stop()),Wc.prepareSequencer(j,O,m,u),e&&Wc.play(t).catch((e=>console.error("Error restarting after mute:",e)))}}),[F,I,j,O,m,u,k]);const he=(0,o.useCallback)((()=>{const e=!z;B(e),I&&Wc.setMetronomeEnabled(e)}),[z,I]);(0,o.useEffect)((()=>{I&&j&&O&&m&&u&&(console.log("[SequencerModule] Calling prepareSequencer due to cellsState/trackNames/structure/mapping change."),Wc.prepareSequencer(j,O,m,u))}),[I,O,m,u]);return(0,St.jsxs)("div",{className:"sequencer-module ".concat("vertical"===y?"vertical-mode":""),ref:x,onTouchStart:e=>{w.current=e.touches[0].clientX},onTouchEnd:e=>{if(!w.current)return;const t=e.changedTouches[0].clientX-w.current;t>75&&s>0?i(s-1):t<-75&&s<c-1&&i(s+1),w.current=null},children:["horizontal"===y&&(0,St.jsxs)(St.Fragment,{children:[(0,St.jsx)(It,{onInstrumentSelect:(e,t)=>{console.log("\u0412\u044b\u0431\u0440\u0430\u043d \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442:",e),console.log("\u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f:",t),a(t?{id:e,config:t}:null)},onClearAll:()=>{window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u044f\u0447\u0435\u0439\u043a\u0438?")&&v.current&&v.current()},isGridModeActive:q,onToggleGridMode:()=>{W((e=>!e))},currentBarInfo:ae(),onTimeSignatureChange:e=>{if(console.log("[Grid Mode] Block count change for bar ".concat(s," to: ").concat(e)),e<1||e>6)return void console.warn("Invalid block count: ".concat(e));const t=[...j],n=U?JSON.parse(JSON.stringify(U)):[],r=h({},m);let o=[...t],a=[...n];a[s]||(console.error("Current bar ".concat(s," not found!")),a[s]={id:(a.length>0?Math.max(...a.map((e=>e.id))):0)+1,name:"\u0422\u0430\u043a\u0442 ".concat(s+1),timeSignature:4});const i=a[s].timeSignature,c=e-i;if(0===c)return;let l=0;for(let h=0;h<s;h++){var u;l+=(null===(u=a[h])||void 0===u?void 0:u.timeSignature)||0}const d=l+i;a[s].timeSignature=e;if(c>0)for(let s=0;s<c;s++){const e={id:"block-"+Date.now()+Math.random().toString(36).substring(2,7),name:"\u0411\u043b\u043e\u043a ".concat(t.length+1+s),trackSteps:h({},O.reduce(((e,t)=>h(h({},e),{},{[t]:4})),{}))};o.splice(d+s,0,e)}else{const e=Math.abs(c);o.splice(d-e,e)}const p={},f={};t.forEach(((e,t)=>{e&&e.id&&(f[e.id]=t)})),o.forEach(((e,t)=>{O.forEach((n=>{const o=e.trackSteps[n]||0;for(let a=0;a<o;a++){const o="".concat(t,"-").concat(n,"-").concat(a);let s={instrumentId:null};if(e.id&&f.hasOwnProperty(e.id)){const t=f[e.id],o="".concat(t,"-").concat(n,"-").concat(a);r.hasOwnProperty(o)&&(s=r[o])}p[o]=s}}))})),V(o),G(a),g(p),console.log("[Grid Mode] States updated by handleTimeSignatureChange with cell remapping.")},onAddBar:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;console.log("[Grid Mode] Add BAR requested after bar:",e);const t=[...j],n=U?JSON.parse(JSON.stringify(U)):[],r=h({},m);let o=[...t],a=[...n];const c=a[s];let l,u;if(c||0!==a.length){if(!c)return void console.error("[AddBar] Cannot add bar - current bar config not found and it's not the first bar.");{u=c.timeSignature,l=s+1;const e={id:(a.length>0?Math.max(...a.map((e=>e.id))):0)+1,name:"\u0422\u0430\u043a\u0442 ".concat(a.length+1),timeSignature:u};a.splice(l,0,e)}}else{console.log("[AddBar] Adding the very first bar."),u=4;const e={id:1,name:"\u0422\u0430\u043a\u0442 1",timeSignature:u};a.push(e),l=0}let d=0;for(let s=0;s<l;s++)d+=a[s].timeSignature;for(let s=0;s<u;s++){const e={id:"block-"+Date.now()+s+Math.random().toString(36).substring(2,7),name:"\u0411\u043b\u043e\u043a ".concat(t.length+1+s),trackSteps:h({},O.reduce(((e,t)=>h(h({},e),{},{[t]:4})),{}))};o.splice(d+s,0,e)}console.log("[AddBar] Added new bar at index ".concat(l," with ").concat(u," blocks."));const p={},f={};t.forEach(((e,t)=>{e&&e.id&&(f[e.id]=t)})),o.forEach(((e,t)=>{O.forEach((n=>{const o=e.trackSteps[n]||0;for(let a=0;a<o;a++){const o="".concat(t,"-").concat(n,"-").concat(a);let s={instrumentId:null};if(e.id&&f.hasOwnProperty(e.id)){const t=f[e.id],o="".concat(t,"-").concat(n,"-").concat(a);r.hasOwnProperty(o)&&(s=r[o])}p[o]=s}}))})),V(o),G(a),g(p),i(l)},onRemoveBar:()=>{if(console.log("[Grid Mode] Remove CURRENT bar requested:",s),U.length<=1)return void console.warn("[RemoveBar] Cannot remove the last bar.");const e=[...j],t=JSON.parse(JSON.stringify(U)),n=h({},m);let r=[...e],o=[...t];const a=o[s];if(!a)return void console.error("[RemoveBar] Config for bar to remove not found!");const c=a.timeSignature;let u=0;for(let i=0;i<s;i++){var d;u+=(null===(d=o[i])||void 0===d?void 0:d.timeSignature)||0}r.splice(u,c),o.splice(s,1),console.log("[RemoveBar] Removed bar ".concat(s," and its ").concat(c," blocks."));const p={},f={};e.forEach(((e,t)=>{e&&e.id&&(f[e.id]=t)})),r.forEach(((e,t)=>{O.forEach((r=>{const o=e.trackSteps[r]||0;for(let a=0;a<o;a++){const o="".concat(t,"-").concat(r,"-").concat(a);let s={instrumentId:null};if(e.id&&f.hasOwnProperty(e.id)){const t=f[e.id],o="".concat(t,"-").concat(r,"-").concat(a);n.hasOwnProperty(o)&&(s=n[o])}p[o]=s}}))})),V(r),G(o),g(p);const y=s>=o.length&&o.length>0?o.length-1:s<0&&o.length>0?0:s;0===o.length?(console.log("[RemoveBar] All bars removed, adding a default first bar."),l(0),i(0)):i(y)}}),(0,St.jsx)(TU,{selectedInstrument:r,onClearSequencer:e=>{v.current=e},onCellsStateChange:g,currentBarBlocks:se(),allBlocks:j,barBlockMapping:u,currentBar:s,onBarChange:i,totalBars:c,playbackPosition:p,cellsState:m,onLoopButtonClick:le,loopedBlockIndices:P,mutedTracks:F,trackNames:O,isGridModeActive:q,onTrackStepsChange:(e,t,n)=>{console.log("[Grid Mode] Track steps change for block ".concat(e,", track ").concat(t," to: ").concat(n));const r=[...j],o=h({},m);let a=r.map((r=>{if(r.id===e){const e=h(h({},r.trackSteps),{},{[t]:n});return h(h({},r),{},{trackSteps:e})}return r}));const s={},i={};r.forEach(((e,t)=>{e&&e.id&&(i[e.id]=t)})),a.forEach(((e,t)=>{O.forEach((n=>{const a=e.trackSteps[n]||0;for(let c=0;c<a;c++){const a="".concat(t,"-").concat(n,"-").concat(c);let l={instrumentId:null};if(e.id&&i.hasOwnProperty(e.id)){const t=i[e.id],a=r.find((t=>t.id===e.id));if(c<(a&&a.trackSteps[n]||0)){const e="".concat(t,"-").concat(n,"-").concat(c);o.hasOwnProperty(e)&&(l=o[e])}}s[a]=l}}))})),V(a),g(s),console.log("[Grid Mode] States updated by handleTrackStepsChange with cell remapping.")}}),(0,St.jsx)(CU,{onGenerateDrums:async()=>{if(!H)return void alert("\u041c\u043e\u0434\u0435\u043b\u044c \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u0430. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e.");if(X||ee)return void alert("\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0443\u0436\u0435 \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435.");Q(!0),console.log("[Magenta] Preparing to generate/fill drum pattern for current bar ".concat(s," with AI SPQ: ").concat(Z,"."));const e=se();if(!e||0===e.length)return alert("\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0442\u0430\u043a\u0442 \u043f\u0443\u0441\u0442 \u0438\u043b\u0438 \u043d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d. \u041d\u0435 \u043c\u043e\u0433\u0443 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0442\u0442\u0435\u0440\u043d."),void Q(!1);let t=[...j],n=h({},m);console.log("[Magenta] Modifying structure for ".concat(e.length," blocks in current bar to ").concat(Z," steps per track."));const r=JSON.parse(JSON.stringify(j));e.forEach((e=>{const o=t[e.originalIndex],a=r[e.originalIndex];if(o&&a){const r={};O.forEach((e=>{r[e]=Z})),t[e.originalIndex]=h(h({},o),{},{trackSteps:r}),O.forEach((t=>{const r=Z,o=a.trackSteps[t]||0;for(let a=0;a<Math.max(r,o);a++){const s="".concat(e.originalIndex,"-").concat(t,"-").concat(a);a<r?a<o&&m[s]?n[s]=m[s]:n[s]={instrumentId:null}:delete n[s]}}))}}));const o=e.map((e=>h(h({},t[e.originalIndex]),{},{originalIndex:e.originalIndex}))),a={};o.forEach((e=>{O.forEach((t=>{const r=e.trackSteps[t]||0;for(let o=0;o<r;o++){const r="".concat(e.originalIndex,"-").concat(t,"-").concat(o);a[r]=n[r]||{instrumentId:null}}}))})),console.log("[Magenta] Structure for AI prepared. Calling AI generation...");try{const e={blocks:o,cells:a,trackNames:O,bpm:_,temperature:Y,genSpq:Z},r=await async function(e){const{blocks:t,cells:n,trackNames:r,bpm:o,temperature:a,genSpq:s}=e;if(!vU)return console.error("[MagentaService] DrumsRNN model is not initialized."),null;console.log("[MagentaService] Creating seed sequence from current bar state...");const i=SU(t,n,r,o,s);if(!i.notes||0===i.notes.length)return console.warn("[MagentaService] Seed sequence is empty. No notes to continue from. Aborting generation."),null;console.log("[MagentaService] Seed sequence created. Notes: ".concat(i.notes.length,", Total quantized steps in seed: ").concat(i.totalQuantizedSteps));const c=t.length*s;let l=0;i.notes&&i.notes.length>0&&(l=i.notes.reduce(((e,t)=>Math.max(e,t.quantizedEndStep||0)),0));const u=c-l;if(u<=0)return console.log("[MagentaService] Bar is already full based on seed notes, or no space to generate. Returning current state as is (after re-mapping seed)."),_U(i,t,r,n,s);console.log("[MagentaService] Attempting to continue sequence. Seed last step: ".concat(l,". Steps to generate: ").concat(u,". Total bar steps: ").concat(c,". Temperature: ").concat(a,"."));try{const e=await vU.continueSequence(i,u,a);return e&&e.notes&&0!==e.notes.length?(console.log("[MagentaService] Sequence continued. Total notes in result: ".concat(e.notes.length,", Total quantized steps in result: ").concat(e.totalQuantizedSteps)),_U(e,t,r,n,s)):(console.warn("[MagentaService] drumsRNN.continueSequence returned empty or invalid result."),null)}catch(h){return console.error("[MagentaService] Error during drumsRNN.continueSequence:",h),null}}(h(h({},e),{},{cells:n}));r?(V(t),g(r),console.log("[Magenta] Drum pattern generated/filled and states updated.")):(console.warn("[Magenta] AI generation (fill/continue) returned no cell changes or seed was empty."),V(t),g(n),alert("\u0417\u0430\u0442\u0440\u0430\u0432\u043a\u0430 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0431\u044b\u043b\u0430 \u043f\u0443\u0441\u0442\u043e\u0439, \u0438\u043b\u0438 \u043c\u043e\u0434\u0435\u043b\u044c \u043d\u0435 \u0441\u043c\u043e\u0433\u043b\u0430 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0430\u0442\u0442\u0435\u0440\u043d. \u0420\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0442\u0430\u043a\u0442\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e."))}catch(i){console.error("[Magenta] Error during drum generation (fill/continue) in SequencerModule:",i),alert("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u043f\u0430\u0442\u0442\u0435\u0440\u043d\u0430."),V(t),g(n)}finally{Q(!1)}},isGeneratingDrums:X,isMagentaModelReady:H,temperature:Y,onTemperatureChange:J,isSequencerInitialized:I,stepsPerQuarterOptions:IU,currentStepsPerQuarter:Z,onStepsPerQuarterChange:$,onGenerateVariation:async()=>{if(!H)return void alert("\u041c\u043e\u0434\u0435\u043b\u044c \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u0430. \u041f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435 \u043d\u0435\u043c\u043d\u043e\u0433\u043e.");if(X||ee)return void alert("\u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0443\u0436\u0435 \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435.");te(!0),console.log("[Magenta] Preparing to generate ".concat(ne," new bar variation(s). AI SPQ: ").concat(Z,"."));const e=se(),t={};if(!(e&&e.length>0))return alert("\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0442\u0430\u043a\u0442 (\u0437\u0430\u0442\u0440\u0430\u0432\u043a\u0430) \u043f\u0443\u0441\u0442. \u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0430\u0440\u0438\u0430\u0446\u0438\u0438."),void te(!1);e.forEach((e=>{O.forEach((n=>{const r=e.trackSteps[n]||0;for(let o=0;o<r;o++){const r="".concat(e.originalIndex,"-").concat(n,"-").concat(o);m[r]&&(t[r]=m[r])}}))}));const n={blocks:e,cells:t,trackNames:O,bpm:_,temperature:Y,genSpq:Z};try{const e=await async function(e,t){const{blocks:n,cells:r,trackNames:o,bpm:a,temperature:s,genSpq:i}=e;if(!vU)return console.error("[MagentaService] DrumsRNN model is not initialized for generateNewBarVariation."),null;if(t<=0)return console.warn("[MagentaService] numberOfNewBarsToGenerate is 0 or negative. Aborting."),[];console.log("[MagentaService] Creating seed sequence for new bar variation from bar with ".concat(n.length," blocks."));const c=SU(n,r,o,a,i);if(!c.notes||0===c.notes.length)return console.warn("[MagentaService] Seed sequence for new bar variation is empty. Aborting generation."),null;console.log("[MagentaService] Seed for variation: ".concat(c.notes.length," notes, total steps in seed: ").concat(c.totalQuantizedSteps,". GenSpQ: ").concat(i));const l=c.totalQuantizedSteps;if(l<=0)return console.warn("[MagentaService] Seed sequence has no duration (totalQuantizedSteps = 0). Cannot generate variations."),null;const u=[];for(let p=0;p<t;p++){console.log("[MagentaService] Generating new bar variation ".concat(p+1," of ").concat(t,"... Temp: ").concat(s));try{const e=await vU.continueSequence(c,l,s);if(!e||!e.notes||0===e.notes.length){console.warn("[MagentaService] Variation ".concat(p+1," generation returned empty result. Skipping this bar.")),u.push({});continue}console.log("[MagentaService] Variation ".concat(p+1," generated. Notes: ").concat(e.notes.length,", Steps: ").concat(e.totalQuantizedSteps));const t=n.map(((e,t)=>h(h({},e),{},{id:"ai_block_".concat(Date.now(),"_").concat(p,"_").concat(t),name:"".concat(e.name||"\u0411\u043b\u043e\u043a"," (AI ").concat(p+1,".").concat(t+1,")"),trackSteps:o.reduce(((e,t)=>h(h({},e),{},{[t]:i})),{}),originalIndex:t}))),r=_U(e,t,o,{},i);u.push(r)}catch(d){console.error("[MagentaService] Error generating variation ".concat(p+1,":"),d),u.push({})}}return u}(n,ne);if(e&&e.length>0){let t=[...j],o=h({},m),a=[...U];const c=s;let l=-1;for(let e=0;e<=c;e++){var r;l+=(null===(r=a[e])||void 0===r?void 0:r.timeSignature)||0}let u=0;for(let r=0;r<e.length;r++){const s=e[r];console.log("[SM NewVar] Processing new bar ".concat(r+1,". singleNewBarCells keys: ").concat(Object.keys(s).join(", ")));const i=n.blocks.map(((e,t)=>h(h({},e),{},{id:"ai_block_".concat(Date.now(),"_var_").concat(r,"_").concat(t),name:"".concat(e.name||"\u0411\u043b\u043e\u043a"," (AI Var ").concat(r+1,".").concat(t+1,")"),trackSteps:O.reduce(((e,t)=>h(h({},e),{},{[t]:n.genSpq})),{})}))),d={id:(a.length>0?Math.max(...a.map((e=>e.id))):0)+1+r,name:"\u0422\u0430\u043a\u0442 AI (\u0412\u0430\u0440. ".concat(r+1,")"),timeSignature:i.length};a.splice(c+1+r,0,d);const p=l+1+u,f=i.map(((e,t)=>h(h({},e),{},{originalIndex:p+t})));t.splice(p,0,...f),f.forEach((e=>{const t=e.originalIndex-p;console.log("[SM NewVar] Processing GlobalBlock originalIndex: ".concat(e.originalIndex,", Mapped LocalBlockIndex: ").concat(t)),O.forEach((n=>{const r=e.trackSteps[n]||0;for(let a=0;a<r;a++){const r="".concat(t,"-").concat(n,"-").concat(a),i="".concat(e.originalIndex,"-").concat(n,"-").concat(a);s[r]?(o[i]=s[r],console.log("[SM NewVar] Mapped cell ".concat(r," to ").concat(i," with data:"),JSON.stringify(s[r]))):(o[i]={instrumentId:null},console.log("[SM NewVar] Initialized empty cell ".concat(i," (local key ").concat(r," was NOT found in singleNewBarCells. singleNewBarCells keys: ").concat(Object.keys(s).join(", "),")")))}}))})),u+=i.length}console.log("[SM NewVar] Before setting state - Final newMasterStructure:",JSON.stringify(t.map((e=>({id:e.id,name:e.name,originalIndex:e.originalIndex,trackSteps:e.trackSteps}))))),console.log("[SM NewVar] Before setting state - Final newMasterBarsConfig:",JSON.stringify(a)),console.log("[SM NewVar] Before setting state - Final newMasterCells keys:",Object.keys(o).join(", ")),V(t),G(a),g(o),i(c+1),console.log("[Magenta] Successfully generated and added ".concat(e.length," new bar variation(s)."))}else e?alert("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0430\u0440\u0438\u0430\u0446\u0438\u0438 (\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u043c\u043e\u0434\u0435\u043b\u044c \u0432\u0435\u0440\u043d\u0443\u043b\u0430 \u043f\u0443\u0441\u0442\u044b\u0435 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u044b)."):alert("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0432\u0430\u0440\u0438\u0430\u0446\u0438\u0438: \u0437\u0430\u0442\u0440\u0430\u0432\u043a\u0430 \u0431\u044b\u043b\u0430 \u043f\u0443\u0441\u0442\u043e\u0439 \u0438\u043b\u0438 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u0432 \u043c\u043e\u0434\u0435\u043b\u0438.")}catch(o){console.error("[Magenta] Error during new bar variation generation in SequencerModule:",o),alert("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u0432\u0430\u0440\u0438\u0430\u0446\u0438\u0439.")}finally{te(!1)}},numNewBars:ne,onNumNewBarsChange:re,isGeneratingVariation:ee}),(0,St.jsx)(Nt,{sequencerStructure:j,trackNames:O,cellsState:m,currentBar:s,totalBars:c,onBarChange:i,currentBarInfo:ae(),onVerticalModeChange:ce,inVerticalMode:!1,isPlaying:k,bpm:_,isInitialized:I,isPrerollEnabled:N,isTransitioning:A,onPlayToggle:ie,onBpmChange:C,onPrerollToggle:E,onMetronomeToggle:he,isMetronomeEnabled:z})]}),(0,St.jsx)(Vc,{isActive:"vertical"===y,blocks:j,trackNames:O,cellsState:m,currentPlaybackPosition:p,handleCellClick:e=>{r?(g((t=>{const n=h({},t);return n[e]={instrumentId:r.id},n})),console.log("\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d \u0438\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442 ".concat(r.id," \u0432 \u044f\u0447\u0435\u0439\u043a\u0443 ").concat(e))):(g((t=>{const n=h({},t);return n[e]&&(n[e]={instrumentId:null}),n})),console.log("\u042f\u0447\u0435\u0439\u043a\u0430 ".concat(e," \u043e\u0447\u0438\u0449\u0435\u043d\u0430")))},currentBar:s,totalBars:c,onBarChange:i,currentBarInfo:ae(),sequencerStructure:j,onVerticalModeChange:ce,isPlaying:k,bpm:_,isInitialized:I,isPrerollEnabled:N,isTransitioning:A,onPlayToggle:ie,onBpmChange:C,onPrerollToggle:E,onLoopButtonClick:le,loopedBlockIndices:P,mutedTracks:F,handleMuteToggle:ue,isMetronomeEnabled:z,onMetronomeToggle:he}),(0,St.jsx)(Uc,{})]})})),EU=NU,AU=()=>{var e;const t=(0,o.useRef)(null),n=(null===(e=de().state)||void 0===e?void 0:e.loadedSessionData)||null;return(0,St.jsxs)("div",{className:"sequencer-page",children:[(0,St.jsxs)("h1",{children:["\u0421\u0435\u043a\u0432\u0435\u043d\u0441\u043e\u0440 ",n?"(".concat(n.sessionName,")"):""]}),(0,St.jsx)("button",{onClick:()=>{const e=window.prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0441\u0435\u0441\u0441\u0438\u0438:");if(e&&""!==e.trim()){let n=window.prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u043f\u0430\u043f\u043a\u0438 (\u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043f\u0443\u0441\u0442\u044b\u043c \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u041e\u0442\u043c\u0435\u043d\u0430 \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0432 \u043a\u043e\u0440\u0435\u043d\u044c):");const r=n?n.trim():"";t.current&&t.current.exportData(e.trim(),r)}else null!==e&&alert("\u0418\u043c\u044f \u0441\u0435\u0441\u0441\u0438\u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c.")},style:{backgroundColor:"#4CAF50",border:"none",color:"white",padding:"10px 20px",textAlign:"center",textDecoration:"none",display:"inline-block",fontSize:"16px",margin:"4px 2px",marginBottom:"10px",cursor:"pointer",borderRadius:"8px",boxShadow:"0 2px 4px 0 rgba(0,0,0,0.2)",transitionDuration:"0.4s"},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440"}),(0,St.jsx)(EU,{ref:t,initialSessionData:n})]})},RU=()=>{const[e,t]=(0,o.useState)([]),[n,r]=(0,o.useState)(!0),[a,s]=(0,o.useState)(null),i=me(),[c,l]=(0,o.useState)(null),u="https://rhythmcapsule.ru/api/sequencer";(0,o.useEffect)((()=>{(async()=>{r(!0),s(null);try{const e=await fetch("".concat(u,"/sessions"));if(!e.ok){const t=await e.json().catch((()=>({message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ".concat(e.status)})));throw new Error(t.message||"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u0438: ".concat(e.statusText))}const n=await e.json();t(n)}catch(L2){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u0435\u0441\u0441\u0438\u0439:",L2),s(L2.message)}finally{r(!1)}})()}),[u]);const{folders:h,sessionsToDisplay:d}=(0,o.useMemo)((()=>{const t=new Set;let n=[];return e.forEach((e=>{e.folderName&&""!==e.folderName.trim()&&t.add(e.folderName.trim())})),n=null===c?e.filter((e=>!e.folderName||""===e.folderName.trim())):e.filter((e=>e.folderName===c)),{folders:Array.from(t).sort(),sessionsToDisplay:n.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)))}}),[e,c]);return n&&0===e.length?(0,St.jsx)("div",{className:"sessions-loader",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0445 \u0441\u0435\u0441\u0441\u0438\u0439..."}):a?(0,St.jsxs)("div",{className:"sessions-error",children:["\u041e\u0448\u0438\u0431\u043a\u0430: ",a,". \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."]}):(0,St.jsxs)("div",{className:"saved-sessions-page",children:[(0,St.jsx)("h1",{children:null===c?"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0435 \u0441\u0435\u0441\u0441\u0438\u0438":"\u041f\u0430\u043f\u043a\u0430: ".concat(c)}),null!==c&&(0,St.jsx)("button",{onClick:()=>l(null),className:"button-back",children:"\u2190 \u041a \u0441\u043f\u0438\u0441\u043a\u0443 \u043f\u0430\u043f\u043e\u043a \u0438 \u043a\u043e\u0440\u043d\u0435\u0432\u044b\u043c \u0441\u0435\u0441\u0441\u0438\u044f\u043c"}),null===c&&h.length>0&&(0,St.jsxs)("div",{className:"folder-section",children:[(0,St.jsx)("h2",{children:"\u041f\u0430\u043f\u043a\u0438"}),(0,St.jsx)("ul",{className:"folder-list",children:h.map((e=>(0,St.jsxs)("li",{className:"folder-item",onClick:()=>l(e),children:[(0,St.jsx)("span",{className:"folder-icon",children:"\ud83d\udcc1"})," ",e," "]},e)))})]}),(0,St.jsxs)("div",{className:"session-section",children:[(0,St.jsx)("h2",{children:null===c?"\u041a\u043e\u0440\u0435\u043d\u044c":"\u0421\u0435\u0441\u0441\u0438\u0438"}),0!==d.length||n?(0,St.jsx)("ul",{className:"sessions-list",children:d.map((n=>(0,St.jsxs)("li",{className:"session-item",children:[(0,St.jsxs)("div",{className:"session-info",children:[(0,St.jsx)("span",{className:"session-name",children:n.sessionName||"[\u0411\u0435\u0437 \u0438\u043c\u0435\u043d\u0438]"}),(0,St.jsxs)("span",{className:"session-date",children:["\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e: ",new Date(n.createdAt).toLocaleString([],{dateStyle:"short",timeStyle:"short"})]})]}),(0,St.jsxs)("div",{className:"session-actions",children:[(0,St.jsx)("button",{onClick:()=>(async t=>{r(!0),s(null);try{const e=await fetch("".concat(u,"/sessions/").concat(t));if(!e.ok){const t=await e.json().catch((()=>({message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ".concat(e.status)})));throw new Error(t.message||"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u0435\u0441\u0441\u0438\u0438: ".concat(e.statusText))}const n=await e.json();i("/sequencer",{state:{loadedSessionData:n}})}catch(L2){const o=e.find((e=>e._id===t)),a=(null===o||void 0===o?void 0:o.sessionName)||"\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u0430\u044f \u0441\u0435\u0441\u0441\u0438\u044f";console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 ".concat(t,":"),L2),s('\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e "'.concat(a,'": ').concat(L2.message)),r(!1)}})(n._id),className:"button-load",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c"}),(0,St.jsx)("button",{onClick:()=>(async(e,n,r)=>{const o=n||"[\u0411\u0435\u0437 \u0438\u043c\u0435\u043d\u0438]";if(window.confirm('\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0423\u0414\u0410\u041b\u0418\u0422\u042c \u0441\u0435\u0441\u0441\u0438\u044e "'.concat(o,'"').concat(r?" \u0438\u0437 \u043f\u0430\u043f\u043a\u0438 '"+r+"'":"","? \u042d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435\u043e\u0431\u0440\u0430\u0442\u0438\u043c\u043e.")))try{const n=await fetch("".concat(u,"/sessions/").concat(e),{method:"DELETE"});if(!n.ok){const e=await n.json().catch((()=>({message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: ".concat(n.status)})));throw new Error(e.message||"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e: ".concat(n.statusText))}t((t=>t.filter((t=>t._id!==e)))),alert('\u0421\u0435\u0441\u0441\u0438\u044f "'.concat(o,'" \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d\u0430.'))}catch(L2){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u0441\u0435\u0441\u0441\u0438\u0438 ".concat(e,":"),L2),alert('\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0435\u0441\u0441\u0438\u044e "'.concat(o,'": ').concat(L2.message))}})(n._id,n.sessionName,n.folderName),className:"button-delete",children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]})]},n._id)))}):(0,St.jsx)("p",{children:null===c?"\u041d\u0435\u0442 \u0441\u0435\u0441\u0441\u0438\u0439 \u0432 \u043a\u043e\u0440\u043d\u0435.":"\u0412 \u044d\u0442\u043e\u0439 \u043f\u0430\u043f\u043a\u0435 \u043f\u043e\u043a\u0430 \u043d\u0435\u0442 \u0441\u0435\u0441\u0441\u0438\u0439."})]}),n&&e.length>0&&(0,St.jsx)("div",{className:"sessions-loader-inline",children:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."})]})};var OU,MU,PU,DU;function FU(e){var t,n,r,o,a,s;return{lang:null!==(t=null===e||void 0===e?void 0:e.lang)&&void 0!==t?t:null===(n=OU)||void 0===n?void 0:n.lang,message:null===e||void 0===e?void 0:e.message,abortEarly:null!==(r=null===e||void 0===e?void 0:e.abortEarly)&&void 0!==r?r:null===(o=OU)||void 0===o?void 0:o.abortEarly,abortPipeEarly:null!==(a=null===e||void 0===e?void 0:e.abortPipeEarly)&&void 0!==a?a:null===(s=OU)||void 0===s?void 0:s.abortPipeEarly}}function LU(e){const t=typeof e;return"string"===t?'"'.concat(e,'"'):"number"===t||"bigint"===t||"boolean"===t?"".concat(e):"object"===t||"function"===t?null!==(n=e&&(null===(r=Object.getPrototypeOf(e))||void 0===r||null===(r=r.constructor)||void 0===r?void 0:r.name))&&void 0!==n?n:"null":t;var n,r}function zU(e,t,n,r,o){var a,s,i,c,l,u,h,d;const p=o&&"input"in o?o.input:n.value,f=null!==(a=null!==(s=null===o||void 0===o?void 0:o.expected)&&void 0!==s?s:e.expects)&&void 0!==a?a:null,m=null!==(i=null===o||void 0===o?void 0:o.received)&&void 0!==i?i:LU(p),g={kind:e.kind,type:e.type,input:p,expected:f,received:m,message:"Invalid ".concat(t,": ").concat(f?"Expected ".concat(f," but r"):"R","eceived ").concat(m),requirement:e.requirement,path:null===o||void 0===o?void 0:o.path,issues:null===o||void 0===o?void 0:o.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},y="schema"===e.kind,b=null!==(c=null!==(l=null!==(u=null!==(h=null!==(d=null===o||void 0===o?void 0:o.message)&&void 0!==d?d:e.message)&&void 0!==h?h:function(e,t){var n;return null===(n=DU)||void 0===n||null===(n=n.get(e))||void 0===n?void 0:n.get(t)}(e.reference,g.lang))&&void 0!==u?u:y?function(e){var t;return null===(t=PU)||void 0===t?void 0:t.get(e)}(g.lang):null)&&void 0!==l?l:r.message)&&void 0!==c?c:function(e){var t;return null===(t=MU)||void 0===t?void 0:t.get(e)}(g.lang);void 0!==b&&(g.message="function"===typeof b?b(g):b),y&&(n.typed=!1),n.issues?n.issues.push(g):n.issues=[g]}function BU(e){return{version:1,vendor:"valibot",validate:t=>e["~run"]({value:t},FU())}}function qU(e,t){return Object.hasOwn(e,t)&&"__proto__"!==t&&"prototype"!==t&&"constructor"!==t}var WU=class extends Error{constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function jU(e,t,n){return"function"===typeof e.fallback?e.fallback(t,n):e.fallback}function VU(e,t,n){return"function"===typeof e.default?e.default(t,n):e.default}function UU(e,t){return!e["~run"]({value:t},{abortEarly:!0}).issues}function GU(){return{kind:"schema",type:"any",reference:GU,expects:"any",async:!1,get"~standard"(){return BU(this)},"~run":e=>(e.typed=!0,e)}}function HU(e){return{kind:"schema",type:"boolean",reference:HU,expects:"boolean",async:!1,message:e,get"~standard"(){return BU(this)},"~run"(e,t){return"boolean"===typeof e.value?e.typed=!0:zU(this,"type",e,t),e}}}function KU(e){return{kind:"schema",type:"function",reference:KU,expects:"Function",async:!1,message:e,get"~standard"(){return BU(this)},"~run"(e,t){return"function"===typeof e.value?e.typed=!0:zU(this,"type",e,t),e}}}function XU(e,t){return{kind:"schema",type:"loose_object",reference:XU,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return BU(this)},"~run"(e,t){const n=e.value;if(n&&"object"===typeof n){e.typed=!0,e.value={};for(const o in this.entries){const a=this.entries[o];if(o in n||("exact_optional"===a.type||"optional"===a.type||"nullish"===a.type)&&void 0!==a.default){const s=o in n?n[o]:VU(a),i=a["~run"]({value:s},t);if(i.issues){const a={type:"object",origin:"value",input:n,key:o,value:s};for(const t of i.issues){var r;t.path?t.path.unshift(a):t.path=[a],null===(r=e.issues)||void 0===r||r.push(t)}if(e.issues||(e.issues=i.issues),t.abortEarly){e.typed=!1;break}}i.typed||(e.typed=!1),e.value[o]=i.value}else if(void 0!==a.fallback)e.value[o]=jU(a);else if("exact_optional"!==a.type&&"optional"!==a.type&&"nullish"!==a.type&&(zU(this,"key",e,t,{input:void 0,expected:'"'.concat(o,'"'),path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),t.abortEarly))break}if(!e.issues||!t.abortEarly)for(const t in n)qU(n,t)&&!(t in this.entries)&&(e.value[t]=n[t])}else zU(this,"type",e,t);return e}}}function QU(e,t){return{kind:"schema",type:"nullish",reference:QU,expects:"(".concat(e.expects," | null | undefined)"),async:!1,wrapped:e,default:t,get"~standard"(){return BU(this)},"~run"(e,t){return null!==e.value&&void 0!==e.value||(void 0!==this.default&&(e.value=VU(this,e,t)),null!==e.value&&void 0!==e.value)?this.wrapped["~run"](e,t):(e.typed=!0,e)}}}function YU(e){return{kind:"schema",type:"number",reference:YU,expects:"number",async:!1,message:e,get"~standard"(){return BU(this)},"~run"(e,t){return"number"!==typeof e.value||isNaN(e.value)?zU(this,"type",e,t):e.typed=!0,e}}}function JU(e,t){return{kind:"schema",type:"optional",reference:JU,expects:"(".concat(e.expects," | undefined)"),async:!1,wrapped:e,default:t,get"~standard"(){return BU(this)},"~run"(e,t){return void 0===e.value&&(void 0!==this.default&&(e.value=VU(this,e,t)),void 0===e.value)?(e.typed=!0,e):this.wrapped["~run"](e,t)}}}function ZU(e){return{kind:"schema",type:"string",reference:ZU,expects:"string",async:!1,message:e,get"~standard"(){return BU(this)},"~run"(e,t){return"string"===typeof e.value?e.typed=!0:zU(this,"type",e,t),e}}}function $U(e,t,n){const r=e["~run"]({value:t},FU(n));if(r.issues)throw new WU(r.issues);return r.value}var eG=Object.defineProperty,tG=(e,t,n)=>((e,t,n)=>t in e?eG(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),nG=Object.defineProperty,rG=(e,t,n)=>((e,t,n)=>t in e?nG(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,t+"",n);function oG(e,t){return n=>n instanceof e&&n.type===t}function aG(e,t){t||(t=[]);const n=Symbol(e);class r extends Error{constructor(){super(..."function"==typeof t?t(...arguments):"string"==typeof t?[t]:t||[]),rG(this,"type",n),this.name=e}}return Object.defineProperty(r,"name",{value:e}),[r,oG(r,n)]}const[sG,iG]=aG("CancelledError","Promise was canceled"),[cG,lG]=aG("TimeoutError",((e,t)=>["Timeout reached: ".concat(e,"ms"),{cause:t}])),uG=Symbol("Resolved");function hG(e){return Array.isArray(e)&&e[0]===uG}function dG(e,t){return e.reject=t.reject,e.abort=t.abort,e}class pG extends Promise{constructor(e,t){let n,r;super(((o,a)=>{let s,i;"function"==typeof e?(s=e,i=t):i=e;const c=[],l=e=>function(){const t=e(...arguments);return c.forEach((e=>e())),t},u=new AbortController,{signal:h}=u;r=e=>{!h.aborted&&u.abort(e)};const d=()=>h.reason,p=e=>{const t=()=>{e(d())};h.addEventListener("abort",t,!0);const n=()=>{h.removeEventListener("abort",t,!0)};return c.push(n),n},f=l((e=>{o(e),r(function(e){return[uG,e]}(e))}));n=l((e=>{a(e),r(e)})),i||(i={});const{abortSignal:m,rejectOnAbort:g=!0}=i;if(m)if(m.aborted){const{reason:e}=m;if(g)return n(e);r(e)}else{const e=()=>{r(m.reason)};m.addEventListener("abort",e),c.push((()=>{m.removeEventListener("abort",e)}))}g&&p(a);const{timeout:y}=i;if(y){const e=setTimeout((()=>{r(new cG(y))}),y);c.push((()=>{clearTimeout(e)}))}const b=()=>h.aborted,v=()=>hG(d()),w=()=>{const e=d();return hG(e)?e[1]:void 0};try{const e=s&&s(f,n,{abortReason:d,abortSignal:h,isAborted:b,isResolved:v,onAborted:p,onResolved:e=>p((()=>{v()&&e(w())})),resolved:w,throwIfAborted(){if(b())throw d()}});e instanceof Promise&&e.catch(n)}catch(x){n(x)}})),tG(this,"abort"),tG(this,"reject"),this.abort=r,this.reject=n}static fn(e,t){return new pG((async(t,n,r)=>{try{t(await e(r))}catch(o){n(o)}}),t)}static resolve(e){return this.fn((()=>e))}static reject(e){return new pG(((t,n)=>{n(e)}))}cancel(){this.abort(new sG)}catch(e){return this.then(void 0,e)}finally(e){return dG(super.finally(e),this)}then(e,t){return dG(super.then(e,t),this)}}function fG(e,t){return e.resolve=t.resolve,e}class mG extends pG{constructor(e,t){let n,r,o;"function"==typeof e?(n=e,r=t):r=e,super(((e,t,r)=>{o=e,n&&n(e,t,r)}),r),tG(this,"resolve"),this.resolve=o}static fn(e,t){return new mG(((t,n,r)=>{try{Promise.resolve(e(r)).then(t,n)}catch(o){n(o)}}),t)}static resolve(e){return this.fn((()=>e))}static reject(e){return new mG(((t,n)=>{n(e)}))}catch(e){return this.then(void 0,e)}finally(e){return fG(super.finally(e),this)}then(e,t){return fG(super.then(e,t),this)}}function gG(e){return e.replace(/[A-Z]/g,(e=>"-".concat(e.toLowerCase())))}function yG(e){const t=function(e){return Object.entries(e).reduce(((e,t)=>{let[n,r]=t;return e[function(e){return e.replace(/_[a-z]/g,(e=>e[1].toUpperCase()))}(n)]=r,e}),{})}(e);for(const n in t){const e=t[n];e&&"object"==typeof e&&!(e instanceof Date)&&(t[n]=Array.isArray(e)?e.map(yG):yG(e))}return t}function bG(e){return"tapps/".concat(e)}function vG(e,t){sessionStorage.setItem(bG(e),JSON.stringify(t))}function wG(e){const t=sessionStorage.getItem(bG(e));try{return t?JSON.parse(t):void 0}catch(n){}}function xG(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.flat(1);return[r.push.bind(r),()=>{r.forEach((e=>{e()}))}]}function kG(e,t){t||(t={});const{textColor:n,bgColor:r,shouldLog:o}=t,a=void 0===o||o,s="boolean"==typeof a?()=>a:a,i=function(t,o){if(o||s()){const o="font-weight:bold;padding:0 5px;border-radius:100px",[s,l,u]={log:["#0089c3","white","INFO"],error:["#ff0000F0","white","ERR"],warn:["#D38E15","white","WARN"]}[t];for(var a=arguments.length,i=new Array(a>2?a-2:0),c=2;c<a;c++)i[c-2]=arguments[c];console[t]("%c".concat(u," ").concat(Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date),"%c %c").concat(e),"".concat(o,";background-color:").concat(s,";color:").concat(l),"","".concat(o,";").concat(n?"color:".concat(n,";"):"").concat(r?"background-color:".concat(r):""),...i)}};return[["log","forceLog"],["warn","forceWarn"],["error","forceError"]].reduce(((e,t)=>{let[n,r]=t;return e[n]=i.bind(void 0,n,!1),e[r]=i.bind(void 0,n,!0),e}),{})}function SG(e){var t,n,r;return{lang:null!==(t=null==e?void 0:e.lang)&&void 0!==t?t:void 0,message:null==e?void 0:e.message,abortEarly:null!==(n=null==e?void 0:e.abortEarly)&&void 0!==n?n:void 0,abortPipeEarly:null!==(r=null==e?void 0:e.abortPipeEarly)&&void 0!==r?r:void 0}}function _G(e,t){var n;return null==(n=void 0)?void 0:n.get(t)}function CG(e){var t,n,r;const o=typeof e;return"string"===o?'"'.concat(e,'"'):"number"===o||"bigint"===o||"boolean"===o?"".concat(e):"object"===o||"function"===o?null!==(t=e&&(null==(r=null==(n=Object.getPrototypeOf(e))?void 0:n.constructor)?void 0:r.name))&&void 0!==t?t:"null":o}function IG(e,t,n,r,o){var a,s,i,c,l,u,h,d;const p=o&&"input"in o?o.input:n.value,f=null!==(a=null!==(s=null==o?void 0:o.expected)&&void 0!==s?s:e.expects)&&void 0!==a?a:null,m=null!==(i=null==o?void 0:o.received)&&void 0!==i?i:CG(p),g={kind:e.kind,type:e.type,input:p,expected:f,received:m,message:"Invalid ".concat(t,": ").concat(f?"Expected ".concat(f," but r"):"R","eceived ").concat(m),requirement:e.requirement,path:null==o?void 0:o.path,issues:null==o?void 0:o.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},y="schema"===e.kind,b=null!==(c=null!==(l=null!==(u=null!==(h=null!==(d=null==o?void 0:o.message)&&void 0!==d?d:e.message)&&void 0!==h?h:_G(e.reference,g.lang))&&void 0!==u?u:y?void g.lang:null)&&void 0!==l?l:r.message)&&void 0!==c?c:void g.lang;b&&(g.message="function"==typeof b?b(g):b),y&&(n.typed=!1),n.issues?n.issues.push(g):n.issues=[g]}function TG(e){return{version:1,vendor:"valibot",validate:t=>e["~run"]({value:t},SG())}}function NG(e,t){return Object.hasOwn(e,t)&&"__proto__"!==t&&"prototype"!==t&&"constructor"!==t}function EG(e,t){var n;const r=[...new Set(e)];return r.length>1?"(".concat(r.join(" ".concat(t," ")),")"):null!==(n=r[0])&&void 0!==n?n:"never"}var AG=class extends Error{constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function RG(e,t){return{kind:"validation",type:"check",reference:RG,async:!1,expects:null,requirement:e,message:t,"~run"(e,t){return e.typed&&!this.requirement(e.value)&&IG(this,"input",e,t),e}}}function OG(e){return{kind:"validation",type:"integer",reference:OG,async:!1,expects:null,requirement:Number.isInteger,message:e,"~run"(e,t){return e.typed&&!this.requirement(e.value)&&IG(this,"integer",e,t),e}}}function MG(e){return{kind:"transformation",type:"transform",reference:MG,async:!1,operation:e,"~run"(e){return e.value=this.operation(e.value),e}}}function PG(e,t,n){return"function"==typeof e.default?e.default(t,n):e.default}function DG(e,t){return!e["~run"]({value:t},{abortEarly:!0}).issues}function FG(e){return{kind:"schema",type:"boolean",reference:FG,expects:"boolean",async:!1,message:e,get"~standard"(){return TG(this)},"~run"(e,t){return"boolean"==typeof e.value?e.typed=!0:IG(this,"type",e,t),e}}}function LG(e){return{kind:"schema",type:"date",reference:LG,expects:"Date",async:!1,message:e,get"~standard"(){return TG(this)},"~run"(e,t){return e.value instanceof Date?isNaN(e.value)?IG(this,"type",e,t,{received:'"Invalid Date"'}):e.typed=!0:IG(this,"type",e,t),e}}}function zG(e,t){return{kind:"schema",type:"instance",reference:zG,expects:e.name,async:!1,class:e,message:t,get"~standard"(){return TG(this)},"~run"(e,t){return e.value instanceof this.class?e.typed=!0:IG(this,"type",e,t),e}}}function BG(e){return{kind:"schema",type:"lazy",reference:BG,expects:"unknown",async:!1,getter:e,get"~standard"(){return TG(this)},"~run"(e,t){return this.getter(e.value)["~run"](e,t)}}}function qG(e,t){return{kind:"schema",type:"loose_object",reference:qG,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return TG(this)},"~run"(e,t){var n;const r=e.value;if(r&&"object"==typeof r){e.typed=!0,e.value={};for(const o in this.entries){const a=this.entries[o];if(o in r||("exact_optional"===a.type||"optional"===a.type||"nullish"===a.type)&&void 0!==a.default){const s=o in r?r[o]:PG(a),i=a["~run"]({value:s},t);if(i.issues){const a={type:"object",origin:"value",input:r,key:o,value:s};for(const t of i.issues)t.path?t.path.unshift(a):t.path=[a],null==(n=e.issues)||n.push(t);if(e.issues||(e.issues=i.issues),t.abortEarly){e.typed=!1;break}}i.typed||(e.typed=!1),e.value[o]=i.value}else if("exact_optional"!==a.type&&"optional"!==a.type&&"nullish"!==a.type&&(IG(this,"key",e,t,{input:void 0,expected:'"'.concat(o,'"'),path:[{type:"object",origin:"key",input:r,key:o,value:r[o]}]}),t.abortEarly))break}if(!e.issues||!t.abortEarly)for(const t in r)NG(r,t)&&!(t in this.entries)&&(e.value[t]=r[t])}else IG(this,"type",e,t);return e}}}function WG(e){return{kind:"schema",type:"number",reference:WG,expects:"number",async:!1,message:e,get"~standard"(){return TG(this)},"~run"(e,t){return"number"!=typeof e.value||isNaN(e.value)?IG(this,"type",e,t):e.typed=!0,e}}}function jG(e,t){return{kind:"schema",type:"optional",reference:jG,expects:"(".concat(e.expects," | undefined)"),async:!1,wrapped:e,default:t,get"~standard"(){return TG(this)},"~run"(e,t){return void 0===e.value&&(void 0!==this.default&&(e.value=PG(this,e,t)),void 0===e.value)?(e.typed=!0,e):this.wrapped["~run"](e,t)}}}function VG(e,t,n){return{kind:"schema",type:"record",reference:VG,expects:"Object",async:!1,key:e,value:t,message:n,get"~standard"(){return TG(this)},"~run"(e,t){var n,r;const o=e.value;if(o&&"object"==typeof o){e.typed=!0,e.value={};for(const a in o)if(NG(o,a)){const s=o[a],i=this.key["~run"]({value:a},t);if(i.issues){const r={type:"object",origin:"key",input:o,key:a,value:s};for(const t of i.issues)t.path=[r],null==(n=e.issues)||n.push(t);if(e.issues||(e.issues=i.issues),t.abortEarly){e.typed=!1;break}}const c=this.value["~run"]({value:s},t);if(c.issues){const n={type:"object",origin:"value",input:o,key:a,value:s};for(const t of c.issues)t.path?t.path.unshift(n):t.path=[n],null==(r=e.issues)||r.push(t);if(e.issues||(e.issues=c.issues),t.abortEarly){e.typed=!1;break}}(!i.typed||!c.typed)&&(e.typed=!1),i.typed&&(e.value[i.value]=c.value)}}else IG(this,"type",e,t);return e}}}function UG(e){return{kind:"schema",type:"string",reference:UG,expects:"string",async:!1,message:e,get"~standard"(){return TG(this)},"~run"(e,t){return"string"==typeof e.value?e.typed=!0:IG(this,"type",e,t),e}}}function GG(e){let t;if(e)for(const n of e)t?t.push(...n.issues):t=n.issues;return t}function HG(e,t){return{kind:"schema",type:"union",reference:HG,expects:EG(e.map((e=>e.expects)),"|"),async:!1,options:e,message:t,get"~standard"(){return TG(this)},"~run"(e,t){let n,r,o;for(const a of this.options){const s=a["~run"]({value:e.value},t);if(s.typed){if(!s.issues){n=s;break}r?r.push(s):r=[s]}else o?o.push(s):o=[s]}if(n)return n;if(r){if(1===r.length)return r[0];IG(this,"type",e,t,{issues:GG(r)}),e.typed=!0}else{if(1===(null==o?void 0:o.length))return o[0];IG(this,"type",e,t,{issues:GG(o)})}return e}}}function KG(){return{kind:"schema",type:"unknown",reference:KG,expects:"unknown",async:!1,get"~standard"(){return TG(this)},"~run":e=>(e.typed=!0,e)}}function XG(e,t,n){const r=e["~run"]({value:t},SG(n));if(r.issues)throw new AG(r.issues);return r.value}function QG(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h(h({},t[0]),{},{pipe:t,get"~standard"(){return TG(this)},"~run"(e,n){for(const r of t)if("metadata"!==r.kind){if(e.issues&&("schema"===r.kind||"transformation"===r.kind)){e.typed=!1;break}(!e.issues||!n.abortEarly&&!n.abortPipeEarly)&&(e=r["~run"](e,n))}return e}})}function YG(e){const t=function(e){return Object.entries(e).reduce(((e,t)=>{let[n,r]=t;return e[function(e){return e.replace(/_[a-z]/g,(e=>e[1].toUpperCase()))}(n)]=r,e}),{})}(e);for(const n in t){const e=t[n];e&&"object"==typeof e&&!(e instanceof Date)&&(t[n]=Array.isArray(e)?e.map(YG):YG(e))}return t}function JG(e){return MG((t=>e?YG(t):t))}function ZG(e){return t=>QG(e,JG(t))}function $G(e){return(t,n)=>XG(QG(e,JG(n)),t)}function eH(){return MG(JSON.parse)}function tH(e){const t=ZG(e);return e=>QG(UG(),eH(),t(e))}function nH(e){return MG((t=>{const n={};return new URLSearchParams(t).forEach(((e,t)=>{const r=n[t];Array.isArray(r)?r.push(e):n[t]=void 0===r?e:[r,e]})),XG(e,n)}))}function rH(e){return t=>QG(HG([UG(),zG(URLSearchParams)]),nH(e),JG(t))}const oH=jG(BG((()=>lH()))),aH=qG({id:WG(),photo_url:jG(UG()),type:UG(),title:UG(),username:jG(UG())}),sH=qG({added_to_attachment_menu:jG(FG()),allows_write_to_pm:jG(FG()),first_name:UG(),id:WG(),is_bot:jG(FG()),is_premium:jG(FG()),last_name:jG(UG()),language_code:jG(UG()),photo_url:jG(UG()),username:jG(UG())}),iH=qG({auth_date:QG(UG(),MG((e=>new Date(1e3*Number(e)))),LG()),can_send_after:jG(QG(UG(),MG(Number),OG())),chat:jG(BG((()=>cH()))),chat_type:jG(UG()),chat_instance:jG(UG()),hash:UG(),query_id:jG(UG()),receiver:oH,start_param:jG(UG()),signature:UG(),user:oH}),cH=tH(aH),lH=tH(sH),uH=rH(iH);function hH(e){return/^#[\da-f]{6}$/i.test(e)}const dH=ZG(VG(UG(),QG(HG([UG(),WG()]),MG((e=>"number"==typeof e?"#".concat((16777215&e).toString(16).padStart(6,"0")):e)),RG(hH)))),pH=jG(QG(UG(),MG((e=>"1"===e)))),fH=tH(dH()),mH=rH(qG({tgWebAppBotInline:pH,tgWebAppData:jG(uH()),tgWebAppDefaultColors:jG(fH()),tgWebAppFullscreen:pH,tgWebAppPlatform:UG(),tgWebAppShowSettings:pH,tgWebAppStartParam:jG(UG()),tgWebAppThemeParams:fH(),tgWebAppVersion:UG()})),gH=($G(uH()),$G(mH())),yH=qG({eventType:UG(),eventData:jG(KG())});function bH(e){try{return DG(mH(),e)}catch(t){return!1}}let vH;function wH(e){if(vH)return e();vH=new Map;try{e()}finally{vH.forEach((e=>e())),vH=void 0}}function xH(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const a=e=>{if(!n(o,e)){const t=o;o=e,function(e,t){vH&&vH.set(e,t)||t()}(c,(()=>{[...r].forEach((n=>{let[r,o]=n;r(e,t),o&&i(r,!0)}))}))}};function s(e){const t="object"!=typeof e?{once:e}:e;return{once:t.once||!1,signal:t.signal||!1}}const i=(e,t)=>{const n=s(t),o=r.findIndex((t=>{let[r,o]=t;return r===e&&o.once===n.once&&o.signal===n.signal}));o>=0&&r.splice(o,1)},c=Object.assign((function(){return function(e){kH.length&&kH[kH.length-1].add(e)}(c),o}),{destroy(){r=[]},set:a,reset(){a(e)},sub:(e,t)=>(r.push([e,s(t)]),()=>i(e,t)),unsub:i,unsubAll(){r=r.filter((e=>e[1].signal))}});return c}const kH=[];var SH=Object.defineProperty,_H=(e,t,n)=>((e,t,n)=>t in e?SH(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);function CH(e,t){return n=>n instanceof e&&n.type===t}function IH(e,t){t||(t=[]);const n=Symbol(e);class r extends Error{constructor(){super(..."function"==typeof t?t(...arguments):"string"==typeof t?[t]:t||[]),_H(this,"type",n),this.name=e}}return Object.defineProperty(r,"name",{value:e}),[r,CH(r,n)]}function TH(e){return UU(XU({TelegramWebviewProxy:XU({postEvent:KU()})}),e)}function NH(){try{return window.self!==window.top}catch(e){return!0}}function EH(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}let AH=!1;const RH=xH(kG("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:()=>AH})),OH={clipboard_text_received:XU({req_id:ZU(),data:QU(ZU())}),custom_method_invoked:XU({req_id:ZU(),result:JU(function e(){return{kind:"schema",type:"unknown",reference:e,expects:"unknown",async:!1,get"~standard"(){return BU(this)},"~run":e=>(e.typed=!0,e)}}()),error:JU(ZU())}),popup_closed:QU(XU({button_id:QU(ZU(),(()=>{}))}),{}),viewport_changed:XU({height:YU(),width:QU(YU(),(()=>window.innerWidth)),is_state_stable:HU(),is_expanded:HU()}),theme_changed:XU({theme_params:dH()})};function MH(e){if(e.source!==window.parent)return;let t;try{t=$U(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h(h({},t[0]),{},{pipe:t,get"~standard"(){return BU(this)},"~run"(e,n){for(const r of t)if("metadata"!==r.kind){if(e.issues&&("schema"===r.kind||"transformation"===r.kind)){e.typed=!1;break}e.issues&&(n.abortEarly||n.abortPipeEarly)||(e=r["~run"](e,n))}return e}})}(ZU(),eH(),yH),e.data)}catch(s){return}const{eventType:n,eventData:r}=t,o=OH[n];let a;try{a=o?$U(o,r):r}catch(UG){return RH().forceError(['An error occurred processing the "'.concat(n,'" event from the Telegram application.'),"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join("\n"),t,UG)}FH(n,a)}const[PH,DH,FH,LH]=function(e,t){const n={all:a=a||new Map,on:function(e,t){var n=a.get(e);n?n.push(t):a.set(e,[t])},off:function(e,t){var n=a.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):a.set(e,[]))},emit:function(e,t){var n=a.get(e);n&&n.slice().map((function(e){e(t)})),(n=a.get("*"))&&n.slice().map((function(n){n(e,t)}))}},r=new Map,o=(e,o,a)=>{a||(a=!1);const s=r.get(e)||new Map;r.set(e,s);const i=s.get(o)||[];s.set(o,i);const c=i.findIndex((e=>e[1]===a));c>=0&&(n.off(e,i[c][0]),i.splice(c,1),!i.length&&s.delete(o),s.size||(r.delete(e),!r.size&&t()))};var a;return[function(t,a,s){function i(){o(t,a,s)}function c(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];s&&i(),"*"===t?a(n):a(...n)}!r.size&&e(),n.on(t,c);const l=r.get(t)||new Map;r.set(t,l);const u=l.get(a)||[];return l.set(a,u),u.push([c,s||!1]),i},o,n.emit,function(){const e=n.all.size;n.all.clear(),r.clear(),e&&t()}]}((()=>{const e=window,t={receiveEvent:EH};e.TelegramGameProxy_receiveEvent=EH,e.TelegramGameProxy=t,e.Telegram={WebView:t},window.addEventListener("message",MH)}),(()=>{["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach((e=>{delete window[e]})),window.removeEventListener("message",MH)})),[zH,BH]=IH("MethodUnsupportedError",((e,t)=>['Method "'.concat(e,'" is unsupported in Mini Apps version ').concat(t)])),[qH,WH]=IH("MethodParameterUnsupportedError",((e,t,n)=>['Parameter "'.concat(t,'" of "').concat(e,'" method is unsupported in Mini Apps version ').concat(n)])),[jH,VH]=function(e,t,n){const r=Symbol(e);class o extends IH(e,n)[0]{constructor(){super(...arguments),_H(this,"data"),_H(this,"type",r),this.data=t(...arguments)}}return Object.defineProperty(o,"name",{value:e}),[o,CH(o,r)]}("LaunchParamsRetrieveError",(e=>({errors:e})),(e=>[["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","\ud83d\udcd6 Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-bridge/environment","","Collected errors:",...e.map((e=>{let[t,n]=e;return"Source: ".concat(t," / ").concat(n instanceof Error?n.message:String(n))}))].join("\n")])),[UH,GH]=IH("InvalidLaunchParamsError",((e,t)=>["Invalid value for launch params: ".concat(e),{cause:t}])),[HH,KH]=IH("UnknownEnvError"),[XH,QH]=IH("InvokeCustomMethodError",(e=>["Server returned error: ".concat(e)])),YH=xH((function(){try{window.parent.postMessage(...arguments)}catch(e){e instanceof SyntaxError?RH().forceError("Unable to call window.parent.postMessage due to incorrectly configured target origin. Use the setTargetOrigin method to allow this origin to receive events",e):RH().forceError(e)}})),JH=xH("https://web.telegram.org");function ZH(e,t){RH().log("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const n=window,r=JSON.stringify({eventType:e,eventData:t});if(NH())return function(){return YH()(...arguments)}(r,JH());if(TH(n))n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));else{if(!UU(XU({external:XU({notify:KU()})}),n))throw new HH;n.external.notify(r)}}function $H(e,t,n){n||(n={});const{capture:r}=n,[o,a]=xG();return new pG((a=>{(Array.isArray(t)?t:[t]).forEach((e=>{o(PH(e,(n=>{(!r||(Array.isArray(t)?r({event:e,payload:n}):r(n)))&&a(n)})))})),(n.postEvent||ZH)(e,n.params)}),n).finally(a)}const eK="launchParams";function tK(e){return e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&")}function nK(){const e=[];for(const[n,r]of[[()=>tK(window.location.href),"window.location.href"],[()=>{const e=performance.getEntriesByType("navigation")[0];return e&&tK(e.name)},"performance navigation entries"],[()=>wG(eK),"local storage"]]){const o=n();if(o){if(bH(o))return vG(eK,o),o;try{gH(o)}catch(t){e.push([r,t])}}else e.push([r,new Error("Source is empty")])}throw new jH(e)}function rK(e){const t=gH(nK());return e?yG(t):t}function oK(e,t){if(!e)try{return rK(),!0}catch(n){return!1}return pG.fn((async e=>{if(TH(window))return!0;try{return await $H("web_app_request_theme","theme_changed",e),!0}catch(t){return!1}}),t||{timeout:100})}function aK(e){return t=>{let{req_id:n}=t;return n===e}}function sK(e){return e.split(".").map(Number)}function iK(e,t){return function(e,t){const n=sK(e),r=sK(t),o=Math.max(n.length,r.length);for(let a=0;a<o;a+=1){const e=n[a]||0,t=r[a]||0;if(e!==t)return e>t?1:-1}return 0}(e,t)<=0}function cK(e,t,n){if("string"==typeof n){if("web_app_open_link"===e){if("try_instant_view"===t)return iK("6.4",n);if("try_browser"===t)return iK("7.6",n)}if("web_app_set_header_color"===e&&"color"===t)return iK("6.9",n);if("web_app_close"===e&&"return_back"===t)return iK("7.6",n);if("web_app_setup_main_button"===e&&"has_shine_effect"===t)return iK("7.10",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return iK("6.1",t);case"web_app_open_popup":return iK("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return iK("6.4",t);case"web_app_switch_inline_query":return iK("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return iK("6.9",t);case"web_app_setup_settings_button":return iK("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return iK("7.2",t);case"web_app_setup_swipe_behavior":return iK("7.7",t);case"web_app_share_to_story":return iK("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return iK("7.10",t);case"web_app_request_safe_area":case"web_app_request_content_safe_area":case"web_app_request_fullscreen":case"web_app_exit_fullscreen":case"web_app_set_emoji_status":case"web_app_add_to_home_screen":case"web_app_check_home_screen":case"web_app_request_emoji_status_access":case"web_app_check_location":case"web_app_open_location_settings":case"web_app_request_file_download":case"web_app_request_location":case"web_app_send_prepared_message":case"web_app_start_accelerometer":case"web_app_start_device_orientation":case"web_app_start_gyroscope":case"web_app_stop_accelerometer":case"web_app_stop_device_orientation":case"web_app_stop_gyroscope":case"web_app_toggle_orientation_lock":return iK("8.0",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function lK(){const e=performance.getEntriesByType("navigation")[0];return!!e&&"reload"===e.type}var uK,hK,dK,pK;function fK(e){var t,n,r,o,a,s;return{lang:null!==(t=null===e||void 0===e?void 0:e.lang)&&void 0!==t?t:null===(n=uK)||void 0===n?void 0:n.lang,message:null===e||void 0===e?void 0:e.message,abortEarly:null!==(r=null===e||void 0===e?void 0:e.abortEarly)&&void 0!==r?r:null===(o=uK)||void 0===o?void 0:o.abortEarly,abortPipeEarly:null!==(a=null===e||void 0===e?void 0:e.abortPipeEarly)&&void 0!==a?a:null===(s=uK)||void 0===s?void 0:s.abortPipeEarly}}function mK(e){const t=typeof e;return"string"===t?'"'.concat(e,'"'):"number"===t||"bigint"===t||"boolean"===t?"".concat(e):"object"===t||"function"===t?null!==(n=e&&(null===(r=Object.getPrototypeOf(e))||void 0===r||null===(r=r.constructor)||void 0===r?void 0:r.name))&&void 0!==n?n:"null":t;var n,r}function gK(e,t,n,r,o){var a,s,i,c,l,u,h,d;const p=o&&"input"in o?o.input:n.value,f=null!==(a=null!==(s=null===o||void 0===o?void 0:o.expected)&&void 0!==s?s:e.expects)&&void 0!==a?a:null,m=null!==(i=null===o||void 0===o?void 0:o.received)&&void 0!==i?i:mK(p),g={kind:e.kind,type:e.type,input:p,expected:f,received:m,message:"Invalid ".concat(t,": ").concat(f?"Expected ".concat(f," but r"):"R","eceived ").concat(m),requirement:e.requirement,path:null===o||void 0===o?void 0:o.path,issues:null===o||void 0===o?void 0:o.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},y="schema"===e.kind,b=null!==(c=null!==(l=null!==(u=null!==(h=null!==(d=null===o||void 0===o?void 0:o.message)&&void 0!==d?d:e.message)&&void 0!==h?h:function(e,t){var n;return null===(n=pK)||void 0===n||null===(n=n.get(e))||void 0===n?void 0:n.get(t)}(e.reference,g.lang))&&void 0!==u?u:y?function(e){var t;return null===(t=dK)||void 0===t?void 0:t.get(e)}(g.lang):null)&&void 0!==l?l:r.message)&&void 0!==c?c:function(e){var t;return null===(t=hK)||void 0===t?void 0:t.get(e)}(g.lang);void 0!==b&&(g.message="function"===typeof b?b(g):b),y&&(n.typed=!1),n.issues?n.issues.push(g):n.issues=[g]}function yK(e){return{version:1,vendor:"valibot",validate:t=>e["~run"]({value:t},fK())}}function bK(e,t){return Object.hasOwn(e,t)&&"__proto__"!==t&&"prototype"!==t&&"constructor"!==t}function vK(e,t){var n;const r=[...new Set(e)];return r.length>1?"(".concat(r.join(" ".concat(t," ")),")"):null!==(n=r[0])&&void 0!==n?n:"never"}var wK=class extends Error{constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function xK(e){return{kind:"transformation",type:"transform",reference:xK,async:!1,operation:e,"~run"(e){return e.value=this.operation(e.value),e}}}function kK(e,t,n){return"function"===typeof e.fallback?e.fallback(t,n):e.fallback}function SK(e,t,n){return"function"===typeof e.default?e.default(t,n):e.default}function _K(e,t){return{kind:"schema",type:"array",reference:_K,expects:"Array",async:!1,item:e,message:t,get"~standard"(){return yK(this)},"~run"(e,t){const n=e.value;if(Array.isArray(n)){e.typed=!0,e.value=[];for(let o=0;o<n.length;o++){const a=n[o],s=this.item["~run"]({value:a},t);if(s.issues){const i={type:"array",origin:"value",input:n,key:o,value:a};for(const t of s.issues){var r;t.path?t.path.unshift(i):t.path=[i],null===(r=e.issues)||void 0===r||r.push(t)}if(e.issues||(e.issues=s.issues),t.abortEarly){e.typed=!1;break}}s.typed||(e.typed=!1),e.value.push(s.value)}}else gK(this,"type",e,t);return e}}}function CK(e){return{kind:"schema",type:"date",reference:CK,expects:"Date",async:!1,message:e,get"~standard"(){return yK(this)},"~run"(e,t){return e.value instanceof Date?isNaN(e.value)?gK(this,"type",e,t,{received:'"Invalid Date"'}):e.typed=!0:gK(this,"type",e,t),e}}}function IK(e,t){return{kind:"schema",type:"instance",reference:IK,expects:e.name,async:!1,class:e,message:t,get"~standard"(){return yK(this)},"~run"(e,t){return e.value instanceof this.class?e.typed=!0:gK(this,"type",e,t),e}}}function TK(e,t){return{kind:"schema",type:"loose_object",reference:TK,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return yK(this)},"~run"(e,t){const n=e.value;if(n&&"object"===typeof n){e.typed=!0,e.value={};for(const o in this.entries){const a=this.entries[o];if(o in n||("exact_optional"===a.type||"optional"===a.type||"nullish"===a.type)&&void 0!==a.default){const s=o in n?n[o]:SK(a),i=a["~run"]({value:s},t);if(i.issues){const a={type:"object",origin:"value",input:n,key:o,value:s};for(const t of i.issues){var r;t.path?t.path.unshift(a):t.path=[a],null===(r=e.issues)||void 0===r||r.push(t)}if(e.issues||(e.issues=i.issues),t.abortEarly){e.typed=!1;break}}i.typed||(e.typed=!1),e.value[o]=i.value}else if(void 0!==a.fallback)e.value[o]=kK(a);else if("exact_optional"!==a.type&&"optional"!==a.type&&"nullish"!==a.type&&(gK(this,"key",e,t,{input:void 0,expected:'"'.concat(o,'"'),path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),t.abortEarly))break}if(!e.issues||!t.abortEarly)for(const t in n)bK(n,t)&&!(t in this.entries)&&(e.value[t]=n[t])}else gK(this,"type",e,t);return e}}}function NK(e){return{kind:"schema",type:"number",reference:NK,expects:"number",async:!1,message:e,get"~standard"(){return yK(this)},"~run"(e,t){return"number"!==typeof e.value||isNaN(e.value)?gK(this,"type",e,t):e.typed=!0,e}}}function EK(e,t){return{kind:"schema",type:"optional",reference:EK,expects:"(".concat(e.expects," | undefined)"),async:!1,wrapped:e,default:t,get"~standard"(){return yK(this)},"~run"(e,t){return void 0===e.value&&(void 0!==this.default&&(e.value=SK(this,e,t)),void 0===e.value)?(e.typed=!0,e):this.wrapped["~run"](e,t)}}}function AK(e,t,n){return{kind:"schema",type:"record",reference:AK,expects:"Object",async:!1,key:e,value:t,message:n,get"~standard"(){return yK(this)},"~run"(e,t){const n=e.value;if(n&&"object"===typeof n){e.typed=!0,e.value={};for(const a in n)if(bK(n,a)){const s=n[a],i=this.key["~run"]({value:a},t);if(i.issues){const o={type:"object",origin:"key",input:n,key:a,value:s};for(const t of i.issues){var r;t.path=[o],null===(r=e.issues)||void 0===r||r.push(t)}if(e.issues||(e.issues=i.issues),t.abortEarly){e.typed=!1;break}}const c=this.value["~run"]({value:s},t);if(c.issues){const r={type:"object",origin:"value",input:n,key:a,value:s};for(const t of c.issues){var o;t.path?t.path.unshift(r):t.path=[r],null===(o=e.issues)||void 0===o||o.push(t)}if(e.issues||(e.issues=c.issues),t.abortEarly){e.typed=!1;break}}i.typed&&c.typed||(e.typed=!1),i.typed&&(e.value[i.value]=c.value)}}else gK(this,"type",e,t);return e}}}function RK(e){return{kind:"schema",type:"string",reference:RK,expects:"string",async:!1,message:e,get"~standard"(){return yK(this)},"~run"(e,t){return"string"===typeof e.value?e.typed=!0:gK(this,"type",e,t),e}}}function OK(e){let t;if(e)for(const n of e)t?t.push(...n.issues):t=n.issues;return t}function MK(e,t){return{kind:"schema",type:"union",reference:MK,expects:vK(e.map((e=>e.expects)),"|"),async:!1,options:e,message:t,get"~standard"(){return yK(this)},"~run"(e,t){var n;let r,o,a;for(const s of this.options){const n=s["~run"]({value:e.value},t);if(n.typed){if(!n.issues){r=n;break}o?o.push(n):o=[n]}else a?a.push(n):a=[n]}if(r)return r;if(o){if(1===o.length)return o[0];gK(this,"type",e,t,{issues:OK(o)}),e.typed=!0}else{if(1===(null===(n=a)||void 0===n?void 0:n.length))return a[0];gK(this,"type",e,t,{issues:OK(a)})}return e}}}function PK(e,t,n){const r=e["~run"]({value:t},fK(n));if(r.issues)throw new wK(r.issues);return r.value}function DK(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h(h({},t[0]),{},{pipe:t,get"~standard"(){return yK(this)},"~run"(e,n){for(const r of t)if("metadata"!==r.kind){if(e.issues&&("schema"===r.kind||"transformation"===r.kind)){e.typed=!1;break}e.issues&&(n.abortEarly||n.abortPipeEarly)||(e=r["~run"](e,n))}return e}})}const FK=["available"];function LK(e,t){return xH(e,t)}function zK(e,t){return function(e,t){let n,r=new Set;function o(){return n||(n=xH(s(),t))}function a(){o().set(s())}function s(){r.forEach((e=>{e.unsub(a,{signal:!0})}));const t=new Set;let n;kH.push(t);try{n=e()}finally{kH.pop()}return t.forEach((e=>{e.sub(a,{signal:!0})})),r=t,n}return Object.assign((function(){return o()()}),{destroy(){o().destroy()},sub(){return o().sub(...arguments)},unsub(){o().unsub(...arguments)},unsubAll(){o().unsubAll(...arguments)}})}(e,t)}function BK(e,t){const n=LK(e,t);return[n,zK(n)]}let qK=!1;const WK=xH(kG("Bridge",{bgColor:"forestgreen",textColor:"white",shouldLog:()=>qK})),jK=LK(0),VK=LK(ZH),[UK,GK]=BK({tgWebAppPlatform:"unknown",tgWebAppVersion:"0.0"}),HK=zK((()=>GK().tgWebAppVersion));function KK(e){e||(e={});const{postEvent:t}=e,n=e.launchParams||rK();UK.set(n),VK.set("function"==typeof t?t:function(e,t){t||(t="strict");const n="function"==typeof t?t:e=>{const{method:n,version:r}=e,o="param"in e?new qH(n,e.param,r):new zH(n,r);if("strict"===t)throw o;return RH().forceWarn(o.message)};return(t,r)=>cK(t,e)?"web_app_set_header_color"===t&&UU(XU({color:GU()}),r)&&!cK(t,"color",e)?n({version:e,method:t,param:"color"}):ZH(t,r):n({version:e,method:t})}(n.tgWebAppVersion)),WK().log("The package was configured. Launch params:",UK())}function XK(){return jK.set(jK()+1),jK().toString()}function QK(e,t,n){return function(e,t,n,r){return $H("web_app_invoke_custom_method","custom_method_invoked",h(h({},r||{}),{},{params:{method:e,params:t,req_id:n},capture:aK(n)})).then((e=>{let{result:t,error:n}=e;if(n)throw new XH(n);return t}))}(e,t,XK(),h(h({},n||{}),{},{postEvent:JK}))}const YK=(e,t,n)=>(n||(n={}),n.postEvent||(n.postEvent=JK),$H(e,t,n)),JK=(e,t)=>VK()(e,t);function ZK(e){return zK((()=>cK(e,HK())))}function $K(e){return[e]}const[eX,tX]=IH("CSSVarsBoundError","CSS variables are already bound"),[nX,rX]=IH("NotAvailableError",$K),[oX,aX]=IH("InvalidEnvError",$K),[sX,iX]=IH("FunctionNotAvailableError",$K),[cX,lX]=IH("InvalidArgumentsError",((e,t)=>[e,{cause:t}])),[uX,hX]=IH("ConcurrentCallError",$K),[dX,pX]=IH("SetEmojiStatusError",(e=>["Failed to set emoji status: ".concat(e)])),[fX,mX]=IH("AccessDeniedError",$K),[gX,yX]=IH("FullscreenFailedError",$K),[bX,vX]=IH("ShareMessageError",$K),[wX,xX]=IH("UnknownThemeParamsKeyError",(e=>["Unknown theme params key passed: ".concat(e)]));function kX(){return typeof window>"u"}function SX(e,t,n){n||(n={});const{isSupported:r,isMounted:o,isMounting:a,component:s,supports:i}=n||{},c="".concat(s?"".concat(s,"."):"").concat(e,"()"),l=r?Array.isArray(r)||"object"==typeof r&&"any"in r?r:[r]:void 0;function u(e){if(i){const t=i[e];return cK(t[0],t[1],HK())}return!0}function h(){if(!l)return;const e=Array.isArray(l)?l:l.any,t=e.map((function(e){return"function"==typeof e?e():cK(e,HK())?void 0:"it is unsupported in Mini Apps version ".concat(HK())})).filter(Boolean);return Array.isArray(l)?t[0]:t.length===e.length?t[t.length-1]:void 0}let d;if(i){d={};for(const e in i)d[e]=zK((()=>u(e)))}const p=zK((()=>!h())),f=zK((()=>"0.0"!==HK())),m=zK((()=>!o||o())),g=zK((()=>oK()&&!kX()&&f()&&p()&&m()));return Object.assign((function(){const e="Unable to call the ".concat(c," ").concat(s?"method":"function",":");if(kX()||!oK())throw new sX("".concat(e," it can't be called outside Mini Apps"));if(!f())throw new sX("".concat(e," the SDK was not initialized. Use the SDK init() function"));const n=h();if(n)throw new sX("".concat(e," ").concat(n));const r=function(){for(const e in i)if(i[e][2](...arguments)&&!u(e))return"option ".concat(e," is not supported in Mini Apps version ").concat(HK())}(...arguments);if(r)throw new sX("".concat(e," ").concat(r));if(!m()){const t=a&&a()?"mounting. Wait for the mount completion":"unmounted. Use the ".concat(s,".mount() method");throw new sX("".concat(e," the component is ").concat(t))}return t(...arguments)}),t,{isAvailable:g,ifAvailable(){return g()?[!0,t(...arguments)]:[!1]}},l?{isSupported:p}:{},d?{supports:d}:{})}function _X(e,t){return t||(t={}),(n,r,o,a)=>SX(n,r,h(h({},t),{},{isSupported:o||t.isSupported,supports:a,component:e}))}function CX(e,t,n){return _X(e,{isSupported:n,isMounted:t})}function IX(e,t){return _X(e,{isSupported:t})}const TX="web_app_setup_back_button",NX="back_button_pressed",EX="backButton",[AX,RX]=BK(!1),[OX,MX]=BK(!1),PX=ZK(TX),DX=CX(EX,OX,TX),FX=IX(EX,TX),LX=DX("hide",(()=>{BX(!1)})),zX=FX("mount",(()=>{OX()||(BX(lK()&&wG(EX)||!1),OX.set(!0))}));function BX(e){e!==AX()&&(JK(TX,{is_visible:e}),vG(EX,e),AX.set(e))}const qX=FX("onClick",(e=>PH(NX,e))),WX=FX("offClick",(e=>{DH(NX,e)})),jX=DX("show",(()=>{BX(!0)}));Symbol.toStringTag;function VX(e,t,n){n||(n={});const{promise:r,error:o}=n,[a,s]=r?[r,zK(r)]:BK(),[i,c]=o?[o,zK(o)]:BK();return[Object.assign((function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(a()){const e=new uX(t);return i.set(e),pG.reject(e)}let s;return wH((()=>{a.set(e(...r)),i.set(void 0)})),a().catch((e=>{throw s=e,e})).finally((()=>{wH((()=>{a.set(void 0),i.set(s)}))}))}),e),[a,s,zK((()=>!!a()))],[i,c]]}function UX(e,t,n){const[r,...o]=VX(t,"The ".concat(e," component is already mounting")),[a,s]=BK(!1);return[function(){return a()?pG.resolve():r(...arguments).then((e=>{wH((()=>{a.set(!0),n(e)}))}))},...o,[a,s]]}const[GX,HX]=BK({available:!1,type:"",accessGranted:!1,accessRequested:!1,deviceId:"",tokenSaved:!1}),KX=zK((()=>GX().available)),XX="web_app_biometry_get_info",QX=SX("requestBiometry",(e=>YK(XX,"biometry_info_received",e)),{isSupported:XX});function YX(e){if(!iG(e))throw e}function JX(e){const t=e();t&&t.catch(YX).cancel()}const ZX="biometry",$X="web_app_biometry_request_auth",eQ="biometry_info_received",tQ=e=>{OQ(rQ(e))};function nQ(){throw new nX("Biometry is not available")}function rQ(e){let t=!1,n=!1,r="",o=!1,a="",s=!1;return e.available&&(t=!0,n=e.token_saved,r=e.device_id,o=e.access_requested,a=e.type,s=e.access_granted),{available:t,tokenSaved:n,deviceId:r,type:a,accessGranted:s,accessRequested:o}}const oQ=ZK($X),[aQ,sQ,iQ,cQ]=UX(ZX,(e=>{const t=lK()&&wG(ZX);return t?pG.resolve(t):QX({abortSignal:e}).then(rQ)}),(e=>{PH(eQ,tQ),OQ(e)})),lQ=IX(ZX,$X),uQ=CX(ZX,cQ[0],$X),hQ=lQ("mount",aQ),[,dQ,pQ]=sQ,[,fQ]=iQ,[mQ,gQ]=cQ,[yQ,bQ,vQ]=VX((e=>pG.fn((async t=>{const n=GX();n.available||nQ();const r=await YK($X,"biometry_auth_requested",h(h(h({},e),t),{},{params:{reason:((e||{}).reason||"").trim()}})),{token:o}=r;return"string"==typeof o&&OQ(h(h({},n),{},{token:o})),r}),e)),"Biometry authentication is already in progress"),wQ=uQ("authenticate",yQ),[,xQ,kQ]=bQ,[,SQ]=vQ,_Q=lQ("openSettings",(()=>{JK("web_app_biometry_open_settings")})),[CQ,IQ,TQ]=VX((e=>pG.fn((async t=>{const n=await YK("web_app_biometry_request_access",eQ,h(h(h({},e),t),{},{params:{reason:(e||{}).reason||""}})).then(rQ);return n.available||nQ(),OQ(n),n.accessGranted}),e)),"Biometry access request is already in progress"),NQ=uQ("requestAccess",CQ),[,EQ,AQ]=IQ,[,RQ]=TQ;function OQ(e){GX.set(e),vG(ZX,e)}const MQ=uQ("updateToken",(e=>(e||(e={}),YK("web_app_biometry_update_token","biometry_token_updated",h(h({},e),{},{params:{token:e.token||"",reason:e.reason}})).then((e=>e.status)))));Symbol.toStringTag;function PQ(e,t){return _X(e,{isMounted:t})}const DQ=_X,FQ="closingBehavior",[LQ,zQ]=BK(!1),[BQ,qQ]=BK(!1),WQ=PQ(FQ,qQ),jQ=DQ(FQ),VQ=WQ("disableConfirmation",(()=>{HQ(!1)})),UQ=WQ("enableConfirmation",(()=>{HQ(!0)})),GQ=jQ("mount",(()=>{BQ()||(HQ(lK()&&wG(FQ)||!1),BQ.set(!0))}));function HQ(e){e!==LQ()&&(JK("web_app_setup_closing_behavior",{need_confirmation:e}),vG(FQ,e),LQ.set(e))}Symbol.toStringTag;const KQ="web_app_invoke_custom_method",XQ=IX("cloudStorage",KQ),QQ=ZK(KQ),YQ=XQ("deleteItem",((e,t)=>{const n=Array.isArray(e)?e:[e];return n.length?QK("deleteStorageValues",{keys:n},t).then():pG.resolve()}));const JQ=XQ("getItem",(function(e,t){const n=Array.isArray(e)?e:[e];return n.length?QK("getStorageValues",{keys:n},t).then((t=>{const r=h(h({},n.reduce(((e,t)=>(e[t]="",e)),{})),PK(AK(RK(),RK()),t));return"string"==typeof e?r[e]:r})):pG.resolve(Array.isArray(e)?{}:"")})),ZQ=XQ("getKeys",(e=>QK("getStorageKeys",{},e).then((e=>PK(_K(RK()),e))))),$Q=XQ("setItem",((e,t,n)=>QK("saveStorageValue",{key:e,value:t},n).then())),eY=XQ("clear",(e=>ZQ(e).then(YQ))),tY=(Symbol.toStringTag,"web_app_trigger_haptic_feedback"),nY=IX("hapticFeedback",tY),rY=ZK(tY),oY=nY("impactOccurred",(e=>{JK(tY,{type:"impact",impact_style:e})})),aY=nY("notificationOccurred",(e=>{JK(tY,{type:"notification",notification_type:e})})),sY=nY("selectionChanged",(()=>{JK(tY,{type:"selection_change"})})),[iY,cY]=(Symbol.toStringTag,BK(void 0));function lY(e){return zK((()=>{const t=iY();return t?t[e]:void 0}))}const uY=lY("auth_date"),hY=lY("can_send_after"),dY=zK((()=>{const e=uY(),t=hY();return t&&e?new Date(e.getTime()+1e3*t):void 0})),pY=lY("chat"),fY=lY("chat_type"),mY=lY("chat_instance"),gY=lY("hash"),yY=lY("query_id"),[bY,vY]=BK(),wY=lY("receiver");const xY=lY("start_param"),kY=lY("user"),SY=(Symbol.toStringTag,"web_app_open_invoice"),_Y=IX("invoice",SY),CY=ZK(SY);const[IY,TY,NY]=VX((function(e,t,n){let r;if("url"===t){const{hostname:t,pathname:n}=new URL(e,window.location.href);if("t.me"!==t)throw new cX("Link has unexpected hostname: ".concat(t));const o=n.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!o)throw new cX('Expected to receive a link with a pathname in format "/invoice/{slug}" or "/${slug}"');[,,r]=o}else r=e,n=t;return YK(SY,"invoice_closed",h(h({},n),{},{params:{slug:r},capture:e=>r===e.slug})).then((e=>e.status))}),"Invoice is already opened"),EY=_Y("open",IY),[,AY,RY]=TY,[,OY]=NY,MY=(Symbol.toStringTag,"locationManager"),PY="web_app_check_location",DY="web_app_open_location_settings",FY=LK({available:!1,accessGranted:!1,accessRequested:!1});function LY(e){return zK((()=>FY()[e]))}const zY=ZK(PY),BY=LY("available"),qY=LY("accessGranted"),WY=LY("accessRequested");function jY(e){let t,n,r=!1;return e.available&&(r=!0,t=e.access_requested,n=e.access_granted),{available:r,accessGranted:n||!1,accessRequested:t||!1}}const[VY,UY,GY,HY]=UX(MY,(e=>{const t=lK()&&wG(MY);return t?pG.resolve(t):YK("web_app_check_location","location_checked",e).then(jY)}),(e=>{FY.set(e),vG(MY,e)})),KY=IX(MY,PY),XY=CX(MY,HY[0],PY),QY=KY("mount",VY),[,YY,JY]=UY,[,ZY]=GY,[$Y,eJ]=HY,[tJ,nJ,rJ]=VX((e=>YK("web_app_request_location","location_requested",e).then((e=>{if(!e.available)throw FY.set(h(h({},FY()),{},{available:!1})),new nX("Location data tracking is not available");const{available:t}=e;return s(e,FK)}))),"Location request is currently in progress"),oJ=XY("requestLocation",tJ),[,aJ,sJ]=nJ,[,iJ]=rJ,cJ=KY("openSettings",(()=>{JK(DY)}),DY);Symbol.toStringTag;function lJ(e){const t={};for(const n in e){const r=e[n];void 0!==r&&(t[n]=r)}return t}function uJ(e){const t=function(e){const t=e.replace(/\s/g,"").toLowerCase();if(hH(t))return t;if(function(e){return/^#[\da-f]{3}$/i.test(e)}(t)){let e="#";for(let n=0;n<3;n+=1)e+=t[1+n].repeat(2);return e}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error('Value "'.concat(e,'" does not satisfy any of known RGB formats.'));return n.slice(1).reduce(((e,t)=>e+parseInt(t,10).toString(16).padStart(2,"0")),"#")}(e);return Math.sqrt([.299,.587,.114].reduce(((e,n,r)=>{const o=parseInt(t.slice(1+2*r,1+2*(r+1)),16);return e+o*o*n}),0))<120}const[hJ,dJ]=BK(!1),[pJ,fJ]=BK({});function mJ(e){return zK((()=>pJ()[e]))}const gJ=mJ("accent_text_color"),yJ=mJ("bg_color"),bJ=mJ("button_color"),vJ=mJ("button_text_color"),wJ=mJ("bottom_bar_bg_color"),xJ=mJ("destructive_text_color"),kJ=mJ("header_bg_color"),SJ=mJ("hint_color"),_J=zK((()=>{const e=yJ();return!e||uJ(e)})),CJ=mJ("link_color"),IJ=mJ("secondary_bg_color"),TJ=mJ("section_bg_color"),NJ=mJ("section_header_text_color"),EJ=mJ("section_separator_color"),AJ=mJ("subtitle_text_color"),RJ=mJ("text_color");function OJ(e){return zK((()=>PJ()[e]))}const MJ=LK({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,text:"Continue"}),PJ=zK((()=>{const e=MJ();return h(h({},e),{},{backgroundColor:e.backgroundColor||bJ()||"#2481cc",textColor:e.textColor||vJ()||"#ffffff"})})),[DJ,FJ]=BK(!1),LJ=OJ("backgroundColor"),zJ=OJ("hasShineEffect"),BJ=OJ("isEnabled"),qJ=OJ("isLoaderVisible"),WJ=OJ("isVisible"),jJ=OJ("text"),VJ=OJ("textColor"),UJ="main_button_pressed",GJ="mainButton",HJ=DQ(GJ),KJ=PQ(GJ,FJ),XJ=HJ("mount",(()=>{if(!DJ()){const e=lK()&&wG(GJ);e&&MJ.set(e),DJ.set(!0)}})),QJ=HJ("onClick",(e=>PH(UJ,e))),YJ=HJ("offClick",(e=>{DH(UJ,e)})),JJ=KJ("setParams",(e=>{MJ.set(h(h({},MJ()),lJ(e))),vG(GJ,MJ());const t=PJ();t.text&&JK("web_app_setup_main_button",{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,text:t.text,text_color:t.textColor})}));Symbol.toStringTag;function ZJ(e,t){document.documentElement.style.setProperty(e,t)}function $J(e){document.documentElement.style.removeProperty(e)}const eZ="themeParams",tZ="theme_changed",nZ=DQ(eZ),rZ=e=>{let{theme_params:t}=e;pJ.set(t),vG(eZ,t)},[oZ,aZ,sZ,iZ]=UX(eZ,(e=>pG.resolve(lK()&&wG(eZ)||GK().tgWebAppThemeParams||{})),(e=>{PH(tZ,rZ),pJ.set(e)})),cZ=PQ(eZ,iZ[0])("bindCssVars",(e=>{if(hJ())throw new eX;function t(e){Object.entries(pJ()).forEach((t=>{let[n,r]=t;r&&e(n,r)}))}function n(){t(((t,n)=>{ZJ(e(t),n)}))}return e||(e=e=>"--tg-theme-".concat(function(e){return e.replace(/_([a-z])/g,((e,t)=>"-".concat(t.toLowerCase())))}(e))),n(),pJ.sub(n),hJ.set(!0),()=>{t($J),pJ.unsub(n),hJ.set(!1)}})),lZ=nZ("mount",oZ),uZ=aZ[2],hZ=aZ[1],dZ=sZ[1],[pZ,fZ]=iZ,mZ=nZ("mountSync",(()=>{if(!pZ()){const e=lK()&&wG(eZ)||GK().tgWebAppThemeParams||{};PH(tZ,rZ),wH((()=>{pJ.set(e),pZ.set(!0)}))}}));function gZ(e){return zK((()=>yZ(e())))}function yZ(e){return hH(e)?e:fJ()[e]}const[bZ,vZ]=BK("bg_color"),wZ=gZ(bZ),[xZ,kZ]=BK("bottom_bar_bg_color"),SZ=zK((()=>{const e=xZ();return hH(e)?e:fJ()[e]||IJ()})),[_Z,CZ]=BK("bg_color"),IZ=gZ(_Z),[TZ,NZ]=BK(!1),EZ=zK((()=>{const e=wZ();return!!e&&uJ(e)})),[AZ,RZ]=BK(!0),OZ=zK((()=>({backgroundColor:bZ(),bottomBarColor:xZ(),headerColor:_Z(),isActive:AZ()}))),MZ=(Symbol.toStringTag,"web_app_set_background_color"),PZ="web_app_set_bottom_bar_color",DZ="web_app_set_header_color",FZ="visibility_changed",LZ="miniApp",zZ={any:[MZ,PZ,DZ]},BZ=zK((()=>zZ.any.some((e=>cK(e,HK()))))),qZ=e=>{AZ.set(e.is_visible),a$()},WZ=e=>{[[_Z,DZ],[bZ,MZ],[xZ,PZ]].forEach((t=>{let[n,r]=t;const o=n();if(!hH(o)&&(r!==DZ||"bg_color"!==o&&"secondary_bg_color"!==o)){const t=e[o];t&&JK(r,{color:t})}}))},[jZ,VZ,UZ,GZ]=UX(LZ,(e=>lZ(e).then((()=>lK()&&wG(LZ)||void 0))),(e=>{s$.ifAvailable(e?e.backgroundColor:"bg_color"),i$.ifAvailable(e?e.bottomBarColor:"bottom_bar_bg_color"),c$.ifAvailable(e?e.headerColor:"bg_color"),AZ.set(!e||e.isActive),PH(FZ,qZ),fJ.sub(WZ)})),HZ=DQ(LZ),KZ=IX(LZ,zZ),XZ=CX(LZ,GZ[0],zZ),QZ=XZ("bindCssVars",(e=>{if(TZ())throw new eX;const[t,n]=xG();function r(e,n){function r(){ZJ(e,n()||null)}r(),t(n.sub(r),$J.bind(null,e))}return e||(e=e=>"--tg-".concat(gG(e))),r(e("bgColor"),wZ),r(e("bottomBarColor"),SZ),r(e("headerColor"),IZ),t((()=>{TZ.set(!1)})),TZ.set(!0),n})),YZ=HZ("close",(e=>{JK("web_app_close",{return_back:e})})),JZ=KZ("mount",jZ),ZZ=VZ[2],$Z=VZ[1],e$=UZ[1],[t$,n$]=GZ,r$=KZ("mountSync",(()=>{if(!t$()){mZ();const e=lK()&&wG(LZ)||void 0;s$.ifAvailable(e?e.backgroundColor:"bg_color"),i$.ifAvailable(e?e.bottomBarColor:"bottom_bar_bg_color"),c$.ifAvailable(e?e.headerColor:"bg_color"),PH(FZ,qZ),fJ.sub(WZ),wH((()=>{AZ.set(!e||e.isActive),t$.set(!0)}))}})),o$=HZ("ready",(()=>{JK("web_app_ready")}));function a$(){vG(LZ,OZ())}const s$=XZ("setBackgroundColor",(e=>{if(e===bZ())return;const t=yZ(e);if(!t)throw new wX(e);JK(MZ,{color:t}),bZ.set(e),a$()}),MZ),i$=XZ("setBottomBarColor",(e=>{if(e===xZ())return;const t=yZ(e);if(!t)throw new wX(e);JK(PZ,{color:t}),xZ.set(e),a$()}),PZ),c$=XZ("setHeaderColor",(e=>{if(e!==_Z()){if("bg_color"===e||"secondary_bg_color"===e)JK(DZ,{color_key:e});else{const t=yZ(e);if(!t)throw new wX(e);JK(DZ,{color:t})}_Z.set(e),a$()}}),DZ,{rgb:[DZ,"color",hH]});Symbol.toStringTag;function l$(e){const t=e.message.trim(),n=(e.title||"").trim(),r=e.buttons||[];if(n.length>64)throw new cX("Invalid title: ".concat(n));if(!t||t.length>256)throw new cX("Invalid message: ".concat(t));if(r.length>3)throw new cX("Invalid buttons count: ".concat(r.length));return{title:n,message:t,buttons:r.length?r.map(((e,t)=>{const n=e.id||"";if(n.length>64)throw new cX("Button with index ".concat(t," has invalid id: ").concat(n));if(!e.type||"default"===e.type||"destructive"===e.type){const r=e.text.trim();if(!r||r.length>64)throw new cX("Button with index ".concat(t," has invalid text: ").concat(r));return{type:e.type,text:r,id:n}}return{type:e.type,id:n}})):[{type:"close",id:""}]}}const u$="web_app_open_popup",h$=IX("popup",u$),d$=ZK(u$),[p$,f$,m$]=VX((e=>YK(u$,"popup_closed",h(h({},e),{},{params:l$(e)})).then((e=>{let{button_id:t}=e;return void 0===t?null:t}))),"A popup is already opened"),g$=h$("open",p$),y$=f$[1],b$=f$[2],v$=m$[1],w$=h$("show",p$),[,x$,k$]=f$,[,S$]=m$,_$=(Symbol.toStringTag,"web_app_close_scan_qr_popup"),C$="web_app_open_scan_qr_popup",I$=IX("qrScanner",C$),T$=I$("close",(()=>{JK(_$),JX(M$)})),N$=ZK(C$);const[E$,A$,R$]=VX((function(e){e||(e={});const{onCaptured:t,text:n,capture:r}=e,[,o]=xG(PH("scan_qr_popup_closed",(()=>{a.resolve()})),PH("qr_text_received",(e=>{t?t(e.data):(!r||r(e.data))&&(a.resolve(e.data),JK(_$))}))),a=new mG(e);return(e.postEvent||JK)(C$,{text:n}),pG.resolve(a).catch(YX).finally(o)}),"The QR Scanner is already opened"),O$=I$("open",E$),[,M$,P$]=A$,[,D$]=R$;Symbol.toStringTag;function F$(e){return zK((()=>z$()[e]))}const L$=LK({hasShineEffect:!1,isEnabled:!0,isLoaderVisible:!1,isVisible:!1,position:"left",text:"Cancel"}),z$=zK((()=>{const e=L$();return h(h({},e),{},{backgroundColor:e.backgroundColor||SZ()||"#000000",textColor:e.textColor||bJ()||"#2481cc"})})),[B$,q$]=BK(!1),W$=F$("backgroundColor"),j$=F$("hasShineEffect"),V$=F$("isEnabled"),U$=F$("isLoaderVisible"),G$=F$("isVisible"),H$=F$("position"),K$=F$("text"),X$=F$("textColor"),Q$="web_app_setup_secondary_button",Y$="secondary_button_pressed",J$="secondaryButton",Z$=IX(J$,Q$),$$=CX(J$,q$,Q$),e0=ZK(Q$),t0=Z$("mount",(()=>{if(!B$()){const e=lK()&&wG(J$);e&&L$.set(e),B$.set(!0)}})),n0=Z$("onClick",(e=>PH(Y$,e))),r0=Z$("offClick",(e=>{DH(Y$,e)})),o0=$$("setParams",(e=>{L$.set(h(h({},L$()),lJ(e))),vG(J$,L$());const t=z$();t.text&&JK(Q$,{color:t.backgroundColor,has_shine_effect:t.hasShineEffect,is_active:t.isEnabled,is_progress_visible:t.isLoaderVisible,is_visible:t.isVisible,position:t.position,text:t.text,text_color:t.textColor})}));Symbol.toStringTag;const a0="web_app_setup_settings_button",s0="settings_button_pressed",i0="settingsButton",[c0,l0]=BK(!1),[u0,h0]=BK(!1),d0=ZK(a0),p0=IX(i0,a0),f0=CX(i0,u0,a0),m0=f0("hide",(()=>{y0(!1)})),g0=p0("mount",(()=>{u0()||(y0(lK()&&wG(i0)||!1),u0.set(!0))}));function y0(e){e!==c0()&&(JK(a0,{is_visible:e}),vG(i0,e),c0.set(e))}const b0=p0("onClick",(e=>PH(s0,e))),v0=p0("offClick",(e=>{DH(s0,e)})),w0=f0("show",(()=>{y0(!0)}));Symbol.toStringTag;const x0="web_app_setup_swipe_behavior",k0="swipeBehavior",[S0,_0]=BK(!1),C0=ZK(x0),[I0,T0]=BK(!0),N0=IX(k0,x0),E0=CX(k0,S0,x0),A0=E0("disableVertical",(()=>{M0(!1)})),R0=E0("enableVertical",(()=>{M0(!0)})),O0=N0("mount",(()=>{S0()||(M0(lK()&&wG(k0)||!1,!0),S0.set(!0))}));function M0(e,t){(e!==I0()||t)&&(JK(x0,{allow_vertical_swipe:e}),vG(k0,e),I0.set(e))}Symbol.toStringTag;const P0="viewport",D0="fullscreen_changed",F0="safe_area_changed",L0="content_safe_area_changed",z0="viewport_changed",B0=DQ(P0),q0={left:0,top:0,bottom:0,right:0};function W0(e){return Math.max(e,0)}const[j0,V0]=BK({contentSafeAreaInsets:q0,height:0,isExpanded:!1,isFullscreen:!1,safeAreaInsets:q0,stableHeight:0,width:0});function U0(e){return zK((()=>V0()[e]))}const G0=U0("height"),H0=U0("stableHeight"),K0=U0("width"),X0=U0("isExpanded"),Q0=zK((()=>G0()===H0()));function Y0(e){const{height:t,stableHeight:n,width:r}=e;j0.set(h(h({},j0()),lJ(h(h({},e),{},{height:t?W0(t):void 0,width:r?W0(r):void 0,stableHeight:n?W0(n):void 0})))),vG(P0,j0())}function J0(e){return zK((()=>Z0()[e]))}const Z0=U0("contentSafeAreaInsets"),$0=J0("bottom"),e1=J0("left"),t1=J0("right"),n1=J0("top");function r1(e){return zK((()=>o1()[e]))}const o1=U0("safeAreaInsets"),a1=r1("bottom"),s1=r1("left"),i1=r1("right"),c1=r1("top"),l1="web_app_request_safe_area",u1=IX(P0,l1),h1=u1("requestContentSafeAreaInsets",(e=>YK("web_app_request_content_safe_area",L0,e)));const d1=u1("requestSafeAreaInsets",(e=>YK(l1,F0,e))),p1=e=>{const{height:t}=e;Y0({isExpanded:e.is_expanded,height:t,width:e.width,stableHeight:e.is_state_stable?t:void 0})},f1=e=>{Y0({isFullscreen:e.is_fullscreen})},m1=e=>{Y0({safeAreaInsets:e})},g1=e=>{Y0({contentSafeAreaInsets:e})},[y1,b1,v1,w1]=UX(P0,(e=>{const t=lK()&&wG(P0);return t?pG.resolve(t):pG.fn((async e=>{const t=await pG.all([d1.isAvailable()?d1(e):o1(),h1.isAvailable()?h1(e):Z0()]),n=GK(),r={contentSafeAreaInsets:t[1],isFullscreen:!!n.tgWebAppFullscreen,safeAreaInsets:t[0]};if(["macos","tdesktop","unigram","webk","weba","web"].includes(n.tgWebAppPlatform)){const e=window;return h(h({},r),{},{height:e.innerHeight,isExpanded:!0,stableHeight:e.innerHeight,width:e.innerWidth})}return function(e){return YK("web_app_request_viewport",z0,e)}(e).then((e=>h(h({},r),{},{height:e.height,isExpanded:e.is_expanded,stableHeight:e.is_state_stable?e.height:0,width:e.width})))}),e)}),(e=>{PH(z0,p1),PH(D0,f1),PH(F0,m1),PH(L0,g1),Y0(e)})),x1=B0("mount",y1),[,k1,S1]=b1,[,_1]=v1,[C1,I1]=w1;const T1=PQ(P0,C1),[N1,E1]=BK(!1),A1=T1("bindCssVars",(e=>{if(N1())throw new eX;e||(e=e=>"--tg-viewport-".concat(gG(e)));const t=[["height",G0],["stableHeight",H0],["width",K0],["safeAreaInsetTop",c1],["safeAreaInsetBottom",a1],["safeAreaInsetLeft",s1],["safeAreaInsetRight",i1],["contentSafeAreaInsetTop",n1],["contentSafeAreaInsetBottom",$0],["contentSafeAreaInsetLeft",e1],["contentSafeAreaInsetRight",t1]].reduce(((t,n)=>{let[r,o]=n;const a=e(r);if(a){const e=()=>{ZJ(a,"".concat(o(),"px"))};t.push([e,o.sub(e),a])}return t}),[]);return t.forEach((e=>{e[0]()})),N1.set(!0),()=>{t.forEach((e=>{e[1](),$J(e[2])})),N1.set(!1)}})),R1=B0("expand",(()=>{JK("web_app_expand")})),O1="web_app_request_fullscreen",M1=CX(P0,C1,O1),P1=U0("isFullscreen"),[D1,F1]=BK(),[L1,z1]=BK();function B1(e,t){return M1(e,VX((e=>YK(t?O1:"web_app_exit_fullscreen",[D0,"fullscreen_failed"],e).then((e=>{if("error"in e&&"ALREADY_FULLSCREEN"!==e.error)throw new gX(e.error);const t=!("is_fullscreen"in e)||e.is_fullscreen;t!==P1()&&Y0({isFullscreen:t})}))),"Fullscreen mode change is already being requested",{promise:D1,error:L1})[0])}const q1=B1("requestFullscreen",!0),W1=B1("exitFullscreen"),j1=Object.freeze(Object.defineProperty({__proto__:null,bindCssVars:A1,changeFullscreenError:z1,changeFullscreenPromise:F1,contentSafeAreaInsetBottom:$0,contentSafeAreaInsetLeft:e1,contentSafeAreaInsetRight:t1,contentSafeAreaInsetTop:n1,contentSafeAreaInsets:Z0,exitFullscreen:W1,expand:R1,height:G0,isCssVarsBound:E1,isExpanded:X0,isFullscreen:P1,isMounted:I1,isMounting:S1,isStable:Q0,mount:x1,mountError:_1,mountPromise:k1,requestFullscreen:q1,safeAreaInsetBottom:a1,safeAreaInsetLeft:s1,safeAreaInsetRight:i1,safeAreaInsetTop:c1,safeAreaInsets:o1,stableHeight:H0,state:V0,unmount:function(){JX(k1),DH(z0,p1),DH(D0,f1),DH(F0,m1),DH(L0,g1),C1.set(!1)},width:K0},Symbol.toStringTag,{value:"Module"})),V1="web_app_request_emoji_status_access",[U1,G1,H1]=VX((e=>YK(V1,"emoji_status_access_requested",e).then((e=>e.status))),"Emoji status access request is already in progress"),[,K1,X1]=G1,[,Q1]=H1,Y1="web_app_set_emoji_status",[J1,Z1,$1]=VX(((e,t)=>YK(Y1,["emoji_status_set","emoji_status_failed"],h({params:{custom_emoji_id:e,duration:(t||{}).duration}},t)).then((e=>{if(e&&"error"in e)throw new dX(e.error)}))),"Emoji status set request is currently in progress"),[,e2,t2]=Z1,[,n2]=$1,r2="web_app_check_home_screen",[o2,a2,s2]=VX((e=>YK(r2,"home_screen_checked",e).then((e=>e.status||"unknown"))),"Check home screen status request is currently in progress"),[,i2,c2]=a2,[,l2]=s2,u2=(DQ()("openLink",((e,t)=>{if("string"==typeof e)try{e=new URL(e)}catch(n){throw new cX('"'.concat(e.toString(),'" is invalid URL'),n)}t||(t={}),JK("web_app_open_link",{url:e.toString(),try_browser:t.tryBrowser,try_instant_view:t.tryInstantView})})),"web_app_open_tg_link"),h2=DQ()("openTelegramLink",(e=>{const t=e.toString();if(!t.match(/^https:\/\/t.me\/.+/))throw new cX('"'.concat(t,'" is invalid URL'));cK(u2,HK())?(e=new URL(e),JK(u2,{path_full:e.pathname+e.search})):window.location.href=t}));DQ()("shareURL",((e,t)=>{h2("https://t.me/share/url?"+new URLSearchParams({url:e,text:t||""}).toString().replace(/\+/g,"%20"))}));function d2(e,t){return new pG({abortSignal:t,timeout:e}).catch((()=>{}))}const p2="web_app_request_phone",[f2,m2,g2]=VX((e=>YK(p2,"phone_requested",e).then((e=>e.status))),"Phone access request is currently in progress"),y2=SX("requestPhoneAccess",f2,{isSupported:p2}),[,b2,v2]=m2,[,w2]=g2;async function x2(e){const t=PK(RK(),await QK("getRequestedContact",{},h(h({},e),{},{timeout:(e||{}).timeout||5e3})));return{raw:t,parsed:PK(DK(MK([RK(),IK(URLSearchParams)]),nH(TK({contact:DK(RK(),eH(),TK({user_id:NK(),phone_number:RK(),first_name:RK(),last_name:EK(RK())})),auth_date:DK(RK(),xK((e=>new Date(1e3*Number(e)))),CK()),hash:RK()}))),t)}}const[k2,S2,_2]=VX((e=>new pG((async(e,t,n)=>{try{return e(await x2(n))}catch(UG){if(UG instanceof wK)throw UG}if("sent"!==await y2(n))throw new fX("User denied access");let r=50;for(;!n.isAborted();){try{return e(await x2(n))}catch(UG){if(UG instanceof wK)throw UG}await d2(r),r+=50}}),e)),"Contact is already being requested"),[,C2,I2]=S2,[,T2]=_2,N2="web_app_request_write_access",[E2,A2,R2]=VX((e=>YK(N2,"write_access_requested",e).then((e=>e.status))),"Write access request is currently in progress"),[,O2,M2]=A2,[,P2]=R2;const D2=function(){var e;const[t,n]=(0,o.useState)(!1),[r,a]=(0,o.useState)([]),s=e=>{a((t=>[...t,"object"===typeof e?JSON.stringify(e):String(e)]))};(0,o.useEffect)((()=>{var e;s("\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u043b\u043e\u0441\u044c"),s("window.Telegram: "+!!window.Telegram),s("window.Telegram?.WebApp: "+!(null===(e=window.Telegram)||void 0===e||!e.WebApp));try{!function(e){KK(e);const[t,n]=xG(PH("reload_iframe",(()=>{WK().log("Received a request to reload the page"),JK("iframe_will_reload"),window.location.reload()}))),{acceptCustomStyles:r=!0}=e||{};if(r){const e=document.createElement("style");e.id="telegram-custom-styles",document.head.appendChild(e),t(PH("set_custom_style",(t=>{e.innerHTML=t})),(()=>{document.head.removeChild(e)}))}JK("iframe_ready",{reload_supported:!0}),WK().log("The package was initialized")}(),s("SDK \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d");const e=Boolean(j1&&j1.mount&&"function"===typeof j1.mount);var t;if(s("Telegram \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d: "+e),e)j1.mount(),s("Viewport \u0441\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d"),j1.bindCssVars&&"function"===typeof j1.bindCssVars&&(j1.bindCssVars(),s("CSS \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u044b")),j1.expand&&"function"===typeof j1.expand&&(j1.expand(),s("Viewport \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d")),j1.requestFullscreen&&"function"===typeof j1.requestFullscreen&&j1.requestFullscreen().then((()=>{n(!0),s("\u041f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u043d")})).catch((e=>{s("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0443\u0441\u043a\u0435 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0436\u0438\u043c\u0430: "+e.message)}));else s("\u041f\u0440\u043e\u0431\u0443\u0435\u043c \u043d\u0430\u0442\u0438\u0432\u043d\u044b\u0439 API"),null!==(t=window.Telegram)&&void 0!==t&&t.WebApp&&(window.Telegram.WebApp.expand(),s("\u041d\u0430\u0442\u0438\u0432\u043d\u044b\u0439 expand() \u0432\u044b\u0437\u0432\u0430\u043d"),window.Telegram.WebApp.requestFullScreen&&(window.Telegram.WebApp.requestFullScreen(),s("\u041d\u0430\u0442\u0438\u0432\u043d\u044b\u0439 requestFullScreen() \u0432\u044b\u0437\u0432\u0430\u043d"),n(!0)))}catch(r){s("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438: "+r.message)}return()=>{if(j1&&j1.unmount&&"function"===typeof j1.unmount)try{j1.unmount()}catch(r){s("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0440\u0430\u0437\u043c\u043e\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438: "+r.message)}}}),[]);const i=Boolean((null===j1||void 0===j1?void 0:j1.requestFullscreen)||(null===(e=window.Telegram)||void 0===e?void 0:e.WebApp));return(0,St.jsx)(pt,{children:(0,St.jsxs)("div",{className:"App",children:[i&&(0,St.jsx)("button",{onClick:async()=>{try{var e,r,o;if(t)j1.exitFullscreen&&"function"===typeof j1.exitFullscreen?(await j1.exitFullscreen(),n(!1),s("\u0412\u044b\u0448\u043b\u0438 \u0438\u0437 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0436\u0438\u043c\u0430")):null!==(e=window.Telegram)&&void 0!==e&&e.WebApp&&(n(!1),s("\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0436\u0438\u043c\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e (\u043d\u0430\u0442\u0438\u0432\u043d\u044b\u0439 API)"));else j1.requestFullscreen&&"function"===typeof j1.requestFullscreen?(await j1.requestFullscreen(),n(!0),s("\u0412\u043e\u0448\u043b\u0438 \u0432 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c")):null!==(r=window.Telegram)&&void 0!==r&&null!==(o=r.WebApp)&&void 0!==o&&o.requestFullScreen&&(window.Telegram.WebApp.requestFullScreen(),n(!0),s("\u0412\u043e\u0448\u043b\u0438 \u0432 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c (\u043d\u0430\u0442\u0438\u0432\u043d\u044b\u0439 API)"))}catch(a){s("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u0435\u0440\u0435\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0438 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0436\u0438\u043c\u0430: "+a.message)}},className:"fullscreen-button",children:t?"\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u0430":"\u041f\u043e\u043b\u043d\u044b\u0439 \u044d\u043a\u0440\u0430\u043d"}),(0,St.jsxs)("nav",{children:[(0,St.jsx)(mt,{to:"/",children:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"}),(0,St.jsx)(mt,{to:"/sequencer",children:"\u0421\u0435\u043a\u0432\u0435\u043d\u0441\u043e\u0440"}),(0,St.jsx)(mt,{to:"/savedsessions",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0435 \u0441\u0435\u0441\u0441\u0438\u0438"})]}),(0,St.jsxs)(Oe,{children:[(0,St.jsx)(Ae,{path:"/",element:(0,St.jsx)("div",{className:"cover-container",children:(0,St.jsx)("img",{src:"cover.PNG",alt:"\u041e\u0431\u043b\u043e\u0436\u043a\u0430",className:"cover-image"})})}),(0,St.jsx)(Ae,{path:"/sequencer",element:(0,St.jsx)(AU,{})}),(0,St.jsx)(Ae,{path:"/savedsessions",element:(0,St.jsx)(RU,{})})]})]})})};a.createRoot(document.getElementById("root")).render((0,St.jsx)(o.StrictMode,{children:(0,St.jsx)(D2,{})}))})()})();
//# sourceMappingURL=main.409b7fee.js.map